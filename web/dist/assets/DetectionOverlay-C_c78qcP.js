import{c as B}from"./preact-app-B0bKZ_VW.js";function v(e,n){e&&(e.stopPropagation(),e.preventDefault()),console.log("DIRECT EXIT FUNCTION CALLED");const o=document.getElementById("live-page");if(!o){console.error("Live page element not found");return}o.classList.remove("fullscreen-mode"),document.body.style.overflow="";const t=document.querySelector(".fullscreen-exit");t?t.remove():console.warn("Exit button not found when trying to remove it");const i=document.getElementById("fullscreen-btn");i?i.style.display="":console.warn("Fullscreen button not found when trying to show it again"),window._fullscreenEscapeHandler&&(document.removeEventListener("keydown",window._fullscreenEscapeHandler),delete window._fullscreenEscapeHandler),n(!1),console.log("Fullscreen mode exited, state set to false")}function $(e,n){console.log("toggleFullscreen called, current state:",e);const o=document.getElementById("live-page");if(!o){console.error("Live page element not found");return}const t=o.classList.contains("fullscreen-mode");if(console.log("DOM check for fullscreen mode:",t),t)v(null,n);else{console.log("Entering fullscreen mode"),o.classList.add("fullscreen-mode"),document.body.style.overflow="hidden";const i=document.createElement("button");i.className="fullscreen-exit fixed top-4 right-4 w-10 h-10 bg-black/70 text-white rounded-full flex justify-center items-center cursor-pointer z-50 transition-all duration-200 hover:bg-black/85 hover:scale-110 shadow-md",i.innerHTML="âœ•";const a=function(d){console.log("Exit button clicked - STANDALONE HANDLER"),v(d,n)};i.addEventListener("click",a),o.appendChild(i);const r=document.getElementById("fullscreen-btn");r&&(r.style.display="none");const f=function(d){d.key==="Escape"&&(console.log("Escape key pressed in fullscreen mode"),v(null,n))};window._fullscreenEscapeHandler=f,document.addEventListener("keydown",f),n(!0),console.log("Fullscreen mode entered, state set to true")}}function F(e){const n="video-".concat(e.replace(/\s+/g,"-")),o=document.getElementById(n),t=o?o.closest(".video-cell"):null;if(!t){console.error("Stream not found:",e);return}document.fullscreenElement?document.exitFullscreen():t.requestFullscreen().catch(i=>{console.error("Error attempting to enable fullscreen: ".concat(i.message)),B("Could not enable fullscreen mode: ".concat(i.message))})}function R(e,n,o,t){t[e]&&clearInterval(t[e]);const i=c=>{const l=n,s=l.getContext("2d");if(l.width=o.clientWidth,l.height=o.clientHeight,s.clearRect(0,0,l.width,l.height),!c||c.length===0)return;const y=o.videoWidth,E=o.videoHeight;if(!y||!E){console.log("Video dimensions not available yet, skipping detection drawing");return}const w=y/E,k=l.width/l.height;let g,h,x=0,b=0;w>k?(g=l.width,h=l.width/w,b=(l.height-h)/2):(h=l.height,g=l.height*w,x=(l.width-g)/2),c.forEach(u=>{const p=u.x*g+x,m=u.y*h+b,L=u.width*g,C=u.height*h;s.strokeStyle="rgba(255, 0, 0, 0.8)",s.lineWidth=3,s.strokeRect(p,m,L,C);const I="".concat(u.label," (").concat(Math.round(u.confidence*100),"%)");s.font="14px Arial";const H=s.measureText(I).width;s.fillStyle="rgba(255, 0, 0, 0.7)",s.fillRect(p,m-20,H+10,20),s.fillStyle="white",s.fillText(I,p+5,m-5)})};let a=0,r=1e3;const f=()=>{o.videoWidth&&fetch("/api/detection/results/".concat(encodeURIComponent(e))).then(c=>{if(!c.ok)throw new Error("Failed to fetch detection results: ".concat(c.status));return a=0,c.json()}).then(c=>{c&&c.detections&&i(c.detections)}).catch(c=>{console.error("Error fetching detection results for ".concat(e,":"),c),n.getContext("2d").clearRect(0,0,n.width,n.height),a++,a>3&&(clearInterval(t[e]),r=Math.min(5e3,r*2),console.log("Reducing detection polling frequency to ".concat(r,"ms due to errors")),t[e]=setInterval(f,r))})},d=setInterval(f,r);return t[e]=d,n.detectionInterval=d,d}function S(e,n){const o="canvas-".concat(e.replace(/\s+/g,"-")),t=document.getElementById(o);t&&t.detectionInterval&&(clearInterval(t.detectionInterval),delete t.detectionInterval),n[e]&&(clearInterval(n[e]),delete n[e])}export{F as a,S as c,v as e,R as s,$ as t};
//# sourceMappingURL=DetectionOverlay-C_c78qcP.js.map
