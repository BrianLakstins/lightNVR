import{d as w,q as g,s as r,y as k,u as p}from"./query-client-CKvJ69Lv.js";import{c as v}from"./UI-QFITwjX7.js";function f(){const[n,c]=w({canvas:null,fileName:null}),m=g((o,i)=>{console.log("Taking snapshot of stream with ID: ".concat(o));const l=document.querySelector('.snapshot-btn[data-id="'.concat(o,'"]'));let e;if(l)e=l.getAttribute("data-name");else if(i){const s=i.currentTarget||i.target,h=s?s.closest(".video-cell"):null;h&&(e=h.dataset.streamName)}if(!e){console.error("Stream name not found for ID:",o),r("Cannot take snapshot: Stream not identified","error");return}const a="video-".concat(e.replace(/\s+/g,"-")),d=document.getElementById(a);if(!d){console.error("Video element not found for stream:",e);return}const t=document.createElement("canvas");if(t.width=d.videoWidth,t.height=d.videoHeight,t.width===0||t.height===0){console.error("Invalid video dimensions:",t.width,t.height),r("Cannot take snapshot: Video not loaded or has invalid dimensions");return}t.getContext("2d").drawImage(d,0,0,t.width,t.height);try{const s=new Date().toISOString().replace(/[:.]/g,"-"),h="snapshot-".concat(e.replace(/\s+/g,"-"),"-").concat(s,".jpg");c({canvas:t,fileName:h}),v(t.toDataURL("image/jpeg",.95),"Snapshot: ".concat(e)),r("Snapshot taken successfully")}catch(s){console.error("Error creating snapshot:",s),r("Failed to create snapshot: "+s.message)}},[]),u=g(()=>{const{canvas:o,fileName:i}=n;if(!o){console.error("No snapshot canvas available"),r("Download failed: No snapshot data available");return}o.toBlob(function(l){if(!l){console.error("Failed to create blob from canvas"),r("Download failed: Unable to create image data");return}console.log("Created blob:",l.size,"bytes");const e=URL.createObjectURL(l);console.log("Created blob URL:",e);const a=document.createElement("a");a.href=e,a.download=i||"snapshot.jpg",document.body.appendChild(a),console.log("Added download link to document"),a.click(),setTimeout(()=>{document.body.contains(a)&&document.body.removeChild(a),URL.revokeObjectURL(e),console.log("Cleaned up download resources")},1e3),r("Download started")},"image/jpeg",.95)},[n]);return{takeSnapshot:m,downloadSnapshot:u,hasSnapshot:!!n.canvas}}function y(){const{takeSnapshot:n,downloadSnapshot:c}=f();return k(()=>(window.takeSnapshot=n,()=>{delete window.takeSnapshot}),[n]),null}function D({streamId:n,streamName:c}){const{takeSnapshot:m}=f();return p("button",{className:"snapshot-btn",title:"Take Snapshot","data-id":n,"data-name":c,onClick:o=>{o.preventDefault(),o.stopPropagation(),m(n,o)},children:p("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"white","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",children:[p("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),p("circle",{cx:"12",cy:"13",r:"4"})]})})}export{D as SnapshotButton,y as SnapshotManager,f as useSnapshotManager};
//# sourceMappingURL=SnapshotManager-aeto7uun.js.map
