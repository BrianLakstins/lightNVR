const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./preact-app-BgFzbx9V.js","./preact-app-BxuTjwGD.css"])))=>i.map(i=>d[i]);
var _=Object.freeze,de=Object.defineProperty;var n=(s,a)=>_(de(s,"raw",{value:_(a||s.slice())}));import{h as i,d as x,A as ie,q as p,y as I,_ as ce,c as h}from"./preact-app-BgFzbx9V.js";import{c as ue,f as $,e as be}from"./fetch-utils-GN-4zfXA.js";const E={0:"Admin",1:"User",2:"Viewer",3:"API"};var j,K;function pe({users:s,onEdit:a,onDelete:l,onApiKey:u}){const b=(e,r)=>{r.preventDefault(),r.stopPropagation(),a(e)},c=(e,r)=>{r.preventDefault(),r.stopPropagation(),l(e)},d=(e,r)=>{r.preventDefault(),r.stopPropagation(),u(e)};return i(K||(K=n(['\n    <div class="overflow-x-auto">\n      <table class="w-full border-collapse">\n        <thead class="bg-gray-50 dark:bg-gray-700">\n          <tr>\n            <th class="py-3 px-6 text-left font-semibold">ID</th>\n            <th class="py-3 px-6 text-left font-semibold">Username</th>\n            <th class="py-3 px-6 text-left font-semibold">Email</th>\n            <th class="py-3 px-6 text-left font-semibold">Role</th>\n            <th class="py-3 px-6 text-left font-semibold">Status</th>\n            <th class="py-3 px-6 text-left font-semibold">Last Login</th>\n            <th class="py-3 px-6 text-left font-semibold">Actions</th>\n          </tr>\n        </thead>\n        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">\n          ',"\n        </tbody>\n      </table>\n    </div>\n  "])),s.map(e=>i(j||(j=n(["\n            <tr key=",' class="hover:bg-gray-100 dark:hover:bg-gray-600">\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">\n                <span class=',">\n                  ",'\n                </span>\n              </td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">\n                <div class="flex space-x-2">\n                  <button \n                    class="p-1 text-blue-600 hover:text-blue-800 rounded hover:bg-blue-100 transition-colors"\n                    onClick=','\n                    title="Edit User"\n                  >\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />\n                    </svg>\n                  </button>\n                  <button \n                    class="p-1 text-red-600 hover:text-red-800 rounded hover:bg-red-100 transition-colors"\n                    onClick=','\n                    title="Delete User"\n                  >\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />\n                    </svg>\n                  </button>\n                  <button \n                    class="p-1 text-gray-600 hover:text-gray-800 rounded hover:bg-gray-100 transition-colors"\n                    onClick=','\n                    title="Manage API Key"\n                  >\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />\n                    </svg>\n                  </button>\n                </div>\n              </td>\n            </tr>\n          '])),e.id,e.id,e.username,e.email||"-",E[e.role]||"Unknown","inline-block px-2 py-1 text-xs font-semibold rounded-full ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),e.is_active?"Active":"Inactive",e.last_login?new Date(e.last_login*1e3).toLocaleString():"Never",r=>b(e,r),r=>c(e,r),r=>d(e,r))))}var M,T;function S({formData:s,handleInputChange:a,handleAddUser:l,onClose:u}){const b=d=>{d.preventDefault(),d.stopPropagation(),l(d)},c=d=>{d.stopPropagation()};return i(T||(T=n(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">Add New User</h2>\n        \n        <form onSubmit=','>\n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="username">\n              Username\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="username"\n              type="text"\n              name="username"\n              value=',"\n              onChange=",'\n              required\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="password">\n              Password\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="password"\n              type="password"\n              name="password"\n              value=',"\n              onChange=",'\n              required\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="email">\n              Email\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="email"\n              type="email"\n              name="email"\n              value=',"\n              onChange=",'\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="role">\n              Role\n            </label>\n            <select\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="role"\n              name="role"\n              value=',"\n              onChange=","\n            >\n              ",'\n            </select>\n          </div>\n          \n          <div class="mb-6">\n            <label class="flex items-center">\n              <input\n                type="checkbox"\n                name="is_active"\n                checked=',"\n                onChange=",'\n                class="mr-2"\n              />\n              <span class="text-sm font-bold">Active</span>\n            </label>\n          </div>\n          \n          <div class="flex justify-end mt-6">\n            <button\n              type="button"\n              class="px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2"\n              onClick=','\n            >\n              Cancel\n            </button>\n            <button\n              type="submit"\n              class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"\n            >\n              Add User\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  '])),u,c,b,s.username,a,s.password,a,s.email,a,s.role,a,Object.entries(E).map(([d,e])=>i(M||(M=n(["\n                <option value=",">","</option>\n              "])),d,e)),s.is_active,a,u)}var L,O;function ge({currentUser:s,formData:a,handleInputChange:l,handleEditUser:u,onClose:b}){const c=e=>{e.preventDefault(),e.stopPropagation(),u(e)},d=e=>{e.stopPropagation()};return i(O||(O=n(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">Edit User: ',"</h2>\n        \n        <form onSubmit=",'>\n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="username">\n              Username\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="username"\n              type="text"\n              name="username"\n              value=',"\n              onChange=",'\n              required\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="password">\n              Password (leave blank to keep current)\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="password"\n              type="password"\n              name="password"\n              value=',"\n              onChange=",'\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="email">\n              Email\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="email"\n              type="email"\n              name="email"\n              value=',"\n              onChange=",'\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="role">\n              Role\n            </label>\n            <select\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="role"\n              name="role"\n              value=',"\n              onChange=","\n            >\n              ",'\n            </select>\n          </div>\n          \n          <div class="mb-6">\n            <label class="flex items-center">\n              <input\n                type="checkbox"\n                name="is_active"\n                checked=',"\n                onChange=",'\n                class="mr-2"\n              />\n              <span class="text-sm font-bold">Active</span>\n            </label>\n          </div>\n          \n          <div class="flex justify-end mt-6">\n            <button\n              type="button"\n              class="px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2"\n              onClick=','\n            >\n              Cancel\n            </button>\n            <button\n              type="submit"\n              class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"\n            >\n              Update User\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  '])),b,d,s.username,c,a.username,l,a.password,l,a.email,l,a.role,l,Object.entries(E).map(([e,r])=>i(L||(L=n(["\n                <option value=",">","</option>\n              "])),e,r)),a.is_active,l,b)}var R;function ye({currentUser:s,handleDeleteUser:a,onClose:l}){const u=c=>{c.stopPropagation(),a()},b=c=>{c.stopPropagation()};return i(R||(R=n(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">Delete User</h2>\n        \n        <p class="mb-6">\n          Are you sure you want to delete the user "','"? This action cannot be undone.\n        </p>\n        \n        <div class="flex justify-end">\n          <button\n            class="px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2"\n            onClick=','\n          >\n            Cancel\n          </button>\n          <button\n            class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"\n            onClick=',"\n          >\n            Delete User\n          </button>\n        </div>\n      </div>\n    </div>\n  "])),l,b,s.username,l,u)}var q,z,B;function he({currentUser:s,newApiKey:a,handleGenerateApiKey:l,copyApiKey:u,onClose:b}){const c=d=>{d.stopPropagation()};return i(B||(B=n(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">API Key for ','</h2>\n        \n        <div class="mb-6">\n          ','\n        </div>\n        \n        <div class="flex justify-end">\n          <button\n            class="px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500"\n            onClick=',"\n          >\n            Close\n          </button>\n        </div>\n      </div>\n    </div>\n  "])),b,c,s.username,a?i(q||(q=n(['\n            <div class="mb-4">\n              <label class="block text-sm font-bold mb-2">\n                API Key\n              </label>\n              <div class="flex">\n                <input\n                  class="shadow appearance-none border rounded-l w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n                  type="text"\n                  value=','\n                  readonly\n                />\n                <button\n                  class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r"\n                  onClick=','\n                >\n                  Copy\n                </button>\n              </div>\n              <p class="text-sm text-gray-600 dark:text-gray-300 mt-2">\n                This key will only be shown once. Save it securely.\n              </p>\n            </div>\n          '])),a,u):i(z||(z=n(['\n            <p class="mb-4">\n              Generate a new API key for this user. This will invalidate any existing API key.\n            </p>\n            <button\n              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4"\n              onClick=',"\n            >\n              Generate New API Key\n            </button>\n          "])),l),b)}var H,N,F,G,V,J,Q,W;function me(){const[s,a]=x([]),[l,u]=x(!0),[b,c]=x(null),[d,e]=x(null),[r,A]=x(null),[U,k]=x(""),[m,C]=x({username:"",password:"",email:"",role:1,is_active:!0}),v=ie(null),g=p(()=>{const t=localStorage.getItem("auth");return t?{Authorization:"Basic "+t}:{}},[]),y=p(async()=>{var t;u(!0);try{const o=await $("/api/auth/users",{headers:g(),cache:"no-store",signal:(t=v.current)==null?void 0:t.signal,timeout:15e3,retries:2,retryDelay:1e3});a(o.users||[]),c(null)}catch(o){o.message!=="Request was cancelled"&&(console.error("Error fetching users:",o),c("Failed to load users. Please try again."))}finally{u(!1)}},[g]);I(()=>(v.current=ue(),y(),()=>{v.current&&v.current.abort()}),[y]),I(()=>{const t=document.getElementById("add-user-btn");if(t){const o=()=>{C({username:"",password:"",email:"",role:1,is_active:!0}),e("add")};return t.addEventListener("click",o),()=>{t&&t.removeEventListener("click",o)}}},[]);const P=p(t=>{const{name:o,value:f,type:se,checked:ne}=t.target;C(le=>({...le,[o]:se==="checkbox"?ne:o==="role"?parseInt(f,10):f}))},[]),D=p(async t=>{var o;t&&t.preventDefault();try{console.log("Adding user:",m.username),await $("/api/auth/users",{method:"POST",headers:{"Content-Type":"application/json",...g()},body:JSON.stringify(m),signal:(o=v.current)==null?void 0:o.signal,timeout:15e3,retries:1,retryDelay:1e3}),e(null),h("User added successfully","success",5e3),await y()}catch(f){console.error("Error adding user:",f),h("Error adding user: ".concat(f.message),"error",8e3)}},[m,g,y]),Y=p(async t=>{var o;t&&t.preventDefault();try{console.log("Editing user:",r.id,r.username),await $("/api/auth/users/".concat(r.id),{method:"PUT",headers:{"Content-Type":"application/json",...g()},body:JSON.stringify(m),signal:(o=v.current)==null?void 0:o.signal,timeout:15e3,retries:1,retryDelay:1e3}),e(null),h("User updated successfully","success",5e3),await y()}catch(f){console.error("Error updating user:",f),h("Error updating user: ".concat(f.message),"error",8e3)}},[r,m,g,y]),Z=p(async()=>{var t;try{console.log("Deleting user:",r.id,r.username),await be("/api/auth/users/".concat(r.id),{method:"DELETE",headers:g(),signal:(t=v.current)==null?void 0:t.signal,timeout:15e3,retries:1,retryDelay:1e3}),e(null),h("User deleted successfully","success",5e3),await y()}catch(o){console.error("Error deleting user:",o),h("Error deleting user: ".concat(o.message),"error",8e3)}},[r,g,y]),ee=p(async()=>{var t;k("Generating...");try{console.log("Generating API key for user:",r.id,r.username);const o=await $("/api/auth/users/".concat(r.id,"/api-key"),{method:"POST",headers:g(),signal:(t=v.current)==null?void 0:t.signal,timeout:2e4,retries:1,retryDelay:2e3});k(o.api_key),h("API key generated successfully","success"),await y()}catch(o){console.error("Error generating API key:",o),k(""),h("Error generating API key: ".concat(o.message),"error")}},[r,g,y]),te=p(()=>{navigator.clipboard.writeText(U).then(()=>{window.showSuccessToast?window.showSuccessToast("API key copied to clipboard"):h("API key copied to clipboard","success")}).catch(t=>{console.error("Error copying API key:",t),window.showErrorToast?window.showErrorToast("Failed to copy API key"):h("Failed to copy API key","error")})},[U]),re=p(t=>{A(t),C({username:t.username,password:"",email:t.email||"",role:t.role,is_active:t.is_active}),e("edit")},[]),ae=p(t=>{A(t),e("delete")},[]),oe=p(t=>{A(t),k(""),e("apiKey")},[]),w=p(()=>{e(null)},[]);return l&&s.length===0?i(H||(H=n(['\n      <div class="flex justify-center items-center p-8">\n        <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>\n        <span class="sr-only">Loading...</span>\n      </div>\n    ']))):s.length===0&&!l?i(F||(F=n(['\n      <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-4">\n        <h4 class="font-bold mb-2">No Users Found</h4>\n        <p>Click the "Add User" button to create your first user.</p>\n      </div>\n      ',"\n    "])),d==="add"&&i(N||(N=n(["<"," \n        formData="," \n        handleInputChange="," \n        handleAddUser="," \n        onClose="," \n      />"])),S,m,P,D,w)):i(W||(W=n(["\n    <div>\n      <"," \n        users="," \n        onEdit="," \n        onDelete="," \n        onApiKey="," \n      />\n      \n      ","\n      \n      ","\n      \n      ","\n      \n      ","\n    </div>\n  "])),pe,s,re,ae,oe,d==="add"&&i(G||(G=n(["<"," \n        formData="," \n        handleInputChange="," \n        handleAddUser="," \n        onClose="," \n      />"])),S,m,P,D,w),d==="edit"&&i(V||(V=n(["<"," \n        currentUser="," \n        formData="," \n        handleInputChange="," \n        handleEditUser="," \n        onClose="," \n      />"])),ge,r,m,P,Y,w),d==="delete"&&i(J||(J=n(["<"," \n        currentUser="," \n        handleDeleteUser="," \n        onClose="," \n      />"])),ye,r,Z,w),d==="apiKey"&&i(Q||(Q=n(["<"," \n        currentUser="," \n        newApiKey="," \n        handleGenerateApiKey="," \n        copyApiKey="," \n        onClose="," \n      />"])),he,r,U,ee,te,w))}var X;function we(){const s=document.getElementById("users-container");s&&ce(async()=>{const{render:a}=await import("./preact-app-BgFzbx9V.js").then(l=>l.p);return{render:a}},__vite__mapDeps([0,1]),import.meta.url).then(({render:a})=>{a(i(X||(X=n(["<"," />"])),me),s)})}export{me as UsersView,we as loadUsersView};
//# sourceMappingURL=UsersView-UoI6Znfy.js.map
