{"version":3,"mappings":"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","names":["StreamDeleteModal","streamId","streamName","onClose","onDisable","onDelete","isConfirmDelete","setIsConfirmDelete","useState","showDeleteConfirmation","handleDisable","handleDelete","html","_c","__template","_b","_a","StreamsView","streams","setStreams","modalVisible","setModalVisible","onvifModalVisible","setOnvifModalVisible","discoveredDevices","setDiscoveredDevices","deviceProfiles","setDeviceProfiles","selectedDevice","setSelectedDevice","selectedProfile","setSelectedProfile","isDiscovering","setIsDiscovering","onvifCredentials","setOnvifCredentials","currentStream","setCurrentStream","detectionModels","setDetectionModels","isEditing","setIsEditing","deleteModalVisible","setDeleteModalVisible","streamToDelete","setStreamToDelete","isLoading","setIsLoading","hasData","setHasData","requestControllerRef","useRef","useEffect","createRequestController","loadStreams","loadDetectionModels","streamsData","fetchJSON","error","showStatusMessage","data","openAddStreamModal","openEditStreamModal","stream","closeModal","handleInputChange","name","value","type","checked","prev","handleThresholdChange","saveStream","streamData","url","enhancedFetch","testStreamConnection","openDeleteModal","closeDeleteModal","disableStream","deleteStream","handleCredentialChange","startOnvifDiscovery","isLoadingProfiles","setIsLoadingProfiles","getDeviceProfiles","device","customStreamName","setCustomStreamName","showCustomNameInput","setShowCustomNameInput","addOnvifDeviceAsStream","profile","defaultStreamName","isAddingStream","setIsAddingStream","submitOnvifDevice","testOnvifConnection","currentCredentials","_r","ContentLoader","_d","_e","_g","model","_f","_o","_h","_j","_i","_l","_k","_n","_m","_q","_p","loadStreamsView","mainContent","__vitePreload","render","n","_s"],"ignoreList":[],"sources":["../../js/components/preact/StreamDeleteModal.js","../../js/components/preact/StreamsView.js"],"sourcesContent":["/**\n * LightNVR Web Interface Stream Delete Modal Component\n * Preact component for the stream delete modal\n */\n\nimport { h } from '../../preact.min.js';\nimport { html } from '../../html-helper.js';\nimport { useState } from '../../preact.hooks.module.js';\n\n/**\n * StreamDeleteModal component\n * @param {Object} props Component props\n * @param {string} props.streamId ID of the stream to delete\n * @param {string} props.streamName Name of the stream to display\n * @param {Function} props.onClose Function to call when the modal is closed\n * @param {Function} props.onDisable Function to call when the disable button is clicked\n * @param {Function} props.onDelete Function to call when the delete button is clicked\n * @returns {JSX.Element} StreamDeleteModal component\n */\nexport function StreamDeleteModal({ streamId, streamName, onClose, onDisable, onDelete }) {\n  const [isConfirmDelete, setIsConfirmDelete] = useState(false);\n  \n  // Show delete confirmation step\n  const showDeleteConfirmation = () => {\n    setIsConfirmDelete(true);\n  };\n  \n  // Handle disable stream\n  const handleDisable = () => {\n    onDisable(streamId);\n    onClose();\n  };\n  \n  // Handle delete stream\n  const handleDelete = () => {\n    onDelete(streamId);\n    onClose();\n  };\n  \n  return html`\n    <div class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300\">\n      <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full\">\n        <div class=\"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-lg font-medium\">${isConfirmDelete ? 'Confirm Permanent Deletion' : 'Stream Actions'}</h3>\n          <span class=\"text-2xl cursor-pointer\" onClick=${onClose}>×</span>\n        </div>\n        \n        <div class=\"p-6\">\n          ${!isConfirmDelete ? html`\n            <div class=\"mb-6\">\n              <h4 class=\"text-lg font-medium mb-2\">What would you like to do with \"${streamName}\"?</h4>\n              <p class=\"text-gray-600 dark:text-gray-400 mb-4\">\n                Please choose one of the following options:\n              </p>\n              \n              <div class=\"space-y-4\">\n                <div class=\"p-4 border border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-900/30 rounded-lg\">\n                  <h5 class=\"font-medium text-yellow-800 dark:text-yellow-500 mb-2\">Disable Stream (Soft Delete)</h5>\n                  <p class=\"text-gray-600 dark:text-gray-400 mb-2\">\n                    This option will disable the stream but keep its configuration in the database. You can re-enable it later.\n                  </p>\n                  <ul class=\"list-disc list-inside text-sm text-gray-600 dark:text-gray-400 mb-3\">\n                    <li>Stream will stop processing</li>\n                    <li>Live streaming will be disabled</li>\n                    <li>Recording will be disabled</li>\n                    <li>Audio recording will be disabled</li>\n                    <li>Detection-based recording will be disabled</li>\n                    <li>Configuration is preserved</li>\n                    <li>Existing recordings are kept</li>\n                    <li>Can be re-enabled later</li>\n                  </ul>\n                  <button \n                    class=\"w-full px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n                    onClick=${handleDisable}\n                  >\n                    Disable Stream\n                  </button>\n                </div>\n                \n                <div class=\"p-4 border border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-900/30 rounded-lg\">\n                  <h5 class=\"font-medium text-red-800 dark:text-red-500 mb-2\">Delete Stream (Permanent)</h5>\n                  <p class=\"text-gray-600 dark:text-gray-400 mb-2\">\n                    This option will permanently delete the stream configuration from the database. This action cannot be undone.\n                  </p>\n                  <ul class=\"list-disc list-inside text-sm text-gray-600 dark:text-gray-400 mb-3\">\n                    <li>Stream will be completely removed</li>\n                    <li>Configuration is deleted</li>\n                    <li>Recordings remain accessible</li>\n                    <li>Cannot be recovered</li>\n                  </ul>\n                  <button \n                    class=\"w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n                    onClick=${showDeleteConfirmation}\n                  >\n                    Delete Stream\n                  </button>\n                </div>\n              </div>\n            </div>\n          ` : html`\n            <div class=\"mb-6\">\n              <div class=\"flex items-center justify-center mb-4 text-red-600 dark:text-red-500\">\n                <svg class=\"w-12 h-12\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                  <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"></path>\n                </svg>\n              </div>\n              <h4 class=\"text-lg font-medium mb-2 text-center\">Are you sure you want to permanently delete \"${streamName}\"?</h4>\n              <p class=\"text-gray-600 dark:text-gray-400 mb-4 text-center\">\n                This action cannot be undone. The stream configuration will be permanently removed from the database.\n              </p>\n            </div>\n            \n            <div class=\"flex justify-center space-x-3\">\n              <button \n                class=\"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n                onClick=${() => setIsConfirmDelete(false)}\n              >\n                Cancel\n              </button>\n              <button \n                class=\"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n                onClick=${handleDelete}\n              >\n                Yes, Delete Permanently\n              </button>\n            </div>\n          `}\n        </div>\n      </div>\n    </div>\n  `;\n}\n","/**\n * LightNVR Web Interface StreamsView Component\n * Preact component for the streams page\n */\n\nimport { h } from '../../preact.min.js';\nimport { html } from '../../html-helper.js';\nimport { useState, useEffect, useRef } from '../../preact.hooks.module.js';\nimport { showStatusMessage } from './UI.js';\nimport { ContentLoader } from './LoadingIndicator.js';\nimport { fetchJSON, enhancedFetch, createRequestController } from '../../fetch-utils.js';\nimport { StreamDeleteModal } from './StreamDeleteModal.js';\n\n/**\n * StreamsView component\n * @returns {JSX.Element} StreamsView component\n */\nexport function StreamsView() {\n  const [streams, setStreams] = useState([]);\n  const [modalVisible, setModalVisible] = useState(false);\n  const [onvifModalVisible, setOnvifModalVisible] = useState(false);\n  const [discoveredDevices, setDiscoveredDevices] = useState([]);\n  const [deviceProfiles, setDeviceProfiles] = useState([]);\n  const [selectedDevice, setSelectedDevice] = useState(null);\n  const [selectedProfile, setSelectedProfile] = useState(null);\n  const [isDiscovering, setIsDiscovering] = useState(false);\n  const [onvifCredentials, setOnvifCredentials] = useState({\n    username: '',\n    password: ''\n  });\n  const [currentStream, setCurrentStream] = useState({\n    name: '',\n    url: '',\n    enabled: true,\n    streamingEnabled: true,\n    width: 1280,\n    height: 720,\n    fps: 15,\n    codec: 'h264',\n    protocol: '0',\n    priority: '5',\n    segment: 30,\n    record: true,\n    detectionEnabled: false,\n    detectionModel: '',\n    detectionThreshold: 50,\n    detectionInterval: 10,\n    preBuffer: 10,\n    postBuffer: 30\n  });\n  const [detectionModels, setDetectionModels] = useState([]);\n  const [isEditing, setIsEditing] = useState(false);\n  \n  // State for delete modal\n  const [deleteModalVisible, setDeleteModalVisible] = useState(false);\n  const [streamToDelete, setStreamToDelete] = useState(null);\n  \n  // State for loading and data status\n  const [isLoading, setIsLoading] = useState(false);\n  const [hasData, setHasData] = useState(false);\n\n  // Request controller for cancelling requests on unmount\n  const requestControllerRef = useRef(null);\n\n  // Load streams on mount\n  useEffect(() => {\n    // Create a new request controller\n    requestControllerRef.current = createRequestController();\n    \n    loadStreams();\n    loadDetectionModels();\n    \n    // Clean up and cancel pending requests on unmount\n    return () => {\n      if (requestControllerRef.current) {\n        requestControllerRef.current.abort();\n      }\n    };\n  }, []);\n  \n  // Load streams from API\n  const loadStreams = async () => {\n    try {\n      setIsLoading(true);\n      setHasData(false);\n      \n      const data = await fetchJSON('/api/streams', {\n        signal: requestControllerRef.current?.signal,\n        timeout: 15000, // 15 second timeout\n        retries: 2,     // Retry twice\n        retryDelay: 1000 // 1 second between retries\n      });\n      \n      const streamsData = data || [];\n      setStreams(streamsData);\n      setHasData(streamsData.length > 0);\n    } catch (error) {\n      // Only show error if the request wasn't cancelled\n      if (error.message !== 'Request was cancelled') {\n        console.error('Error loading streams:', error);\n        showStatusMessage('Error loading streams: ' + error.message);\n        setHasData(false);\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  \n  // Load detection models from API\n  const loadDetectionModels = async () => {\n    try {\n      const data = await fetchJSON('/api/detection/models', {\n        signal: requestControllerRef.current?.signal,\n        timeout: 10000, // 10 second timeout\n        retries: 1,     // Retry once\n        retryDelay: 500 // 0.5 second between retries\n      });\n      \n      setDetectionModels(data.models || []);\n    } catch (error) {\n      // Only log error if the request wasn't cancelled\n      if (error.message !== 'Request was cancelled') {\n        console.error('Error loading detection models:', error);\n        // Don't show error message for this, just log it\n      }\n    }\n  };\n  \n  // Open add stream modal\n  const openAddStreamModal = () => {\n    setCurrentStream({\n      name: '',\n      url: '',\n      enabled: true,\n      streamingEnabled: true,\n      width: 1280,\n      height: 720,\n      fps: 15,\n      codec: 'h264',\n      protocol: '0',\n      priority: '5',\n      segment: 30,\n      record: true,\n      recordAudio: true,\n      detectionEnabled: false,\n      detectionModel: '',\n      detectionThreshold: 50,\n      detectionInterval: 10,\n      preBuffer: 10,\n      postBuffer: 30\n    });\n    setIsEditing(false);\n    setModalVisible(true);\n  };\n  \n  // Open edit stream modal\n  const openEditStreamModal = async (streamId) => {\n    try {\n      const stream = await fetchJSON(`/api/streams/${encodeURIComponent(streamId)}`, {\n        signal: requestControllerRef.current?.signal,\n        timeout: 10000, // 10 second timeout\n        retries: 2,     // Retry twice\n        retryDelay: 1000 // 1 second between retries\n      });\n    setCurrentStream({\n      ...stream,\n      // Convert numeric values to strings for form inputs\n      width: stream.width || 1280,\n      height: stream.height || 720,\n      fps: stream.fps || 15,\n      protocol: stream.protocol?.toString() || '0',\n      priority: stream.priority?.toString() || '5',\n      segment: stream.segment_duration || 30,\n      detectionThreshold: stream.detection_threshold || 50,\n      detectionInterval: stream.detection_interval || 10,\n      preBuffer: stream.pre_detection_buffer || 10,\n      postBuffer: stream.post_detection_buffer || 30,\n      // Map API fields to form fields\n      streamingEnabled: stream.streaming_enabled !== undefined ? stream.streaming_enabled : true,\n      isOnvif: stream.is_onvif !== undefined ? stream.is_onvif : false,\n      detectionEnabled: stream.detection_based_recording || false,\n      detectionModel: stream.detection_model || '',\n      recordAudio: stream.record_audio !== undefined ? stream.record_audio : true\n      });\n      setIsEditing(true);\n      setModalVisible(true);\n    } catch (error) {\n      console.error('Error loading stream details:', error);\n      showStatusMessage('Error loading stream details: ' + error.message);\n    }\n  };\n  \n  // Close modal\n  const closeModal = () => {\n    setModalVisible(false);\n  };\n  \n  // Handle input change\n  const handleInputChange = (e) => {\n    const { name, value, type, checked } = e.target;\n    \n    setCurrentStream(prev => ({\n      ...prev,\n      [name]: type === 'checkbox' ? checked : value\n    }));\n  };\n  \n  // Handle threshold slider change\n  const handleThresholdChange = (e) => {\n    const value = parseInt(e.target.value, 10);\n    setCurrentStream(prev => ({\n      ...prev,\n      detectionThreshold: value\n    }));\n  };\n  \n  // Save stream\n  const saveStream = async () => {\n    try {\n      // Prepare data for API\n      const streamData = {\n        ...currentStream,\n        // Convert string values to numbers where needed\n        width: parseInt(currentStream.width, 10),\n        height: parseInt(currentStream.height, 10),\n        fps: parseInt(currentStream.fps, 10),\n        protocol: parseInt(currentStream.protocol, 10),\n        priority: parseInt(currentStream.priority, 10),\n        segment_duration: parseInt(currentStream.segment, 10),\n        // Map form fields to API fields\n        streaming_enabled: currentStream.streamingEnabled,\n        is_onvif: currentStream.isOnvif,\n        detection_based_recording: currentStream.detectionEnabled,\n        detection_model: currentStream.detectionModel,\n        detection_threshold: currentStream.detectionThreshold,\n        detection_interval: parseInt(currentStream.detectionInterval, 10),\n        pre_detection_buffer: parseInt(currentStream.preBuffer, 10),\n        post_detection_buffer: parseInt(currentStream.postBuffer, 10),\n        record_audio: currentStream.recordAudio\n      };\n      \n      // When editing, set is_deleted to false to allow undeleting soft-deleted streams\n      if (isEditing) {\n        streamData.is_deleted = false;\n      }\n      \n      const url = isEditing \n        ? `/api/streams/${encodeURIComponent(currentStream.name)}`\n        : '/api/streams';\n      \n      const method = isEditing ? 'PUT' : 'POST';\n      \n      await enhancedFetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(streamData),\n        signal: requestControllerRef.current?.signal,\n        timeout: 15000, // 15 second timeout\n        retries: 1,     // Retry once\n        retryDelay: 1000 // 1 second between retries\n      });\n      \n      // The streaming flag is already handled by the main update endpoint\n      // The ONVIF flag is now properly handled by the backend\n      \n      showStatusMessage(`Stream ${isEditing ? 'updated' : 'added'} successfully`);\n      closeModal();\n      loadStreams();\n    } catch (error) {\n      console.error(`Error ${isEditing ? 'updating' : 'adding'} stream:`, error);\n      showStatusMessage(`Error ${isEditing ? 'updating' : 'adding'} stream: ${error.message}`);\n    }\n  };\n  \n  // Test stream connection\n  const testStreamConnection = async () => {\n    try {\n      showStatusMessage('Testing stream connection...');\n      \n      const data = await fetchJSON('/api/streams/test', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          url: currentStream.url,\n          protocol: parseInt(currentStream.protocol, 10)\n        }),\n        signal: requestControllerRef.current?.signal,\n        timeout: 20000, // 20 second timeout for stream testing\n        retries: 1,     // Retry once\n        retryDelay: 2000 // 2 seconds between retries\n      });\n      \n      if (data.success) {\n        showStatusMessage('Stream connection successful!');\n        \n        // Update stream info if available\n        if (data.info) {\n          setCurrentStream(prev => ({\n            ...prev,\n            width: data.info.width || prev.width,\n            height: data.info.height || prev.height,\n            fps: data.info.fps || prev.fps,\n            codec: data.info.codec || prev.codec\n          }));\n        }\n      } else {\n        showStatusMessage(`Stream test failed: ${data.message || 'Unknown error'}`, 3000, 'error');\n      }\n    } catch (error) {\n      console.error('Error testing stream:', error);\n      showStatusMessage('Error testing stream: ' + error.message, 3000, 'error');\n    }\n  };\n  \n  // Open delete modal\n  const openDeleteModal = (stream) => {\n    setStreamToDelete(stream);\n    setDeleteModalVisible(true);\n  };\n  \n  // Close delete modal\n  const closeDeleteModal = () => {\n    setDeleteModalVisible(false);\n    setStreamToDelete(null);\n  };\n  \n  // Disable stream (soft delete)\n  const disableStream = async (streamId) => {\n    try {\n      // First, get the current stream configuration\n      const stream = await fetchJSON(`/api/streams/${encodeURIComponent(streamId)}`, {\n        signal: requestControllerRef.current?.signal,\n        timeout: 10000, // 10 second timeout\n        retries: 1,     // Retry once\n        retryDelay: 1000 // 1 second between retries\n      });\n      \n      // Update the stream with disabled flags for all relevant features\n      await enhancedFetch(`/api/streams/${encodeURIComponent(streamId)}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          enabled: false,                    // Disable the stream\n          streaming_enabled: false,          // Disable live streaming\n          record: false,                     // Disable recording\n          record_audio: false,               // Disable audio recording\n          detection_based_recording: false   // Disable detection-based recording\n        }),\n        signal: requestControllerRef.current?.signal,\n        timeout: 15000, // 15 second timeout\n        retries: 1,     // Retry once\n        retryDelay: 1000 // 1 second between retries\n      });\n      \n      showStatusMessage('Stream disabled successfully');\n      loadStreams();\n    } catch (error) {\n      console.error('Error disabling stream:', error);\n      showStatusMessage('Error disabling stream: ' + error.message);\n    }\n  };\n  \n  // Delete stream (permanent)\n  const deleteStream = async (streamId) => {\n    try {\n      await enhancedFetch(`/api/streams/${encodeURIComponent(streamId)}?permanent=true`, {\n        method: 'DELETE',\n        signal: requestControllerRef.current?.signal,\n        timeout: 15000, // 15 second timeout\n        retries: 1,     // Retry once\n        retryDelay: 1000 // 1 second between retries\n      });\n      \n      showStatusMessage('Stream deleted permanently');\n      loadStreams();\n    } catch (error) {\n      console.error('Error deleting stream:', error);\n      showStatusMessage('Error deleting stream: ' + error.message);\n    }\n  };\n  \n  // Enable/disable stream\n  const toggleStreamEnabled = async (streamId, enabled) => {\n    try {\n      await enhancedFetch(`/api/streams/${encodeURIComponent(streamId)}/enable`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ enabled: !enabled }),\n        signal: requestControllerRef.current?.signal,\n        timeout: 10000, // 10 second timeout\n        retries: 1,     // Retry once\n        retryDelay: 1000 // 1 second between retries\n      });\n      \n      showStatusMessage(`Stream ${enabled ? 'disabled' : 'enabled'} successfully`);\n      loadStreams();\n    } catch (error) {\n      console.error(`Error ${enabled ? 'disabling' : 'enabling'} stream:`, error);\n      showStatusMessage(`Error ${enabled ? 'disabling' : 'enabling'} stream: ${error.message}`);\n    }\n  };\n  \n  // Handle ONVIF credential input change\n  const handleCredentialChange = (e) => {\n    const { name, value } = e.target;\n    setOnvifCredentials(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n  \n  // Start ONVIF discovery\n  const startOnvifDiscovery = async () => {\n    try {\n      setIsDiscovering(true);\n      // Don't clear discovered devices immediately to prevent UI flicker\n      // and to preserve any credentials entered\n      showStatusMessage('Starting ONVIF discovery...');\n      \n      const data = await fetchJSON('/api/onvif/discovery/discover', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({}),\n        signal: requestControllerRef.current?.signal,\n        timeout: 120000, // 120 second timeout for discovery (ONVIF discovery can take up to 90 seconds)\n        retries: 0       // No retries for discovery\n      });\n      // Update discovered devices without clearing credentials\n      setDiscoveredDevices(data.devices || []);\n      \n      if (data.devices && data.devices.length > 0) {\n        showStatusMessage(`Discovered ${data.devices.length} ONVIF devices`);\n      } else {\n        showStatusMessage('No ONVIF devices found');\n      }\n    } catch (error) {\n      console.error('Error discovering ONVIF devices:', error);\n      showStatusMessage('Error discovering ONVIF devices: ' + error.message, 3000, 'error');\n    } finally {\n      setIsDiscovering(false);\n    }\n  };\n  \n  // State for profile loading\n  const [isLoadingProfiles, setIsLoadingProfiles] = useState(false);\n\n  // Get ONVIF device profiles\n  const getDeviceProfiles = async (device) => {\n    try {\n      setSelectedDevice(device);\n      setDeviceProfiles([]);\n      setIsLoadingProfiles(true);\n      showStatusMessage('Getting device profiles...');\n      \n      const data = await fetchJSON(`/api/onvif/device/profiles`, {\n        headers: {\n          'X-Device-URL': device.device_service,\n          'X-Username': onvifCredentials.username,\n          'X-Password': onvifCredentials.password\n        },\n        signal: requestControllerRef.current?.signal,\n        timeout: 20000, // 20 second timeout for getting profiles\n        retries: 1,     // Retry once\n        retryDelay: 2000 // 2 seconds between retries\n      });\n      setDeviceProfiles(data.profiles || []);\n      \n      if (data.profiles && data.profiles.length > 0) {\n        showStatusMessage(`Found ${data.profiles.length} profiles`);\n      } else {\n        showStatusMessage('No profiles found');\n      }\n    } catch (error) {\n      console.error('Error getting device profiles:', error);\n      showStatusMessage('Error getting device profiles: ' + error.message, 3000, 'error');\n    } finally {\n      setIsLoadingProfiles(false);\n    }\n  };\n  \n  // State for custom stream name\n  const [customStreamName, setCustomStreamName] = useState('');\n  const [showCustomNameInput, setShowCustomNameInput] = useState(false);\n\n  // Add ONVIF device as stream\n  const addOnvifDeviceAsStream = async (profile) => {\n    try {\n      setSelectedProfile(profile);\n      \n      // Generate a default stream name from device info\n      const defaultStreamName = `ONVIF_${selectedDevice.ip_address.replace(/\\./g, '_')}_${profile.name.replace(/\\s+/g, '_')}`;\n      \n      // Show custom name input dialog\n      setCustomStreamName(defaultStreamName);\n      setShowCustomNameInput(true);\n    } catch (error) {\n      console.error('Error preparing to add ONVIF device:', error);\n      showStatusMessage('Error preparing to add ONVIF device: ' + error.message, 3000, 'error');\n    }\n  };\n  \n  // State for adding stream\n  const [isAddingStream, setIsAddingStream] = useState(false);\n\n  // Submit ONVIF device with custom name\n  const submitOnvifDevice = async () => {\n    try {\n      setIsAddingStream(true);\n      showStatusMessage('Adding ONVIF device as stream...');\n      \n      await enhancedFetch('/api/onvif/device/add', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          device_url: selectedDevice.device_service,\n          profile_token: selectedProfile.token,\n          stream_name: customStreamName,\n          username: onvifCredentials.username,\n          password: onvifCredentials.password\n        }),\n        signal: requestControllerRef.current?.signal,\n        timeout: 30000, // 30 second timeout for adding ONVIF device\n        retries: 1,     // Retry once\n        retryDelay: 3000 // 3 seconds between retries\n      });\n      \n      showStatusMessage('ONVIF device added as stream successfully');\n      setOnvifModalVisible(false);\n      setShowCustomNameInput(false);\n      loadStreams();\n    } catch (error) {\n      console.error('Error adding ONVIF device as stream:', error);\n      showStatusMessage('Error adding ONVIF device as stream: ' + error.message, 3000, 'error');\n    } finally {\n      setIsAddingStream(false);\n    }\n  };\n  \n  // Test ONVIF connection\n  const testOnvifConnection = async (device) => {\n    try {\n      // Save current credentials to preserve them\n      const currentCredentials = {\n        username: onvifCredentials.username,\n        password: onvifCredentials.password\n      };\n      \n      showStatusMessage('Testing ONVIF connection...');\n      \n      await enhancedFetch('/api/onvif/device/test', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          url: device.device_service,\n          username: currentCredentials.username,\n          password: currentCredentials.password\n        }),\n        signal: requestControllerRef.current?.signal,\n        timeout: 15000, // 15 second timeout for testing connection\n        retries: 1,     // Retry once\n        retryDelay: 2000 // 2 seconds between retries\n      });\n      \n      showStatusMessage('ONVIF connection successful!');\n      \n      // Get device profiles after successful connection test\n      // Pass the saved credentials to ensure they're not lost\n      getDeviceProfiles(device);\n    } catch (error) {\n      console.error('Error testing ONVIF connection:', error);\n      showStatusMessage('Error testing ONVIF connection: ' + error.message, 3000, 'error');\n    }\n  };\n  \n  return html`\n    <section id=\"streams-page\" class=\"page\">\n      <div class=\"page-header flex justify-between items-center mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow\">\n        <h2 class=\"text-xl font-bold\">Streams</h2>\n        <div class=\"controls flex space-x-2\">\n          <button \n            id=\"discover-onvif-btn\" \n            class=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n            onClick=${() => setOnvifModalVisible(true)}\n          >\n            Discover ONVIF Cameras\n          </button>\n          <button \n            id=\"add-stream-btn\" \n            class=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n            onClick=${openAddStreamModal}\n          >\n            Add Stream\n          </button>\n        </div>\n      </div>\n      \n      <${ContentLoader}\n        isLoading=${isLoading}\n        hasData=${hasData}\n        loadingMessage=\"Loading streams...\"\n        emptyMessage=\"No streams configured yet. Click 'Add Stream' to create one.\"\n      >\n        <div class=\"streams-container bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden\">\n          <div class=\"overflow-x-auto\">\n            <table id=\"streams-table\" class=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n              <thead class=\"bg-gray-50 dark:bg-gray-700\">\n                <tr>\n                  <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Name</th>\n                  <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">URL</th>\n                  <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Resolution</th>\n                  <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">FPS</th>\n                  <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Recording</th>\n                  <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Actions</th>\n                </tr>\n              </thead>\n              <tbody class=\"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700\">\n                ${streams.map(stream => html`\n                  <tr key=${stream.name} class=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\n                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                      <div class=\"flex items-center\">\n                        <span class=${`status-indicator w-2 h-2 rounded-full mr-2 ${stream.enabled ? 'bg-green-500' : 'bg-red-500'}`}></span>\n                        ${stream.name}\n                      </div>\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap\">${stream.url}</td>\n                    <td class=\"px-6 py-4 whitespace-nowrap\">${stream.width}x${stream.height}</td>\n                    <td class=\"px-6 py-4 whitespace-nowrap\">${stream.fps}</td>\n                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                      ${stream.record ? 'Enabled' : 'Disabled'}\n                      ${stream.detection_based_recording ? ' (Detection)' : ''}\n                    </td>\n                    <td class=\"px-6 py-4 whitespace-nowrap\">\n                      <div class=\"flex space-x-2\">\n                        <button \n                          class=\"p-1 rounded-full text-blue-600 hover:bg-blue-100 dark:text-blue-400 dark:hover:bg-blue-900 focus:outline-none\"\n                          onClick=${() => openEditStreamModal(stream.name)}\n                          title=\"Edit\"\n                        >\n                          <svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                            <path d=\"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z\"></path>\n                          </svg>\n                        </button>\n                        <button \n                          class=\"p-1 rounded-full text-red-600 hover:bg-red-100 dark:text-red-400 dark:hover:bg-red-900 focus:outline-none\"\n                          onClick=${() => openDeleteModal(stream)}\n                          title=\"Delete\"\n                        >\n                          <svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                            <path fill-rule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clip-rule=\"evenodd\"></path>\n                          </svg>\n                        </button>\n                      </div>\n                    </td>\n                  </tr>\n                `)}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      <//>\n      \n      ${deleteModalVisible && streamToDelete && html`\n        <${StreamDeleteModal}\n          streamId=${streamToDelete.name}\n          streamName=${streamToDelete.name}\n          onClose=${closeDeleteModal}\n          onDisable=${disableStream}\n          onDelete=${deleteStream}\n        />\n      `}\n      \n      ${modalVisible && html`\n        <div id=\"stream-modal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300\">\n          <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto\">\n            <div class=\"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700\">\n              <h3 class=\"text-lg font-medium\">${isEditing ? 'Edit Stream' : 'Add Stream'}</h3>\n              <span class=\"text-2xl cursor-pointer\" onClick=${closeModal}>×</span>\n            </div>\n            <div class=\"p-4\">\n              <form id=\"stream-form\" class=\"space-y-4\">\n                <div class=\"form-group\">\n                  <label for=\"stream-name\" class=\"block text-sm font-medium mb-1\">Name</label>\n                  <input \n                    type=\"text\" \n                    id=\"stream-name\" \n                    name=\"name\"\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white ${isEditing ? 'bg-gray-100 dark:bg-gray-800' : ''}\"\n                    value=${currentStream.name}\n                    onChange=${handleInputChange}\n                    disabled=${isEditing}\n                    required\n                  />\n                </div>\n                <div class=\"form-group\">\n                  <label for=\"stream-url\" class=\"block text-sm font-medium mb-1\">URL</label>\n                  <input \n                    type=\"text\" \n                    id=\"stream-url\" \n                    name=\"url\"\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                    placeholder=\"rtsp://example.com/stream\" \n                    value=${currentStream.url}\n                    onChange=${handleInputChange}\n                    required\n                  />\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input \n                    type=\"checkbox\" \n                    id=\"stream-enabled\" \n                    name=\"enabled\"\n                    class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                    checked=${currentStream.enabled}\n                    onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-enabled\" class=\"ml-2 block text-sm\">Stream Active</label>\n                  <span class=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">Enable/disable all stream processing</span>\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input \n                    type=\"checkbox\" \n                    id=\"stream-streaming-enabled\" \n                    name=\"streamingEnabled\"\n                    class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                    checked=${currentStream.streamingEnabled}\n                    onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-streaming-enabled\" class=\"ml-2 block text-sm\">Live View Enabled</label>\n                  <span class=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">Enable/disable live viewing in browser</span>\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input \n                    type=\"checkbox\" \n                    id=\"stream-is-onvif\" \n                    name=\"isOnvif\"\n                    class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                    checked=${currentStream.isOnvif}\n                    onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-is-onvif\" class=\"ml-2 block text-sm\">ONVIF Camera</label>\n                  <span class=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">Mark this stream as an ONVIF camera for special handling</span>\n                </div>\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div class=\"form-group\">\n                    <label for=\"stream-width\" class=\"block text-sm font-medium mb-1\">Width</label>\n                    <input \n                      type=\"number\" \n                      id=\"stream-width\" \n                      name=\"width\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      min=\"320\" \n                      max=\"1920\" \n                      value=${currentStream.width}\n                      onChange=${handleInputChange}\n                    />\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-height\" class=\"block text-sm font-medium mb-1\">Height</label>\n                    <input \n                      type=\"number\" \n                      id=\"stream-height\" \n                      name=\"height\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      min=\"240\" \n                      max=\"1080\" \n                      value=${currentStream.height}\n                      onChange=${handleInputChange}\n                    />\n                  </div>\n                </div>\n                <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div class=\"form-group\">\n                    <label for=\"stream-fps\" class=\"block text-sm font-medium mb-1\">FPS</label>\n                    <input \n                      type=\"number\" \n                      id=\"stream-fps\" \n                      name=\"fps\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      min=\"1\" \n                      max=\"30\" \n                      value=${currentStream.fps}\n                      onChange=${handleInputChange}\n                    />\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-codec\" class=\"block text-sm font-medium mb-1\">Codec</label>\n                    <select \n                      id=\"stream-codec\" \n                      name=\"codec\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      value=${currentStream.codec}\n                      onChange=${handleInputChange}\n                    >\n                      <option value=\"h264\">H.264</option>\n                      <option value=\"h265\">H.265</option>\n                    </select>\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-protocol\" class=\"block text-sm font-medium mb-1\">Protocol</label>\n                    <select \n                      id=\"stream-protocol\" \n                      name=\"protocol\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      value=${currentStream.protocol}\n                      onChange=${handleInputChange}\n                    >\n                      <option value=\"0\">TCP</option>\n                      <option value=\"1\">UDP</option>\n                    </select>\n                    <span class=\"text-xs text-gray-500 dark:text-gray-400\">Connection protocol (ONVIF cameras use either TCP or UDP)</span>\n                  </div>\n                </div>\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div class=\"form-group\">\n                    <label for=\"stream-priority\" class=\"block text-sm font-medium mb-1\">Priority</label>\n                    <select \n                      id=\"stream-priority\" \n                      name=\"priority\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      value=${currentStream.priority}\n                      onChange=${handleInputChange}\n                    >\n                      <option value=\"1\">Low (1)</option>\n                      <option value=\"5\">Medium (5)</option>\n                      <option value=\"10\">High (10)</option>\n                    </select>\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-segment\" class=\"block text-sm font-medium mb-1\">Segment Duration (seconds)</label>\n                    <input \n                      type=\"number\" \n                      id=\"stream-segment\" \n                      name=\"segment\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      min=\"60\" \n                      max=\"3600\" \n                      value=${currentStream.segment}\n                      onChange=${handleInputChange}\n                    />\n                  </div>\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input \n                    type=\"checkbox\" \n                    id=\"stream-record\" \n                    name=\"record\"\n                    class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                    checked=${currentStream.record}\n                    onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-record\" class=\"ml-2 block text-sm\">Record</label>\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input \n                    type=\"checkbox\" \n                    id=\"stream-record-audio\" \n                    name=\"recordAudio\"\n                    class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                    checked=${currentStream.recordAudio}\n                    onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-record-audio\" class=\"ml-2 block text-sm\">Record Audio</label>\n                  <span class=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">Include audio in recordings if available in the stream</span>\n                </div>\n                \n                <!-- Detection-based recording options -->\n                <div class=\"mt-6 mb-2 pb-1 border-b border-gray-200 dark:border-gray-700\">\n                  <h4 class=\"text-md font-medium\">Detection-Based Recording</h4>\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input \n                    type=\"checkbox\" \n                    id=\"stream-detection-enabled\" \n                    name=\"detectionEnabled\"\n                    class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                    checked=${currentStream.detectionEnabled}\n                    onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-detection-enabled\" class=\"ml-2 block text-sm\">Enable Detection-Based Recording</label>\n                  <span class=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">Only record when objects are detected</span>\n                </div>\n                <div class=\"form-group\" style=${currentStream.detectionEnabled ? '' : 'display: none'}>\n                  <label for=\"stream-detection-model\" class=\"block text-sm font-medium mb-1\">Detection Model</label>\n                  <div class=\"flex space-x-2\">\n                    <select \n                      id=\"stream-detection-model\" \n                      name=\"detectionModel\"\n                      class=\"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      value=${currentStream.detectionModel}\n                      onChange=${handleInputChange}\n                    >\n                      <option value=\"\">Select a model</option>\n                      ${detectionModels.map(model => html`\n                        <option key=${model.id} value=${model.id}>${model.name}</option>\n                      `)}\n                    </select>\n                    <button \n                      id=\"refresh-models-btn\" \n                      class=\"p-2 rounded-md bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none\"\n                      title=\"Refresh Models\"\n                      onClick=${loadDetectionModels}\n                      type=\"button\"\n                    >\n                      <svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                        <path fill-rule=\"evenodd\" d=\"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z\" clip-rule=\"evenodd\"></path>\n                      </svg>\n                    </button>\n                  </div>\n                </div>\n                <div class=\"form-group\" style=${currentStream.detectionEnabled ? '' : 'display: none'}>\n                  <label for=\"stream-detection-threshold\" class=\"block text-sm font-medium mb-1\">Detection Threshold</label>\n                  <div class=\"flex items-center space-x-2\">\n                    <input \n                      type=\"range\" \n                      id=\"stream-detection-threshold\" \n                      name=\"detectionThreshold\"\n                      class=\"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700\"\n                      min=\"0\" \n                      max=\"100\" \n                      step=\"1\" \n                      value=${currentStream.detectionThreshold}\n                      onInput=${handleThresholdChange}\n                    />\n                    <span id=\"stream-threshold-value\" class=\"font-medium text-blue-600 dark:text-blue-400 min-w-[3rem] text-center\">\n                      ${currentStream.detectionThreshold}%\n                    </span>\n                  </div>\n                </div>\n                <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\" style=${currentStream.detectionEnabled ? '' : 'display: none'}>\n                  <div class=\"form-group\">\n                    <label for=\"stream-detection-interval\" class=\"block text-sm font-medium mb-1\">Detection Interval (frames)</label>\n                    <input \n                      type=\"number\" \n                      id=\"stream-detection-interval\" \n                      name=\"detectionInterval\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      min=\"1\" \n                      max=\"100\" \n                      value=${currentStream.detectionInterval}\n                      onChange=${handleInputChange}\n                    />\n                    <span class=\"text-xs text-gray-500 dark:text-gray-400\">Detect on every Nth frame</span>\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-pre-buffer\" class=\"block text-sm font-medium mb-1\">Pre-detection Buffer (seconds)</label>\n                    <input \n                      type=\"number\" \n                      id=\"stream-pre-buffer\" \n                      name=\"preBuffer\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      min=\"0\" \n                      max=\"60\" \n                      value=${currentStream.preBuffer}\n                      onChange=${handleInputChange}\n                    />\n                    <span class=\"text-xs text-gray-500 dark:text-gray-400\">Seconds to keep before detection</span>\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-post-buffer\" class=\"block text-sm font-medium mb-1\">Post-detection Buffer (seconds)</label>\n                    <input \n                      type=\"number\" \n                      id=\"stream-post-buffer\" \n                      name=\"postBuffer\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      min=\"0\" \n                      max=\"300\" \n                      value=${currentStream.postBuffer}\n                      onChange=${handleInputChange}\n                    />\n                    <span class=\"text-xs text-gray-500 dark:text-gray-400\">Seconds to keep after detection</span>\n                  </div>\n                </div>\n              </form>\n            </div>\n            <div class=\"flex justify-between p-4 border-t border-gray-200 dark:border-gray-700\">\n              <button \n                id=\"stream-test-btn\" \n                class=\"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600\"\n                onClick=${testStreamConnection}\n                type=\"button\"\n              >\n                Test Connection\n              </button>\n              <div class=\"space-x-2\">\n                <button \n                  id=\"stream-save-btn\" \n                  class=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\n                  onClick=${saveStream}\n                  type=\"button\"\n                >\n                  Save\n                </button>\n                <button \n                  id=\"stream-cancel-btn\" \n                  class=\"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors\"\n                  onClick=${closeModal}\n                  type=\"button\"\n                >\n                  Cancel\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      `}\n      \n      ${onvifModalVisible && html`\n        <div id=\"onvif-modal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300\">\n          <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n            <div class=\"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700\">\n              <h3 class=\"text-lg font-medium\">ONVIF Camera Discovery</h3>\n              <span class=\"text-2xl cursor-pointer\" onClick=${() => setOnvifModalVisible(false)}>×</span>\n            </div>\n            <div class=\"p-4\">\n              <div class=\"mb-4 flex justify-between items-center\">\n                <h4 class=\"text-md font-medium\">Discovered Devices</h4>\n                <button \n                  id=\"discover-btn\" \n                  class=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors focus:outline-none\"\n                  onClick=${startOnvifDiscovery}\n                  disabled=${isDiscovering}\n                  type=\"button\"\n                >\n                  ${isDiscovering ? html`\n                    <span class=\"flex items-center\">\n                      Discovering\n                      <span class=\"ml-1 flex space-x-1\">\n                        <span class=\"animate-pulse delay-0 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                        <span class=\"animate-pulse delay-150 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                        <span class=\"animate-pulse delay-300 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                      </span>\n                    </span>\n                  ` : 'Start Discovery'}\n                </button>\n              </div>\n              \n              <div class=\"overflow-x-auto\">\n                <table class=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n                  <thead class=\"bg-gray-50 dark:bg-gray-700\">\n                    <tr>\n                      <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">IP Address</th>\n                      <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Manufacturer</th>\n                      <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Model</th>\n                      <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody class=\"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700\">\n                    ${discoveredDevices.length === 0 ? html`\n                      <tr>\n                        <td colspan=\"4\" class=\"px-6 py-4 text-center text-gray-500 dark:text-gray-400\">\n                          ${isDiscovering ? html`\n                            <div class=\"flex items-center justify-center\">\n                              <span>Discovering devices</span>\n                              <span class=\"ml-1 flex space-x-1\">\n                                <span class=\"animate-pulse delay-0 h-1.5 w-1.5 bg-gray-500 dark:bg-gray-400 rounded-full\"></span>\n                                <span class=\"animate-pulse delay-150 h-1.5 w-1.5 bg-gray-500 dark:bg-gray-400 rounded-full\"></span>\n                                <span class=\"animate-pulse delay-300 h-1.5 w-1.5 bg-gray-500 dark:bg-gray-400 rounded-full\"></span>\n                              </span>\n                            </div>\n                          ` : 'No devices discovered yet. Click \"Start Discovery\" to scan your network.'}\n                        </td>\n                      </tr>\n                    ` : discoveredDevices.map(device => html`\n                      <tr key=${device.ip_address} class=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\n                        <td class=\"px-6 py-4 whitespace-nowrap\">${device.ip_address}</td>\n                        <td class=\"px-6 py-4 whitespace-nowrap\">${device.manufacturer || 'Unknown'}</td>\n                        <td class=\"px-6 py-4 whitespace-nowrap\">${device.model || 'Unknown'}</td>\n                        <td class=\"px-6 py-4 whitespace-nowrap\">\n                          <button \n                            class=\"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors focus:outline-none\"\n                            onClick=${() => testOnvifConnection(device)}\n                            disabled=${isLoadingProfiles && selectedDevice && selectedDevice.ip_address === device.ip_address}\n                            type=\"button\"\n                          >\n                            ${isLoadingProfiles && selectedDevice && selectedDevice.ip_address === device.ip_address ? html`\n                              <span class=\"flex items-center\">\n                                Loading\n                                <span class=\"ml-1 flex space-x-1\">\n                                  <span class=\"animate-pulse delay-0 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                                  <span class=\"animate-pulse delay-150 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                                  <span class=\"animate-pulse delay-300 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                                </span>\n                              </span>\n                            ` : 'Connect'}\n                          </button>\n                        </td>\n                      </tr>\n                    `)}\n                  </tbody>\n                </table>\n              </div>\n              \n              <div class=\"mt-6 mb-4\">\n                <h4 class=\"text-md font-medium mb-2\">Authentication</h4>\n                <p class=\"text-sm text-gray-500 dark:text-gray-400 mb-3\">\n                  Enter credentials to connect to the selected ONVIF device. Credentials are not needed for discovery, only for connecting to devices.\n                </p>\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div class=\"form-group\">\n                    <label for=\"onvif-username\" class=\"block text-sm font-medium mb-1\">Username</label>\n                    <input \n                      type=\"text\" \n                      id=\"onvif-username\" \n                      name=\"username\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      placeholder=\"admin\" \n                      value=${onvifCredentials.username}\n                      onChange=${handleCredentialChange}\n                    />\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"onvif-password\" class=\"block text-sm font-medium mb-1\">Password</label>\n                    <input \n                      type=\"password\" \n                      id=\"onvif-password\" \n                      name=\"password\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      placeholder=\"password\" \n                      value=${onvifCredentials.password}\n                      onChange=${handleCredentialChange}\n                    />\n                  </div>\n                </div>\n              </div>\n              \n              ${selectedDevice && deviceProfiles.length > 0 && html`\n                <div class=\"mt-6\">\n                  <h4 class=\"text-md font-medium mb-2\">Available Profiles for ${selectedDevice.ip_address}</h4>\n                  <div class=\"overflow-x-auto\">\n                    <table class=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n                      <thead class=\"bg-gray-50 dark:bg-gray-700\">\n                        <tr>\n                          <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Name</th>\n                          <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Resolution</th>\n                          <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Encoding</th>\n                          <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">FPS</th>\n                          <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Actions</th>\n                        </tr>\n                      </thead>\n                      <tbody class=\"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700\">\n                        ${deviceProfiles.map(profile => html`\n                          <tr key=${profile.token} class=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\n                            <td class=\"px-6 py-4 whitespace-nowrap\">${profile.name}</td>\n                            <td class=\"px-6 py-4 whitespace-nowrap\">${profile.width}x${profile.height}</td>\n                            <td class=\"px-6 py-4 whitespace-nowrap\">${profile.encoding}</td>\n                            <td class=\"px-6 py-4 whitespace-nowrap\">${profile.fps}</td>\n                            <td class=\"px-6 py-4 whitespace-nowrap\">\n                              <button \n                                class=\"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition-colors focus:outline-none\"\n                                onClick=${() => addOnvifDeviceAsStream(profile)}\n                                type=\"button\"\n                              >\n                                Add as Stream\n                              </button>\n                            </td>\n                          </tr>\n                        `)}\n                      </tbody>\n                    </table>\n                  </div>\n                </div>\n              `}\n            </div>\n            <div class=\"flex justify-end p-4 border-t border-gray-200 dark:border-gray-700\">\n              <button \n                id=\"onvif-close-btn\" \n                class=\"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors\"\n                onClick=${() => setOnvifModalVisible(false)}\n                type=\"button\"\n              >\n                Close\n              </button>\n            </div>\n          </div>\n        </div>\n      `}\n      \n      ${showCustomNameInput && html`\n        <div id=\"custom-name-modal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300\">\n          <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full\">\n            <div class=\"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700\">\n              <h3 class=\"text-lg font-medium\">Stream Name</h3>\n              <span class=\"text-2xl cursor-pointer\" onClick=${() => setShowCustomNameInput(false)}>×</span>\n            </div>\n            <div class=\"p-4\">\n              <div class=\"mb-4\">\n                <label for=\"custom-stream-name\" class=\"block text-sm font-medium mb-1\">Enter a name for this stream:</label>\n                <input \n                  type=\"text\" \n                  id=\"custom-stream-name\" \n                  class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                  value=${customStreamName}\n                  onChange=${(e) => setCustomStreamName(e.target.value)}\n                />\n                <p class=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\n                  This name will be used to identify the stream in the system.\n                </p>\n              </div>\n            </div>\n            <div class=\"flex justify-end p-4 border-t border-gray-200 dark:border-gray-700 space-x-2\">\n              <button \n                class=\"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors\"\n                onClick=${() => setShowCustomNameInput(false)}\n                type=\"button\"\n              >\n                Cancel\n              </button>\n              <button \n                class=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors\"\n                onClick=${submitOnvifDevice}\n                type=\"button\"\n                disabled=${!customStreamName.trim() || isAddingStream}\n              >\n                ${isAddingStream ? html`\n                  <span class=\"flex items-center\">\n                    Adding\n                    <span class=\"ml-1 flex space-x-1\">\n                      <span class=\"animate-pulse delay-0 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                      <span class=\"animate-pulse delay-150 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                      <span class=\"animate-pulse delay-300 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                    </span>\n                  </span>\n                ` : 'Add Stream'}\n              </button>\n            </div>\n          </div>\n        </div>\n      `}\n    </section>\n  `;\n}\n\n/**\n * Load StreamsView component\n */\nexport function loadStreamsView() {\n  const mainContent = document.getElementById('main-content');\n  if (!mainContent) return;\n  \n  // Render the StreamsView component to the container\n  import('../../preact.min.js').then(({ render }) => {\n    render(html`<${StreamsView} />`, mainContent);\n  });\n}\n"],"file":"assets/StreamsView-BE-gJPaf.js"}