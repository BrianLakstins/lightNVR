{"version":3,"file":"index-csKkRC54.js","sources":["../../node_modules/webrtc-adapter/src/js/utils.js","../../node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","../../node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","../../node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","../../node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js","../../node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","../../node_modules/webrtc-adapter/src/js/safari/safari_shim.js","../../node_modules/sdp/sdp.js","../../node_modules/webrtc-adapter/src/js/common_shim.js","../../node_modules/webrtc-adapter/src/js/adapter_factory.js","../../node_modules/webrtc-adapter/src/js/adapter_core.js","../../js/components/preact/WebRTCVideoCell.jsx","../../js/components/preact/WebRTCView.jsx","../../js/pages/index-page.jsx"],"sourcesContent":["/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nlet logDisabled_ = true;\nlet deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nexport function extractVersion(uastring, expr, pos) {\n  const match = uastring.match(expr);\n  return match && match.length >= pos && parseFloat(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nexport function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  const nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    const wrappedCallback = (e) => {\n      const modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        if (cb.handleEvent) {\n          cb.handleEvent(modifiedEvent);\n        } else {\n          cb(modifiedEvent);\n        }\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    if (!this._eventMap[eventNameToWrap]) {\n      this._eventMap[eventNameToWrap] = new Map();\n    }\n    this._eventMap[eventNameToWrap].set(cb, wrappedCallback);\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  const nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[eventNameToWrap]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    if (!this._eventMap[eventNameToWrap].has(cb)) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    const unwrappedCb = this._eventMap[eventNameToWrap].get(cb);\n    this._eventMap[eventNameToWrap].delete(cb);\n    if (this._eventMap[eventNameToWrap].size === 0) {\n      delete this._eventMap[eventNameToWrap];\n    }\n    if (Object.keys(this._eventMap).length === 0) {\n      delete this._eventMap;\n    }\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n          this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n          this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\nexport function disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return (bool) ? 'adapter.js logging disabled' :\n    'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nexport function disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nexport function log() {\n  if (typeof window === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nexport function deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n      ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nexport function detectBrowser(window) {\n  // Returned result object.\n  const result = {browser: null, version: null};\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator ||\n      !window.navigator.userAgent) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  const {navigator} = window;\n\n  // Prefer navigator.userAgentData.\n  if (navigator.userAgentData && navigator.userAgentData.brands) {\n    const chromium = navigator.userAgentData.brands.find((brand) => {\n      return brand.brand === 'Chromium';\n    });\n    if (chromium) {\n      return {browser: 'chrome', version: parseInt(chromium.version, 10)};\n    }\n  }\n\n  if (navigator.mozGetUserMedia) { // Firefox.\n    result.browser = 'firefox';\n    result.version = parseInt(extractVersion(navigator.userAgent,\n      /Firefox\\/(\\d+)\\./, 1));\n  } else if (navigator.webkitGetUserMedia ||\n      (window.isSecureContext === false && window.webkitRTCPeerConnection)) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    // Chrome 74 removed webkitGetUserMedia on http as well so we need the\n    // more complicated fallback to webkitRTCPeerConnection.\n    result.browser = 'chrome';\n    result.version = parseInt(extractVersion(navigator.userAgent,\n      /Chrom(e|ium)\\/(\\d+)\\./, 2));\n  } else if (window.RTCPeerConnection &&\n      navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n    result.browser = 'safari';\n    result.version = parseInt(extractVersion(navigator.userAgent,\n      /AppleWebKit\\/(\\d+)\\./, 1));\n    result.supportsUnifiedPlan = window.RTCRtpTransceiver &&\n        'currentDirection' in window.RTCRtpTransceiver.prototype;\n    // Only for internal usage.\n    result._safariVersion = extractVersion(navigator.userAgent,\n      /Version\\/(\\d+(\\.?\\d+))/, 1);\n  } else { // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Checks if something is an object.\n *\n * @param {*} val The something you want to check.\n * @return true if val is an object, false otherwise.\n */\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nexport function compactObject(data) {\n  if (!isObject(data)) {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function(accumulator, key) {\n    const isObj = isObject(data[key]);\n    const value = isObj ? compactObject(data[key]) : data[key];\n    const isEmptyObject = isObj && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n    return Object.assign(accumulator, {[key]: value});\n  }, {});\n}\n\n/* iterates the stats graph recursively. */\nexport function walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(name => {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(id => {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nexport function filterStats(result, track, outbound) {\n  const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  const filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  const trackStats = [];\n  result.forEach(value => {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(trackStat => {\n    result.forEach(stats => {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\nconst logging = utils.log;\n\nexport function shimGetUserMedia(window, browserDetails) {\n  const navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  const constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    const cc = {};\n    Object.keys(c).forEach(key => {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      const r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      const oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        let oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(mix => {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  const shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      const remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      let face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      const getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        let matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n            .then(devices => {\n              devices = devices.filter(d => d.kind === 'videoinput');\n              let dev = devices.find(d => matches.some(match =>\n                d.label.toLowerCase().includes(match)));\n              if (!dev && devices.length && matches.includes('back')) {\n                dev = devices[devices.length - 1]; // more likely the back cam\n              }\n              if (dev) {\n                constraints.video.deviceId = face.exact\n                  ? {exact: dev.deviceId}\n                  : {ideal: dev.deviceId};\n              }\n              constraints.video = constraintsToChrome_(constraints.video);\n              logging('chrome: ' + JSON.stringify(constraints));\n              return func(constraints);\n            });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  const shimError_ = function(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  const getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, c => {\n      navigator.webkitGetUserMedia(c, onSuccess, e => {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  if (navigator.mediaDevices.getUserMedia) {\n    const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, c => origGetUserMedia(c).then(stream => {\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(track => {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, e => Promise.reject(shimError_(e))));\n    };\n  }\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\n\nexport {shimGetUserMedia} from './getusermedia';\n\nexport function shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n      window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get() {\n        return this._ontrack;\n      },\n      set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    const origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        if (!this._ontrackpoly) {\n          this._ontrackpoly = (e) => {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', te => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === te.track.id);\n              } else {\n                receiver = {track: te.track};\n              }\n\n              const event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(track => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === track.id);\n              } else {\n                receiver = {track};\n              }\n              const event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n          };\n          this.addEventListener('addstream', this._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(this, arguments);\n      };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver',\n          {value: {receiver: e.receiver}});\n      }\n      return e;\n    });\n  }\n}\n\nexport function shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if (typeof window === 'object' && window.RTCPeerConnection &&\n      !('getSenders' in window.RTCPeerConnection.prototype) &&\n      'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    const shimSenderWithDtmf = function(pc, track) {\n      return {\n        track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack =\n        function addTrack(track, stream) {\n          let sender = origAddTrack.apply(this, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(this, track);\n            this._senders.push(sender);\n          }\n          return sender;\n        };\n\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack =\n        function removeTrack(sender) {\n          origRemoveTrack.apply(this, arguments);\n          const idx = this._senders.indexOf(sender);\n          if (idx !== -1) {\n            this._senders.splice(idx, 1);\n          }\n        };\n    }\n    const origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(track => {\n        this._senders.push(shimSenderWithDtmf(this, track));\n      });\n    };\n\n    const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        this._senders = this._senders || [];\n        origRemoveStream.apply(this, [stream]);\n\n        stream.getTracks().forEach(track => {\n          const sender = this._senders.find(s => s.track === track);\n          if (sender) { // remove sender\n            this._senders.splice(this._senders.indexOf(sender), 1);\n          }\n        });\n      };\n  } else if (typeof window === 'object' && window.RTCPeerConnection &&\n             'getSenders' in window.RTCPeerConnection.prototype &&\n             'createDTMFSender' in window.RTCPeerConnection.prototype &&\n             window.RTCRtpSender &&\n             !('dtmf' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nexport function shimSenderReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        const senders = origGetSenders.apply(this, []);\n        senders.forEach(sender => sender._pc = this);\n        return senders;\n      };\n    }\n\n    const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        const sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      const sender = this;\n      return this._pc.getStats().then(result =>\n        /* Note: this will include stats of all senders that\n         *   send a track with the same id as sender.track as\n         *   it is not possible to identify the RTCRtpSender.\n         */\n        utils.filterStats(result, sender.track, true));\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers =\n        function getReceivers() {\n          const receivers = origGetReceivers.apply(this, []);\n          receivers.forEach(receiver => receiver._pc = this);\n          return receivers;\n        };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      const receiver = this;\n      return this._pc.getStats().then(result =>\n        utils.filterStats(result, receiver.track, false));\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype &&\n      'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 &&\n        arguments[0] instanceof window.MediaStreamTrack) {\n      const track = arguments[0];\n      let sender;\n      let receiver;\n      let err;\n      this.getSenders().forEach(s => {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(r => {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || (sender && receiver)) {\n        return Promise.reject(new DOMException(\n          'There are more than one sender or receiver for the track.',\n          'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException(\n        'There is no sender or receiver for the track.',\n        'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nexport function shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams)\n        .map(streamId => this._shimmedLocalStreams[streamId][0]);\n    };\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      const sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n    });\n    const existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    const newSenders = this.getSenders()\n      .filter(newSender => existingSenders.indexOf(newSender) === -1);\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n  const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(streamId => {\n          const idx = this._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            this._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (this._shimmedLocalStreams[streamId].length === 1) {\n            delete this._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n}\n\nexport function shimAddTrackRemoveTrack(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack &&\n      browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  const origGetLocalStreams = window.RTCPeerConnection.prototype\n    .getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      const nativeStreams = origGetLocalStreams.apply(this);\n      this._reverseStreams = this._reverseStreams || {};\n      return nativeStreams.map(stream => this._reverseStreams[stream.id]);\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      const newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n\n      origRemoveStream.apply(this, [(this._streams[stream.id] || stream)]);\n      delete this._reverseStreams[(this._streams[stream.id] ?\n        this._streams[stream.id].id : stream.id)];\n      delete this._streams[stream.id];\n    };\n\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      const streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(t => t === track)) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n      const oldStream = this._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(() => {\n          this.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        const newStream = new window.MediaStream([track]);\n        this._streams[stream.id] = newStream;\n        this._reverseStreams[newStream.id] = stream;\n        this.addStream(newStream);\n      }\n      return this.getSenders().find(s => s.track === track);\n    };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n        externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n        internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function(method) {\n    const nativeMethod = window.RTCPeerConnection.prototype[method];\n    const methodObj = {[method]() {\n      const args = arguments;\n      const isLegacyCall = arguments.length &&\n          typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [\n          (description) => {\n            const desc = replaceInternalStreamId(this, description);\n            args[0].apply(null, [desc]);\n          },\n          (err) => {\n            if (args[1]) {\n              args[1].apply(null, err);\n            }\n          }, arguments[2]\n        ]);\n      }\n      return nativeMethod.apply(this, arguments)\n        .then(description => replaceInternalStreamId(this, description));\n    }};\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  const origSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(this, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(this, arguments[0]);\n      return origSetLocalDescription.apply(this, arguments);\n    };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  const origLocalDescription = Object.getOwnPropertyDescriptor(\n    window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype,\n    'localDescription', {\n      get() {\n        const description = origLocalDescription.get.apply(this);\n        if (description.type === '') {\n          return description;\n        }\n        return replaceInternalStreamId(this, description);\n      }\n    });\n\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      const isLocal = sender._pc === this;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n          'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      this._streams = this._streams || {};\n      let stream;\n      Object.keys(this._streams).forEach(streamid => {\n        const hasTrack = this._streams[streamid].getTracks()\n          .find(track => sender.track === track);\n        if (hasTrack) {\n          stream = this._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          this.removeStream(this._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        this.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n}\n\nexport function shimPeerConnection(window, browserDetails) {\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n      .forEach(function(method) {\n        const nativeMethod = window.RTCPeerConnection.prototype[method];\n        const methodObj = {[method]() {\n          arguments[0] = new ((method === 'addIceCandidate') ?\n            window.RTCIceCandidate :\n            window.RTCSessionDescription)(arguments[0]);\n          return nativeMethod.apply(this, arguments);\n        }};\n        window.RTCPeerConnection.prototype[method] = methodObj[method];\n      });\n  }\n}\n\n// Attempt to fix ONN in plan-b mode.\nexport function fixNegotiationNeeded(window, browserDetails) {\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', e => {\n    const pc = e.target;\n    if (browserDetails.version < 72 || (pc.getConfiguration &&\n        pc.getConfiguration().sdpSemantics === 'plan-b')) {\n      if (pc.signalingState !== 'stable') {\n        return;\n      }\n    }\n    return e;\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window, browserDetails) {\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n      'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      if (!(constraints && constraints.video)) {\n        const err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      ('receiver' in window.RTCTrackEvent.prototype) &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimPeerConnection(window, browserDetails) {\n  if (typeof window !== 'object' ||\n      !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  if (browserDetails.version < 53) {\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n      .forEach(function(method) {\n        const nativeMethod = window.RTCPeerConnection.prototype[method];\n        const methodObj = {[method]() {\n          arguments[0] = new ((method === 'addIceCandidate') ?\n            window.RTCIceCandidate :\n            window.RTCSessionDescription)(arguments[0]);\n          return nativeMethod.apply(this, arguments);\n        }};\n        window.RTCPeerConnection.prototype[method] = methodObj[method];\n      });\n  }\n\n  const modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n    return nativeGetStats.apply(this, [selector || null])\n      .then(stats => {\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(stat => {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            }\n            // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n            stats.forEach((stat, i) => {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n        return stats;\n      })\n      .then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n  }\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n      const sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function getStats() {\n    return this.track ? this._pc.getStats(this.track) :\n      Promise.resolve(new Map());\n  };\n}\n\nexport function shimReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n      const receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(receiver => receiver._pc = this);\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', e => {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function getStats() {\n    return this._pc.getStats(this.track);\n  };\n}\n\nexport function shimRemoveStream(window) {\n  if (!window.RTCPeerConnection ||\n      'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(sender => {\n        if (sender.track && stream.getTracks().includes(sender.track)) {\n          this.removeTrack(sender);\n        }\n      });\n    };\n}\n\nexport function shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\nexport function shimAddTransceiver(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;\n  if (origAddTransceiver) {\n    window.RTCPeerConnection.prototype.addTransceiver =\n      function addTransceiver() {\n        this.setParametersPromises = [];\n        // WebIDL input coercion and validation\n        let sendEncodings = arguments[1] && arguments[1].sendEncodings;\n        if (sendEncodings === undefined) {\n          sendEncodings = [];\n        }\n        sendEncodings = [...sendEncodings];\n        const shouldPerformCheck = sendEncodings.length > 0;\n        if (shouldPerformCheck) {\n          // If sendEncodings params are provided, validate grammar\n          sendEncodings.forEach((encodingParam) => {\n            if ('rid' in encodingParam) {\n              const ridRegex = /^[a-z0-9]{0,16}$/i;\n              if (!ridRegex.test(encodingParam.rid)) {\n                throw new TypeError('Invalid RID value provided.');\n              }\n            }\n            if ('scaleResolutionDownBy' in encodingParam) {\n              if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {\n                throw new RangeError('scale_resolution_down_by must be >= 1.0');\n              }\n            }\n            if ('maxFramerate' in encodingParam) {\n              if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {\n                throw new RangeError('max_framerate must be >= 0.0');\n              }\n            }\n          });\n        }\n        const transceiver = origAddTransceiver.apply(this, arguments);\n        if (shouldPerformCheck) {\n          // Check if the init options were applied. If not we do this in an\n          // asynchronous way and save the promise reference in a global object.\n          // This is an ugly hack, but at the same time is way more robust than\n          // checking the sender parameters before and after the createOffer\n          // Also note that after the createoffer we are not 100% sure that\n          // the params were asynchronously applied so we might miss the\n          // opportunity to recreate offer.\n          const {sender} = transceiver;\n          const params = sender.getParameters();\n          if (!('encodings' in params) ||\n              // Avoid being fooled by patched getParameters() below.\n              (params.encodings.length === 1 &&\n               Object.keys(params.encodings[0]).length === 0)) {\n            params.encodings = sendEncodings;\n            sender.sendEncodings = sendEncodings;\n            this.setParametersPromises.push(sender.setParameters(params)\n              .then(() => {\n                delete sender.sendEncodings;\n              }).catch(() => {\n                delete sender.sendEncodings;\n              })\n            );\n          }\n        }\n        return transceiver;\n      };\n  }\n}\n\nexport function shimGetParameters(window) {\n  if (!(typeof window === 'object' && window.RTCRtpSender)) {\n    return;\n  }\n  const origGetParameters = window.RTCRtpSender.prototype.getParameters;\n  if (origGetParameters) {\n    window.RTCRtpSender.prototype.getParameters =\n      function getParameters() {\n        const params = origGetParameters.apply(this, arguments);\n        if (!('encodings' in params)) {\n          params.encodings = [].concat(this.sendEncodings || [{}]);\n        }\n        return params;\n      };\n  }\n}\n\nexport function shimCreateOffer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function createOffer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n        .then(() => {\n          return origCreateOffer.apply(this, arguments);\n        })\n        .finally(() => {\n          this.setParametersPromises = [];\n        });\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\nexport function shimCreateAnswer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;\n  window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n        .then(() => {\n          return origCreateAnswer.apply(this, arguments);\n        })\n        .finally(() => {\n          this.setParametersPromises = [];\n        });\n    }\n    return origCreateAnswer.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track, ...streams) {\n        if (streams) {\n          streams.forEach((stream) => {\n            if (!this._localStreams) {\n              this._localStreams = [stream];\n            } else if (!this._localStreams.includes(stream)) {\n              this._localStreams.push(stream);\n            }\n          });\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n        .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (server.urls === undefined && server.url) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in OrigPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio', {direction: 'recvonly'});\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video', {direction: 'recvonly'});\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n\nexport function shimAudioContext(window) {\n  if (typeof window !== 'object' || window.AudioContext) {\n    return;\n  }\n  window.AudioContext = window.webkitAudioContext;\n}\n\n","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nconst SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substring(2, 12);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(line => line.trim());\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  const parts = blob.split('\\nm=');\n  return parts.map((part, index) => (index > 0 ?\n    'm=' + part : part).trim() + '\\r\\n');\n};\n\n// Returns the session description.\nSDPUtils.getDescription = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// Returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(line => line.indexOf(prefix) === 0);\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\n// Input can be prefixed with a=.\nSDPUtils.parseCandidate = function(line) {\n  let parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  const candidate = {\n    foundation: parts[0],\n    component: {1: 'rtp', 2: 'rtcp'}[parts[1]] || parts[1],\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7],\n  };\n\n  for (let i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compatibility.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag. Don't overwrite.\n        if (candidate[parts[i]] === undefined) {\n          candidate[parts[i]] = parts[i + 1];\n        }\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\n// This does not include the a= prefix!\nSDPUtils.writeCandidate = function(candidate) {\n  const sdp = [];\n  sdp.push(candidate.foundation);\n\n  const component = candidate.component;\n  if (component === 'rtp') {\n    sdp.push(1);\n  } else if (component === 'rtcp') {\n    sdp.push(2);\n  } else {\n    sdp.push(component);\n  }\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  const type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// Sample input:\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substring(14).split(' ');\n};\n\n// Parses a rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  let parts = line.substring(9).split(' ');\n  const parsed = {\n    payloadType: parseInt(parts.shift(), 10), // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generates a rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  const channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses a extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  const parts = line.substring(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1],\n    attributes: parts.slice(2).join(' '),\n  };\n};\n\n// Generates an extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri +\n      (headerExtension.attributes ? ' ' + headerExtension.attributes : '') +\n      '\\r\\n';\n};\n\n// Parses a fmtp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  const parsed = {};\n  let kv;\n  const parts = line.substring(line.indexOf(' ') + 1).split(';');\n  for (let j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates a fmtp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  let line = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    const params = [];\n    Object.keys(codec.parameters).forEach(param => {\n      if (codec.parameters[param] !== undefined) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses a rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  const parts = line.substring(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' '),\n  };\n};\n\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  let lines = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(fb => {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses a RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  const sp = line.indexOf(' ');\n  const parts = {\n    ssrc: parseInt(line.substring(7, sp), 10),\n  };\n  const colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substring(sp + 1, colon);\n    parts.value = line.substring(colon + 1);\n  } else {\n    parts.attribute = line.substring(sp + 1);\n  }\n  return parts;\n};\n\n// Parse a ssrc-group line (see RFC 5576). Sample input:\n// a=ssrc-group:semantics 12 34\nSDPUtils.parseSsrcGroup = function(line) {\n  const parts = line.substring(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(ssrc => parseInt(ssrc, 10)),\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// Returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  const mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substring(6);\n  }\n};\n\n// Parses a fingerprint line for DTLS-SRTP.\nSDPUtils.parseFingerprint = function(line) {\n  const parts = line.substring(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1].toUpperCase(), // the definition is upper-case in RFC 4572.\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint),\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  let sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(fp => {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n\n// Parses a=crypto lines into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members\nSDPUtils.parseCryptoLine = function(line) {\n  const parts = line.substring(9).split(' ');\n  return {\n    tag: parseInt(parts[0], 10),\n    cryptoSuite: parts[1],\n    keyParams: parts[2],\n    sessionParams: parts.slice(3),\n  };\n};\n\nSDPUtils.writeCryptoLine = function(parameters) {\n  return 'a=crypto:' + parameters.tag + ' ' +\n    parameters.cryptoSuite + ' ' +\n    (typeof parameters.keyParams === 'object'\n      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)\n      : parameters.keyParams) +\n    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +\n    '\\r\\n';\n};\n\n// Parses the crypto key parameters into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*\nSDPUtils.parseCryptoKeyParams = function(keyParams) {\n  if (keyParams.indexOf('inline:') !== 0) {\n    return null;\n  }\n  const parts = keyParams.substring(7).split('|');\n  return {\n    keyMethod: 'inline',\n    keySalt: parts[0],\n    lifeTime: parts[1],\n    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,\n    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,\n  };\n};\n\nSDPUtils.writeCryptoKeyParams = function(keyParams) {\n  return keyParams.keyMethod + ':'\n    + keyParams.keySalt +\n    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +\n    (keyParams.mkiValue && keyParams.mkiLength\n      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength\n      : '');\n};\n\n// Extracts all SDES parameters.\nSDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=crypto:');\n  return lines.map(SDPUtils.parseCryptoLine);\n};\n\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  const ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-ufrag:')[0];\n  const pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-pwd:')[0];\n  if (!(ufrag && pwd)) {\n    return null;\n  }\n  return {\n    usernameFragment: ufrag.substring(12),\n    password: pwd.substring(10),\n  };\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  let sdp = 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n  if (params.iceLite) {\n    sdp += 'a=ice-lite\\r\\n';\n  }\n  return sdp;\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  const description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: [],\n  };\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  description.profile = mline[2];\n  for (let i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    const pt = mline[i];\n    const rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      const codec = SDPUtils.parseRtpMap(rtpmapline);\n      const fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(line => {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  const wildcardRtcpFb = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-fb:* ')\n    .map(SDPUtils.parseRtcpFb);\n  description.codecs.forEach(codec => {\n    wildcardRtcpFb.forEach(fb=> {\n      const duplicate = codec.rtcpFeedback.find(existingFeedback => {\n        return existingFeedback.type === fb.type &&\n          existingFeedback.parameter === fb.parameter;\n      });\n      if (!duplicate) {\n        codec.rtcpFeedback.push(fb);\n      }\n    });\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  let sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' ' + (caps.profile || 'UDP/TLS/RTP/SAVPF') + ' ';\n  sdp += caps.codecs.map(codec => {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(codec => {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  let maxptime = 0;\n  caps.codecs.forEach(codec => {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(extension => {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  const encodingParameters = [];\n  const description = SDPUtils.parseRtpParameters(mediaSection);\n  const hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  const hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  const ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(parts => parts.attribute === 'cname');\n  const primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  let secondarySsrc;\n\n  const flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(line => {\n      const parts = line.substring(17).split(' ');\n      return parts.map(part => parseInt(part, 10));\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(codec => {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      let encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red',\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc,\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  let bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substring(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substring(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(params => {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  const rtcpParameters = {};\n\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  const remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(obj => obj.attribute === 'cname')[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  const rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrіbute.\n  // Note that Edge does not support unmuxed RTCP.\n  const mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\nSDPUtils.writeRtcpParameters = function(rtcpParameters) {\n  let sdp = '';\n  if (rtcpParameters.reducedSize) {\n    sdp += 'a=rtcp-rsize\\r\\n';\n  }\n  if (rtcpParameters.mux) {\n    sdp += 'a=rtcp-mux\\r\\n';\n  }\n  if (rtcpParameters.ssrc !== undefined && rtcpParameters.cname) {\n    sdp += 'a=ssrc:' + rtcpParameters.ssrc +\n      ' cname:' + rtcpParameters.cname + '\\r\\n';\n  }\n  return sdp;\n};\n\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  let parts;\n  const spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substring(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  const planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(msidParts => msidParts.attribute === 'msid');\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  const mline = SDPUtils.parseMLine(mediaSection);\n  const maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  let maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substring(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  const sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substring(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize,\n    };\n  }\n  const sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    const parts = sctpMapLines[0]\n      .substring(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize,\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  let output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n',\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n',\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 22);\n};\n\n// Write boiler plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  let sessionId;\n  const version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  const user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  const lines = SDPUtils.splitLines(mediaSection);\n  for (let i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substring(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  return mline[0].substring(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const parts = lines[0].substring(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' '),\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  const line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  const parts = line.substring(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5],\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  const lines = SDPUtils.splitLines(blob);\n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport SDPUtils from 'sdp';\nimport * as utils from './utils';\n\nexport function shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  const NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function RTCIceCandidate(args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if (typeof args === 'object' && args.candidate &&\n        args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substring(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      const nativeCandidate = new NativeRTCIceCandidate(args);\n      const parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      for (const key in parsedCandidate) {\n        if (!(key in nativeCandidate)) {\n          Object.defineProperty(nativeCandidate, key,\n            {value: parsedCandidate[key]});\n        }\n      }\n\n      // Override serializer to not serialize the extra attributes.\n      nativeCandidate.toJSON = function toJSON() {\n        return {\n          candidate: nativeCandidate.candidate,\n          sdpMid: nativeCandidate.sdpMid,\n          sdpMLineIndex: nativeCandidate.sdpMLineIndex,\n          usernameFragment: nativeCandidate.usernameFragment,\n        };\n      };\n      return nativeCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nexport function shimRTCIceCandidateRelayProtocol(window) {\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'relayProtocol' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      const parsedCandidate = SDPUtils.parseCandidate(e.candidate.candidate);\n      if (parsedCandidate.type === 'relay') {\n        // This is a libwebrtc-specific mapping of local type preference\n        // to relayProtocol.\n        e.candidate.relayProtocol = {\n          0: 'tls',\n          1: 'tcp',\n          2: 'udp',\n        }[parsedCandidate.priority >> 24];\n      }\n    }\n    return e;\n  });\n}\n\nexport function shimMaxMessageSize(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  const sctpInDescription = function(description) {\n    if (!description || !description.sdp) {\n      return false;\n    }\n    const sections = SDPUtils.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(mediaSection => {\n      const mLine = SDPUtils.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application'\n          && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  const getRemoteFirefoxVersion = function(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    const version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  const getCanSendMaxMessageSize = function(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    let canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize =\n          browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  const getMaxMessageSize = function(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    let maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox'\n         && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    const match = SDPUtils.matchPrefix(description.sdp,\n      'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substring(19), 10);\n    } else if (browserDetails.browser === 'firefox' &&\n                remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n    function setRemoteDescription() {\n      this._sctp = null;\n      // Chrome decided to not expose .sctp in plan-b mode.\n      // As usual, adapter.js has to do an 'ugly worakaround'\n      // to cover up the mess.\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\n        const {sdpSemantics} = this.getConfiguration();\n        if (sdpSemantics === 'plan-b') {\n          Object.defineProperty(this, 'sctp', {\n            get() {\n              return typeof this._sctp === 'undefined' ? null : this._sctp;\n            },\n            enumerable: true,\n            configurable: true,\n          });\n        }\n      }\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        const isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        const canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        let maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        const sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get() {\n            return maxMessageSize;\n          }\n        });\n        this._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n}\n\nexport function shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection &&\n      'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    const origDataChannelSend = dc.send;\n    dc.send = function send() {\n      const data = arguments[0];\n      const length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' &&\n          pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' +\n          pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  const origCreateDataChannel =\n    window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel =\n    function createDataChannel() {\n      const dataChannel = origCreateDataChannel.apply(this, arguments);\n      wrapDcSend(dataChannel, this);\n      return dataChannel;\n    };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', e => {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nexport function shimConnectionState(window) {\n  if (!window.RTCPeerConnection ||\n      'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get() {\n      return this._onconnectionstatechange || null;\n    },\n    set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange',\n          this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange',\n          this._onconnectionstatechange = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\n    const origMethod = proto[method];\n    proto[method] = function() {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = e => {\n          const pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            const newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange',\n          this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nexport function removeExtmapAllowMixed(window, browserDetails) {\n  /* remove a=extmap-allow-mixed for webrtc.org < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  if (browserDetails.browser === 'safari' &&\n      browserDetails._safariVersion >= 13.1) {\n    return;\n  }\n  const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n  function setRemoteDescription(desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      const sdp = desc.sdp.split('\\n').filter((line) => {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n      // Safari enforces read-only-ness of RTCSessionDescription fields.\n      if (window.RTCSessionDescription &&\n          desc instanceof window.RTCSessionDescription) {\n        arguments[0] = new window.RTCSessionDescription({\n          type: desc.type,\n          sdp,\n        });\n      } else {\n        desc.sdp = sdp;\n      }\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n\nexport function shimAddIceCandidateNullOrEmpty(window, browserDetails) {\n  // Support for addIceCandidate(null or undefined)\n  // as well as addIceCandidate({candidate: \"\", ...})\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=978582\n  // Note: must be called before other polyfills which change the signature.\n  if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {\n    return;\n  }\n  const nativeAddIceCandidate =\n      window.RTCPeerConnection.prototype.addIceCandidate;\n  if (!nativeAddIceCandidate || nativeAddIceCandidate.length === 0) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions.\n      // Native support for ignoring exists for Chrome M77+.\n      // Safari ignores as well, exact version unknown but works in the same\n      // version that also ignores addIceCandidate(null).\n      if (((browserDetails.browser === 'chrome' && browserDetails.version < 78)\n           || (browserDetails.browser === 'firefox'\n               && browserDetails.version < 68)\n           || (browserDetails.browser === 'safari'))\n          && arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n}\n\n// Note: Make sure to call this ahead of APIs that modify\n// setLocalDescription.length\nexport function shimParameterlessSetLocalDescription(window, browserDetails) {\n  if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {\n    return;\n  }\n  const nativeSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  if (!nativeSetLocalDescription || nativeSetLocalDescription.length === 0) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      let desc = arguments[0] || {};\n      if (typeof desc !== 'object' || (desc.type && desc.sdp)) {\n        return nativeSetLocalDescription.apply(this, arguments);\n      }\n      // The remaining steps should technically happen when SLD comes off the\n      // RTCPeerConnection's operations chain (not ahead of going on it), but\n      // this is too difficult to shim. Instead, this shim only covers the\n      // common case where the operations chain is empty. This is imperfect, but\n      // should cover many cases. Rationale: Even if we can't reduce the glare\n      // window to zero on imperfect implementations, there's value in tapping\n      // into the perfect negotiation pattern that several browsers support.\n      desc = {type: desc.type, sdp: desc.sdp};\n      if (!desc.type) {\n        switch (this.signalingState) {\n          case 'stable':\n          case 'have-local-offer':\n          case 'have-remote-pranswer':\n            desc.type = 'offer';\n            break;\n          default:\n            desc.type = 'answer';\n            break;\n        }\n      }\n      if (desc.sdp || (desc.type !== 'offer' && desc.type !== 'answer')) {\n        return nativeSetLocalDescription.apply(this, [desc]);\n      }\n      const func = desc.type === 'offer' ? this.createOffer : this.createAnswer;\n      return func.apply(this)\n        .then(d => nativeSetLocalDescription.apply(this, [d]));\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n// Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\nimport * as sdp from 'sdp';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings,\n    // Expose sdp as a convenience. For production apps include directly.\n    sdp,\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      if (browserDetails.version === null) {\n        logging('Chrome shim can not determine version, not shimming.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      chromeShim.shimGetUserMedia(window, browserDetails);\n      chromeShim.shimMediaStream(window, browserDetails);\n      chromeShim.shimPeerConnection(window, browserDetails);\n      chromeShim.shimOnTrack(window, browserDetails);\n      chromeShim.shimAddTrackRemoveTrack(window, browserDetails);\n      chromeShim.shimGetSendersWithDtmf(window, browserDetails);\n      chromeShim.shimSenderReceiverGetStats(window, browserDetails);\n      chromeShim.fixNegotiationNeeded(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      firefoxShim.shimGetUserMedia(window, browserDetails);\n      firefoxShim.shimPeerConnection(window, browserDetails);\n      firefoxShim.shimOnTrack(window, browserDetails);\n      firefoxShim.shimRemoveStream(window, browserDetails);\n      firefoxShim.shimSenderGetStats(window, browserDetails);\n      firefoxShim.shimReceiverGetStats(window, browserDetails);\n      firefoxShim.shimRTCDataChannel(window, browserDetails);\n      firefoxShim.shimAddTransceiver(window, browserDetails);\n      firefoxShim.shimGetParameters(window, browserDetails);\n      firefoxShim.shimCreateOffer(window, browserDetails);\n      firefoxShim.shimCreateAnswer(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      // Must be called before shimCallbackAPI.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      safariShim.shimRTCIceServerUrls(window, browserDetails);\n      safariShim.shimCreateOfferLegacy(window, browserDetails);\n      safariShim.shimCallbacksAPI(window, browserDetails);\n      safariShim.shimLocalStreamsAPI(window, browserDetails);\n      safariShim.shimRemoteStreamsAPI(window, browserDetails);\n      safariShim.shimTrackEventTransceiver(window, browserDetails);\n      safariShim.shimGetUserMedia(window, browserDetails);\n      safariShim.shimAudioContext(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nimport {adapterFactory} from './adapter_factory.js';\n\nconst adapter =\n  adapterFactory({window: typeof window === 'undefined' ? undefined : window});\nexport default adapter;\n","/**\n * WebRTCVideoCell Component\n * A self-contained component for displaying a WebRTC video stream\n */\n\nimport { h } from 'preact';\nimport { useState, useEffect, useRef } from 'preact/hooks';\nimport { DetectionOverlay, takeSnapshotWithDetections } from './DetectionOverlay.jsx';\nimport { SnapshotButton } from './SnapshotManager.jsx';\nimport { LoadingIndicator } from './LoadingIndicator.jsx';\nimport { showSnapshotPreview } from './UI.jsx';\nimport adapter from 'webrtc-adapter';\n\n/**\n * WebRTCVideoCell component\n * @param {Object} props - Component props\n * @param {Object} props.stream - Stream object\n * @param {Function} props.onToggleFullscreen - Fullscreen toggle handler\n * @param {string} props.streamId - Stream ID for stable reference\n * @returns {JSX.Element} WebRTCVideoCell component\n */\nexport function WebRTCVideoCell({\n  stream,\n  streamId,\n  onToggleFullscreen\n}) {\n  // Component state\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [connectionQuality, setConnectionQuality] = useState('unknown'); // 'unknown', 'good', 'poor', 'bad'\n\n  // Refs\n  const videoRef = useRef(null);\n  const cellRef = useRef(null);\n  const peerConnectionRef = useRef(null);\n  const detectionOverlayRef = useRef(null);\n  const abortControllerRef = useRef(null);\n  const connectionMonitorRef = useRef(null);\n  const reconnectAttemptsRef = useRef(0);\n\n  // Initialize WebRTC connection when component mounts\n  useEffect(() => {\n    if (!stream || !stream.name || !videoRef.current) return;\n\n    console.log(`Initializing WebRTC connection for stream ${stream.name}`);\n    setIsLoading(true);\n    setError(null);\n\n    // Create a new RTCPeerConnection\n    const pc = new RTCPeerConnection({\n      iceTransports: 'all',\n      bundlePolicy: 'balanced',\n      rtcpCnameCpn: 'LightNVR',\n      rtcpCnameRtp: 'LightNVR',\n      iceCandidatePoolSize: 0,\n      iceServers: [\n        { urls: 'stun:stun.l.google.com:19302' },\n      ]\n    });\n\n    peerConnectionRef.current = pc;\n\n    // Set up event handlers\n    pc.ontrack = (event) => {\n      console.log(`Track received for stream ${stream.name}`);\n      \n      if (event.track.kind === 'video') {\n        const videoElement = videoRef.current;\n        if (!videoElement) return;\n\n        // Set srcObject\n        videoElement.srcObject = event.streams[0];\n        \n        // Add event handlers\n        videoElement.onloadeddata = () => {\n          console.log(`Video data loaded for stream ${stream.name}`);\n        };\n\n        videoElement.onplaying = () => {\n          console.log(`Video playing for stream ${stream.name}`);\n          setIsLoading(false);\n          setIsPlaying(true);\n        };\n        videoElement.onerror = (event) => {\n          console.error(`Error loading video for stream ${stream.name}:`, event);\n          setError('Failed to load video');\n          setIsLoading(false);\n        };\n      }\n    };\n\n    pc.oniceconnectionstatechange = () => {\n      console.log(`ICE connection state for stream ${stream.name}: ${pc.iceConnectionState}`);\n      \n      if (pc.iceConnectionState === 'failed') {\n        console.error(`WebRTC ICE connection failed for stream ${stream.name}`);\n        setError('WebRTC ICE connection failed');\n        setIsLoading(false);\n      } else if (pc.iceConnectionState === 'disconnected') {\n        // Connection is temporarily disconnected, log but don't show error yet\n        console.warn(`WebRTC ICE connection disconnected for stream ${stream.name}, attempting to recover...`);\n        \n        // Set a timeout to check if the connection recovers on its own\n        setTimeout(() => {\n          if (peerConnectionRef.current && \n              (peerConnectionRef.current.iceConnectionState === 'disconnected' || \n               peerConnectionRef.current.iceConnectionState === 'failed')) {\n            console.error(`WebRTC ICE connection could not recover for stream ${stream.name}`);\n            setError('WebRTC connection lost. Please retry.');\n            setIsLoading(false);\n          } else if (peerConnectionRef.current) {\n            console.log(`WebRTC ICE connection recovered for stream ${stream.name}, current state: ${peerConnectionRef.current.iceConnectionState}`);\n          }\n        }, 5000); // Wait 5 seconds to see if connection recovers\n      } else if (pc.iceConnectionState === 'connected' || pc.iceConnectionState === 'completed') {\n        // Connection is established or completed, clear any previous error\n        if (error) {\n          console.log(`WebRTC connection restored for stream ${stream.name}`);\n          setError(null);\n        }\n      }\n    };\n\n    // Add transceivers\n    pc.addTransceiver('video', {direction: 'recvonly'});\n\n    // Create and send offer\n    pc.createOffer()\n      .then(offer => pc.setLocalDescription(offer))\n      .then(() => {\n        // Create a new AbortController for this request\n        abortControllerRef.current = new AbortController();\n        \n        // Format the offer\n        const formattedOffer = {\n          type: pc.localDescription.type,\n          sdp: pc.localDescription.sdp\n        };\n\n        // Get auth token if available\n        const auth = localStorage.getItem('auth');\n\n        // Send the offer to the server\n        return fetch(`/api/webrtc?src=${encodeURIComponent(stream.name)}`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            ...(auth ? { 'Authorization': 'Basic ' + auth } : {})\n          },\n          body: JSON.stringify(formattedOffer),\n        });\n      })\n      .then(response => {\n        if (!response.ok) {\n          throw new Error(`Failed to send offer: ${response.status} ${response.statusText}`);\n        }\n        return response.text();\n      })\n      .then(text => {\n        try {\n          return JSON.parse(text);\n        } catch (error) {\n          console.error(`Error parsing JSON for stream ${stream.name}:`, error);\n          throw new Error('Failed to parse WebRTC answer');\n        }\n      })\n      .then(answer => pc.setRemoteDescription(new RTCSessionDescription(answer)))\n      .catch(error => {\n        console.error(`Error setting up WebRTC for stream ${stream.name}:`, error);\n        setError(error.message || 'Failed to establish WebRTC connection');\n      });\n\n    // Set up connection quality monitoring\n    const startConnectionMonitoring = () => {\n      // Clear any existing monitor\n      if (connectionMonitorRef.current) {\n        clearInterval(connectionMonitorRef.current);\n      }\n      \n      // Start a new monitor\n      connectionMonitorRef.current = setInterval(() => {\n        if (!peerConnectionRef.current) return;\n        \n        // Get connection stats\n        peerConnectionRef.current.getStats().then(stats => {\n          let packetsLost = 0;\n          let packetsReceived = 0;\n          let currentRtt = 0;\n          let jitter = 0;\n          \n          stats.forEach(report => {\n            if (report.type === 'inbound-rtp' && report.kind === 'video') {\n              packetsLost = report.packetsLost || 0;\n              packetsReceived = report.packetsReceived || 0;\n              jitter = report.jitter || 0;\n            }\n            \n            if (report.type === 'candidate-pair' && report.state === 'succeeded') {\n              currentRtt = report.currentRoundTripTime || 0;\n            }\n          });\n          \n          // Calculate packet loss percentage\n          const totalPackets = packetsReceived + packetsLost;\n          const lossPercentage = totalPackets > 0 ? (packetsLost / totalPackets) * 100 : 0;\n          \n          // Determine connection quality\n          let quality = 'unknown';\n          \n          if (packetsReceived > 0) {\n            if (lossPercentage < 2 && currentRtt < 0.1 && jitter < 0.03) {\n              quality = 'good';\n            } else if (lossPercentage < 5 && currentRtt < 0.3 && jitter < 0.1) {\n              quality = 'fair';\n            } else if (lossPercentage < 15 && currentRtt < 1) {\n              quality = 'poor';\n            } else {\n              quality = 'bad';\n            }\n          }\n          \n          // Update connection quality state if changed\n          if (quality !== connectionQuality) {\n            console.log(`WebRTC connection quality for stream ${stream.name} changed to ${quality}`);\n            console.log(`Stats: loss=${lossPercentage.toFixed(2)}%, rtt=${(currentRtt * 1000).toFixed(0)}ms, jitter=${(jitter * 1000).toFixed(0)}ms`);\n            setConnectionQuality(quality);\n          }\n        }).catch(err => {\n          console.warn(`Error getting WebRTC stats for stream ${stream.name}:`, err);\n        });\n      }, 10000); // Check every 10 seconds\n    };\n    \n    // Start monitoring once we have a connection\n    if (peerConnectionRef.current && peerConnectionRef.current.iceConnectionState === 'connected') {\n      startConnectionMonitoring();\n    }\n    \n    // Listen for connection state changes to start/stop monitoring\n    const originalOnIceConnectionStateChange = pc.oniceconnectionstatechange;\n    pc.oniceconnectionstatechange = () => {\n      // Call the original handler\n      if (originalOnIceConnectionStateChange) {\n        originalOnIceConnectionStateChange();\n      }\n      \n      // Start monitoring when connected\n      if (pc.iceConnectionState === 'connected' || pc.iceConnectionState === 'completed') {\n        startConnectionMonitoring();\n        // Reset reconnect attempts counter when we get a good connection\n        reconnectAttemptsRef.current = 0;\n      }\n      \n      // Stop monitoring when disconnected or failed\n      if (pc.iceConnectionState === 'disconnected' || pc.iceConnectionState === 'failed' || pc.iceConnectionState === 'closed') {\n        if (connectionMonitorRef.current) {\n          clearInterval(connectionMonitorRef.current);\n          connectionMonitorRef.current = null;\n        }\n      }\n    };\n\n    // Cleanup function\n    return () => {\n      console.log(`Cleaning up WebRTC connection for stream ${stream.name}`);\n      \n      // Stop connection monitoring\n      if (connectionMonitorRef.current) {\n        clearInterval(connectionMonitorRef.current);\n        connectionMonitorRef.current = null;\n      }\n      \n      // Abort any pending fetch requests\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n        abortControllerRef.current = null;\n      }\n      \n      // Clean up video element\n      if (videoRef.current && videoRef.current.srcObject) {\n        const tracks = videoRef.current.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n        videoRef.current.srcObject = null;\n      }\n      \n      // Close peer connection\n      if (peerConnectionRef.current) {\n        peerConnectionRef.current.close();\n        peerConnectionRef.current = null;\n      }\n    };\n  }, [stream]);\n\n  // Handle retry button click\n  const handleRetry = () => {\n    // Force a re-render to restart the WebRTC connection\n    setError(null);\n    setIsLoading(true);\n    \n    // Clean up existing connection\n    if (peerConnectionRef.current) {\n      peerConnectionRef.current.close();\n      peerConnectionRef.current = null;\n    }\n    \n    if (videoRef.current && videoRef.current.srcObject) {\n      const tracks = videoRef.current.srcObject.getTracks();\n      tracks.forEach(track => track.stop());\n      videoRef.current.srcObject = null;\n    }\n\n    // Force a re-render by updating state\n    setIsPlaying(false);\n  };\n\n  return (\n    <div\n      className=\"video-cell\"\n      data-stream-name={stream.name}\n      data-stream-id={streamId}\n      ref={cellRef}\n      style={{\n        position: 'relative',\n        pointerEvents: 'auto',\n        zIndex: 1\n      }}\n    >\n      {/* Video element */}\n      <video\n        id={`video-${streamId.replace(/\\s+/g, '-')}`}\n        className=\"video-element\"\n        ref={videoRef}\n        autoPlay\n        muted\n        disablePictureInPicture\n        playsInline\n        style={{ width: '100%', height: '100%', objectFit: 'contain' }}\n      />\n\n      {/* Detection overlay component */}\n      {stream.detection_based_recording && stream.detection_model && (\n        <DetectionOverlay\n          ref={detectionOverlayRef}\n          streamName={stream.name}\n          videoRef={videoRef}\n          enabled={isPlaying}\n          detectionModel={stream.detection_model}\n        />\n      )}\n\n      {/* Stream name overlay with connection quality indicator */}\n      <div\n        className=\"stream-name-overlay\"\n        style={{\n          position: 'absolute',\n          top: '10px',\n          left: '10px',\n          padding: '5px 10px',\n          backgroundColor: 'rgba(0, 0, 0, 0.5)',\n          color: 'white',\n          borderRadius: '4px',\n          fontSize: '14px',\n          zIndex: 3,\n          display: 'flex',\n          alignItems: 'center',\n          gap: '8px'\n        }}\n      >\n        {stream.name}\n        \n        {/* Connection quality indicator - only show when we have quality data and stream is playing */}\n        {isPlaying && connectionQuality !== 'unknown' && (\n          <div \n            className={`connection-quality-indicator quality-${connectionQuality}`}\n            title={`Connection Quality: ${connectionQuality.charAt(0).toUpperCase() + connectionQuality.slice(1)}`}\n            style={{\n              width: '10px',\n              height: '10px',\n              borderRadius: '50%',\n              backgroundColor: \n                connectionQuality === 'good' ? '#10B981' :  // Green\n                connectionQuality === 'fair' ? '#FBBF24' :  // Yellow\n                connectionQuality === 'poor' ? '#F97316' :  // Orange\n                connectionQuality === 'bad' ? '#EF4444' :   // Red\n                '#6B7280',                                  // Gray (unknown)\n              boxShadow: '0 0 4px rgba(0, 0, 0, 0.3)'\n            }}\n          />\n        )}\n      </div>\n\n      {/* Stream controls */}\n      <div\n        className=\"stream-controls\"\n        style={{\n          position: 'absolute',\n          bottom: '10px',\n          right: '10px',\n          display: 'flex',\n          gap: '10px',\n          zIndex: 5,\n          backgroundColor: 'rgba(0, 0, 0, 0.5)',\n          padding: '5px',\n          borderRadius: '4px'\n        }}\n      >\n        <div\n          style={{\n            backgroundColor: 'transparent',\n            padding: '5px',\n            borderRadius: '4px'\n          }}\n          onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.2)'}\n          onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'transparent'}\n        >\n          <SnapshotButton\n            streamId={streamId}\n            streamName={stream.name}\n            onSnapshot={() => {\n              if (videoRef.current) {\n                let canvasRef = null;\n\n                // Try to get canvas ref from detection overlay if available\n                if (detectionOverlayRef.current && typeof detectionOverlayRef.current.getCanvasRef === 'function') {\n                  canvasRef = detectionOverlayRef.current.getCanvasRef();\n                }\n\n                // Take snapshot with or without detections\n                if (canvasRef) {\n                  const snapshot = takeSnapshotWithDetections(videoRef, canvasRef, stream.name);\n                  if (snapshot) {\n                    showSnapshotPreview(snapshot.canvas.toDataURL('image/jpeg', 0.95), `Snapshot: ${stream.name}`);\n                  }\n                } else {\n                  // Take a simple snapshot without detections\n                  const videoElement = videoRef.current;\n                  const canvas = document.createElement('canvas');\n                  canvas.width = videoElement.videoWidth;\n                  canvas.height = videoElement.videoHeight;\n\n                  if (canvas.width > 0 && canvas.height > 0) {\n                    const ctx = canvas.getContext('2d');\n                    ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);\n\n                    showSnapshotPreview(canvas.toDataURL('image/jpeg', 0.95), `Snapshot: ${stream.name}`);\n                  }\n                }\n              }\n            }}\n          />\n        </div>\n        <button\n          className=\"fullscreen-btn\"\n          title=\"Toggle Fullscreen\"\n          data-id={streamId}\n          data-name={stream.name}\n          onClick={(e) => onToggleFullscreen(stream.name, e, cellRef.current)}\n          style={{\n            backgroundColor: 'transparent',\n            border: 'none',\n            padding: '5px',\n            borderRadius: '4px',\n            color: 'white',\n            cursor: 'pointer'\n          }}\n          onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.2)'}\n          onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'transparent'}\n        >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3\"></path></svg>\n        </button>\n      </div>\n\n      {/* Loading indicator */}\n      {isLoading && (\n        <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, zIndex: 5, pointerEvents: 'none' }}>\n          <LoadingIndicator message=\"Connecting...\" />\n        </div>\n      )}\n\n      {/* Error indicator */}\n      {error && (\n        <div\n          className=\"error-indicator\"\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            right: 0,\n            bottom: 0,\n            width: '100%',\n            height: '100%',\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'center',\n            alignItems: 'center',\n            backgroundColor: 'rgba(0, 0, 0, 0.7)',\n            color: 'white',\n            zIndex: 5,\n            textAlign: 'center'\n          }}\n        >\n          <div\n            className=\"error-content\"\n            style={{\n              display: 'flex',\n              flexDirection: 'column',\n              justifyContent: 'center',\n              alignItems: 'center',\n              width: '80%',\n              maxWidth: '300px',\n              padding: '20px',\n              borderRadius: '8px',\n              backgroundColor: 'rgba(0, 0, 0, 0.5)'\n            }}\n          >\n            <div\n              className=\"error-icon\"\n              style={{\n                fontSize: '28px',\n                marginBottom: '15px',\n                fontWeight: 'bold',\n                width: '40px',\n                height: '40px',\n                lineHeight: '40px',\n                borderRadius: '50%',\n                backgroundColor: 'rgba(220, 38, 38, 0.8)',\n                textAlign: 'center'\n              }}\n            >\n              !\n            </div>\n            <p style={{\n              marginBottom: '20px',\n              textAlign: 'center',\n              width: '100%',\n              fontSize: '14px',\n              lineHeight: '1.4'\n            }}>\n              {error}\n            </p>\n            <button\n              className=\"retry-button\"\n              onClick={handleRetry}\n              style={{\n                padding: '8px 20px',\n                backgroundColor: '#2563eb',\n                color: 'white',\n                borderRadius: '4px',\n                border: 'none',\n                cursor: 'pointer',\n                fontWeight: 'bold',\n                fontSize: '14px',\n                boxShadow: '0 2px 4px rgba(0, 0, 0, 0.2)',\n                transition: 'background-color 0.2s ease'\n              }}\n              onMouseOver={(e) => e.currentTarget.style.backgroundColor = '#1d4ed8'}\n              onMouseOut={(e) => e.currentTarget.style.backgroundColor = '#2563eb'}\n            >\n              Retry\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\n * LightNVR Web Interface WebRTCView Component\n * Preact component for the WebRTC view page\n */\n\nimport { useState, useEffect, useRef, useCallback, useMemo } from 'preact/hooks';\nimport { setupModals, addModalStyles } from './UI.jsx';\nimport { showStatusMessage } from './ToastContainer.jsx';\nimport { useFullscreenManager, FullscreenManager } from './FullscreenManager.jsx';\nimport { useQuery, useQueryClient } from '../../query-client.js';\nimport { WebRTCVideoCell } from './WebRTCVideoCell.jsx';\nimport { SnapshotManager, useSnapshotManager } from './SnapshotManager.jsx';\n\n/**\n * WebRTCView component\n * @returns {JSX.Element} WebRTCView component\n */\nexport function WebRTCView() {\n  // Use the snapshot manager hook\n  const { takeSnapshot } = useSnapshotManager();\n\n  // Use the fullscreen manager hook\n  const { isFullscreen, setIsFullscreen, toggleFullscreen } = useFullscreenManager();\n\n  // State for streams and layout\n  const [streams, setStreams] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Initialize layout from URL or sessionStorage if available\n  const [layout, setLayout] = useState(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const layoutParam = urlParams.get('layout');\n    if (layoutParam) {\n      return layoutParam;\n    }\n    // Check sessionStorage as a backup\n    const storedLayout = sessionStorage.getItem('webrtc_layout');\n    return storedLayout || '4';\n  });\n\n  // Initialize selectedStream from URL or sessionStorage if available\n  const [selectedStream, setSelectedStream] = useState(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const streamParam = urlParams.get('stream');\n    if (streamParam) {\n      return streamParam;\n    }\n    // Check sessionStorage as a backup\n    const storedStream = sessionStorage.getItem('webrtc_selected_stream');\n    return storedStream || '';\n  });\n\n  // Initialize currentPage from URL or sessionStorage if available (URL uses 1-based indexing, internal state uses 0-based)\n  const [currentPage, setCurrentPage] = useState(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const pageParam = urlParams.get('page');\n    if (pageParam) {\n      // Convert from 1-based (URL) to 0-based (internal)\n      return Math.max(0, parseInt(pageParam, 10) - 1);\n    }\n    // Check sessionStorage as a backup\n    const storedPage = sessionStorage.getItem('webrtc_current_page');\n    if (storedPage) {\n      // Convert from 1-based (stored) to 0-based (internal)\n      return Math.max(0, parseInt(storedPage, 10) - 1);\n    }\n    return 0;\n  });\n\n  // Get query client for fetching and invalidating queries\n  const queryClient = useQueryClient();\n\n  // Set up event listeners and UI components\n  useEffect(() => {\n    // Set up modals for snapshot preview\n    setupModals();\n    addModalStyles();\n  }, []);\n\n  // Fetch streams using preact-query\n  const {\n    data: streamsData,\n    isLoading: isLoadingStreams,\n    error: streamsError\n  } = useQuery(\n    'streams',\n    '/api/streams',\n    {\n      timeout: 15000, // 15 second timeout\n      retries: 2,     // Retry twice\n      retryDelay: 1000 // 1 second between retries\n    }\n  );\n\n  // Update loading state based on streams query status\n  useEffect(() => {\n    setIsLoading(isLoadingStreams);\n  }, [isLoadingStreams]);\n\n  // Process streams data when it's loaded\n  useEffect(() => {\n    if (streamsData && Array.isArray(streamsData)) {\n      // Process the streams data\n      const processStreams = async () => {\n        try {\n          // Filter and process the streams\n          const filteredStreams = await filterStreamsForWebRTC(streamsData);\n\n          if (filteredStreams.length > 0) {\n            setStreams(filteredStreams);\n\n            // Set selectedStream based on URL parameter if it exists and is valid\n            const urlParams = new URLSearchParams(window.location.search);\n            const streamParam = urlParams.get('stream');\n\n            if (streamParam && filteredStreams.some(stream => stream.name === streamParam)) {\n              // If the stream from URL exists in the loaded streams, use it\n              setSelectedStream(streamParam);\n            } else if (!selectedStream || !filteredStreams.some(stream => stream.name === selectedStream)) {\n              // Otherwise use the first stream if selectedStream is not set or invalid\n              setSelectedStream(filteredStreams[0].name);\n            }\n          } else {\n            console.warn('No streams available for WebRTC view after filtering');\n          }\n        } catch (error) {\n          console.error('Error processing streams:', error);\n          showStatusMessage('Error processing streams: ' + error.message);\n        }\n      };\n\n      processStreams();\n    }\n  }, [streamsData, selectedStream]);\n\n  // Update URL when layout, page, or selectedStream changes\n  useEffect(() => {\n    // Don't update URL during initial load or when streams are empty\n    if (streams.length === 0) return;\n\n    console.log('Updating URL parameters');\n    const url = new URL(window.location);\n\n    // Handle page parameter (convert from 0-based internal to 1-based URL)\n    if (currentPage === 0) {\n      url.searchParams.delete('page');\n    } else {\n      // Add 1 to convert from 0-based (internal) to 1-based (URL)\n      url.searchParams.set('page', currentPage + 1);\n    }\n\n    // Handle layout parameter\n    if (layout !== '4') { // Only set if not the default\n      url.searchParams.set('layout', layout);\n    } else {\n      // Remove layout parameter if it's the default value\n      url.searchParams.delete('layout');\n    }\n\n    // Handle selectedStream parameter\n    if (layout === '1' && selectedStream) {\n      url.searchParams.set('stream', selectedStream);\n    } else {\n      // Remove stream parameter if not in single stream mode\n      url.searchParams.delete('stream');\n    }\n\n    // Update URL without reloading the page\n    window.history.replaceState({}, '', url);\n\n    // Also update sessionStorage\n    if (currentPage > 0) {\n      sessionStorage.setItem('webrtc_current_page', (currentPage + 1).toString());\n    } else {\n      sessionStorage.removeItem('webrtc_current_page');\n    }\n\n    if (layout !== '4') {\n      sessionStorage.setItem('webrtc_layout', layout);\n    } else {\n      sessionStorage.removeItem('webrtc_layout');\n    }\n\n    if (layout === '1' && selectedStream) {\n      sessionStorage.setItem('webrtc_selected_stream', selectedStream);\n    } else {\n      sessionStorage.removeItem('webrtc_selected_stream');\n    }\n  }, [currentPage, layout, selectedStream, streams.length]);\n\n  /**\n   * Filter streams for WebRTC view\n   * @param {Array} streams - Array of streams\n   * @returns {Promise<Array>} Promise resolving to filtered array of streams\n   */\n  const filterStreamsForWebRTC = async (streams) => {\n    try {\n      if (!streams || !Array.isArray(streams)) {\n        console.warn('No streams data provided to filter');\n        return [];\n      }\n\n      // For WebRTC view, we need to fetch full details for each stream\n      const streamPromises = streams.map(async (stream) => {\n        try {\n          const streamId = stream.id || stream.name;\n\n          const streamDetails = await queryClient.fetchQuery({\n            queryKey: ['stream-details', streamId],\n            queryFn: async () => {\n              const response = await fetch(`/api/streams/${encodeURIComponent(streamId)}`);\n              if (!response.ok) {\n                throw new Error(`Failed to load details for stream ${stream.name}`);\n              }\n              return response.json();\n            },\n            staleTime: 30000 // 30 seconds\n          });\n\n          return streamDetails;\n        } catch (error) {\n          console.error(`Error loading details for stream ${stream.name}:`, error);\n          // Return the basic stream info if we can't get details\n          return stream;\n        }\n      });\n\n      const detailedStreams = await Promise.all(streamPromises);\n      console.log('Loaded detailed streams for WebRTC view:', detailedStreams);\n\n      // Filter out streams that are soft deleted, inactive, or not configured for streaming\n      const filteredStreams = detailedStreams.filter(stream => {\n        // Filter out soft deleted streams\n        if (stream.is_deleted) {\n          console.log(`Stream ${stream.name} is soft deleted, filtering out`);\n          return false;\n        }\n\n        // Filter out inactive streams\n        if (!stream.enabled) {\n          console.log(`Stream ${stream.name} is inactive, filtering out`);\n          return false;\n        }\n\n        // Filter out streams not configured for streaming\n        if (!stream.streaming_enabled) {\n          console.log(`Stream ${stream.name} is not configured for streaming, filtering out`);\n          return false;\n        }\n\n        return true;\n      });\n\n      console.log('Filtered streams for WebRTC view:', filteredStreams);\n\n      return filteredStreams || [];\n    } catch (error) {\n      console.error('Error filtering streams for WebRTC view:', error);\n      showStatusMessage('Error processing streams: ' + error.message);\n      return [];\n    }\n  };\n\n  /**\n   * Get maximum number of streams to display based on layout\n   * @returns {number} Maximum number of streams\n   */\n  const getMaxStreamsForLayout = useCallback(() => {\n    switch (layout) {\n      case '1': return 1;  // Single view\n      case '2': return 2;  // 2x1 grid\n      case '4': return 4;  // 2x2 grid\n      case '6': return 6;  // 2x3 grid\n      case '9': return 9;  // 3x3 grid\n      case '16': return 16; // 4x4 grid\n      default: return 4;\n    }\n  }, [layout]);\n\n  /**\n   * Get streams to show based on layout, selected stream, and pagination\n   * @returns {Array} Streams to show\n   */\n  const getStreamsToShow = useCallback(() => {\n    // Filter streams based on layout and selected stream\n    let streamsToShow = streams;\n\n    if (layout === '1' && selectedStream) {\n      streamsToShow = streams.filter(stream => stream.name === selectedStream);\n    } else {\n      // Apply pagination\n      const maxStreams = getMaxStreamsForLayout();\n      const totalPages = Math.ceil(streams.length / maxStreams);\n\n      // Ensure current page is valid\n      if (currentPage >= totalPages && totalPages > 0) {\n        return []; // Will be handled by the effect that watches currentPage\n      }\n\n      // Get streams for current page\n      const startIdx = currentPage * maxStreams;\n      const endIdx = Math.min(startIdx + maxStreams, streams.length);\n      streamsToShow = streams.slice(startIdx, endIdx);\n    }\n\n    return streamsToShow;\n  }, [streams, layout, selectedStream, currentPage]);\n\n  // Ensure current page is valid when streams or layout changes\n  useEffect(() => {\n    if (streams.length === 0) return;\n\n    const maxStreams = getMaxStreamsForLayout();\n    const totalPages = Math.ceil(streams.length / maxStreams);\n\n    if (currentPage >= totalPages) {\n      setCurrentPage(Math.max(0, totalPages - 1));\n    }\n  }, [streams, layout, currentPage, getMaxStreamsForLayout]);\n\n  /**\n   * Toggle fullscreen mode for a specific stream\n   * @param {string} streamName - Stream name\n   * @param {Event} event - Click event\n   * @param {HTMLElement} cellElement - The video cell element\n   */\n  const toggleStreamFullscreen = (streamName, event, cellElement) => {\n    // Prevent default button behavior\n    if (event) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n\n    if (!streamName) {\n      console.error('Stream name not provided for fullscreen toggle');\n      return;\n    }\n\n    console.log(`Toggling fullscreen for stream: ${streamName}`);\n\n    if (!cellElement) {\n      console.error('Video cell element not provided for fullscreen toggle');\n      return;\n    }\n\n    if (!document.fullscreenElement) {\n      console.log('Entering fullscreen mode for video cell');\n      cellElement.requestFullscreen().catch(err => {\n        console.error(`Error attempting to enable fullscreen: ${err.message}`);\n        showStatusMessage(`Could not enable fullscreen mode: ${err.message}`);\n      });\n    } else {\n      console.log('Exiting fullscreen mode');\n      document.exitFullscreen();\n    }\n\n    // Prevent event propagation\n    if (event) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  };\n\n  // Memoize the streams to show to prevent unnecessary re-renders\n  const streamsToShow = useMemo(() => getStreamsToShow(), [streams, layout, selectedStream, currentPage, getMaxStreamsForLayout]);\n\n  return (\n    <section\n      id=\"live-page\"\n      className={`page ${isFullscreen ? 'fullscreen-mode' : ''}`}\n    >\n      {/* Include the SnapshotManager component */}\n      <SnapshotManager />\n\n      {/* Include the FullscreenManager component */}\n      <FullscreenManager\n        isFullscreen={isFullscreen}\n        setIsFullscreen={setIsFullscreen}\n        targetId=\"live-page\"\n      />\n\n      <div className=\"page-header flex justify-between items-center mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow\" style={{ position: 'relative', zIndex: 10, pointerEvents: 'auto' }}>\n        <div className=\"flex items-center space-x-2\">\n          <h2 className=\"text-xl font-bold mr-4\">Live View</h2>\n          <div className=\"flex space-x-2\">\n            <button\n              id=\"hls-toggle-btn\"\n              className=\"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 inline-block text-center\"\n              style={{ position: 'relative', zIndex: 50 }} // Very high z-index to ensure clickability\n              onClick={() => {\n                window.location.href = '/hls.html';\n              }}\n            >\n              HLS View\n            </button>\n          </div>\n        </div>\n        <div className=\"controls flex items-center space-x-2\">\n          <div className=\"flex items-center\">\n            <label htmlFor=\"layout-selector\" className=\"mr-2\">Layout:</label>\n            <select\n              id=\"layout-selector\"\n              className=\"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600\"\n              value={layout}\n              onChange={(e) => {\n                const newLayout = e.target.value;\n                setLayout(newLayout);\n                setCurrentPage(0); // Reset to first page when layout changes\n              }}\n            >\n              <option value=\"1\">1 Stream</option>\n              <option value=\"2\">2 Streams</option>\n              <option value=\"4\">4 Streams</option>\n              <option value=\"6\">6 Streams</option>\n              <option value=\"9\">9 Streams</option>\n              <option value=\"16\">16 Streams</option>\n            </select>\n          </div>\n\n          {layout === '1' && (\n            <div className=\"flex items-center\">\n              <label htmlFor=\"stream-selector\" className=\"mr-2\">Stream:</label>\n              <select\n                id=\"stream-selector\"\n                className=\"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600\"\n                value={selectedStream}\n                onChange={(e) => {\n                  const newStream = e.target.value;\n                  setSelectedStream(newStream);\n                }}\n              >\n                {streams.map(stream => (\n                  <option key={stream.name} value={stream.name}>{stream.name}</option>\n                ))}\n              </select>\n            </div>\n          )}\n\n          <button\n            id=\"fullscreen-btn\"\n            className=\"p-2 rounded-full bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none\"\n            onClick={() => toggleFullscreen()}\n            title=\"Toggle Fullscreen\"\n          >\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                 stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n              <path\n                d=\"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3\"></path>\n            </svg>\n          </button>\n        </div>\n      </div>\n\n      <div className=\"flex flex-col space-y-4 h-full\">\n        <div\n          id=\"video-grid\"\n          className={`video-container layout-${layout}`}\n        >\n          {isLoadingStreams ? (\n              <div className=\"flex justify-center items-center col-span-full row-span-full h-64 w-full\" style={{ pointerEvents: 'none', zIndex: 1 }}>\n                <div className=\"flex flex-col items-center justify-center py-8\">\n                <div\n                  className=\"inline-block animate-spin rounded-full border-4 border-gray-300 dark:border-gray-600 border-t-blue-600 dark:border-t-blue-500 w-16 h-16\"></div>\n                <p className=\"mt-4 text-gray-700 dark:text-gray-300\">Loading streams...</p>\n              </div>\n            </div>\n          ) : (isLoading && !isLoadingStreams) ? (\n            <div\n                className=\"flex justify-center items-center col-span-full row-span-full h-64 w-full\"\n                style={{\n                  pointerEvents: 'none',\n                  position: 'relative',\n                  zIndex: 1\n                }}\n            >\n              <div className=\"flex flex-col items-center justify-center py-8\">\n                <div\n                  className=\"inline-block animate-spin rounded-full border-4 border-gray-300 dark:border-gray-600 border-t-blue-600 dark:border-t-blue-500 w-16 h-16\"></div>\n                <p className=\"mt-4 text-gray-700 dark:text-gray-300\">Loading streams...</p>\n              </div>\n            </div>\n          ) : (streamsError) ? (\n            <div className=\"placeholder flex flex-col justify-center items-center col-span-full row-span-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-center p-8\">\n              <p className=\"mb-6 text-gray-600 dark:text-gray-300 text-lg\">Error loading streams: {streamsError.message}</p>\n              <button\n                onClick={() => window.location.reload()}\n                className=\"btn-primary px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\n              >\n                Retry\n              </button>\n            </div>\n          ) : streams.length === 0 ? (\n            <div className=\"placeholder flex flex-col justify-center items-center col-span-full row-span-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-center p-8\">\n              <p className=\"mb-6 text-gray-600 dark:text-gray-300 text-lg\">No streams configured</p>\n              <a href=\"streams.html\" className=\"btn-primary px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\">Configure Streams</a>\n            </div>\n          ) : (\n            // Render video cells using our self-contained WebRTCVideoCell component\n            streamsToShow.map(stream => (\n              <WebRTCVideoCell\n                key={stream.name}\n                stream={stream}\n                onToggleFullscreen={toggleStreamFullscreen}\n                streamId={stream.name} // Add explicit streamId prop to prevent re-renders\n              />\n            ))\n          )}\n        </div>\n\n        {layout !== '1' && streams.length > getMaxStreamsForLayout() ? (\n          <div className=\"pagination-controls flex justify-center items-center space-x-4 mt-4\">\n            <button\n              className=\"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed\"\n              onClick={() => {\n                console.log('Changing to previous page');\n                setCurrentPage(Math.max(0, currentPage - 1));\n              }}\n              disabled={currentPage === 0}\n            >\n              Previous\n            </button>\n\n            <span className=\"text-gray-700 dark:text-gray-300\">\n              Page {currentPage + 1} of {Math.ceil(streams.length / getMaxStreamsForLayout())}\n            </span>\n\n            <button\n              className=\"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed\"\n              onClick={() => {\n                console.log('Changing to next page');\n                const totalPages = Math.ceil(streams.length / getMaxStreamsForLayout());\n                setCurrentPage(Math.min(totalPages - 1, currentPage + 1));\n              }}\n              disabled={currentPage >= Math.ceil(streams.length / getMaxStreamsForLayout()) - 1}\n            >\n              Next\n            </button>\n          </div>\n        ) : null}\n      </div>\n    </section>\n  );\n}\n","/**\n * LightNVR Web Interface Live View Page\n * Entry point for the live view page with WebRTC/HLS support\n */\n\nimport { render } from 'preact';\nimport { useState, useEffect } from 'preact/hooks';\nimport { LiveView } from '../components/preact/LiveView.jsx';\nimport { WebRTCView } from '../components/preact/WebRTCView.jsx';\nimport { QueryClientProvider, queryClient } from '../query-client.js';\nimport { Header } from \"../components/preact/Header.jsx\";\nimport { Footer } from \"../components/preact/Footer.jsx\";\nimport { ToastContainer } from \"../components/preact/ToastContainer.jsx\";\n\n/**\n * Main App component that conditionally renders WebRTCView or LiveView\n * based on whether WebRTC is disabled in settings\n */\nfunction App() {\n    const [isWebRTCDisabled, setIsWebRTCDisabled] = useState(false);\n    const [isLoading, setIsLoading] = useState(true);\n\n    useEffect(() => {\n        // Check if WebRTC is disabled in settings\n        async function checkWebRTCStatus() {\n            try {\n                const response = await fetch('/api/settings');\n                if (!response.ok) {\n                    console.error('Failed to fetch settings:', response.status, response.statusText);\n                    setIsLoading(false);\n                    return;\n                }\n\n                const settings = await response.json();\n                \n                if (settings.webrtc_disabled) {\n                    console.log('WebRTC is disabled, using HLS view');\n                    setIsWebRTCDisabled(true);\n                } else {\n                    console.log('WebRTC is enabled, using WebRTC view');\n                    setIsWebRTCDisabled(false);\n                }\n            } catch (error) {\n                console.error('Error checking WebRTC status:', error);\n            } finally {\n                setIsLoading(false);\n            }\n        }\n\n        checkWebRTCStatus();\n    }, []);\n\n    if (isLoading) {\n        return <div className=\"loading\">Loading...</div>;\n    }\n\n    return (\n            <>{isWebRTCDisabled ? <LiveView isWebRTCDisabled={true} /> : <WebRTCView />}</>\n    );\n}\n\n// Render the App component when the DOM is loaded\ndocument.addEventListener('DOMContentLoaded', () => {\n    // Get the container element\n    const container = document.getElementById('main-content');\n\n    if (container) {\n        render(\n            <QueryClientProvider client={queryClient}>\n                <Header />\n                <ToastContainer />\n                <App />\n                <Footer />\n            </QueryClientProvider>,\n            container\n        );\n    }\n});\n"],"names":["logDisabled_","deprecationWarnings_","extractVersion","uastring","expr","pos","match","wrapPeerConnectionEvent","window","eventNameToWrap","wrapper","proto","nativeAddEventListener","nativeEventName","cb","wrappedCallback","e","modifiedEvent","nativeRemoveEventListener","unwrappedCb","disableLog","bool","disableWarnings","log","deprecated","oldMethod","newMethod","detectBrowser","result","navigator","chromium","brand","isObject","val","compactObject","data","accumulator","key","isObj","value","isEmptyObject","walkStats","stats","base","resultSet","name","id","filterStats","track","outbound","streamStatsType","filteredResult","trackStats","trackStat","logging","utils.log","shimGetUserMedia","browserDetails","constraintsToChrome_","c","cc","r","oldname_","prefix","oc","mix","shimConstraints_","constraints","func","remap","obj","a","b","face","getSupportedFacingModeLies","matches","devices","d","dev","shimError_","getUserMedia_","onSuccess","onError","origGetUserMedia","cs","stream","shimMediaStream","shimOnTrack","f","origSetRemoteDescription","te","receiver","event","utils.wrapPeerConnectionEvent","shimGetSendersWithDtmf","shimSenderWithDtmf","pc","origAddTrack","sender","origRemoveTrack","idx","origAddStream","origRemoveStream","s","origGetSenders","senders","shimSenderReceiverGetStats","utils.filterStats","origGetReceivers","receivers","origGetStats","err","shimAddTrackRemoveTrackWithNative","streamId","existingSenders","newSenders","newSender","shimAddTrackRemoveTrack","origGetLocalStreams","nativeStreams","newStream","streams","t","oldStream","replaceInternalStreamId","description","sdp","internalId","externalStream","internalStream","replaceExternalStreamId","method","nativeMethod","methodObj","args","desc","origSetLocalDescription","origLocalDescription","streamid","shimPeerConnection","fixNegotiationNeeded","MediaStreamTrack","utils.deprecated","nativeGetUserMedia","nativeGetSettings","nativeApplyConstraints","shimGetDisplayMedia","preferredMediaSource","modernStatsTypes","nativeGetStats","selector","onSucc","onErr","stat","i","shimSenderGetStats","shimReceiverGetStats","shimRemoveStream","shimRTCDataChannel","shimAddTransceiver","origAddTransceiver","sendEncodings","shouldPerformCheck","encodingParam","transceiver","params","shimGetParameters","origGetParameters","shimCreateOffer","origCreateOffer","shimCreateAnswer","origCreateAnswer","shimLocalStreamsAPI","_addTrack","index","tracks","shimRemoteStreamsAPI","shimCallbacksAPI","prototype","setLocalDescription","setRemoteDescription","addIceCandidate","successCallback","failureCallback","options","promise","withCallback","candidate","mediaDevices","_getUserMedia","shimConstraints","errcb","utils.compactObject","shimRTCIceServerUrls","OrigPeerConnection","pcConfig","pcConstraints","newIceServers","server","shimTrackEventTransceiver","shimCreateOfferLegacy","offerOptions","audioTransceiver","videoTransceiver","shimAudioContext","SDPUtils","blob","line","part","sections","parts","component","type","parsed","codec","pt","channels","headerExtension","kv","j","param","lines","fb","sp","colon","ssrc","mediaSection","mid","sessionpart","setupType","fp","parameters","keyParams","ufrag","pwd","mline","rtpmapline","fmtps","wildcardRtcpFb","existingFeedback","kind","caps","maxptime","extension","encodingParameters","hasRed","hasUlpfec","ssrcs","primarySsrc","secondarySsrc","flows","encParam","bandwidth","rtcpParameters","remoteSsrc","rsize","mux","spec","planB","msidParts","maxSizeLine","maxMessageSize","sctpPort","sctpMapLines","media","sctp","output","sessId","sessVer","sessUser","sessionId","version","module","shimRTCIceCandidate","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","shimRTCIceCandidateRelayProtocol","shimMaxMessageSize","sctpInDescription","mLine","getRemoteFirefoxVersion","getCanSendMaxMessageSize","remoteIsFirefox","canSendMaxMessageSize","getMaxMessageSize","sdpSemantics","isFirefox","canSendMMS","remoteMMS","shimSendThrowTypeError","wrapDcSend","dc","origDataChannelSend","length","origCreateDataChannel","dataChannel","shimConnectionState","origMethod","newEvent","removeExtmapAllowMixed","nativeSRD","shimAddIceCandidateNullOrEmpty","nativeAddIceCandidate","shimParameterlessSetLocalDescription","nativeSetLocalDescription","adapterFactory","utils.detectBrowser","adapter","commonShim","utils.extractVersion","utils.disableLog","utils.disableWarnings","chromeShim","chromeShim.shimPeerConnection","commonShim.shimAddIceCandidateNullOrEmpty","commonShim.shimParameterlessSetLocalDescription","chromeShim.shimGetUserMedia","chromeShim.shimMediaStream","chromeShim.shimOnTrack","chromeShim.shimAddTrackRemoveTrack","chromeShim.shimGetSendersWithDtmf","chromeShim.shimSenderReceiverGetStats","chromeShim.fixNegotiationNeeded","commonShim.shimRTCIceCandidate","commonShim.shimRTCIceCandidateRelayProtocol","commonShim.shimConnectionState","commonShim.shimMaxMessageSize","commonShim.shimSendThrowTypeError","commonShim.removeExtmapAllowMixed","firefoxShim","firefoxShim.shimPeerConnection","firefoxShim.shimGetUserMedia","firefoxShim.shimOnTrack","firefoxShim.shimRemoveStream","firefoxShim.shimSenderGetStats","firefoxShim.shimReceiverGetStats","firefoxShim.shimRTCDataChannel","firefoxShim.shimAddTransceiver","firefoxShim.shimGetParameters","firefoxShim.shimCreateOffer","firefoxShim.shimCreateAnswer","safariShim","safariShim.shimRTCIceServerUrls","safariShim.shimCreateOfferLegacy","safariShim.shimCallbacksAPI","safariShim.shimLocalStreamsAPI","safariShim.shimRemoteStreamsAPI","safariShim.shimTrackEventTransceiver","safariShim.shimGetUserMedia","safariShim.shimAudioContext","WebRTCVideoCell","onToggleFullscreen","isLoading","setIsLoading","useState","error","setError","isPlaying","setIsPlaying","connectionQuality","setConnectionQuality","videoRef","useRef","cellRef","peerConnectionRef","detectionOverlayRef","abortControllerRef","connectionMonitorRef","reconnectAttemptsRef","useEffect","videoElement","offer","formattedOffer","auth","response","text","answer","startConnectionMonitoring","packetsLost","packetsReceived","currentRtt","jitter","report","totalPackets","lossPercentage","quality","originalOnIceConnectionStateChange","handleRetry","jsxs","jsx","DetectionOverlay","SnapshotButton","canvasRef","snapshot","takeSnapshotWithDetections","showSnapshotPreview","canvas","LoadingIndicator","WebRTCView","takeSnapshot","useSnapshotManager","isFullscreen","setIsFullscreen","toggleFullscreen","useFullscreenManager","setStreams","layout","setLayout","layoutParam","selectedStream","setSelectedStream","streamParam","currentPage","setCurrentPage","pageParam","storedPage","queryClient","useQueryClient","setupModals","addModalStyles","streamsData","isLoadingStreams","streamsError","useQuery","filteredStreams","filterStreamsForWebRTC","showStatusMessage","url","streamPromises","detailedStreams","getMaxStreamsForLayout","useCallback","getStreamsToShow","streamsToShow","maxStreams","totalPages","startIdx","endIdx","toggleStreamFullscreen","streamName","cellElement","useMemo","SnapshotManager","FullscreenManager","newLayout","App","isWebRTCDisabled","setIsWebRTCDisabled","checkWebRTCStatus","Fragment","LiveView","container","render","QueryClientProvider","Header","ToastContainer","Footer"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10]}