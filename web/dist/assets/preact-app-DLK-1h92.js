const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./WebRTCView-5e5jxpsi.js","./DetectionOverlay-DZZGu2Dx.js","./LiveView-DupScMJZ.js","./LoadingIndicator-BApsLZ4U.js","./RecordingsView-Bw4b9YOD.js","./TimelineView-Cq5Hgy8L.js","./SettingsView-Df1owDzy.js","./StreamsView-BrF9bRvO.js","./SystemView-BcCMRgeB.js"])))=>i.map(i=>d[i]);
var Pt=Object.freeze,Rr=Object.defineProperty;var G=(t,e)=>Pt(Rr(t,"raw",{value:Pt(e||t.slice())}));(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Pr="modulepreload",Or=function(t,e){return new URL(t,e).href},Ot={},L=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){const i=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),u=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(n.map(c=>{if(c=Or(c,r),c in Ot)return;Ot[c]=!0;const h=c.endsWith(".css"),l=h?'[rel="stylesheet"]':"";if(!!r)for(let p=i.length-1;p>=0;p--){const m=i[p];if(m.href===c&&(!h||m.rel==="stylesheet"))return}else if(document.querySelector('link[href="'.concat(c,'"]').concat(l)))return;const d=document.createElement("link");if(d.rel=h?"stylesheet":Pr,h||(d.as="script"),d.crossOrigin="",d.href=c,u&&d.setAttribute("nonce",u),document.head.appendChild(d),h)return new Promise((p,m)=>{d.addEventListener("load",p),d.addEventListener("error",()=>m(new Error("Unable to preload CSS for ".concat(c))))})}))}function o(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return s.then(i=>{for(const a of i||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})};var be,x,yn,ne,Dt,vn,bn,wn,st,ze,Je,Cn,ye={},xn=[],Dr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,we=Array.isArray;function B(t,e){for(var n in e)t[n]=e[n];return t}function ot(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function F(t,e,n){var r,s,o,i={};for(o in e)o=="key"?r=e[o]:o=="ref"?s=e[o]:i[o]=e[o];if(arguments.length>2&&(i.children=arguments.length>3?be.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)i[o]==null&&(i[o]=t.defaultProps[o]);return _e(t,i,r,s,null)}function _e(t,e,n,r,s){var o={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s==null?++yn:s,__i:-1,__u:0};return s==null&&x.vnode!=null&&x.vnode(o),o}function it(){return{current:null}}function W(t){return t.children}function U(t,e){this.props=t,this.context=e}function ue(t,e){if(e==null)return t.__?ue(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?ue(t):null}function Sn(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Sn(t)}}function Ge(t){(!t.__d&&(t.__d=!0)&&ne.push(t)&&!$e.__r++||Dt!=x.debounceRendering)&&((Dt=x.debounceRendering)||vn)($e)}function $e(){for(var t,e,n,r,s,o,i,a=1;ne.length;)ne.length>a&&ne.sort(bn),t=ne.shift(),a=ne.length,t.__d&&(n=void 0,s=(r=(e=t).__v).__e,o=[],i=[],e.__P&&((n=B({},r)).__v=r.__v+1,x.vnode&&x.vnode(n),at(e.__P,n,r,e.__n,e.__P.namespaceURI,32&r.__u?[s]:null,o,s==null?ue(r):s,!!(32&r.__u),i),n.__v=r.__v,n.__.__k[n.__i]=n,Rn(o,n,i),n.__e!=s&&Sn(n)));$e.__r=0}function En(t,e,n,r,s,o,i,a,u,c,h){var l,f,d,p,m,_,g=r&&r.__k||xn,y=e.length;for(u=$r(n,e,g,u,y),l=0;l<y;l++)(d=n.__k[l])!=null&&(f=d.__i==-1?ye:g[d.__i]||ye,d.__i=l,_=at(t,d,f,s,o,i,a,u,c,h),p=d.__e,d.ref&&f.ref!=d.ref&&(f.ref&&lt(f.ref,null,d),h.push(d.ref,d.__c||p,d)),m==null&&p!=null&&(m=p),4&d.__u||f.__k===d.__k?u=kn(d,u,t):typeof d.type=="function"&&_!==void 0?u=_:p&&(u=p.nextSibling),d.__u&=-7);return n.__e=m,u}function $r(t,e,n,r,s){var o,i,a,u,c,h=n.length,l=h,f=0;for(t.__k=new Array(s),o=0;o<s;o++)(i=e[o])!=null&&typeof i!="boolean"&&typeof i!="function"?(u=o+f,(i=t.__k[o]=typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?_e(null,i,null,null,null):we(i)?_e(W,{children:i},null,null,null):i.constructor==null&&i.__b>0?_e(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i).__=t,i.__b=t.__b+1,a=null,(c=i.__i=Tr(i,n,u,l))!=-1&&(l--,(a=n[c])&&(a.__u|=2)),a==null||a.__v==null?(c==-1&&(s>h?f--:s<h&&f++),typeof i.type!="function"&&(i.__u|=4)):c!=u&&(c==u-1?f--:c==u+1?f++:(c>u?f--:f++,i.__u|=4))):t.__k[o]=null;if(l)for(o=0;o<h;o++)(a=n[o])!=null&&(2&a.__u)==0&&(a.__e==r&&(r=ue(a)),On(a,a));return r}function kn(t,e,n){var r,s;if(typeof t.type=="function"){for(r=t.__k,s=0;r&&s<r.length;s++)r[s]&&(r[s].__=t,e=kn(r[s],e,n));return e}t.__e!=e&&(e&&t.type&&!n.contains(e)&&(e=ue(t)),n.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function j(t,e){return e=e||[],t==null||typeof t=="boolean"||(we(t)?t.some(function(n){j(n,e)}):e.push(t)),e}function Tr(t,e,n,r){var s,o,i=t.key,a=t.type,u=e[n];if(u===null&&t.key==null||u&&i==u.key&&a==u.type&&(2&u.__u)==0)return n;if(r>(u!=null&&(2&u.__u)==0?1:0))for(s=n-1,o=n+1;s>=0||o<e.length;){if(s>=0){if((u=e[s])&&(2&u.__u)==0&&i==u.key&&a==u.type)return s;s--}if(o<e.length){if((u=e[o])&&(2&u.__u)==0&&i==u.key&&a==u.type)return o;o++}}return-1}function $t(t,e,n){e[0]=="-"?t.setProperty(e,n==null?"":n):t[e]=n==null?"":typeof n!="number"||Dr.test(e)?n:n+"px"}function Pe(t,e,n,r,s){var o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||$t(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||$t(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(wn,"$1")),e=e.toLowerCase()in t||e=="onFocusOut"||e=="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?r?n.u=r.u:(n.u=st,t.addEventListener(e,o?Je:ze,o)):t.removeEventListener(e,o?Je:ze,o);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n==null?"":n;break e}catch(i){}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function Tt(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=st++;else if(e.t<n.u)return;return n(x.event?x.event(e):e)}}}function at(t,e,n,r,s,o,i,a,u,c){var h,l,f,d,p,m,_,g,y,S,w,E,v,C,b,D,A,R=e.type;if(e.constructor!=null)return null;128&n.__u&&(u=!!(32&n.__u),o=[a=e.__e=n.__e]),(h=x.__b)&&h(e);e:if(typeof R=="function")try{if(g=e.props,y="prototype"in R&&R.prototype.render,S=(h=R.contextType)&&r[h.__c],w=h?S?S.props.value:h.__:r,n.__c?_=(l=e.__c=n.__c).__=l.__E:(y?e.__c=l=new R(g,w):(e.__c=l=new U(g,w),l.constructor=R,l.render=Ir),S&&S.sub(l),l.props=g,l.state||(l.state={}),l.context=w,l.__n=r,f=l.__d=!0,l.__h=[],l._sb=[]),y&&l.__s==null&&(l.__s=l.state),y&&R.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=B({},l.__s)),B(l.__s,R.getDerivedStateFromProps(g,l.__s))),d=l.props,p=l.state,l.__v=e,f)y&&R.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),y&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(y&&R.getDerivedStateFromProps==null&&g!==d&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(g,w),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(g,l.__s,w)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(l.props=g,l.state=l.__s,l.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(M){M&&(M.__=e)}),E=0;E<l._sb.length;E++)l.__h.push(l._sb[E]);l._sb=[],l.__h.length&&i.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(g,l.__s,w),y&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(d,p,m)})}if(l.context=w,l.props=g,l.__P=t,l.__e=!1,v=x.__r,C=0,y){for(l.state=l.__s,l.__d=!1,v&&v(e),h=l.render(l.props,l.state,l.context),b=0;b<l._sb.length;b++)l.__h.push(l._sb[b]);l._sb=[]}else do l.__d=!1,v&&v(e),h=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++C<25);l.state=l.__s,l.getChildContext!=null&&(r=B(B({},r),l.getChildContext())),y&&!f&&l.getSnapshotBeforeUpdate!=null&&(m=l.getSnapshotBeforeUpdate(d,p)),D=h,h!=null&&h.type===W&&h.key==null&&(D=Pn(h.props.children)),a=En(t,we(D)?D:[D],e,n,r,s,o,i,a,u,c),l.base=e.__e,e.__u&=-161,l.__h.length&&i.push(l),_&&(l.__E=l.__=null)}catch(M){if(e.__v=null,u||o!=null)if(M.then){for(e.__u|=u?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;o[o.indexOf(a)]=null,e.__e=a}else for(A=o.length;A--;)ot(o[A]);else e.__e=n.__e,e.__k=n.__k;x.__e(M,e,n)}else o==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=Mr(n.__e,e,n,r,s,o,i,u,c);return(h=x.diffed)&&h(e),128&e.__u?void 0:a}function Rn(t,e,n){for(var r=0;r<n.length;r++)lt(n[r],n[++r],n[++r]);x.__c&&x.__c(e,t),t.some(function(s){try{t=s.__h,s.__h=[],t.some(function(o){o.call(s)})}catch(o){x.__e(o,s.__v)}})}function Pn(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:we(t)?t.map(Pn):B({},t)}function Mr(t,e,n,r,s,o,i,a,u){var c,h,l,f,d,p,m,_=n.props,g=e.props,y=e.type;if(y=="svg"?s="http://www.w3.org/2000/svg":y=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),o!=null){for(c=0;c<o.length;c++)if((d=o[c])&&"setAttribute"in d==!!y&&(y?d.localName==y:d.nodeType==3)){t=d,o[c]=null;break}}if(t==null){if(y==null)return document.createTextNode(g);t=document.createElementNS(s,y,g.is&&g),a&&(x.__m&&x.__m(e,o),a=!1),o=null}if(y==null)_===g||a&&t.data==g||(t.data=g);else{if(o=o&&be.call(t.childNodes),_=n.props||ye,!a&&o!=null)for(_={},c=0;c<t.attributes.length;c++)_[(d=t.attributes[c]).name]=d.value;for(c in _)if(d=_[c],c!="children"){if(c=="dangerouslySetInnerHTML")l=d;else if(!(c in g)){if(c=="value"&&"defaultValue"in g||c=="checked"&&"defaultChecked"in g)continue;Pe(t,c,null,d,s)}}for(c in g)d=g[c],c=="children"?f=d:c=="dangerouslySetInnerHTML"?h=d:c=="value"?p=d:c=="checked"?m=d:a&&typeof d!="function"||_[c]===d||Pe(t,c,d,_[c],s);if(h)a||l&&(h.__html==l.__html||h.__html==t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(l&&(t.innerHTML=""),En(e.type=="template"?t.content:t,we(f)?f:[f],e,n,r,y=="foreignObject"?"http://www.w3.org/1999/xhtml":s,o,i,o?o[0]:n.__k&&ue(n,0),a,u),o!=null)for(c=o.length;c--;)ot(o[c]);a||(c="value",y=="progress"&&p==null?t.removeAttribute("value"):p!=null&&(p!==t[c]||y=="progress"&&!p||y=="option"&&p!=_[c])&&Pe(t,c,p,_[c],s),c="checked",m!=null&&m!=t[c]&&Pe(t,c,m,_[c],s))}return t}function lt(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(s){x.__e(s,n)}}function On(t,e,n){var r,s;if(x.unmount&&x.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||lt(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){x.__e(o,e)}r.base=r.__P=null}if(r=t.__k)for(s=0;s<r.length;s++)r[s]&&On(r[s],e,n||typeof t.type!="function");n||ot(t.__e),t.__c=t.__=t.__e=void 0}function Ir(t,e,n){return this.constructor(t,n)}function oe(t,e,n){var r,s,o,i;e==document&&(e=document.documentElement),x.__&&x.__(t,e),s=(r=typeof n=="function")?null:n&&n.__k||e.__k,o=[],i=[],at(e,t=(!r&&n||e).__k=F(W,null,[t]),s||ye,ye,e.namespaceURI,!r&&n?[n]:s?null:e.firstChild?be.call(e.childNodes):null,o,!r&&n?n:s?s.__e:e.firstChild,r,i),Rn(o,t,i)}function ct(t,e){oe(t,e,ct)}function Dn(t,e,n){var r,s,o,i,a=B({},t.props);for(o in t.type&&t.type.defaultProps&&(i=t.type.defaultProps),e)o=="key"?r=e[o]:o=="ref"?s=e[o]:a[o]=e[o]==null&&i!=null?i[o]:e[o];return arguments.length>2&&(a.children=arguments.length>3?be.call(arguments,2):n),_e(t.type,a,r||t.key,s||t.ref,null)}function ae(t){function e(n){var r,s;return this.getChildContext||(r=new Set,(s={})[e.__c]=this,this.getChildContext=function(){return s},this.componentWillUnmount=function(){r=null},this.shouldComponentUpdate=function(o){this.props.value!=o.value&&r.forEach(function(i){i.__e=!0,Ge(i)})},this.sub=function(o){r.add(o);var i=o.componentWillUnmount;o.componentWillUnmount=function(){r&&r.delete(o),i&&i.call(o)}}),n.children}return e.__c="__cC"+Cn++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,r){return n.children(r)}).contextType=e,e}be=xn.slice,x={__e:function(t,e,n,r){for(var s,o,i;e=e.__;)if((s=e.__c)&&!s.__)try{if((o=s.constructor)&&o.getDerivedStateFromError!=null&&(s.setState(o.getDerivedStateFromError(t)),i=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,r||{}),i=s.__d),i)return s.__E=s}catch(a){t=a}throw t}},yn=0,U.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=B({},this.state),typeof t=="function"&&(t=t(B({},n),this.props)),t&&B(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Ge(this))},U.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Ge(this))},U.prototype.render=W,ne=[],vn=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,bn=function(t,e){return t.__v.__b-e.__v.__b},$e.__r=0,wn=/(PointerCapture)$|Capture$/i,st=0,ze=Tt(!1),Je=Tt(!0),Cn=0;const $n=Object.freeze(Object.defineProperty({__proto__:null,Component:U,Fragment:W,cloneElement:Dn,createContext:ae,createElement:F,createRef:it,h:F,hydrate:ct,get options(){return x},render:oe,toChildArray:j},Symbol.toStringTag,{value:"Module"}));var Tn=function(t,e,n,r){var s;e[0]=0;for(var o=1;o<e.length;o++){var i=e[o++],a=e[o]?(e[0]|=i?1:2,n[e[o++]]):e[++o];i===3?r[0]=a:i===4?r[1]=Object.assign(r[1]||{},a):i===5?(r[1]=r[1]||{})[e[++o]]=a:i===6?r[1][e[++o]]+=a+"":i?(s=t.apply(a,Tn(t,a,n,["",null])),r.push(s),a[0]?e[0]|=2:(e[o-2]=0,e[o]=s)):r.push(a)}return r},Mt=new Map;function Nr(t){var e=Mt.get(this);return e||(e=new Map,Mt.set(this,e)),(e=Tn(this,e.get(t)||(e.set(t,e=function(n){for(var r,s,o=1,i="",a="",u=[0],c=function(f){o===1&&(f||(i=i.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?u.push(0,f,i):o===3&&(f||i)?(u.push(3,f,i),o=2):o===2&&i==="..."&&f?u.push(4,f,0):o===2&&i&&!f?u.push(5,0,!0,i):o>=5&&((i||!f&&o===5)&&(u.push(o,0,i,s),o=6),f&&(u.push(o,f,0,s),o=6)),i=""},h=0;h<n.length;h++){h&&(o===1&&c(),c(h));for(var l=0;l<n[h].length;l++)r=n[h][l],o===1?r==="<"?(c(),u=[u],o=3):i+=r:o===4?i==="--"&&r===">"?(o=1,i=""):i=r+i[0]:a?r===a?a="":i+=r:r==='"'||r==="'"?a=r:r===">"?(c(),o=1):o&&(r==="="?(o=5,s=i,i=""):r==="/"&&(o<5||n[h][l+1]===">")?(c(),o===3&&(u=u[0]),o=u,(u=u[0]).push(2,0,o),o=0):r===" "||r==="	"||r==="\n"||r==="\r"?(c(),o=2):i+=r),o===3&&i==="!--"&&(o=4,u=u[0])}return c(),u}(t)),e),arguments,[])).length>1?e:e[0]}const se=Nr.bind(F);class Te{static generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)})}constructor(){this.socket=null,this.clientId=Te.generateUUID(),this.connected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.handlers={},this.subscriptions=new Set,this.pendingSubscriptions=new Set,this.messageQueue=[],this.connecting=!1,this.subscriptionParams=new Map,console.log("Generated local WebSocket client ID: ".concat(this.clientId));try{const e=localStorage.getItem("websocket_client_id");e?(this.clientId=e,console.log("Loaded WebSocket client ID from localStorage: ".concat(this.clientId))):(localStorage.setItem("websocket_client_id",this.clientId),console.log("Stored WebSocket client ID in localStorage: ".concat(this.clientId)))}catch(e){console.warn("Could not access localStorage for client ID:",e)}this.connect=this.connect.bind(this),this.disconnect=this.disconnect.bind(this),this.reconnect=this.reconnect.bind(this),this.send=this.send.bind(this),this.subscribe=this.subscribe.bind(this),this.unsubscribe=this.unsubscribe.bind(this),this.handleMessage=this.handleMessage.bind(this),this.processMessageQueue=this.processMessageQueue.bind(this),this.connect()}connect(){if(this.socket&&(this.socket.readyState===WebSocket.OPEN||this.socket.readyState===WebSocket.CONNECTING)){console.log("WebSocket already connected or connecting");return}if(this.connecting){console.log("WebSocket connection already in progress");return}this.connecting=!0;const e=window.location.protocol==="https:"?"wss:":"ws:",n="".concat(e,"//").concat(window.location.host,"/api/ws");if(console.log("Connecting to WebSocket server at ".concat(n)),typeof WebSocket>"u"){console.error("WebSocket not supported by this browser or environment"),this.connecting=!1,this.fallbackToHttp();return}try{const r=setTimeout(()=>{console.error("WebSocket connection timeout"),this.socket&&this.socket.readyState!==WebSocket.OPEN&&(this.socket.close(),this.socket=null,this.connecting=!1,this.fallbackToHttp())},1e4);this.socket=new WebSocket(n),this.socket.onopen=()=>{clearTimeout(r),console.log("WebSocket connection established"),this.connected=!0,this.connecting=!1,this.reconnectAttempts=0,this.reconnectDelay=1e3,this.socket.bufferedAmount!==void 0&&console.log("Initial WebSocket buffered amount: ".concat(this.socket.bufferedAmount)),this.pendingSubscriptions=new Set([...this.subscriptions]),this.subscriptions.clear(),this.processPendingSubscriptions(),this.processMessageQueue()},this.socket.onmessage=s=>{try{this.handleMessage(s.data)}catch(o){console.error("Error handling WebSocket message:",o)}},this.socket.onclose=s=>{if(clearTimeout(r),console.log("WebSocket connection closed: ".concat(s.code," ").concat(s.reason)),this.connected=!1,this.connecting=!1,s.code===1006&&(console.warn("WebSocket closed abnormally (code 1006), possible compatibility issue"),this.reconnectAttempts>=3)){console.warn("Multiple abnormal closures, falling back to HTTP"),this.fallbackToHttp();return}s.code!==1e3&&this.reconnect()},this.socket.onerror=s=>{console.error("WebSocket error:",s),this.connecting=!1,this.reconnectAttempts++,this.reconnectAttempts>=3&&(console.warn("Multiple WebSocket errors, falling back to HTTP"),this.fallbackToHttp())}}catch(r){console.error("Error creating WebSocket:",r),this.connecting=!1,this.reconnect()}}fallbackToHttp(){console.warn("Falling back to HTTP for operations"),this.usingHttpFallback=!0;const e=new CustomEvent("websocket-fallback",{detail:{usingHttp:!0}});window.dispatchEvent(e),this.pendingSubscriptions.size>0&&console.log("Notifying ".concat(this.pendingSubscriptions.size," pending subscriptions about HTTP fallback"))}disconnect(){this.socket&&(this.socket.close(1e3,"Client disconnected"),this.socket=null),this.connected=!1,this.connecting=!1,this.subscriptions.clear(),this.pendingSubscriptions.clear(),this.subscriptionParams.clear(),this.messageQueue=[]}reconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Maximum reconnect attempts reached");return}this.reconnectAttempts++;const e=Math.min(3e4,this.reconnectDelay*Math.pow(1.5,this.reconnectAttempts-1));console.log("Reconnecting in ".concat(e,"ms (attempt ").concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),setTimeout(()=>{this.connect()},e)}send(e,n,r){if(!this.connected)return console.log("WebSocket not connected, queueing message"),this.messageQueue.push({type:e,topic:n,payload:r}),this.connect(),!1;const s={type:e,topic:n,payload:r};try{return console.log("Sending WebSocket message:",JSON.stringify(s)),this.socket.send(JSON.stringify(s)),!0}catch(o){return console.error("Error sending WebSocket message:",o),this.messageQueue.push({type:e,topic:n,payload:r}),!1}}processMessageQueue(){if(!this.connected||this.messageQueue.length===0)return;console.log("Processing ".concat(this.messageQueue.length," queued messages"));const e=[...this.messageQueue];this.messageQueue=[];for(const n of e)this.send(n.type,n.topic,n.payload)}processPendingSubscriptions(){if(!(!this.connected||this.pendingSubscriptions.size===0)){console.log("Processing ".concat(this.pendingSubscriptions.size," pending subscriptions"));for(const e of this.pendingSubscriptions){const n=this.subscriptionParams.get(e)||{};this.subscribe(e,n)}this.pendingSubscriptions.clear()}}subscribe(e,n={}){if(!this.connected)return console.log("WebSocket not connected, queueing subscription to ".concat(e)),this.pendingSubscriptions.add(e),this.connect(),!1;this.subscriptions.has(e)&&console.log("Already subscribed to ".concat(e,", updating parameters")),console.log("Subscribing to ".concat(e," with params:"),n),this.subscriptionParams.set(e,n);const r={client_id:this.clientId,...n},s=this.send("subscribe",e,r);return s?this.subscriptions.add(e):this.pendingSubscriptions.add(e),s}unsubscribe(e){if(!this.connected)return console.log("WebSocket not connected, cannot unsubscribe from ".concat(e)),this.pendingSubscriptions.delete(e),!1;if(!this.subscriptions.has(e))return console.log("Not subscribed to ".concat(e)),!0;console.log("Unsubscribing from ".concat(e));const n=this.send("unsubscribe",e,{});return n&&(this.subscriptions.delete(e),this.subscriptionParams.delete(e)),n}handleMessage(e){console.log("Raw WebSocket message received:",e);try{const n=JSON.parse(e);if(!n.type||!n.topic){console.error("Invalid WebSocket message format:",n);return}if(console.log("Received WebSocket message: ".concat(n.type," ").concat(n.topic),n),(n.type==="progress"||n.type==="result")&&console.log("Received ".concat(n.type," message for topic ").concat(n.topic,":"),n.payload),typeof n.payload=="string")try{const o=JSON.parse(n.payload);console.log("Parsed payload for ".concat(n.type,":").concat(n.topic,":"),o),n.payload=o}catch(o){console.log("Payload for ".concat(n.type,":").concat(n.topic," is not JSON, keeping as string"))}if(n.type==="welcome"&&n.topic==="system"){console.log("Received welcome message:",n);let o=n.payload;if(console.log("Welcome payload type:",typeof o),typeof o=="string")try{o=JSON.parse(o),console.log("Parsed welcome payload:",o)}catch(i){console.error("Error parsing welcome payload as JSON:",i),console.log("Raw payload string:",o)}!o||!o.client_id?console.error("Welcome message missing client_id:",o):(this.clientId=o.client_id,console.log("WebSocket client ID received: ".concat(this.clientId)),this.processPendingSubscriptions(),console.log("Notifying any waiting operations about client ID"));return}const r="".concat(n.type,":").concat(n.topic),s=this.handlers[r]||[];for(const o of s)try{o(n.payload)}catch(i){console.error("Error in WebSocket message handler for ".concat(r,":"),i)}}catch(n){console.error("Error parsing WebSocket message:",n)}}on(e,n,r){const s="".concat(e,":").concat(n);this.handlers[s]||(this.handlers[s]=[]),this.handlers[s].push(r),e!=="welcome"&&e!=="ack"&&e!=="error"&&this.subscribe(n)}off(e,n,r){const s="".concat(e,":").concat(n);this.handlers[s]&&(r?this.handlers[s]=this.handlers[s].filter(o=>o!==r):this.handlers[s]=[],this.handlers[s].length===0&&e!=="welcome"&&e!=="ack"&&e!=="error"&&this.unsubscribe(n))}getClientId(){return this.clientId}isConnected(){return this.connected}}class It{constructor(e){this.wsClient=e,this.topic="recordings/batch-delete",this.progressHandlers=[],this.resultHandlers=[],this.errorHandlers=[],this.wsClient.subscribe(this.topic),this.wsClient.on("progress",this.topic,n=>{this.handleProgress(n)}),this.wsClient.on("result",this.topic,n=>{this.handleResult(n)}),this.wsClient.on("error",this.topic,n=>{this.handleError(n)})}deleteWithProgress(e){return new Promise((n,r)=>{if(console.log("Starting batch delete operation with params:",e),!this.wsClient.isConnected()){console.error("WebSocket not connected, attempting to connect"),this.wsClient.connect(),setTimeout(()=>{this.wsClient.isConnected()?(console.log("WebSocket connected, retrying batch delete"),this.deleteWithProgress(e).then(n).catch(r)):(console.error("WebSocket still not connected, falling back to HTTP"),typeof batchDeleteRecordingsByHttpRequest=="function"?batchDeleteRecordingsByHttpRequest(e).then(n).catch(r):r(new Error("WebSocket not connected and HTTP fallback not available")))},1e3);return}const s=this.wsClient.getClientId();console.log("Using WebSocket client ID:",s),console.log("Registering WebSocket handlers for batch delete");const o=a=>{console.log("Batch delete result received:",a),this.wsClient.off("result",this.topic,o),console.log("Batch delete result details:",JSON.stringify(a,null,2)),n(a)},i=a=>{console.error("Batch delete error received:",a),this.wsClient.off("error",this.topic,i),r(new Error(a.error||"Unknown error"))};this.wsClient.on("result",this.topic,o),this.wsClient.on("error",this.topic,i),this.wsClient.subscriptions.has(this.topic)?this.sendDeleteRequest(e,s,n,r,o,i):(console.log("Subscribing to ".concat(this.topic," before sending request")),this.wsClient.send("subscribe",this.topic,{}),this.wsClient.subscriptions.add(this.topic),setTimeout(()=>{this.sendDeleteRequest(e,s,n,r,o,i)},500))})}sendDeleteRequest(e,n,r,s,o,i){if(console.log("Sending batch delete request"),!e.ids&&!e.filter){console.error("Missing ids or filter in batch delete params"),this.wsClient.off("result",this.topic,o),this.wsClient.off("error",this.topic,i),s(new Error("Missing ids or filter in batch delete params"));return}e.ids?console.log("Deleting ".concat(e.ids.length," recordings with IDs:"),e.ids):e.filter&&console.log("Deleting recordings with filter:",e.filter);const a={...e,client_id:n};console.log("Full request params:",JSON.stringify(a,null,2));const u={type:"request",topic:this.topic,payload:a};console.log("Complete WebSocket message:",JSON.stringify(u,null,2)),e.filter&&e.totalCount&&typeof window.updateBatchDeleteProgress=="function"&&(console.log("Simulating initial progress update with total count:",e.totalCount),window.updateBatchDeleteProgress({current:0,total:e.totalCount,succeeded:0,failed:0,status:"Starting batch delete operation for ".concat(e.totalCount," recordings..."),complete:!1}));try{if(this.wsClient.socket&&this.wsClient.socket.readyState===WebSocket.OPEN)return this.wsClient.socket.send(JSON.stringify(u)),console.log("Batch delete request sent successfully via direct socket send"),!0;{const c=this.wsClient.send("request",this.topic,a);return c?console.log("Batch delete request sent successfully via send method"):(console.error("Failed to send batch delete request"),this.wsClient.off("result",this.topic,o),this.wsClient.off("error",this.topic,i),s(new Error("Failed to send batch delete request"))),c}}catch(c){return console.error("Error sending batch delete request:",c),this.wsClient.off("result",this.topic,o),this.wsClient.off("error",this.topic,i),s(c),!1}}handleProgress(e){console.log("Batch delete progress update received:",e);let n=e;if(typeof e=="string")try{n=JSON.parse(e),console.log("Parsed progress payload:",n)}catch(r){console.error("Error parsing progress payload:",r),n={error:"Failed to parse progress data"}}if(typeof window.updateBatchDeleteProgress=="function"&&n)try{console.log("Directly updating progress UI with:",n),window.updateBatchDeleteProgress(n)}catch(r){console.error("Error directly updating progress UI:",r)}for(const r of this.progressHandlers)try{r(n)}catch(s){console.error("Error in progress handler:",s)}}handleResult(e){console.log("Batch delete result received:",e);let n=e;if(typeof e=="string")try{n=JSON.parse(e),console.log("Parsed result payload:",n)}catch(r){console.error("Error parsing result payload:",r),n={error:"Failed to parse result data"}}if(typeof window.updateBatchDeleteProgress=="function"&&n)try{const r={current:n.total||0,total:n.total||0,succeeded:n.succeeded||0,failed:n.failed||0,status:"Batch delete operation complete",complete:!0};console.log("Updating progress UI with final result:",r),window.updateBatchDeleteProgress(r)}catch(r){console.error("Error updating progress UI from result:",r)}for(const r of this.resultHandlers)try{r(n)}catch(s){console.error("Error in result handler:",s)}}handleError(e){console.log("Batch delete error received:",e);let n=e;if(typeof e=="string")try{n=JSON.parse(e),console.log("Parsed error payload:",n)}catch(r){console.error("Error parsing error payload:",r),n={error:typeof e=="string"?e:"Unknown error"}}for(const r of this.errorHandlers)try{r(n)}catch(s){console.error("Error in error handler:",s)}}onProgress(e){return this.progressHandlers.push(e),()=>{this.progressHandlers=this.progressHandlers.filter(n=>n!==e)}}onResult(e){return this.resultHandlers.push(e),()=>{this.resultHandlers=this.resultHandlers.filter(n=>n!==e)}}onError(e){return this.errorHandlers.push(e),()=>{this.errorHandlers=this.errorHandlers.filter(n=>n!==e)}}}var z,k,Be,Nt,de=0,Mn=[],$=x,Ft=$.__b,At=$.__r,Lt=$.diffed,qt=$.__c,Ut=$.unmount,Qt=$.__;function le(t,e){$.__h&&$.__h(k,t,de||e),de=0;var n=k.__H||(k.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function V(t){return de=1,Ae(In,t)}function Ae(t,e,n){var r=le(z++,2);if(r.t=t,!r.__c&&(r.__=[n?n(e):In(void 0,e),function(a){var u=r.__N?r.__N[0]:r.__[0],c=r.t(u,a);u!==c&&(r.__N=[c,r.__[1]],r.__c.setState({}))}],r.__c=k,!k.__f)){var s=function(a,u,c){if(!r.__c.__H)return!0;var h=r.__c.__H.__.filter(function(f){return!!f.__c});if(h.every(function(f){return!f.__N}))return!o||o.call(this,a,u,c);var l=r.__c.props!==a;return h.forEach(function(f){if(f.__N){var d=f.__[0];f.__=f.__N,f.__N=void 0,d!==f.__[0]&&(l=!0)}}),o&&o.call(this,a,u,c)||l};k.__f=!0;var o=k.shouldComponentUpdate,i=k.componentWillUpdate;k.componentWillUpdate=function(a,u,c){if(this.__e){var h=o;o=void 0,s(a,u,c),o=h}i&&i.call(this,a,u,c)},k.shouldComponentUpdate=s}return r.__N||r.__}function J(t,e){var n=le(z++,3);!$.__s&&pt(n.__H,e)&&(n.__=t,n.u=e,k.__H.__h.push(n))}function fe(t,e){var n=le(z++,4);!$.__s&&pt(n.__H,e)&&(n.__=t,n.u=e,k.__h.push(n))}function ut(t){return de=5,Ce(function(){return{current:t}},[])}function dt(t,e,n){de=6,fe(function(){if(typeof t=="function"){var r=t(e());return function(){t(null),r&&typeof r=="function"&&r()}}if(t)return t.current=e(),function(){return t.current=null}},n==null?n:n.concat(t))}function Ce(t,e){var n=le(z++,7);return pt(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function he(t,e){return de=8,Ce(function(){return t},e)}function ie(t){var e=k.context[t.__c],n=le(z++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(k)),e.props.value):t.__}function ht(t,e){$.useDebugValue&&$.useDebugValue(e?e(t):t)}function Fr(t){var e=le(z++,10),n=V();return e.__=t,k.componentDidCatch||(k.componentDidCatch=function(r,s){e.__&&e.__(r,s),n[1](r)}),[n[0],function(){n[1](void 0)}]}function ft(){var t=le(z++,11);if(!t.__){for(var e=k.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function Ar(){for(var t;t=Mn.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Oe),t.__H.__h.forEach(Ye),t.__H.__h=[]}catch(e){t.__H.__h=[],$.__e(e,t.__v)}}$.__b=function(t){k=null,Ft&&Ft(t)},$.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Qt&&Qt(t,e)},$.__r=function(t){At&&At(t),z=0;var e=(k=t.__c).__H;e&&(Be===k?(e.__h=[],k.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(Oe),e.__h.forEach(Ye),e.__h=[],z=0)),Be=k},$.diffed=function(t){Lt&&Lt(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Mn.push(e)!==1&&Nt===$.requestAnimationFrame||((Nt=$.requestAnimationFrame)||Lr)(Ar)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Be=k=null},$.__c=function(t,e){e.some(function(n){try{n.__h.forEach(Oe),n.__h=n.__h.filter(function(r){return!r.__||Ye(r)})}catch(r){e.some(function(s){s.__h&&(s.__h=[])}),e=[],$.__e(r,n.__v)}}),qt&&qt(t,e)},$.unmount=function(t){Ut&&Ut(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{Oe(r)}catch(s){e=s}}),n.__H=void 0,e&&$.__e(e,n.__v))};var Ht=typeof requestAnimationFrame=="function";function Lr(t){var e,n=function(){clearTimeout(r),Ht&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,100);Ht&&(e=requestAnimationFrame(n))}function Oe(t){var e=k,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),k=e}function Ye(t){var e=k;t.__c=t.__(),k=e}function pt(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function In(t,e){return typeof e=="function"?e(t):e}function Nn(t,e){for(var n in e)t[n]=e[n];return t}function Ze(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var r in e)if(r!=="__source"&&t[r]!==e[r])return!0;return!1}function mt(t,e){var n=e(),r=V({t:{__:n,u:e}}),s=r[0].t,o=r[1];return fe(function(){s.__=n,s.u=e,je(s)&&o({t:s})},[t,n,e]),J(function(){return je(s)&&o({t:s}),t(function(){je(s)&&o({t:s})})},[t]),n}function je(t){var e,n,r=t.u,s=t.__;try{var o=r();return!((e=s)===(n=o)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch(i){return!0}}function _t(t){t()}function gt(t){return t}function yt(){return[!1,_t]}var vt=fe;function Me(t,e){this.props=t,this.context=e}function Fn(t,e){function n(s){var o=this.props.ref,i=o==s.ref;return!i&&o&&(o.call?o(null):o.current=null),e?!e(this.props,s)||!i:Ze(this.props,s)}function r(s){return this.shouldComponentUpdate=n,F(t,s)}return r.displayName="Memo("+(t.displayName||t.name)+")",r.prototype.isReactComponent=!0,r.__f=!0,r}(Me.prototype=new U).isPureReactComponent=!0,Me.prototype.shouldComponentUpdate=function(t,e){return Ze(this.props,t)||Ze(this.state,e)};var Wt=x.__b;x.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),Wt&&Wt(t)};var qr=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function An(t){function e(n){var r=Nn({},n);return delete r.ref,t(r,n.ref||null)}return e.$$typeof=qr,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var Bt=function(t,e){return t==null?null:j(j(t).map(e))},Ln={map:Bt,forEach:Bt,count:function(t){return t?j(t).length:0},only:function(t){var e=j(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:j},Ur=x.__e;x.__e=function(t,e,n,r){if(t.then){for(var s,o=e;o=o.__;)if((s=o.__c)&&s.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),s.__c(t,e)}Ur(t,e,n,r)};var jt=x.unmount;function qn(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),t.__c.__H=null),(t=Nn({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(r){return qn(r,e,n)})),t}function Un(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(r){return Un(r,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function ge(){this.__u=0,this.o=null,this.__b=null}function Qn(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function Hn(t){var e,n,r;function s(o){if(e||(e=t()).then(function(i){n=i.default||i},function(i){r=i}),r)throw r;if(!n)throw e;return F(n,o)}return s.displayName="Lazy",s.__f=!0,s}function ce(){this.i=null,this.l=null}x.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),jt&&jt(t)},(ge.prototype=new U).__c=function(t,e){var n=e.__c,r=this;r.o==null&&(r.o=[]),r.o.push(n);var s=Qn(r.__v),o=!1,i=function(){o||(o=!0,n.__R=null,s?s(a):a())};n.__R=i;var a=function(){if(!--r.__u){if(r.state.__a){var u=r.state.__a;r.__v.__k[0]=Un(u,u.__c.__P,u.__c.__O)}var c;for(r.setState({__a:r.__b=null});c=r.o.pop();)c.forceUpdate()}};r.__u++||32&e.__u||r.setState({__a:r.__b=r.__v.__k[0]}),t.then(i,i)},ge.prototype.componentWillUnmount=function(){this.o=[]},ge.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=qn(this.__b,n,r.__O=r.__P)}this.__b=null}var s=e.__a&&F(W,null,t.fallback);return s&&(s.__u&=-33),[F(W,null,e.__a?null:t.children),s]};var Vt=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};function Qr(t){return this.getChildContext=function(){return t.context},t.children}function Hr(t){var e=this,n=t.h;e.componentWillUnmount=function(){oe(null,e.v),e.v=null,e.h=null},e.h&&e.h!==n&&e.componentWillUnmount(),e.v||(e.h=n,e.v={nodeType:1,parentNode:n,childNodes:[],contains:function(){return!0},appendChild:function(r){this.childNodes.push(r),e.h.appendChild(r)},insertBefore:function(r,s){this.childNodes.push(r),e.h.insertBefore(r,s)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.h.removeChild(r)}}),oe(F(Qr,{context:e.context},t.__v),e.v)}function Wn(t,e){var n=F(Hr,{__v:t,h:e});return n.containerInfo=e,n}(ce.prototype=new U).__a=function(t){var e=this,n=Qn(e.__v),r=e.l.get(t);return r[0]++,function(s){var o=function(){e.props.revealOrder?(r.push(s),Vt(e,t,r)):s()};n?n(o):o()}},ce.prototype.render=function(t){this.i=null,this.l=new Map;var e=j(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},ce.prototype.componentDidUpdate=ce.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){Vt(t,n,e)})};var Bn=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Wr=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Br=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,jr=/[A-Z0-9]/g,Vr=typeof document<"u",Kr=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function jn(t,e,n){return e.__k==null&&(e.textContent=""),oe(t,e),typeof n=="function"&&n(),t?t.__c:null}function Vn(t,e,n){return ct(t,e),typeof n=="function"&&n(),t?t.__c:null}U.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(U.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var Kt=x.event;function zr(){}function Jr(){return this.cancelBubble}function Gr(){return this.defaultPrevented}x.event=function(t){return Kt&&(t=Kt(t)),t.persist=zr,t.isPropagationStopped=Jr,t.isDefaultPrevented=Gr,t.nativeEvent=t};var bt,Yr={enumerable:!1,configurable:!0,get:function(){return this.class}},zt=x.vnode;x.vnode=function(t){typeof t.type=="string"&&function(e){var n=e.props,r=e.type,s={},o=r.indexOf("-")===-1;for(var i in n){var a=n[i];if(!(i==="value"&&"defaultValue"in n&&a==null||Vr&&i==="children"&&r==="noscript"||i==="class"||i==="className")){var u=i.toLowerCase();i==="defaultValue"&&"value"in n&&n.value==null?i="value":i==="download"&&a===!0?a="":u==="translate"&&a==="no"?a=!1:u[0]==="o"&&u[1]==="n"?u==="ondoubleclick"?i="ondblclick":u!=="onchange"||r!=="input"&&r!=="textarea"||Kr(n.type)?u==="onfocus"?i="onfocusin":u==="onblur"?i="onfocusout":Br.test(i)&&(i=u):u=i="oninput":o&&Wr.test(i)?i=i.replace(jr,"-$&").toLowerCase():a===null&&(a=void 0),u==="oninput"&&s[i=u]&&(i="oninputCapture"),s[i]=a}}r=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=j(n.children).forEach(function(c){c.props.selected=s.value.indexOf(c.props.value)!=-1})),r=="select"&&s.defaultValue!=null&&(s.value=j(n.children).forEach(function(c){c.props.selected=s.multiple?s.defaultValue.indexOf(c.props.value)!=-1:s.defaultValue==c.props.value})),n.class&&!n.className?(s.class=n.class,Object.defineProperty(s,"className",Yr)):(n.className&&!n.class||n.class&&n.className)&&(s.class=s.className=n.className),e.props=s}(t),t.$$typeof=Bn,zt&&zt(t)};var Jt=x.__r;x.__r=function(t){Jt&&Jt(t),bt=t.__c};var Gt=x.diffed;x.diffed=function(t){Gt&&Gt(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),bt=null};var Kn={ReactCurrentDispatcher:{current:{readContext:function(t){return bt.__n[t.__c].props.value},useCallback:he,useContext:ie,useDebugValue:ht,useDeferredValue:gt,useEffect:J,useId:ft,useImperativeHandle:dt,useInsertionEffect:vt,useLayoutEffect:fe,useMemo:Ce,useReducer:Ae,useRef:ut,useState:V,useSyncExternalStore:mt,useTransition:yt}}},Zr="18.3.1";function zn(t){return F.bind(null,t)}function xe(t){return!!t&&t.$$typeof===Bn}function Jn(t){return xe(t)&&t.type===W}function Gn(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function Yn(t){return xe(t)?Dn.apply(null,arguments):t}function Zn(t){return!!t.__k&&(oe(null,t),!0)}function Xn(t){return t&&(t.base||t.nodeType===1&&t)||null}var er=function(t,e){return t(e)},tr=function(t,e){return t(e)},nr=W,rr=xe,Xr={useState:V,useId:ft,useReducer:Ae,useEffect:J,useLayoutEffect:fe,useInsertionEffect:vt,useTransition:yt,useDeferredValue:gt,useSyncExternalStore:mt,startTransition:_t,useRef:ut,useImperativeHandle:dt,useMemo:Ce,useCallback:he,useContext:ie,useDebugValue:ht,version:"18.3.1",Children:Ln,render:jn,hydrate:Vn,unmountComponentAtNode:Zn,createPortal:Wn,createElement:F,createContext:ae,createFactory:zn,cloneElement:Yn,createRef:it,Fragment:W,isValidElement:xe,isElement:rr,isFragment:Jn,isMemo:Gn,findDOMNode:Xn,Component:U,PureComponent:Me,memo:Fn,forwardRef:An,flushSync:tr,unstable_batchedUpdates:er,StrictMode:nr,Suspense:ge,SuspenseList:ce,lazy:Hn,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Kn};const sr=Object.freeze(Object.defineProperty({__proto__:null,Children:Ln,Component:U,Fragment:W,PureComponent:Me,StrictMode:nr,Suspense:ge,SuspenseList:ce,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Kn,cloneElement:Yn,createContext:ae,createElement:F,createFactory:zn,createPortal:Wn,createRef:it,default:Xr,findDOMNode:Xn,flushSync:tr,forwardRef:An,hydrate:Vn,isElement:rr,isFragment:Jn,isMemo:Gn,isValidElement:xe,lazy:Hn,memo:Fn,render:jn,startTransition:_t,unmountComponentAtNode:Zn,unstable_batchedUpdates:er,useCallback:he,useContext:ie,useDebugValue:ht,useDeferredValue:gt,useEffect:J,useErrorBoundary:Fr,useId:ft,useImperativeHandle:dt,useInsertionEffect:vt,useLayoutEffect:fe,useMemo:Ce,useReducer:Ae,useRef:ut,useState:V,useSyncExternalStore:mt,useTransition:yt,version:Zr},Symbol.toStringTag,{value:"Module"})),es="0.11.1";function or(){return es}var dn,hn,fn;function ts({activeNav:t="",version:e=""}){const[n,r]=V(""),[s,o]=V(!1);J(()=>{const l=localStorage.getItem("auth");if(l)try{const d=atob(l).split(":")[0];r(d)}catch(f){console.error("Error decoding auth token:",f),r("User")}else r("User")},[]);const i=l=>{l.preventDefault(),localStorage.removeItem("auth"),fetch("/api/auth/logout",{method:"POST"}).then(()=>{window.location.href="login.html?logout=true"}).catch(()=>{window.location.href="login.html?logout=true"})},a=()=>{o(!s)},c=[{id:"nav-live",href:window.location.pathname==="/"||window.location.pathname.endsWith("/")?"./":"index.html",label:"Live View"},{id:"nav-recordings",href:"recordings.html",label:"Recordings"},{id:"nav-streams",href:"streams.html",label:"Streams"},{id:"nav-settings",href:"settings.html",label:"Settings"},{id:"nav-users",href:"users.html",label:"Users"},{id:"nav-system",href:"system.html",label:"System"}],h=l=>{const f=t===l.id,d="text-white no-underline rounded transition-colors",p="px-3 py-2",m="block w-full px-4 py-3 text-left",_=f?"bg-blue-600":"hover:bg-blue-700";return se(dn||(dn=G(["\n      <li class=",'>\n        <a\n          href="','"\n          id=',"\n          class=","\n          onClick=","\n        >\n          ","\n        </a>\n      </li>\n    "])),s?"w-full":"mx-1",l.href,l.id,"".concat(d," ").concat(s?m:p," ").concat(_),s?a:null,l.label)};return se(fn||(fn=G(['\n    <header class="bg-gray-800 text-white py-2 shadow-md mb-4 w-full">\n      <div class="container mx-auto px-4 flex justify-between items-center">\n        <div class="logo flex items-center">\n          <h1 class="text-xl font-bold m-0">LightNVR</h1>\n          <span class="version text-blue-200 text-xs ml-2">v','</span>\n        </div>\n\n        <!-- Desktop Navigation -->\n        <nav class="hidden md:block">\n          <ul class="flex list-none m-0 p-0">\n            ','\n          </ul>\n        </nav>\n\n        <!-- User Menu (Desktop) -->\n        <div class="user-menu hidden md:flex items-center">\n          <span class="mr-2">','</span>\n          <a href="#" onClick=',' class="text-white no-underline hover:bg-blue-700 px-3 py-1 rounded transition-colors">Logout</a>\n        </div>\n\n        <!-- Mobile Menu Button -->\n        <button\n          class="md:hidden text-white p-2 focus:outline-none"\n          onClick=','\n          aria-label="Toggle menu"\n        >\n          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d='," />\n          </svg>\n        </button>\n      </div>\n\n      <!-- Mobile Navigation -->\n      ","\n    </header>\n  "])),e,c.map(h),n,i,a,s?"M6 18L18 6M6 6l12 12":"M4 6h16M4 12h16M4 18h16",s?se(hn||(hn=G(['\n        <div class="md:hidden mt-2 border-t border-gray-700 pt-2 container mx-auto px-4">\n          <ul class="list-none m-0 p-0 flex flex-col w-full">\n            ','\n            <li class="w-full mt-2 pt-2 border-t border-gray-700">\n              <div class="flex justify-between items-center px-4 py-2">\n                <span>','</span>\n                <a href="#" onClick=',' class="text-white no-underline hover:bg-blue-700 px-3 py-1 rounded transition-colors">Logout</a>\n              </div>\n            </li>\n          </ul>\n        </div>\n      '])),c.map(h),n,i):null)}var pn;function ns(t=""){const e=document.getElementById("header-container");if(!e)return;const n=or();L(async()=>{const{render:r}=await Promise.resolve().then(()=>$n);return{render:r}},void 0,import.meta.url).then(({render:r})=>{r(se(pn||(pn=G(["<"," activeNav="," version="," />"])),ts,t,n),e)}).catch(r=>{console.error("Error importing Preact:",r)})}var mn;function rs(){const[t]=V(new Date().getFullYear());return se(mn||(mn=G(['\n    <footer class="bg-gray-800 text-white py-3 px-4 mt-4 shadow-inner">\n      <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center">\n        <div class="text-center sm:text-left mb-2 sm:mb-0">\n          <p class="text-sm">© ',' LightNVR ·\n            <a href="https://github.com/opensensor/lightnvr" class="text-blue-300 hover:text-blue-100 text-sm" target="_blank" rel="noopener noreferrer">GitHub</a>\n          </p>\n          <p class="text-xs text-gray-400 mt-1 hidden sm:block">Lightweight Network Video Recorder</p>\n        </div>\n      </div>\n    </footer>\n  '])),t)}var _n;function ss(){const t=document.getElementById("footer-container");if(!t)return;const e=or();L(async()=>{const{render:n}=await Promise.resolve().then(()=>$n);return{render:n}},void 0,import.meta.url).then(({render:n})=>{n(se(_n||(_n=G(["<"," version="," />"])),rs,e),t)}).catch(n=>{console.error("Error importing Preact for footer:",n)})}function os(){let t=document.getElementById("snapshot-modal-container");t||(t=document.createElement("div"),t.id="snapshot-modal-container",document.body.appendChild(t));const e=document.createElement("div");e.id="snapshot-preview-modal",e.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden",e.innerHTML='\n    <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl max-h-[90vh] flex flex-col transform transition-all duration-300 ease-out scale-95 opacity-0" style="width: 90%;">\n      <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">\n        <h3 id="snapshot-preview-title" class="text-lg font-semibold text-gray-900 dark:text-white">Snapshot</h3>\n        <button class="close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">✕</button>\n      </div>\n      <div class="p-4 overflow-auto flex-grow">\n        <img id="snapshot-preview-image" class="max-w-full max-h-[70vh] mx-auto" src="" alt="Snapshot">\n      </div>\n      <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-2">\n        <button id="snapshot-download-btn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">Download</button>\n        <button id="snapshot-close-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600">Close</button>\n      </div>\n    </div>\n  ',t.appendChild(e);let n=document.getElementById("video-modal-container");n||(n=document.createElement("div"),n.id="video-modal-container",document.body.appendChild(n));const r=document.createElement("div");r.id="video-preview-modal",r.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden",r.innerHTML='\n    <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl max-h-[90vh] flex flex-col transform transition-all duration-300 ease-out scale-95 opacity-0 w-full md:w-[90%]">\n      <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">\n        <h3 id="video-preview-title" class="text-lg font-semibold text-gray-900 dark:text-white">Video</h3>\n        <button class="close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">✕</button>\n      </div>\n      <div class="p-4 flex-grow">\n        <video id="video-preview-player" class="w-full h-auto max-w-full object-contain mx-auto" controls autoplay></video>\n      </div>\n      <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-2">\n        <a id="video-download-btn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors" href="#" download>Download</a>\n        <button id="video-close-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600">Close</button>\n      </div>\n    </div>\n  ',n.appendChild(r),document.addEventListener("keydown",s=>{s.key==="Escape"&&document.querySelectorAll(".fixed.inset-0.bg-black.bg-opacity-75").forEach(i=>{i.classList.contains("hidden")||i.classList.add("hidden")})})}function is(){L(async()=>{const{initToastContainer:t}=await import("./toast-Do6XSKgM.js");return{initToastContainer:t}},[],import.meta.url).then(({initToastContainer:t})=>{t(!1)}).catch(t=>{if(console.error("Error loading toast module:",t),document.getElementById("status-message-styles"))return;const e=document.createElement("style");e.id="status-message-styles",e.textContent="\n      #status-message-container {\n        position: fixed;\n        top: 1rem;\n        left: 50%;\n        transform: translateX(-50%);\n        z-index: 50;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n      }\n      \n      .status-message {\n        background-color: #1f2937;\n        color: white;\n        padding: 0.5rem 1rem;\n        border-radius: 0.375rem;\n        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n        margin-bottom: 0.5rem;\n        transition: all 0.3s ease;\n        opacity: 0;\n        transform: translateY(-0.5rem);\n      }\n      \n      .status-message.show {\n        opacity: 1;\n        transform: translateY(0);\n      }\n      \n      .status-message.success {\n        background-color: #10b981;\n      }\n      \n      .status-message.error {\n        background-color: #ef4444;\n      }\n      \n      .status-message.warning {\n        background-color: #f59e0b;\n      }\n      \n      .status-message.info {\n        background-color: #3b82f6;\n      }\n    ",document.head.appendChild(e)})}function as(){if(document.getElementById("modal-styles"))return;const t=document.createElement("style");t.id="modal-styles",t.textContent="\n    .modal-content {\n      transition: all 0.3s ease-out;\n    }\n    \n    .modal-content.scale-95 {\n      transform: scale(0.95);\n      opacity: 0;\n    }\n    \n    .modal-content.scale-100 {\n      transform: scale(1);\n      opacity: 1;\n    }\n  ",document.head.appendChild(t)}var gn;function eo(t){const{isOpen:e,onClose:n,onConfirm:r,mode:s,count:o}=t;if(!e)return null;let i="Confirm Delete",a="Are you sure you want to delete this item?";s==="selected"?(i="Delete Selected Recordings",a="Are you sure you want to delete ".concat(o," selected recording").concat(o!==1?"s":"","?")):s==="all"&&(i="Delete All Filtered Recordings",a="Are you sure you want to delete all recordings matching the current filters? This action cannot be undone.");const u=h=>{h.key==="Escape"&&n()},c=h=>{h.target===h.currentTarget&&n()};return se(gn||(gn=G(['\n    <div \n      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"\n      onClick=',"\n      onKeyDown=",'\n    >\n      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md mx-auto">\n        <div class="mb-4">\n          <h3 class="text-lg font-semibold text-gray-900 dark:text-white">','</h3>\n        </div>\n        \n        <p class="text-gray-600 dark:text-gray-300 mb-6">','</p>\n        \n        <div class="flex justify-end space-x-3">\n          <button \n            class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"\n            onClick=','\n          >\n            Cancel\n          </button>\n          <button \n            class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"\n            onClick=',"\n          >\n            Delete\n          </button>\n        </div>\n      </div>\n    </div>\n  "])),c,u,i,a,n,r)}function to(t,e,n){const r=document.createElement("div");r.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",r.id="video-modal-overlay";const s=document.createElement("div");s.className="bg-gray-50 dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl flex flex-col w-full md:w-[90%]";const o=document.createElement("div");o.className="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700";const i=document.createElement("h3");i.className="text-lg font-semibold text-gray-900 dark:text-white",i.textContent=e||"Video";const a=document.createElement("button");a.className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",a.innerHTML="✕",a.addEventListener("click",()=>{document.body.removeChild(r)}),o.appendChild(i),o.appendChild(a);const u=document.createElement("div");u.className="p-4";const c=document.createElement("video");c.src=t,c.className="w-full h-auto max-w-full object-contain mx-auto",c.controls=!0,c.autoplay=!0,u.appendChild(c);const h=document.createElement("div");h.id="recordings-controls",h.className="mx-4 mb-4 p-4 border border-green-500 rounded-lg bg-white dark:bg-gray-700 shadow-md relative z-10";const l=document.createElement("h3");l.className="text-lg font-bold text-center mb-4 text-gray-800 dark:text-white",l.textContent="PLAYBACK CONTROLS",h.appendChild(l);const f=document.createElement("div");f.className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-2";const d=document.createElement("div");d.className="border-b pb-4 md:border-b-0 md:border-r md:pr-4 md:pb-0";const p=document.createElement("h4");p.className="font-bold text-center mb-3 text-gray-700 dark:text-gray-300",p.textContent="Playback Speed",d.appendChild(p);const m=document.createElement("div");m.className="flex flex-wrap justify-center gap-2",[.25,.5,1,1.5,2,4].forEach(P=>{const O=document.createElement("button");O.textContent=P===1?"1× (Normal)":"".concat(P,"×"),O.className=P===1?"speed-btn px-3 py-2 rounded-full bg-green-500 text-white text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50":"speed-btn px-3 py-2 rounded-full bg-gray-200 hover:bg-gray-300 text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50",O.setAttribute("data-speed",P),O.addEventListener("click",()=>{c.playbackRate=P,m.querySelectorAll(".speed-btn").forEach(N=>{N.getAttribute("data-speed")===P.toString()?(N.classList.remove("bg-gray-200","hover:bg-gray-300"),N.classList.add("bg-green-500","text-white")):(N.classList.remove("bg-green-500","text-white"),N.classList.add("bg-gray-200","hover:bg-gray-300"))}),g.textContent="Current Speed: ".concat(P,"× ").concat(P===1?"(Normal)":"")}),m.appendChild(O)}),d.appendChild(m);const g=document.createElement("div");g.id="current-speed-indicator",g.className="mt-3 text-center font-medium text-green-600 dark:text-green-400 text-sm",g.textContent="Current Speed: 1× (Normal)",d.appendChild(g),f.appendChild(d);const y=document.createElement("div");y.className="pt-4 md:pt-0 md:pl-4";const S=document.createElement("h4");S.className="font-bold text-center mb-2 text-gray-700 dark:text-gray-300",S.textContent="Detection Overlays",y.appendChild(S);const w=document.createElement("div");w.className="flex flex-col items-center gap-2";const E=document.createElement("div");E.className="flex items-center gap-2 mb-2";const v=document.createElement("input");v.type="checkbox",v.id="detection-overlay-checkbox",v.className="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600";const C=document.createElement("label");C.htmlFor="detection-overlay-checkbox",C.className="text-sm font-medium text-gray-700 dark:text-gray-300",C.textContent="Show Detection Overlays",E.appendChild(v),E.appendChild(C),w.appendChild(E);const b=document.createElement("div");b.className="flex flex-col w-full mt-2 mb-2";const D=document.createElement("label");D.htmlFor="detection-sensitivity-slider",D.className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",D.textContent="Detection Sensitivity";const A=document.createElement("div");A.id="detection-sensitivity-value",A.className="text-xs text-gray-600 dark:text-gray-400 text-center mb-1",A.textContent="Time Window: 2 seconds";const R=document.createElement("input");R.type="range",R.id="detection-sensitivity-slider",R.className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700",R.min="1",R.max="10",R.step="1",R.value="2",b.appendChild(D),b.appendChild(R),b.appendChild(A),R.addEventListener("input",()=>{ke=parseInt(R.value),A.textContent="Time Window: ".concat(ke," second").concat(ke!==1?"s":""),X&&ee()}),w.appendChild(b);const M=document.createElement("div");if(M.id="detection-status-indicator",M.className="text-center text-sm text-gray-600 dark:text-gray-400",M.textContent="No detections loaded",w.appendChild(M),y.appendChild(w),f.appendChild(y),h.appendChild(f),n){const P=document.createElement("div");P.className="flex justify-center mt-4 pt-2 border-t border-gray-200 dark:border-gray-700";const O=document.createElement("a");O.className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center text-sm",O.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />\n      </svg>\n      Download Video\n    ',O.href=n,O.download="video-".concat(Date.now(),".mp4"),P.appendChild(O),h.appendChild(P)}const Ee=document.createElement("div");Ee.className="p-2";const Z=document.createElement("div");Z.className="relative",Z.style.position="relative",Z.style.width="100%",Z.style.height="100%";const I=document.createElement("canvas");I.id="detection-overlay-canvas",I.className="absolute top-0 left-0 w-full h-full pointer-events-none",I.style.position="absolute",I.style.top="0",I.style.left="0",I.style.width="100%",I.style.height="100%",I.style.pointerEvents="none",I.style.display="none",Z.appendChild(c),Z.appendChild(I),u.appendChild(Z);let Q=null,H=[],X=!1,ke=parseInt(R.value);const Ue=t.match(/\/play\/(\d+)/);if(Ue&&Ue[1]){const P=parseInt(Ue[1],10);fetch("/api/recordings/".concat(P)).then(O=>O.json()).then(O=>{if(Q=O,Q&&Q.stream&&Q.start_time&&Q.end_time){const N=Math.floor(new Date(Q.start_time).getTime()/1e3),Qe=Math.floor(new Date(Q.end_time).getTime()/1e3),kt=new URLSearchParams({start:N,end:Qe});return fetch("/api/detection/results/".concat(Q.stream,"?").concat(kt.toString()))}throw new Error("Recording data incomplete")}).then(O=>O.json()).then(O=>{H=O.detections||[],H.length>0?(M.textContent="".concat(H.length," detection").concat(H.length!==1?"s":""," available"),M.className="text-center text-sm font-medium text-green-600 dark:text-green-400",v.disabled=!1):(M.textContent="No detections found for this recording",v.disabled=!0)}).catch(O=>{console.error("Error fetching detection data:",O),M.textContent="Error loading detections",M.className="text-center text-sm font-medium text-red-600 dark:text-red-400",v.disabled=!0})}v.addEventListener("change",()=>{X=v.checked,X?(I.style.display="block",ee(),M.textContent="Showing ".concat(H.length," detection").concat(H.length!==1?"s":"")):(I.style.display="none",M.textContent="".concat(H.length," detection").concat(H.length!==1?"s":""," available"))});function ee(){if(!X||!c||!I||H.length===0)return;const P=c.videoWidth,O=c.videoHeight;if(P===0||O===0){requestAnimationFrame(ee);return}I.width=P,I.height=O;const N=I.getContext("2d");N.clearRect(0,0,I.width,I.height);const Qe=c.currentTime;if(!Q||!Q.start_time)return;const xr=Math.floor(new Date(Q.start_time).getTime()/1e3)+Math.floor(Qe),Re=H.filter(K=>K.timestamp?Math.abs(K.timestamp-xr)<=ke:!1);M&&(Re.length>0?M.textContent="Showing ".concat(Re.length," detection").concat(Re.length!==1?"s":""," at current time"):M.textContent="No detections at current time (".concat(H.length," total)")),Re.forEach(K=>{const He=K.x*P,We=K.y*O,Sr=K.width*P,Er=K.height*O;N.strokeStyle="rgba(0, 255, 0, 0.8)",N.lineWidth=2,N.strokeRect(He,We,Sr,Er),N.fillStyle="rgba(0, 0, 0, 0.7)";const Rt="".concat(K.label," (").concat(Math.round(K.confidence*100),"%)"),kr=N.measureText(Rt).width+10;N.fillRect(He,We-20,kr,20),N.fillStyle="white",N.font="12px Arial",N.fillText(Rt,He+5,We-5)}),!c.paused&&!c.ended&&requestAnimationFrame(ee)}c.addEventListener("play",()=>{X&&ee()}),c.addEventListener("seeked",()=>{X&&ee()}),c.addEventListener("timeupdate",()=>{if(X){const P=Math.floor(c.currentTime*2)/2;c.lastDrawnTime!==P&&(c.lastDrawnTime=P,ee())}}),s.appendChild(o),s.appendChild(u),s.appendChild(h),s.appendChild(Ee),r.appendChild(s),document.body.appendChild(r);const Et=P=>{P.key==="Escape"&&(document.body.contains(r)&&document.body.removeChild(r),document.removeEventListener("keydown",Et))};document.addEventListener("keydown",Et),r.addEventListener("click",P=>{P.target===r&&document.body.removeChild(r)})}function te(t,e="info",n=4e3){if(console.log("Showing status message: ".concat(t," (").concat(e,")")),window.showToast){window.showToast(t,e,n);return}L(async()=>{const{showStatusMessage:r}=await import("./toast-Do6XSKgM.js");return{showStatusMessage:r}},[],import.meta.url).then(({showStatusMessage:r})=>{r(t,e,n)}).catch(r=>{console.error("Error loading toast module:",r);let s=document.getElementById("status-message-container");s||(s=document.createElement("div"),s.id="status-message-container",s.className="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 flex flex-col items-center",document.body.appendChild(s));const o=document.createElement("div");let i="bg-blue-500";e==="success"?i="bg-green-500":e==="error"?i="bg-red-500":e==="warning"&&(i="bg-yellow-500"),o.className="".concat(i," text-white px-4 py-2 rounded-lg shadow-lg mb-2 transition-all duration-300 opacity-0 transform translate-y-2"),o.textContent=t,s.appendChild(o),setTimeout(()=>{o.classList.remove("opacity-0","translate-y-2")},10),setTimeout(()=>{o.classList.add("opacity-0","translate-y-2"),setTimeout(()=>{o.parentNode===s&&s.removeChild(o),s.children.length===0&&s.parentNode===document.body&&document.body.removeChild(s)},300)},n)})}function no(t,e){const n=document.getElementById("snapshot-preview-modal");if(!n){console.error("Snapshot modal not found. Make sure setupModals() has been called.");return}const r=document.getElementById("snapshot-preview-title"),s=document.getElementById("snapshot-preview-image"),o=document.getElementById("snapshot-download-btn"),i=document.getElementById("snapshot-close-btn"),a=n.querySelectorAll(".close"),u=n.querySelector(".modal-content");r&&(r.textContent="Snapshot: ".concat(e)),n.dataset.imageData=t,n.dataset.streamName=e,s&&(s.src=t,s.style.display="block",s.onload=()=>{console.log("Snapshot image loaded successfully")},s.onerror=h=>{console.error("Error loading snapshot image:",h)});function c(){n.classList.add("hidden"),u&&(u.classList.remove("scale-100"),u.classList.add("scale-95"))}i&&(i.onclick=c),a.forEach(h=>{h.onclick=c}),n.onclick=function(h){h.target===n&&c()},document.addEventListener("keydown",function(h){h.key==="Escape"&&!n.classList.contains("hidden")&&c()}),o&&(o.onclick=function(){const h=n.dataset.imageData,l=n.dataset.streamName||e;if(!h){console.error("No image data available for download"),te("Download failed: No image data available",5e3);return}console.log("Downloading snapshot with data URL length:",h.length);try{console.log("Using iframe download method");const d=document.createElement("canvas"),p=new Image;p.onload=function(){try{console.log("Image loaded for optimization, original dimensions:",p.width,"x",p.height);const m=p.width,_=p.height;console.log("Using original image dimensions for maximum quality:",m,"x",_),d.width=m,d.height=_;const g=d.getContext("2d");g.fillStyle="black",g.fillRect(0,0,d.width,d.height),g.drawImage(p,0,0,m,_);const y=d.toDataURL("image/jpeg",1);console.log("Optimized JPEG data URL length:",y.length);const S="snapshot_".concat(l,"_").concat(new Date().toISOString().replace(/[:.]/g,"-"),".jpg"),w=document.createElement("iframe");w.style.display="none",document.body.appendChild(w);try{const E=w.contentWindow.document;E.open(),E.write("\n                <!DOCTYPE html>\n                <html>\n                <head>\n                  <title>Downloading...</title>\n                  <script>\n                    function startDownload() {\n                      const a = document.getElementById('download-link');\n                      a.click();\n                      setTimeout(function() {\n                        window.parent.postMessage('download-complete', '*');\n                      }, 1000);\n                    }\n                  <\/script>\n                </head>\n                <body onload=\"startDownload()\">\n                  <a id=\"download-link\" href=\"".concat(y,'" download="').concat(S,'">Download</a>\n                </body>\n                </html>\n              ')),E.close(),window.addEventListener("message",function v(C){C.data==="download-complete"&&(window.removeEventListener("message",v),document.body.removeChild(w),te("Snapshot downloaded successfully",3e3))},{once:!0}),setTimeout(()=>{document.body.contains(w)&&document.body.removeChild(w)},5e3)}catch(E){console.error("Iframe download method failed:",E),document.body.removeChild(w),f(y,S)}}catch(m){console.error("Canvas processing error:",m),te("Download failed: Error processing image",5e3),f(h,"snapshot_".concat(l,"_").concat(new Date().toISOString().replace(/[:.]/g,"-"),".jpg"))}},p.onerror=function(m){console.error("Error loading image for optimization:",m),te("Download failed: Could not load image",5e3),f(h,"snapshot_".concat(l,"_").concat(new Date().toISOString().replace(/[:.]/g,"-"),".jpg"))},p.src=h}catch(d){console.error("Error in snapshot download process:",d),te("Download failed: "+d.message,5e3),f(h,"snapshot_".concat(l,"_").concat(new Date().toISOString().replace(/[:.]/g,"-"),".jpg"))}function f(d,p){console.log("Attempting direct link download");try{const m=document.createElement("a");m.href=d,m.download=p,m.target="_blank",m.rel="noopener noreferrer",document.body.appendChild(m),m.click(),setTimeout(()=>{document.body.removeChild(m)},100),te("Download initiated",3e3)}catch(m){console.error("Direct link download failed:",m),te("Download failed: Browser restrictions",5e3)}}}),n.classList.remove("hidden"),u&&setTimeout(()=>{u.classList.remove("scale-95","opacity-0"),u.classList.add("scale-100","opacity-100")},10)}class pe{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){const n={listener:e};return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}}const ve=typeof window>"u"||"Deno"in window;function q(){}function ls(t,e){return typeof t=="function"?t(e):t}function Xe(t){return typeof t=="number"&&t>=0&&t!==1/0}function ir(t,e){return Math.max(t+(e||0)-Date.now(),0)}function me(t,e,n){return Se(t)?typeof e=="function"?{...n,queryKey:t,queryFn:e}:{...e,queryKey:t}:t}function cs(t,e,n){return Se(t)?{...e,mutationKey:t}:typeof t=="function"?{...e,mutationFn:t}:{...t}}function Y(t,e,n){return Se(t)?[{...e,queryKey:t},n]:[t||{},e]}function Yt(t,e){const{type:n="all",exact:r,fetchStatus:s,predicate:o,queryKey:i,stale:a}=t;if(Se(i)){if(r){if(e.queryHash!==wt(i,e.options))return!1}else if(!Ie(e.queryKey,i))return!1}if(n!=="all"){const u=e.isActive();if(n==="active"&&!u||n==="inactive"&&u)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||typeof s<"u"&&s!==e.state.fetchStatus||o&&!o(e))}function Zt(t,e){const{exact:n,fetching:r,predicate:s,mutationKey:o}=t;if(Se(o)){if(!e.options.mutationKey)return!1;if(n){if(re(e.options.mutationKey)!==re(o))return!1}else if(!Ie(e.options.mutationKey,o))return!1}return!(typeof r=="boolean"&&e.state.status==="loading"!==r||s&&!s(e))}function wt(t,e){return((e==null?void 0:e.queryKeyHashFn)||re)(t)}function re(t){return JSON.stringify(t,(e,n)=>tt(n)?Object.keys(n).sort().reduce((r,s)=>(r[s]=n[s],r),{}):n)}function Ie(t,e){return ar(t,e)}function ar(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?!Object.keys(e).some(n=>!ar(t[n],e[n])):!1}function lr(t,e){if(t===e)return t;const n=Xt(t)&&Xt(e);if(n||tt(t)&&tt(e)){const r=n?t.length:Object.keys(t).length,s=n?e:Object.keys(e),o=s.length,i=n?[]:{};let a=0;for(let u=0;u<o;u++){const c=n?u:s[u];i[c]=lr(t[c],e[c]),i[c]===t[c]&&a++}return r===o&&a===r?t:i}return e}function et(t,e){if(t&&!e||e&&!t)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Xt(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function tt(t){if(!en(t))return!1;const e=t.constructor;if(typeof e>"u")return!0;const n=e.prototype;return!(!en(n)||!n.hasOwnProperty("isPrototypeOf"))}function en(t){return Object.prototype.toString.call(t)==="[object Object]"}function Se(t){return Array.isArray(t)}function cr(t){return new Promise(e=>{setTimeout(e,t)})}function tn(t){cr(0).then(t)}function us(){if(typeof AbortController=="function")return new AbortController}function nt(t,e,n){return n.isDataEqual!=null&&n.isDataEqual(t,e)?t:typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?lr(t,e):e}class ds extends pe{constructor(){super(),this.setup=e=>{if(!ve&&window.addEventListener){const n=()=>e();return window.addEventListener("visibilitychange",n,!1),window.addEventListener("focus",n,!1),()=>{window.removeEventListener("visibilitychange",n),window.removeEventListener("focus",n)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.cleanup)==null||e.call(this),this.cleanup=void 0}}setEventListener(e){var n;this.setup=e,(n=this.cleanup)==null||n.call(this),this.cleanup=e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()})}setFocused(e){this.focused!==e&&(this.focused=e,this.onFocus())}onFocus(){this.listeners.forEach(({listener:e})=>{e()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const Ne=new ds,nn=["online","offline"];class hs extends pe{constructor(){super(),this.setup=e=>{if(!ve&&window.addEventListener){const n=()=>e();return nn.forEach(r=>{window.addEventListener(r,n,!1)}),()=>{nn.forEach(r=>{window.removeEventListener(r,n)})}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.cleanup)==null||e.call(this),this.cleanup=void 0}}setEventListener(e){var n;this.setup=e,(n=this.cleanup)==null||n.call(this),this.cleanup=e(r=>{typeof r=="boolean"?this.setOnline(r):this.onOnline()})}setOnline(e){this.online!==e&&(this.online=e,this.onOnline())}onOnline(){this.listeners.forEach(({listener:e})=>{e()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const Fe=new hs;function fs(t){return Math.min(1e3*2**t,3e4)}function Le(t){return(t!=null?t:"online")==="online"?Fe.isOnline():!0}class ur{constructor(e){this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}}function De(t){return t instanceof ur}function dr(t){let e=!1,n=0,r=!1,s,o,i;const a=new Promise((_,g)=>{o=_,i=g}),u=_=>{r||(d(new ur(_)),t.abort==null||t.abort())},c=()=>{e=!0},h=()=>{e=!1},l=()=>!Ne.isFocused()||t.networkMode!=="always"&&!Fe.isOnline(),f=_=>{r||(r=!0,t.onSuccess==null||t.onSuccess(_),s==null||s(),o(_))},d=_=>{r||(r=!0,t.onError==null||t.onError(_),s==null||s(),i(_))},p=()=>new Promise(_=>{s=g=>{const y=r||!l();return y&&_(g),y},t.onPause==null||t.onPause()}).then(()=>{s=void 0,r||t.onContinue==null||t.onContinue()}),m=()=>{if(r)return;let _;try{_=t.fn()}catch(g){_=Promise.reject(g)}Promise.resolve(_).then(f).catch(g=>{var y,S;if(r)return;const w=(y=t.retry)!=null?y:3,E=(S=t.retryDelay)!=null?S:fs,v=typeof E=="function"?E(n,g):E,C=w===!0||typeof w=="number"&&n<w||typeof w=="function"&&w(n,g);if(e||!C){d(g);return}n++,t.onFail==null||t.onFail(n,g),cr(v).then(()=>{if(l())return p()}).then(()=>{e?d(g):m()})})};return Le(t.networkMode)?m():p().then(m),{promise:a,cancel:u,continue:()=>(s==null?void 0:s())?a:Promise.resolve(),cancelRetry:c,continueRetry:h}}const Ct=console;function ps(){let t=[],e=0,n=h=>{h()},r=h=>{h()};const s=h=>{let l;e++;try{l=h()}finally{e--,e||a()}return l},o=h=>{e?t.push(h):tn(()=>{n(h)})},i=h=>(...l)=>{o(()=>{h(...l)})},a=()=>{const h=t;t=[],h.length&&tn(()=>{r(()=>{h.forEach(l=>{n(l)})})})};return{batch:s,batchCalls:i,schedule:o,setNotifyFunction:h=>{n=h},setBatchNotifyFunction:h=>{r=h}}}const T=ps();class hr{destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Xe(this.cacheTime)&&(this.gcTimeout=setTimeout(()=>{this.optionalRemove()},this.cacheTime))}updateCacheTime(e){this.cacheTime=Math.max(this.cacheTime||0,e!=null?e:ve?1/0:5*60*1e3)}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}class ms extends hr{constructor(e){super(),this.abortSignalConsumed=!1,this.defaultOptions=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.cache=e.cache,this.logger=e.logger||Ct,this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.initialState=e.state||_s(this.options),this.state=this.initialState,this.scheduleGc()}get meta(){return this.options.meta}setOptions(e){this.options={...this.defaultOptions,...e},this.updateCacheTime(this.options.cacheTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.cache.remove(this)}setData(e,n){const r=nt(this.state.data,e,this.options);return this.dispatch({data:r,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),r}setState(e,n){this.dispatch({type:"setState",state:e,setStateOptions:n})}cancel(e){var n;const r=this.promise;return(n=this.retryer)==null||n.cancel(e),r?r.then(q).catch(q):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.initialState)}isActive(){return this.observers.some(e=>e.options.enabled!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(e=>e.getCurrentResult().isStale)}isStaleByTime(e=0){return this.state.isInvalidated||!this.state.dataUpdatedAt||!ir(this.state.dataUpdatedAt,e)}onFocus(){var e;const n=this.observers.find(r=>r.shouldFetchOnWindowFocus());n&&n.refetch({cancelRefetch:!1}),(e=this.retryer)==null||e.continue()}onOnline(){var e;const n=this.observers.find(r=>r.shouldFetchOnReconnect());n&&n.refetch({cancelRefetch:!1}),(e=this.retryer)==null||e.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.retryer&&(this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.scheduleGc()),this.cache.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.dispatch({type:"invalidate"})}fetch(e,n){var r,s;if(this.state.fetchStatus!=="idle"){if(this.state.dataUpdatedAt&&n!=null&&n.cancelRefetch)this.cancel({silent:!0});else if(this.promise){var o;return(o=this.retryer)==null||o.continueRetry(),this.promise}}if(e&&this.setOptions(e),!this.options.queryFn){const d=this.observers.find(p=>p.options.queryFn);d&&this.setOptions(d.options)}Array.isArray(this.options.queryKey);const i=us(),a={queryKey:this.queryKey,pageParam:void 0,meta:this.meta},u=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>{if(i)return this.abortSignalConsumed=!0,i.signal}})};u(a);const c=()=>this.options.queryFn?(this.abortSignalConsumed=!1,this.options.queryFn(a)):Promise.reject("Missing queryFn for queryKey '"+this.options.queryHash+"'"),h={fetchOptions:n,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:c};if(u(h),(r=this.options.behavior)==null||r.onFetch(h),this.revertState=this.state,this.state.fetchStatus==="idle"||this.state.fetchMeta!==((s=h.fetchOptions)==null?void 0:s.meta)){var l;this.dispatch({type:"fetch",meta:(l=h.fetchOptions)==null?void 0:l.meta})}const f=d=>{if(De(d)&&d.silent||this.dispatch({type:"error",error:d}),!De(d)){var p,m,_,g;(p=(m=this.cache.config).onError)==null||p.call(m,d,this),(_=(g=this.cache.config).onSettled)==null||_.call(g,this.state.data,d,this)}this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return this.retryer=dr({fn:h.fetchFn,abort:i==null?void 0:i.abort.bind(i),onSuccess:d=>{var p,m,_,g;if(typeof d>"u"){f(new Error(this.queryHash+" data is undefined"));return}this.setData(d),(p=(m=this.cache.config).onSuccess)==null||p.call(m,d,this),(_=(g=this.cache.config).onSettled)==null||_.call(g,d,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:f,onFail:(d,p)=>{this.dispatch({type:"failed",failureCount:d,error:p})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:h.options.retry,retryDelay:h.options.retryDelay,networkMode:h.options.networkMode}),this.promise=this.retryer.promise,this.promise}dispatch(e){const n=r=>{var s,o;switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:(s=e.meta)!=null?s:null,fetchStatus:Le(this.options.networkMode)?"fetching":"paused",...!r.dataUpdatedAt&&{error:null,status:"loading"}};case"success":return{...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:(o=e.dataUpdatedAt)!=null?o:Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const i=e.error;return De(i)&&i.revert&&this.revertState?{...this.revertState}:{...r,error:i,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),T.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate(e)}),this.cache.notify({query:this,type:"updated",action:e})})}}function _s(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=typeof e<"u",r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r!=null?r:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"loading",fetchStatus:"idle"}}class gs extends pe{constructor(e){super(),this.config=e||{},this.queries=[],this.queriesMap={}}build(e,n,r){var s;const o=n.queryKey,i=(s=n.queryHash)!=null?s:wt(o,n);let a=this.get(i);return a||(a=new ms({cache:this,logger:e.getLogger(),queryKey:o,queryHash:i,options:e.defaultQueryOptions(n),state:r,defaultOptions:e.getQueryDefaults(o)}),this.add(a)),a}add(e){this.queriesMap[e.queryHash]||(this.queriesMap[e.queryHash]=e,this.queries.push(e),this.notify({type:"added",query:e}))}remove(e){const n=this.queriesMap[e.queryHash];n&&(e.destroy(),this.queries=this.queries.filter(r=>r!==e),n===e&&delete this.queriesMap[e.queryHash],this.notify({type:"removed",query:e}))}clear(){T.batch(()=>{this.queries.forEach(e=>{this.remove(e)})})}get(e){return this.queriesMap[e]}getAll(){return this.queries}find(e,n){const[r]=Y(e,n);return typeof r.exact>"u"&&(r.exact=!0),this.queries.find(s=>Yt(r,s))}findAll(e,n){const[r]=Y(e,n);return Object.keys(r).length>0?this.queries.filter(s=>Yt(r,s)):this.queries}notify(e){T.batch(()=>{this.listeners.forEach(({listener:n})=>{n(e)})})}onFocus(){T.batch(()=>{this.queries.forEach(e=>{e.onFocus()})})}onOnline(){T.batch(()=>{this.queries.forEach(e=>{e.onOnline()})})}}class ys extends hr{constructor(e){super(),this.defaultOptions=e.defaultOptions,this.mutationId=e.mutationId,this.mutationCache=e.mutationCache,this.logger=e.logger||Ct,this.observers=[],this.state=e.state||fr(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options={...this.defaultOptions,...e},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(e){this.dispatch({type:"setState",state:e})}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.observers=this.observers.filter(n=>n!==e),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.observers.length||(this.state.status==="loading"?this.scheduleGc():this.mutationCache.remove(this))}continue(){var e,n;return(e=(n=this.retryer)==null?void 0:n.continue())!=null?e:this.execute()}async execute(){const e=()=>{var C;return this.retryer=dr({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(b,D)=>{this.dispatch({type:"failed",failureCount:b,error:D})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(C=this.options.retry)!=null?C:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},n=this.state.status==="loading";try{var r,s,o,i,a,u,c,h;if(!n){var l,f,d,p;this.dispatch({type:"loading",variables:this.options.variables}),await((l=(f=this.mutationCache.config).onMutate)==null?void 0:l.call(f,this.state.variables,this));const b=await((d=(p=this.options).onMutate)==null?void 0:d.call(p,this.state.variables));b!==this.state.context&&this.dispatch({type:"loading",context:b,variables:this.state.variables})}const C=await e();return await((r=(s=this.mutationCache.config).onSuccess)==null?void 0:r.call(s,C,this.state.variables,this.state.context,this)),await((o=(i=this.options).onSuccess)==null?void 0:o.call(i,C,this.state.variables,this.state.context)),await((a=(u=this.mutationCache.config).onSettled)==null?void 0:a.call(u,C,null,this.state.variables,this.state.context,this)),await((c=(h=this.options).onSettled)==null?void 0:c.call(h,C,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:C}),C}catch(C){try{var m,_,g,y,S,w,E,v;throw await((m=(_=this.mutationCache.config).onError)==null?void 0:m.call(_,C,this.state.variables,this.state.context,this)),await((g=(y=this.options).onError)==null?void 0:g.call(y,C,this.state.variables,this.state.context)),await((S=(w=this.mutationCache.config).onSettled)==null?void 0:S.call(w,void 0,C,this.state.variables,this.state.context,this)),await((E=(v=this.options).onSettled)==null?void 0:E.call(v,void 0,C,this.state.variables,this.state.context)),C}finally{this.dispatch({type:"error",error:C})}}}dispatch(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"loading":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!Le(this.options.networkMode),status:"loading",variables:e.variables};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"};case"setState":return{...r,...e.state}}};this.state=n(this.state),T.batch(()=>{this.observers.forEach(r=>{r.onMutationUpdate(e)}),this.mutationCache.notify({mutation:this,type:"updated",action:e})})}}function fr(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class vs extends pe{constructor(e){super(),this.config=e||{},this.mutations=[],this.mutationId=0}build(e,n,r){const s=new ys({mutationCache:this,logger:e.getLogger(),mutationId:++this.mutationId,options:e.defaultMutationOptions(n),state:r,defaultOptions:n.mutationKey?e.getMutationDefaults(n.mutationKey):void 0});return this.add(s),s}add(e){this.mutations.push(e),this.notify({type:"added",mutation:e})}remove(e){this.mutations=this.mutations.filter(n=>n!==e),this.notify({type:"removed",mutation:e})}clear(){T.batch(()=>{this.mutations.forEach(e=>{this.remove(e)})})}getAll(){return this.mutations}find(e){return typeof e.exact>"u"&&(e.exact=!0),this.mutations.find(n=>Zt(e,n))}findAll(e){return this.mutations.filter(n=>Zt(e,n))}notify(e){T.batch(()=>{this.listeners.forEach(({listener:n})=>{n(e)})})}resumePausedMutations(){var e;return this.resuming=((e=this.resuming)!=null?e:Promise.resolve()).then(()=>{const n=this.mutations.filter(r=>r.state.isPaused);return T.batch(()=>n.reduce((r,s)=>r.then(()=>s.continue().catch(q)),Promise.resolve()))}).then(()=>{this.resuming=void 0}),this.resuming}}function bs(){return{onFetch:t=>{t.fetchFn=()=>{var e,n,r,s,o,i;const a=(e=t.fetchOptions)==null||(n=e.meta)==null?void 0:n.refetchPage,u=(r=t.fetchOptions)==null||(s=r.meta)==null?void 0:s.fetchMore,c=u==null?void 0:u.pageParam,h=(u==null?void 0:u.direction)==="forward",l=(u==null?void 0:u.direction)==="backward",f=((o=t.state.data)==null?void 0:o.pages)||[],d=((i=t.state.data)==null?void 0:i.pageParams)||[];let p=d,m=!1;const _=v=>{Object.defineProperty(v,"signal",{enumerable:!0,get:()=>{var C;if((C=t.signal)!=null&&C.aborted)m=!0;else{var b;(b=t.signal)==null||b.addEventListener("abort",()=>{m=!0})}return t.signal}})},g=t.options.queryFn||(()=>Promise.reject("Missing queryFn for queryKey '"+t.options.queryHash+"'")),y=(v,C,b,D)=>(p=D?[C,...p]:[...p,C],D?[b,...v]:[...v,b]),S=(v,C,b,D)=>{if(m)return Promise.reject("Cancelled");if(typeof b>"u"&&!C&&v.length)return Promise.resolve(v);const A={queryKey:t.queryKey,pageParam:b,meta:t.options.meta};_(A);const R=g(A);return Promise.resolve(R).then(Ee=>y(v,b,Ee,D))};let w;if(!f.length)w=S([]);else if(h){const v=typeof c<"u",C=v?c:rn(t.options,f);w=S(f,v,C)}else if(l){const v=typeof c<"u",C=v?c:ws(t.options,f);w=S(f,v,C,!0)}else{p=[];const v=typeof t.options.getNextPageParam>"u";w=(a&&f[0]?a(f[0],0,f):!0)?S([],v,d[0]):Promise.resolve(y([],d[0],f[0]));for(let b=1;b<f.length;b++)w=w.then(D=>{if(a&&f[b]?a(f[b],b,f):!0){const R=v?d[b]:rn(t.options,D);return S(D,v,R)}return Promise.resolve(y(D,d[b],f[b]))})}return w.then(v=>({pages:v,pageParams:p}))}}}}function rn(t,e){return t.getNextPageParam==null?void 0:t.getNextPageParam(e[e.length-1],e)}function ws(t,e){return t.getPreviousPageParam==null?void 0:t.getPreviousPageParam(e[0],e)}class pr{constructor(e={}){this.queryCache=e.queryCache||new gs,this.mutationCache=e.mutationCache||new vs,this.logger=e.logger||Ct,this.defaultOptions=e.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[],this.mountCount=0}mount(){this.mountCount++,this.mountCount===1&&(this.unsubscribeFocus=Ne.subscribe(()=>{Ne.isFocused()&&(this.resumePausedMutations(),this.queryCache.onFocus())}),this.unsubscribeOnline=Fe.subscribe(()=>{Fe.isOnline()&&(this.resumePausedMutations(),this.queryCache.onOnline())}))}unmount(){var e,n;this.mountCount--,this.mountCount===0&&((e=this.unsubscribeFocus)==null||e.call(this),this.unsubscribeFocus=void 0,(n=this.unsubscribeOnline)==null||n.call(this),this.unsubscribeOnline=void 0)}isFetching(e,n){const[r]=Y(e,n);return r.fetchStatus="fetching",this.queryCache.findAll(r).length}isMutating(e){return this.mutationCache.findAll({...e,fetching:!0}).length}getQueryData(e,n){var r;return(r=this.queryCache.find(e,n))==null?void 0:r.state.data}ensureQueryData(e,n,r){const s=me(e,n,r),o=this.getQueryData(s.queryKey);return o?Promise.resolve(o):this.fetchQuery(s)}getQueriesData(e){return this.getQueryCache().findAll(e).map(({queryKey:n,state:r})=>{const s=r.data;return[n,s]})}setQueryData(e,n,r){const s=this.queryCache.find(e),o=s==null?void 0:s.state.data,i=ls(n,o);if(typeof i>"u")return;const a=me(e),u=this.defaultQueryOptions(a);return this.queryCache.build(this,u).setData(i,{...r,manual:!0})}setQueriesData(e,n,r){return T.batch(()=>this.getQueryCache().findAll(e).map(({queryKey:s})=>[s,this.setQueryData(s,n,r)]))}getQueryState(e,n){var r;return(r=this.queryCache.find(e,n))==null?void 0:r.state}removeQueries(e,n){const[r]=Y(e,n),s=this.queryCache;T.batch(()=>{s.findAll(r).forEach(o=>{s.remove(o)})})}resetQueries(e,n,r){const[s,o]=Y(e,n,r),i=this.queryCache,a={type:"active",...s};return T.batch(()=>(i.findAll(s).forEach(u=>{u.reset()}),this.refetchQueries(a,o)))}cancelQueries(e,n,r){const[s,o={}]=Y(e,n,r);typeof o.revert>"u"&&(o.revert=!0);const i=T.batch(()=>this.queryCache.findAll(s).map(a=>a.cancel(o)));return Promise.all(i).then(q).catch(q)}invalidateQueries(e,n,r){const[s,o]=Y(e,n,r);return T.batch(()=>{var i,a;if(this.queryCache.findAll(s).forEach(c=>{c.invalidate()}),s.refetchType==="none")return Promise.resolve();const u={...s,type:(i=(a=s.refetchType)!=null?a:s.type)!=null?i:"active"};return this.refetchQueries(u,o)})}refetchQueries(e,n,r){const[s,o]=Y(e,n,r),i=T.batch(()=>this.queryCache.findAll(s).filter(u=>!u.isDisabled()).map(u=>{var c;return u.fetch(void 0,{...o,cancelRefetch:(c=o==null?void 0:o.cancelRefetch)!=null?c:!0,meta:{refetchPage:s.refetchPage}})}));let a=Promise.all(i).then(q);return o!=null&&o.throwOnError||(a=a.catch(q)),a}fetchQuery(e,n,r){const s=me(e,n,r),o=this.defaultQueryOptions(s);typeof o.retry>"u"&&(o.retry=!1);const i=this.queryCache.build(this,o);return i.isStaleByTime(o.staleTime)?i.fetch(o):Promise.resolve(i.state.data)}prefetchQuery(e,n,r){return this.fetchQuery(e,n,r).then(q).catch(q)}fetchInfiniteQuery(e,n,r){const s=me(e,n,r);return s.behavior=bs(),this.fetchQuery(s)}prefetchInfiniteQuery(e,n,r){return this.fetchInfiniteQuery(e,n,r).then(q).catch(q)}resumePausedMutations(){return this.mutationCache.resumePausedMutations()}getQueryCache(){return this.queryCache}getMutationCache(){return this.mutationCache}getLogger(){return this.logger}getDefaultOptions(){return this.defaultOptions}setDefaultOptions(e){this.defaultOptions=e}setQueryDefaults(e,n){const r=this.queryDefaults.find(s=>re(e)===re(s.queryKey));r?r.defaultOptions=n:this.queryDefaults.push({queryKey:e,defaultOptions:n})}getQueryDefaults(e){if(!e)return;const n=this.queryDefaults.find(r=>Ie(e,r.queryKey));return n==null?void 0:n.defaultOptions}setMutationDefaults(e,n){const r=this.mutationDefaults.find(s=>re(e)===re(s.mutationKey));r?r.defaultOptions=n:this.mutationDefaults.push({mutationKey:e,defaultOptions:n})}getMutationDefaults(e){if(!e)return;const n=this.mutationDefaults.find(r=>Ie(e,r.mutationKey));return n==null?void 0:n.defaultOptions}defaultQueryOptions(e){if(e!=null&&e._defaulted)return e;const n={...this.defaultOptions.queries,...this.getQueryDefaults(e==null?void 0:e.queryKey),...e,_defaulted:!0};return!n.queryHash&&n.queryKey&&(n.queryHash=wt(n.queryKey,n)),typeof n.refetchOnReconnect>"u"&&(n.refetchOnReconnect=n.networkMode!=="always"),typeof n.useErrorBoundary>"u"&&(n.useErrorBoundary=!!n.suspense),n}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...this.defaultOptions.mutations,...this.getMutationDefaults(e==null?void 0:e.mutationKey),...e,_defaulted:!0}}clear(){this.queryCache.clear(),this.mutationCache.clear()}}class Cs extends pe{constructor(e,n){super(),this.client=e,this.options=n,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(n)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.currentQuery.addObserver(this),sn(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return rt(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return rt(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(e,n){const r=this.options,s=this.currentQuery;if(this.options=this.client.defaultQueryOptions(e),et(r,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=r.queryKey),this.updateQuery();const o=this.hasListeners();o&&on(this.currentQuery,s,this.options,r)&&this.executeFetch(),this.updateResult(n),o&&(this.currentQuery!==s||this.options.enabled!==r.enabled||this.options.staleTime!==r.staleTime)&&this.updateStaleTimeout();const i=this.computeRefetchInterval();o&&(this.currentQuery!==s||this.options.enabled!==r.enabled||i!==this.currentRefetchInterval)&&this.updateRefetchInterval(i)}getOptimisticResult(e){const n=this.client.getQueryCache().build(this.client,e),r=this.createResult(n,e);return Ss(this,r,e)&&(this.currentResult=r,this.currentResultOptions=this.options,this.currentResultState=this.currentQuery.state),r}getCurrentResult(){return this.currentResult}trackResult(e){const n={};return Object.keys(e).forEach(r=>{Object.defineProperty(n,r,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(r),e[r])})}),n}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:e,...n}={}){return this.fetch({...n,meta:{refetchPage:e}})}fetchOptimistic(e){const n=this.client.defaultQueryOptions(e),r=this.client.getQueryCache().build(this.client,n);return r.isFetchingOptimistic=!0,r.fetch().then(()=>this.createResult(r,n))}fetch(e){var n;return this.executeFetch({...e,cancelRefetch:(n=e.cancelRefetch)!=null?n:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(e){this.updateQuery();let n=this.currentQuery.fetch(this.options,e);return e!=null&&e.throwOnError||(n=n.catch(q)),n}updateStaleTimeout(){if(this.clearStaleTimeout(),ve||this.currentResult.isStale||!Xe(this.options.staleTime))return;const n=ir(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},n)}computeRefetchInterval(){var e;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(e=this.options.refetchInterval)!=null?e:!1}updateRefetchInterval(e){this.clearRefetchInterval(),this.currentRefetchInterval=e,!(ve||this.options.enabled===!1||!Xe(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||Ne.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(e,n){const r=this.currentQuery,s=this.options,o=this.currentResult,i=this.currentResultState,a=this.currentResultOptions,u=e!==r,c=u?e.state:this.currentQueryInitialState,h=u?this.currentResult:this.previousQueryResult,{state:l}=e;let{dataUpdatedAt:f,error:d,errorUpdatedAt:p,fetchStatus:m,status:_}=l,g=!1,y=!1,S;if(n._optimisticResults){const b=this.hasListeners(),D=!b&&sn(e,n),A=b&&on(e,r,n,s);(D||A)&&(m=Le(e.options.networkMode)?"fetching":"paused",f||(_="loading")),n._optimisticResults==="isRestoring"&&(m="idle")}if(n.keepPreviousData&&!l.dataUpdatedAt&&h!=null&&h.isSuccess&&_!=="error")S=h.data,f=h.dataUpdatedAt,_=h.status,g=!0;else if(n.select&&typeof l.data<"u")if(o&&l.data===(i==null?void 0:i.data)&&n.select===this.selectFn)S=this.selectResult;else try{this.selectFn=n.select,S=n.select(l.data),S=nt(o==null?void 0:o.data,S,n),this.selectResult=S,this.selectError=null}catch(b){this.selectError=b}else S=l.data;if(typeof n.placeholderData<"u"&&typeof S>"u"&&_==="loading"){let b;if(o!=null&&o.isPlaceholderData&&n.placeholderData===(a==null?void 0:a.placeholderData))b=o.data;else if(b=typeof n.placeholderData=="function"?n.placeholderData():n.placeholderData,n.select&&typeof b<"u")try{b=n.select(b),this.selectError=null}catch(D){this.selectError=D}typeof b<"u"&&(_="success",S=nt(o==null?void 0:o.data,b,n),y=!0)}this.selectError&&(d=this.selectError,S=this.selectResult,p=Date.now(),_="error");const w=m==="fetching",E=_==="loading",v=_==="error";return{status:_,fetchStatus:m,isLoading:E,isSuccess:_==="success",isError:v,isInitialLoading:E&&w,data:S,dataUpdatedAt:f,error:d,errorUpdatedAt:p,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>c.dataUpdateCount||l.errorUpdateCount>c.errorUpdateCount,isFetching:w,isRefetching:w&&!E,isLoadingError:v&&l.dataUpdatedAt===0,isPaused:m==="paused",isPlaceholderData:y,isPreviousData:g,isRefetchError:v&&l.dataUpdatedAt!==0,isStale:xt(e,n),refetch:this.refetch,remove:this.remove}}updateResult(e){const n=this.currentResult,r=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,et(r,n))return;this.currentResult=r;const s={cache:!0},o=()=>{if(!n)return!0;const{notifyOnChangeProps:i}=this.options;if(i==="all"||!i&&!this.trackedProps.size)return!0;const a=new Set(i!=null?i:this.trackedProps);return this.options.useErrorBoundary&&a.add("error"),Object.keys(this.currentResult).some(u=>{const c=u;return this.currentResult[c]!==n[c]&&a.has(c)})};(e==null?void 0:e.listeners)!==!1&&o()&&(s.listeners=!0),this.notify({...s,...e})}updateQuery(){const e=this.client.getQueryCache().build(this.client,this.options);if(e===this.currentQuery)return;const n=this.currentQuery;this.currentQuery=e,this.currentQueryInitialState=e.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(n==null||n.removeObserver(this),e.addObserver(this))}onQueryUpdate(e){const n={};e.type==="success"?n.onSuccess=!e.manual:e.type==="error"&&!De(e.error)&&(n.onError=!0),this.updateResult(n),this.hasListeners()&&this.updateTimers()}notify(e){T.batch(()=>{if(e.onSuccess){var n,r,s,o;(n=(r=this.options).onSuccess)==null||n.call(r,this.currentResult.data),(s=(o=this.options).onSettled)==null||s.call(o,this.currentResult.data,null)}else if(e.onError){var i,a,u,c;(i=(a=this.options).onError)==null||i.call(a,this.currentResult.error),(u=(c=this.options).onSettled)==null||u.call(c,void 0,this.currentResult.error)}e.listeners&&this.listeners.forEach(({listener:h})=>{h(this.currentResult)}),e.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function xs(t,e){return e.enabled!==!1&&!t.state.dataUpdatedAt&&!(t.state.status==="error"&&e.retryOnMount===!1)}function sn(t,e){return xs(t,e)||t.state.dataUpdatedAt>0&&rt(t,e,e.refetchOnMount)}function rt(t,e,n){if(e.enabled!==!1){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&xt(t,e)}return!1}function on(t,e,n,r){return n.enabled!==!1&&(t!==e||r.enabled===!1)&&(!n.suspense||t.state.status!=="error")&&xt(t,n)}function xt(t,e){return t.isStaleByTime(e.staleTime)}function Ss(t,e,n){return n.keepPreviousData?!1:n.placeholderData!==void 0?e.isPlaceholderData:t.getCurrentResult()!==e}let Es=class extends pe{constructor(e,n){super(),this.client=e,this.setOptions(n),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var n;const r=this.options;this.options=this.client.defaultMutationOptions(e),et(r,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(n=this.currentMutation)==null||n.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.currentMutation)==null||e.removeObserver(this)}}onMutationUpdate(e){this.updateResult();const n={listeners:!0};e.type==="success"?n.onSuccess=!0:e.type==="error"&&(n.onError=!0),this.notify(n)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(e,n){return this.mutateOptions=n,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof e<"u"?e:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const e=this.currentMutation?this.currentMutation.state:fr(),n={...e,isLoading:e.status==="loading",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=n}notify(e){T.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(e.onSuccess){var n,r,s,o;(n=(r=this.mutateOptions).onSuccess)==null||n.call(r,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(s=(o=this.mutateOptions).onSettled)==null||s.call(o,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(e.onError){var i,a,u,c;(i=(a=this.mutateOptions).onError)==null||i.call(a,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(u=(c=this.mutateOptions).onSettled)==null||u.call(c,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}e.listeners&&this.listeners.forEach(({listener:h})=>{h(this.currentResult)})})}};function ks(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var Ve={exports:{}},Ke={};const Rs=ks(sr);/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var an;function Ps(){if(an)return Ke;an=1;var t=Rs;function e(l,f){return l===f&&(l!==0||1/l===1/f)||l!==l&&f!==f}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,s=t.useEffect,o=t.useLayoutEffect,i=t.useDebugValue;function a(l,f){var d=f(),p=r({inst:{value:d,getSnapshot:f}}),m=p[0].inst,_=p[1];return o(function(){m.value=d,m.getSnapshot=f,u(m)&&_({inst:m})},[l,d,f]),s(function(){return u(m)&&_({inst:m}),l(function(){u(m)&&_({inst:m})})},[l]),i(d),d}function u(l){var f=l.getSnapshot;l=l.value;try{var d=f();return!n(l,d)}catch(p){return!0}}function c(l,f){return f()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return Ke.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:h,Ke}var ln;function Os(){return ln||(ln=1,Ve.exports=Ps()),Ve.exports}var Ds=Os();const mr=Ds.useSyncExternalStore,cn=ae(void 0),_r=ae(!1);function gr(t,e){return t||(e&&typeof window<"u"?(window.ReactQueryClientContext||(window.ReactQueryClientContext=cn),window.ReactQueryClientContext):cn)}const St=({context:t}={})=>{const e=ie(gr(t,ie(_r)));if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},yr=({client:t,children:e,context:n,contextSharing:r=!1})=>{J(()=>(t.mount(),()=>{t.unmount()}),[t]);const s=gr(n,r);return F(_r.Provider,{value:!n&&r},F(s.Provider,{value:t},e))},vr=ae(!1),$s=()=>ie(vr);vr.Provider;function Ts(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}const Ms=ae(Ts()),Is=()=>ie(Ms);function br(t,e){return typeof t=="function"?t(...e):!!t}const Ns=(t,e)=>{(t.suspense||t.useErrorBoundary)&&(e.isReset()||(t.retryOnMount=!1))},Fs=t=>{J(()=>{t.clearReset()},[t])},As=({result:t,errorResetBoundary:e,useErrorBoundary:n,query:r})=>t.isError&&!e.isReset()&&!t.isFetching&&br(n,[t.error,r]),Ls=t=>{t.suspense&&typeof t.staleTime!="number"&&(t.staleTime=1e3)},qs=(t,e)=>t.isLoading&&t.isFetching&&!e,Us=(t,e,n)=>(t==null?void 0:t.suspense)&&qs(e,n),Qs=(t,e,n)=>e.fetchOptimistic(t).then(({data:r})=>{var s,o;(s=t.onSuccess)==null||s.call(t,r),(o=t.onSettled)==null||o.call(t,r,null)}).catch(r=>{var s,o;n.clearReset(),(s=t.onError)==null||s.call(t,r),(o=t.onSettled)==null||o.call(t,void 0,r)});function Hs(t,e){const n=St({context:t.context}),r=$s(),s=Is(),o=n.defaultQueryOptions(t);o._optimisticResults=r?"isRestoring":"optimistic",o.onError&&(o.onError=T.batchCalls(o.onError)),o.onSuccess&&(o.onSuccess=T.batchCalls(o.onSuccess)),o.onSettled&&(o.onSettled=T.batchCalls(o.onSettled)),Ls(o),Ns(o,s),Fs(s);const[i]=V(()=>new e(n,o)),a=i.getOptimisticResult(o);if(mr(he(u=>{const c=r?()=>{}:i.subscribe(T.batchCalls(u));return i.updateResult(),c},[i,r]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),J(()=>{i.setOptions(o,{listeners:!1})},[o,i]),Us(o,a,r))throw Qs(o,i,s);if(As({result:a,errorResetBoundary:s,useErrorBoundary:o.useErrorBoundary,query:i.getCurrentQuery()}))throw a.error;return o.notifyOnChangeProps?a:i.trackResult(a)}function un(t,e,n){const r=me(t,e,n);return Hs(r,Cs)}function Ws(t,e,n){const r=cs(t,e),s=St({context:r.context}),[o]=V(()=>new Es(s,r));J(()=>{o.setOptions(r)},[o,r]);const i=mr(he(u=>o.subscribe(T.batchCalls(u)),[o]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),a=he((u,c)=>{o.mutate(u,c).catch(Bs)},[o]);if(i.error&&br(o.options.useErrorBoundary,[i.error]))throw i.error;return{...i,mutate:a,mutateAsync:i.mutate}}function Bs(){}async function js(t,e={}){const{timeout:n=3e4,retries:r=1,retryDelay:s=1e3,signal:o,...i}=e;console.log("enhancedFetch: ".concat(i.method||"GET"," ").concat(t)),console.debug("enhancedFetch options:",{timeout:n,retries:r,retryDelay:s,...i});const a=new AbortController;let u;n&&(u=setTimeout(()=>{console.warn("enhancedFetch: Timeout reached for ".concat(t,", aborting request")),a.abort()},n));const c=o?Vs(o,a.signal):a.signal,h={...i,signal:c};let l,f=0;for(;f<=r;)try{console.debug("enhancedFetch: Attempt ".concat(f+1,"/").concat(r+1," for ").concat(t));const d=await fetch(t,h);if(u&&clearTimeout(u),console.log("enhancedFetch response: ".concat(d.status," ").concat(d.statusText," for ").concat(t)),!d.ok)throw new Error("HTTP error ".concat(d.status,": ").concat(d.statusText));return d}catch(d){if(l=d,u&&clearTimeout(u),console.error("enhancedFetch error (attempt ".concat(f+1,"/").concat(r+1,"):"),d),d.name==="AbortError")throw o&&o.aborted?(console.warn("enhancedFetch: Request was cancelled by external signal for ".concat(t)),new Error("Request was cancelled")):(console.warn("enhancedFetch: Request timed out for ".concat(t)),new Error("Request timed out"));if(f>=r){console.error("enhancedFetch: All ".concat(r+1," attempts failed for ").concat(t));break}if(console.log("enhancedFetch: Waiting ".concat(s,"ms before retry ").concat(f+1," for ").concat(t)),await new Promise(p=>setTimeout(p,s)),n){a.abort();const p=new AbortController;u=setTimeout(()=>{p.abort()},n)}f++}throw l}function Vs(...t){const e=new AbortController,n=()=>{e.abort(),t.forEach(r=>{r.removeEventListener("abort",n)})};return t.forEach(r=>{r.aborted?n():r.addEventListener("abort",n)}),e.signal}function Ks(){const t=new AbortController;return{signal:t.signal,abort:()=>t.abort(),isAborted:()=>t.signal.aborted}}async function wr(t,e={}){console.log("fetchJSON: ".concat(e.method||"GET"," ").concat(t));try{const n=await js(t,e);console.log("fetchJSON: Parsing JSON response from ".concat(t));const r=await n.json();return console.log("fetchJSON: Successfully parsed JSON from ".concat(t)),r}catch(n){throw console.error("fetchJSON: Error fetching or parsing JSON from ".concat(t,":"),n),n}}const Cr=new pr({defaultOptions:{queries:{staleTime:3e4,cacheTime:5*60*1e3,retry:1,refetchOnWindowFocus:!1}}});function zs(){return St()}function Js(t,e,n={},r={}){return typeof t=="object"&&!Array.isArray(t)&&t!==null?un(t):un({queryKey:Array.isArray(t)?t:[t],queryFn:async()=>{const s=Ks(),o={...n,signal:s.signal};try{return await wr(e,o)}catch(i){throw console.error("useQuery error for ".concat(e,":"),i),i}},...r})}function Gs(t){return Ws({...t})}const so=Object.freeze(Object.defineProperty({__proto__:null,QueryClient:pr,QueryClientProvider:yr,fetchJSON:wr,queryClient:Cr,useMutation:Gs,useQuery:Js,useQueryClient:zs},Symbol.toStringTag,{value:"Module"}));window.React=sr;if(typeof Te<"u"){if(window.wsClient=new Te,console.log("WebSocket client initialized at application level"),window.wsClient){console.log("Initial WebSocket connection state:",{connected:window.wsClient.isConnected(),clientId:window.wsClient.getClientId()});const t=window.wsClient.connect;window.wsClient.connect=function(){const n=t.apply(this,arguments);if(this.socket){const r=this.socket.onopen;this.socket.onopen=a=>{console.log("WebSocket connection opened at application level"),r&&r.call(this,a)};const s=this.socket.onerror;this.socket.onerror=a=>{console.error("WebSocket error at application level:",a),s&&s.call(this,a)};const o=this.socket.onclose;this.socket.onclose=a=>{console.log("WebSocket connection closed at application level: ".concat(a.code," ").concat(a.reason)),o&&o.call(this,a)};const i=this.socket.onmessage;this.socket.onmessage=a=>{a.data.includes('"type":"welcome"')||console.log("WebSocket message received at application level"),i&&i.call(this,a)}}return n};const e=window.wsClient.handleMessage;window.wsClient.handleMessage=function(n){const r=this.clientId;e.call(this,n);const s=this.clientId;r!==s&&s&&console.log("WebSocket client ID changed at application level: ".concat(s))}}typeof It<"u"&&(window.batchDeleteClient=new It(window.wsClient),console.log("Batch delete client initialized"))}function qe(t={}){let e={...t};const n=new Set;return{getState:()=>e,setState:r=>{typeof r=="function"?e=r(e):e={...e,...r},n.forEach(s=>s(e))},subscribe:r=>(n.add(r),()=>{n.delete(r)})}}qe({message:"",visible:!1,timeout:null,type:"success"});qe({imageUrl:"",title:""});qe({videoUrl:"",title:"",downloadUrl:""});const Ys=qe({client:window.wsClient||null,connected:window.wsClient?window.wsClient.isConnected():!1,clientId:window.wsClient?window.wsClient.getClientId():null});window.wsClient&&setInterval(()=>{if(window.wsClient){const t=window.wsClient.isConnected(),e=window.wsClient.getClientId();Ys.setState({connected:t,clientId:e}),!t&&!window.wsClient.connecting&&window.wsClient.reconnectAttempts<window.wsClient.maxReconnectAttempts&&(console.log("WebSocket not connected, attempting to reconnect from application level"),window.wsClient.connect())}},5e3);function Zs(){const t=window.location.pathname.split("/").pop();let e="";switch(t){case"index.html":case"":e="nav-live";break;case"recordings.html":case"timeline.html":e="nav-recordings";break;case"streams.html":e="nav-streams";break;case"settings.html":e="nav-settings";break;case"users.html":e="nav-users";break;case"system.html":e="nav-system";break}let n=document.getElementById("app-root");if(!n){n=document.createElement("div"),n.id="app-root";const r=document.getElementById("main-content");r?r.appendChild(n):document.body.appendChild(n),console.log("Created app-root element for Preact Query provider")}oe(F(yr,{client:Cr},F("div",{id:"app-content"})),n),ns(e),ss(),t==="index.html"?L(()=>import("./WebRTCView-5e5jxpsi.js"),__vite__mapDeps([0,1]),import.meta.url).then(r=>{r.loadWebRTCView()}):t==="hls.html"?L(()=>import("./LiveView-DupScMJZ.js"),__vite__mapDeps([2,3,1]),import.meta.url).then(r=>{r.loadLiveView()}):t==="recordings.html"?L(()=>import("./RecordingsView-Bw4b9YOD.js"),__vite__mapDeps([4,3]),import.meta.url).then(r=>{r.loadRecordingsView()}):t==="timeline.html"?L(()=>import("./TimelineView-Cq5Hgy8L.js"),__vite__mapDeps([5,3]),import.meta.url).then(r=>{r.loadTimelineView()}):t==="settings.html"?L(()=>import("./SettingsView-Df1owDzy.js"),__vite__mapDeps([6,3]),import.meta.url).then(r=>{r.loadSettingsView()}):t==="streams.html"?L(()=>import("./StreamsView-BrF9bRvO.js"),__vite__mapDeps([7,3]),import.meta.url).then(r=>{r.loadStreamsView()}):t==="system.html"?L(()=>import("./SystemView-BcCMRgeB.js"),__vite__mapDeps([8,3]),import.meta.url).then(r=>{r.loadSystemView()}):t==="login.html"?L(()=>import("./LoginView-BdFSFB7R.js"),[],import.meta.url).then(r=>{r.loadLoginView()}):t==="users.html"?L(()=>import("./UsersView-CwSTiUDS.js"),[],import.meta.url).then(r=>{r.loadUsersView()}):t===""&&L(()=>import("./WebRTCView-5e5jxpsi.js"),__vite__mapDeps([0,1]),import.meta.url).then(r=>{r.loadWebRTCView()}),os(),is(),as(),L(async()=>{const{initToastContainer:r}=await import("./toast-Do6XSKgM.js");return{initToastContainer:r}},[],import.meta.url).then(({initToastContainer:r})=>{r(!1),console.log("Toast container initialized from preact-app.js"),window.testToastFromApp=(s="info")=>{const o="App test ".concat(s," toast at ").concat(new Date().toLocaleTimeString());return window.showToast&&window.showToast(o,s),"App toast triggered"}}).catch(r=>{console.error("Error initializing toast container:",r)})}document.addEventListener("DOMContentLoaded",Zs);export{ut as A,eo as D,oe as E,L as _,is as a,as as b,te as c,V as d,no as e,wr as f,js as g,se as h,to as i,Gs as j,zs as k,Ks as l,so as m,$n as p,he as q,os as s,Js as u,J as y};
//# sourceMappingURL=preact-app-DLK-1h92.js.map
