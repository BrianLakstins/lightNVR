const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./query-client-CKvJ69Lv.js","../css/query-client.css","./SnapshotManager-aeto7uun.js"])))=>i.map(i=>d[i]);
import{K as G,u as e,s as D,d as E,A as M,y as _,q as J,$ as I}from"./query-client-CKvJ69Lv.js";const Q="modulepreload",U=function(a,i){return new URL(a,i).href},B={},P=function(i,m,h){let o=Promise.resolve();if(m&&m.length>0){const s=document.getElementsByTagName("link"),t=document.querySelector("meta[property=csp-nonce]"),u=(t==null?void 0:t.nonce)||(t==null?void 0:t.getAttribute("nonce"));o=Promise.allSettled(m.map(l=>{if(l=U(l,h),l in B)return;B[l]=!0;const c=l.endsWith(".css"),y=c?'[rel="stylesheet"]':"";if(!!h)for(let w=s.length-1;w>=0;w--){const v=s[w];if(v.href===l&&(!c||v.rel==="stylesheet"))return}else if(document.querySelector('link[href="'.concat(l,'"]').concat(y)))return;const b=document.createElement("link");if(b.rel=c?"stylesheet":Q,c||(b.as="script"),b.crossOrigin="",b.href=l,u&&b.setAttribute("nonce",u),document.head.appendChild(b),c)return new Promise((w,v)=>{b.addEventListener("load",w),b.addEventListener("error",()=>v(new Error("Unable to preload CSS for ".concat(l))))})}))}function r(s){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=s,window.dispatchEvent(t),!t.defaultPrevented)throw s}return o.then(s=>{for(const t of s||[])t.status==="rejected"&&r(t.reason);return i().catch(r)})};G({showVideoModal:()=>{},showSnapshotPreview:()=>{}});function te(a){const{isOpen:i,onClose:m,onConfirm:h,mode:o,count:r}=a;if(!i)return null;let s="Confirm Delete",t="Are you sure you want to delete this item?";return o==="selected"?(s="Delete Selected Recordings",t="Are you sure you want to delete ".concat(r," selected recording").concat(r!==1?"s":"","?")):o==="all"&&(s="Delete All Filtered Recordings",t="Are you sure you want to delete all recordings matching the current filters? This action cannot be undone."),e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:c=>{c.target===c.currentTarget&&m()},onKeyDown:c=>{c.key==="Escape"&&m()},children:e("div",{class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md mx-auto",children:[e("div",{class:"mb-4",children:e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white",children:s})}),e("p",{class:"text-gray-600 dark:text-gray-300 mb-6",children:t}),e("div",{class:"flex justify-end space-x-3",children:[e("button",{class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",onClick:m,children:"Cancel"}),e("button",{class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",onClick:h,children:"Delete"})]})]})})}function X({isOpen:a,onClose:i,imageData:m,streamName:h,onDownload:o}){const r=M(null);_(()=>{const t=u=>{u.key==="Escape"&&a&&i()};return document.addEventListener("keydown",t),a&&r.current&&setTimeout(()=>{const u=r.current.querySelector(".modal-content");u&&(u.classList.remove("scale-95","opacity-0"),u.classList.add("scale-100","opacity-100"))},10),()=>{document.removeEventListener("keydown",t)}},[a,i]);const s=t=>{t.target===t.currentTarget&&i()};return a?I(e("div",{ref:r,id:"snapshot-preview-modal",className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:s,children:e("div",{className:"modal-content bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl max-h-[90vh] flex flex-col transform transition-all duration-300 ease-out scale-95 opacity-0",style:{width:"90%"},children:[e("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[e("h3",{id:"snapshot-preview-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:h?"Snapshot: ".concat(h):"Snapshot"}),e("button",{className:"close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:i,children:"✕"})]}),e("div",{className:"p-4 overflow-auto flex-grow",children:e("img",{id:"snapshot-preview-image",className:"max-w-full max-h-[70vh] mx-auto",src:m,alt:"Snapshot"})}),e("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-2",children:[e("button",{id:"snapshot-download-btn",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",onClick:o,children:"Download"}),e("button",{id:"snapshot-close-btn",className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",onClick:i,children:"Close"})]})]})}),document.body):null}function Z({isOpen:a,onClose:i,videoUrl:m,title:h,downloadUrl:o}){const[r,s]=E(!1),[t,u]=E(2),[l,c]=E([]),[y,j]=E(null),[b,w]=E("No detections loaded"),[v,W]=E(1),S=M(null),C=M(null),F=M(null);_(()=>{const n=g=>{g.key==="Escape"&&a&&i()};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[a,i]),_(()=>{if(!a||!m)return;const n=m.match(/\/play\/(\d+)/);if(!n||!n[1])return;const g=parseInt(n[1],10);(async()=>{try{const p=await fetch("/api/recordings/".concat(g));if(!p.ok)throw new Error("Failed to fetch recording data");const d=await p.json();if(j(d),d&&d.stream&&d.start_time&&d.end_time){const R=Math.floor(new Date(d.start_time).getTime()/1e3),A=Math.floor(new Date(d.end_time).getTime()/1e3),T=await fetch("/api/detection/results/".concat(d.stream,"?start=").concat(R,"&end=").concat(A));if(!T.ok)throw new Error("Failed to fetch detections");const f=(await T.json()).detections||[];c(f),f.length>0?w("".concat(f.length," detection").concat(f.length!==1?"s":""," available")):w("No detections found for this recording")}}catch(p){console.error("Error fetching data:",p),w("Error loading detections")}})()},[a,m]);const x=J(()=>{if(!r||!S.current||!C.current||l.length===0)return;const n=S.current,g=C.current,k=n.videoWidth,p=n.videoHeight;if(k===0||p===0){requestAnimationFrame(x);return}g.width=k,g.height=p;const d=g.getContext("2d");d.clearRect(0,0,g.width,g.height);const R=n.currentTime;if(!y||!y.start_time)return;const T=Math.floor(new Date(y.start_time).getTime()/1e3)+Math.floor(R),N=l.filter(f=>f.timestamp?Math.abs(f.timestamp-T)<=t:!1);N.length>0?w("Showing ".concat(N.length," detection").concat(N.length!==1?"s":""," at current time")):w("No detections at current time (".concat(l.length," total)")),N.forEach(f=>{const $=f.x*k,L=f.y*p,z=f.width*k,H=f.height*p;d.strokeStyle="rgba(0, 255, 0, 0.8)",d.lineWidth=2,d.strokeRect($,L,z,H),d.fillStyle="rgba(0, 0, 0, 0.7)";const V="".concat(f.label," (").concat(Math.round(f.confidence*100),"%)"),Y=d.measureText(V).width+10;d.fillRect($,L-20,Y,20),d.fillStyle="white",d.font="12px Arial",d.fillText(V,$+5,L-5)}),!n.paused&&!n.ended&&requestAnimationFrame(x)},[r,l,y,t]);_(()=>{if(!a||!S.current)return;const n=S.current,g=()=>{r&&x()},k=()=>{r&&x()},p=()=>{if(r){const d=Math.floor(n.currentTime*2)/2;n.lastDrawnTime!==d&&(n.lastDrawnTime=d,x())}};return n.addEventListener("play",g),n.addEventListener("seeked",k),n.addEventListener("timeupdate",p),()=>{n.removeEventListener("play",g),n.removeEventListener("seeked",k),n.removeEventListener("timeupdate",p)}},[a,r,x]),_(()=>{r?(C.current&&(C.current.style.display="block"),x()):C.current&&(C.current.style.display="none")},[r,x]);const K=n=>{n.target===n.currentTarget&&i()},q=n=>{S.current&&(S.current.playbackRate=n,W(n))},O=n=>{const g=parseInt(n.target.value,10);u(g),r&&x()};return a?I(e("div",{ref:F,id:"video-preview-modal",className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:K,children:e("div",{className:"modal-content bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl max-h-[90vh] flex flex-col transform transition-all duration-300 ease-out scale-95 opacity-0 w-full md:w-[90%]",children:[e("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[e("h3",{id:"video-preview-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:h||"Video"}),e("button",{className:"close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:i,children:"✕"})]}),e("div",{className:"p-4 flex-grow",children:e("div",{className:"relative",children:[e("video",{ref:S,className:"w-full h-auto max-w-full object-contain mx-auto",src:m,controls:!0,autoPlay:!0}),e("canvas",{ref:C,className:"absolute top-0 left-0 w-full h-full pointer-events-none",style:{display:"none"}})]})}),e("div",{id:"recordings-controls",className:"mx-4 mb-4 p-4 border border-green-500 rounded-lg bg-white dark:bg-gray-700 shadow-md relative z-10",children:[e("h3",{className:"text-lg font-bold text-center mb-4 text-gray-800 dark:text-white",children:"PLAYBACK CONTROLS"}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-2",children:[e("div",{className:"border-b pb-4 md:border-b-0 md:border-r md:pr-4 md:pb-0",children:[e("h4",{className:"font-bold text-center mb-3 text-gray-700 dark:text-gray-300",children:"Playback Speed"}),e("div",{className:"flex flex-wrap justify-center gap-2",children:[.25,.5,1,1.5,2,4].map(n=>e("button",{className:"speed-btn px-3 py-2 rounded-full ".concat(n===v?"bg-green-500 text-white":"bg-gray-200 hover:bg-gray-300"," text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50"),"data-speed":n,onClick:()=>q(n),children:n===1?"1× (Normal)":"".concat(n,"×")},n))}),e("div",{id:"current-speed-indicator",className:"mt-3 text-center font-medium text-green-600 dark:text-green-400 text-sm",children:["Current Speed: ",v,"× ",v===1?"(Normal)":""]})]}),e("div",{className:"pt-4 md:pt-0 md:pl-4",children:[e("h4",{className:"font-bold text-center mb-2 text-gray-700 dark:text-gray-300",children:"Detection Overlays"}),e("div",{className:"flex flex-col items-center gap-2",children:[e("div",{className:"flex items-center gap-2 mb-2",children:[e("input",{type:"checkbox",id:"detection-overlay-checkbox",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",checked:r,onChange:n=>s(n.target.checked),disabled:l.length===0}),e("label",{htmlFor:"detection-overlay-checkbox",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Show Detection Overlays"})]}),e("div",{className:"flex flex-col w-full mt-2 mb-2",children:[e("label",{htmlFor:"detection-sensitivity-slider",className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Detection Sensitivity"}),e("input",{type:"range",id:"detection-sensitivity-slider",className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700",min:"1",max:"10",step:"1",value:t,onChange:O}),e("div",{id:"detection-sensitivity-value",className:"text-xs text-gray-600 dark:text-gray-400 text-center mb-1",children:["Time Window: ",t," second",t!==1?"s":""]})]}),e("div",{id:"detection-status-indicator",className:"text-center text-sm ".concat(l.length>0?"font-medium text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400"),children:b})]})]})]}),o&&e("div",{className:"flex justify-center mt-4 pt-2 border-t border-gray-200 dark:border-gray-700",children:e("a",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center text-sm",href:o,download:"video-".concat(Date.now(),".mp4"),children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download Video"]})})]}),e("div",{className:"p-2"})]})}),document.body):null}function ne(){console.warn("setupModals() is deprecated. Use <ModalProvider> component instead.")}function re(){console.warn("addModalStyles() is deprecated. Modal styles are now included in components.css")}function oe(a,i,m){if(console.warn("Direct showVideoModal() is deprecated. Use ModalContext.showVideoModal instead."),window.__modalContext&&window.__modalContext.showVideoModal){window.__modalContext.showVideoModal(a,i,m);return}if(!document.getElementById("modal-root")){const r=document.createElement("div");r.id="modal-root",document.body.appendChild(r)}const o=document.createElement("div");o.id="temp-modal-container",document.body.appendChild(o),P(async()=>{const{render:r,h:s}=await import("./query-client-CKvJ69Lv.js").then(t=>t.p);return{render:r,h:s}},__vite__mapDeps([0,1]),import.meta.url).then(({render:r,h:s})=>{r(s(Z,{isOpen:!0,onClose:()=>{r(null,o),document.body.removeChild(o)},videoUrl:a,title:i,downloadUrl:m}),o)}).catch(r=>{console.error("Error rendering video modal:",r),D("Error showing video modal: "+r.message,"error")})}function ae(a,i){if(console.warn("Direct showSnapshotPreview() is deprecated. Use ModalContext.showSnapshotPreview instead."),window.__modalContext&&window.__modalContext.showSnapshotPreview){window.__modalContext.showSnapshotPreview(a,i);return}if(!document.getElementById("modal-root")){const o=document.createElement("div");o.id="modal-root",document.body.appendChild(o)}const h=document.createElement("div");h.id="temp-snapshot-container",document.body.appendChild(h),P(async()=>{const{render:o,h:r}=await import("./query-client-CKvJ69Lv.js").then(s=>s.p);return{render:o,h:r}},__vite__mapDeps([0,1]),import.meta.url).then(({render:o,h:r})=>{o(r(X,{isOpen:!0,onClose:()=>{o(null,h),document.body.removeChild(h)},imageData:a,streamName:i,onDownload:()=>{try{P(async()=>{const{useSnapshotManager:t}=await import("./SnapshotManager-aeto7uun.js");return{useSnapshotManager:t}},__vite__mapDeps([2,0,1]),import.meta.url).then(({useSnapshotManager:t})=>{const{downloadSnapshot:u}=t();if(u)u();else{const l=new Date().toISOString().replace(/[:.]/g,"-"),c="snapshot_".concat(i,"_").concat(l,".jpg"),y=document.createElement("a");y.href=a,y.download=c,document.body.appendChild(y),y.click(),setTimeout(()=>{document.body.removeChild(y)},100),D("Snapshot downloaded successfully","success",3e3)}}).catch(t=>{console.error("Error importing SnapshotManager:",t);const u=new Date().toISOString().replace(/[:.]/g,"-"),l="snapshot_".concat(i,"_").concat(u,".jpg"),c=document.createElement("a");c.href=a,c.download=l,document.body.appendChild(c),c.click(),setTimeout(()=>{document.body.removeChild(c)},100),D("Snapshot downloaded successfully","success",3e3)})}catch(t){console.error("Error downloading snapshot:",t),D("Download failed: "+t.message,"error",5e3)}}}),h)}).catch(o=>{console.error("Error rendering snapshot modal:",o),D("Error showing snapshot preview: "+o.message,"error")})}export{te as D,re as a,oe as b,ae as c,ne as s};
//# sourceMappingURL=UI-QFITwjX7.js.map
