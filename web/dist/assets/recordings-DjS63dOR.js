var oe=Object.freeze,He=Object.defineProperty;var $=(e,t)=>oe(He(e,"raw",{value:oe(t||e.slice())}));import{a as Q,b as We,c as je,e as V,f as M,g as q,d as D,A as Ne,y as E,u as b,E as Ve,q as qe,Q as Qe}from"./query-client-mfCUf3pQ.js";import{h as C,c as m,D as Je,d as Ke,H as Ye,F as Ge}from"./Footer-BhxJVGxY.js";import{C as Xe}from"./LoadingIndicator-DlQOsIse.js";import{W as se,B as ie}from"./websocket-client-DzZLM-9M.js";function ut(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}function J(e,t=3e3){let r=document.getElementById("status-message-container");r||(r=document.createElement("div"),r.id="status-message-container",r.className="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 flex flex-col items-center",document.body.appendChild(r));const n=document.createElement("div");n.className="bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg mb-2 transition-all duration-300 opacity-0 transform translate-y-2",n.textContent=e,r.appendChild(n),setTimeout(()=>{n.classList.remove("opacity-0","translate-y-2")},10),setTimeout(()=>{n.classList.add("opacity-0","translate-y-2"),setTimeout(()=>{n.parentNode===r&&r.removeChild(n),r.children.length===0&&document.body.removeChild(r)},300)},t)}function _(){let e=document.getElementById("batch-delete-modal-container");e||(e=document.createElement("div"),e.id="batch-delete-modal-container",document.body.appendChild(e)),e.innerHTML='\n        <div id="batch-delete-modal" class="modal hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">\n            <div class="modal-content relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md mx-auto p-6 w-full">\n                <div class="modal-header flex justify-between items-center mb-4 pb-2 border-b border-gray-200 dark:border-gray-700">\n                    <h3 id="batch-delete-modal-title" class="text-xl font-bold text-gray-900 dark:text-white">Batch Delete Progress</h3>\n                    <button id="batch-delete-close-btn" class="close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl font-bold">&times;</button>\n                </div>\n                <div class="modal-body">\n                    <div id="batch-delete-status" class="mb-4 text-gray-700 dark:text-gray-300">\n                        Preparing to delete recordings...\n                    </div>\n                    <div class="progress-container bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-4">\n                        <div id="batch-delete-progress-bar" class="bg-green-500 h-4 rounded-full text-center text-xs text-white" style="width: 0%"></div>\n                    </div>\n                    <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-6">\n                        <div id="batch-delete-count">0 / 0</div>\n                        <div id="batch-delete-percentage">0%</div>\n                    </div>\n                    <div id="batch-delete-details" class="mb-4">\n                        <div class="flex justify-between mb-2">\n                            <span class="text-gray-700 dark:text-gray-300">Succeeded:</span>\n                            <span id="batch-delete-succeeded" class="font-bold text-green-600 dark:text-green-400">0</span>\n                        </div>\n                        <div class="flex justify-between">\n                            <span class="text-gray-700 dark:text-gray-300">Failed:</span>\n                            <span id="batch-delete-failed" class="font-bold text-red-600 dark:text-red-400">0</span>\n                        </div>\n                    </div>\n                    <div id="batch-delete-message" class="text-sm italic text-gray-600 dark:text-gray-400 mb-4"></div>\n                </div>\n                <div class="modal-footer flex justify-end pt-2 border-t border-gray-200 dark:border-gray-700">\n                    <button id="batch-delete-done-btn" class="btn btn-primary hidden">Done</button>\n                    <button id="batch-delete-cancel-btn" class="btn btn-secondary">Cancel</button>\n                </div>\n            </div>\n        </div>\n    ';const t=document.getElementById("batch-delete-modal"),r=document.getElementById("batch-delete-close-btn"),n=document.getElementById("batch-delete-done-btn"),a=document.getElementById("batch-delete-cancel-btn");r&&r.addEventListener("click",U),n&&n.addEventListener("click",U),a&&a.addEventListener("click",et),window.addEventListener("click",i=>{i.target===t&&U()})}function A(){const e=document.getElementById("batch-delete-modal");e||_(),Ze(),e.classList.remove("hidden")}function U(){const e=document.getElementById("batch-delete-modal");e&&e.classList.add("hidden")}function Ze(){const e=document.getElementById("batch-delete-progress-bar");e&&(e.style.width="0%");const t=document.getElementById("batch-delete-status");t&&(t.textContent="Preparing to delete recordings...");const r=document.getElementById("batch-delete-count");r&&(r.textContent="0 / 0");const n=document.getElementById("batch-delete-percentage");n&&(n.textContent="0%");const a=document.getElementById("batch-delete-succeeded");a&&(a.textContent="0");const i=document.getElementById("batch-delete-failed");i&&(i.textContent="0");const s=document.getElementById("batch-delete-message");s&&(s.textContent="");const d=document.getElementById("batch-delete-done-btn");d&&d.classList.add("hidden");const g=document.getElementById("batch-delete-cancel-btn");g&&g.classList.remove("hidden")}window.updateBatchDeleteProgress=function(e){console.log("Updating batch delete progress UI:",e),A();const t=document.getElementById("batch-delete-progress-bar");if(t){if(console.log("Updating progress bar: current=".concat(e.current,", total=").concat(e.total)),e.total>0){const d=Math.round(e.current/e.total*100);console.log("Setting progress bar width to ".concat(d,"%")),t.style.width="".concat(d,"%"),t.classList.remove("animate-pulse"),t.offsetWidth}else if(e.current>0){const d=Math.min(90,e.current/10);console.log("Setting progress bar width to ".concat(d,"% (estimated)")),t.style.width="".concat(d,"%"),t.classList.add("animate-pulse"),t.offsetWidth}else e.complete?(console.log("Setting progress bar to 100% (complete)"),t.style.width="100%",t.classList.remove("animate-pulse"),t.offsetWidth):(console.log("Setting progress bar to 50% (indeterminate)"),t.style.width="50%",t.classList.add("animate-pulse"),t.offsetWidth);e.error?(t.classList.add("bg-red-500"),t.classList.remove("bg-blue-500")):(t.classList.add("bg-blue-500"),t.classList.remove("bg-red-500"))}const r=document.getElementById("batch-delete-status");r&&e.status&&(r.textContent=e.status);const n=document.getElementById("batch-delete-count");n&&(e.total>0?n.textContent="".concat(e.current," / ").concat(e.total):n.textContent="".concat(e.current," / ?"));const a=document.getElementById("batch-delete-percentage");if(a)if(e.total>0){const d=Math.round(e.current/e.total*100);a.textContent="".concat(d,"%")}else e.complete?a.textContent="100%":a.textContent="In progress";const i=document.getElementById("batch-delete-succeeded");i&&(i.textContent=e.succeeded||"0");const s=document.getElementById("batch-delete-failed");if(s&&(s.textContent=e.failed||"0"),e.complete){const d=document.getElementById("batch-delete-done-btn");d&&d.classList.remove("hidden");const g=document.getElementById("batch-delete-cancel-btn");g&&g.classList.add("hidden"),r&&(!e.status||e.status==="Preparing to delete recordings...")&&(r.textContent="Batch delete operation complete"),t&&(t.style.width="100%",t.classList.remove("animate-pulse"))}};function et(){U(),J("Batch delete operation cancelled",5e3)}window.batchDeleteRecordingsByHttpRequest=function(e){return console.log("Using HTTP fallback for batch delete with params:",e),new Promise((t,r)=>{A();let n=0;e.ids?n=e.ids.length:e.filter&&e.totalCount&&(n=e.totalCount),updateBatchDeleteProgress({current:0,total:n,status:"Using HTTP fallback for batch delete operation",succeeded:0,failed:0}),fetch("/api/recordings/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(a=>{if(!a.ok)throw new Error("HTTP error ".concat(a.status,": ").concat(a.statusText));return a.json()}).then(a=>{console.log("HTTP batch delete result:",a);const i=a.total||n||0,s=a.succeeded||0,d=a.failed||0;updateBatchDeleteProgress({current:i,total:i,succeeded:s,failed:d,status:"Batch delete operation complete",complete:!0});const g=a.success?"Successfully deleted ".concat(s," recordings"):"Deleted ".concat(s," recordings with ").concat(d," failures");J(g,5e3),setTimeout(()=>{typeof loadRecordings=="function"&&loadRecordings()},1e3),t(a)}).catch(a=>{console.error("HTTP batch delete error:",a),updateBatchDeleteProgress({current:0,total:0,succeeded:0,failed:0,status:"Error: ".concat(a.message||"Unknown error"),complete:!0,error:!0}),J("Error: ".concat(a.message||"Unknown error"),5e3),r(a)})})};document.addEventListener("DOMContentLoaded",()=>{if(console.log("Initializing batch delete modal"),_(),!document.getElementById("batch-delete-modal-container")){console.error("Batch delete modal container not found, creating it");const t=document.createElement("div");t.id="batch-delete-modal-container",document.body.appendChild(t),_()}typeof window.updateBatchDeleteProgress!="function"&&(console.error("updateBatchDeleteProgress function not available, setting it up"),window.updateBatchDeleteProgress=updateBatchDeleteProgress),typeof window.showBatchDeleteModal!="function"&&(console.error("showBatchDeleteModal function not available, setting it up"),window.showBatchDeleteModal=A)});window.showBatchDeleteModal=A;window.updateBatchDeleteProgress=updateBatchDeleteProgress;window.initBatchDeleteModal=_;var de,le;function tt({filters:e,setFilters:t,pagination:r,setPagination:n,streams:a,filtersVisible:i,applyFilters:s,resetFilters:d,handleDateRangeChange:g,setDefaultDateRange:y}){return C(le||(le=$(['\n    <aside id="filters-sidebar" \n           class=','>\n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Date Range</h3>\n        <div class="filter-option mb-2">\n          <label for="date-range-select" class="block mb-1 text-sm font-medium">Quick Select:</label>\n          <select id="date-range-select" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="today">Today</option>\n            <option value="yesterday">Yesterday</option>\n            <option value="last7days">Last 7 Days</option>\n            <option value="last30days">Last 30 Days</option>\n            <option value="custom">Custom Range</option>\n          </select>\n        </div>\n        \n        <div id="custom-date-range" \n             class="filter-option space-y-3"\n             style=','>\n          <div class="space-y-1">\n            <label for="start-date" class="block text-sm font-medium">Start Date:</label>\n            <input type="date" id="start-date" \n                   class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                   value=',"\n                   onChange=",' />\n            <div class="mt-1">\n              <label for="start-time" class="block text-sm font-medium">Time:</label>\n              <input type="time" id="start-time" \n                     class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                     value=',"\n                     onChange=",' />\n            </div>\n          </div>\n          \n          <div class="space-y-1">\n            <label for="end-date" class="block text-sm font-medium">End Date:</label>\n            <input type="date" id="end-date" \n                   class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                   value=',"\n                   onChange=",' />\n            <div class="mt-1">\n              <label for="end-time" class="block text-sm font-medium">Time:</label>\n              <input type="time" id="end-time" \n                     class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                     value=',"\n                     onChange=",' />\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Stream</h3>\n        <div class="filter-option">\n          <select id="stream-filter" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="all">All Streams</option>\n            ','\n          </select>\n        </div>\n      </div>\n      \n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Recording Type</h3>\n        <div class="filter-option">\n          <select id="detection-filter" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="all">All Recordings</option>\n            <option value="detection">Detection Events Only</option>\n          </select>\n        </div>\n      </div>\n      \n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Display Options</h3>\n        <div class="filter-option">\n          <label for="page-size" class="block mb-1 text-sm font-medium">Items per page:</label>\n          <select id="page-size" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="10">10</option>\n            <option value="20">20</option>\n            <option value="50">50</option>\n            <option value="100">100</option>\n          </select>\n        </div>\n      </div>\n      \n      <div class="filter-actions flex space-x-2">\n        <button id="apply-filters-btn" \n                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"\n                onClick=','>\n          Apply Filters\n        </button>\n        <button id="reset-filters-btn" \n                class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"\n                onClick=',">\n          Reset\n        </button>\n      </div>\n    </aside>\n  "])),"filters-sidebar w-full md:w-64 bg-white dark:bg-gray-800 rounded-lg shadow p-4 md:sticky md:top-4 md:self-start transition-all duration-300 ".concat(i?"":"hidden md:block"),e.dateRange,g,e.dateRange==="custom"?"display: block":"display: none",e.startDate,c=>t(p=>({...p,startDate:c.target.value})),e.startTime,c=>t(p=>({...p,startTime:c.target.value})),e.endDate,c=>t(p=>({...p,endDate:c.target.value})),e.endTime,c=>t(p=>({...p,endTime:c.target.value})),e.streamId,c=>t(p=>({...p,streamId:c.target.value})),a.map(c=>C(de||(de=$(["\n              <option key="," value=",">","</option>\n            "])),c.name,c.name,c.name)),e.recordingType,c=>t(p=>({...p,recordingType:c.target.value})),r.pageSize,c=>n(p=>({...p,pageSize:parseInt(c.target.value,10)})),s,d)}var ce,ge;function at({activeFiltersDisplay:e,removeFilter:t,hasActiveFilters:r}){return r?C(ge||(ge=$(['\n    <div id="active-filters" \n         class="active-filters mb-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex flex-wrap gap-2">\n      ',"\n    </div>\n  "])),e.map((n,a)=>C(ce||(ce=$(["\n        <div key=",' class="filter-tag inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-200">\n          <span>','</span>\n          <button class="ml-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 focus:outline-none"\n                  onClick=',">\n            ×\n          </button>\n        </div>\n      "])),a,n.label,()=>t(n.key)))):null}const K={formatDateTime:e=>e?new Date(e).toLocaleString():"",formatDuration:e=>{if(!e)return"00:00:00";const t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.floor(e%60);return[t.toString().padStart(2,"0"),r.toString().padStart(2,"0"),n.toString().padStart(2,"0")].join(":")},formatFileSize:e=>{if(!e)return"0 B";const t=["B","KB","MB","GB","TB"];let r=0,n=e;for(;n>=1024&&r<t.length-1;)n/=1024,r++;return"".concat(n.toFixed(1)," ").concat(t[r])}};var ue,me,pe,he,fe,be,ye;function rt({recordings:e,sortField:t,sortDirection:r,sortBy:n,selectedRecordings:a,toggleRecordingSelection:i,selectAll:s,toggleSelectAll:d,getSelectedCount:g,openDeleteModal:y,playRecording:c,downloadRecording:p,deleteRecording:w,recordingsTableBodyRef:S,pagination:H}){return C(ye||(ye=$(['\n    <div class="recordings-container bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden w-full">\n      <div class="batch-actions p-3 border-b border-gray-200 dark:border-gray-700 flex flex-wrap gap-2 items-center">\n        <div class="selected-count text-sm text-gray-600 dark:text-gray-400 mr-2">\n          ','\n        </div>\n        <button \n          class="px-3 py-1.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"\n          disabled=',"\n          onClick=",'>\n          Delete Selected\n        </button>\n        <button \n          class="px-3 py-1.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"\n          onClick=','>\n          Delete All Filtered\n        </button>\n      </div>\n      <div class="overflow-x-auto">\n        <table id="recordings-table" class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">\n          <thead class="bg-gray-50 dark:bg-gray-700">\n            <tr>\n              <th class="w-10 px-4 py-3">\n                <input \n                  type="checkbox" \n                  checked=',"\n                  onChange=",'\n                  class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"\n                />\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer"\n                  onClick=','>\n                <div class="flex items-center">\n                  Stream\n                  ','\n                </div>\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer"\n                  onClick=','>\n                <div class="flex items-center">\n                  Start Time\n                  ','\n                </div>\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">\n                Duration\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer"\n                  onClick=','>\n                <div class="flex items-center">\n                  Size\n                  ','\n                </div>\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">\n                Detections\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">\n                Actions\n              </th>\n            </tr>\n          </thead>\n          <tbody ref=',' class="bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700">\n            ',"\n          </tbody>\n        </table>\n      </div>\n    </div>\n  "])),g()>0?"".concat(g()," recording").concat(g()!==1?"s":""," selected"):"No recordings selected",g()===0,()=>y("selected"),()=>y("all"),s,d,()=>n("stream_name"),t==="stream_name"&&C(ue||(ue=$(['\n                    <span class="sort-icon ml-1">',"</span>\n                  "])),r==="asc"?"▲":"▼"),()=>n("start_time"),t==="start_time"&&C(me||(me=$(['\n                    <span class="sort-icon ml-1">',"</span>\n                  "])),r==="asc"?"▲":"▼"),()=>n("size_bytes"),t==="size_bytes"&&C(pe||(pe=$(['\n                    <span class="sort-icon ml-1">',"</span>\n                  "])),r==="asc"?"▲":"▼"),S,e.length===0?C(he||(he=$(['\n              <tr>\n                <td colspan="6" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">\n                  ',"\n                </td>\n              </tr>\n            "])),H.totalItems===0?"No recordings found":"Loading recordings..."):e.map(k=>C(be||(be=$(["\n              <tr key=",' class="hover:bg-gray-50 dark:hover:bg-gray-700">\n                <td class="px-4 py-4 whitespace-nowrap">\n                  <input \n                    type="checkbox" \n                    checked=',"\n                    onChange=",'\n                    class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"\n                  />\n                </td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">\n                  ','\n                </td>\n                <td class="px-6 py-4 whitespace-nowrap">\n                  <div class="flex space-x-2">\n                    <button class="p-1 rounded-full text-blue-600 hover:bg-blue-100 dark:text-blue-400 dark:hover:bg-blue-900 focus:outline-none"\n                            onClick=','\n                            title="Play">\n                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>\n                      </svg>\n                    </button>\n                    <button class="p-1 rounded-full text-green-600 hover:bg-green-100 dark:text-green-400 dark:hover:bg-green-900 focus:outline-none"\n                            onClick=','\n                            title="Download">\n                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>\n                      </svg>\n                    </button>\n                    <button class="p-1 rounded-full text-red-600 hover:bg-red-100 dark:text-red-400 dark:hover:bg-red-900 focus:outline-none"\n                            onClick=','\n                            title="Delete">\n                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>\n                      </svg>\n                    </button>\n                  </div>\n                </td>\n              </tr>\n            '])),k.id,!!a[k.id],()=>i(k.id),k.stream||"",K.formatDateTime(k.start_time),K.formatDuration(k.duration),k.size||"",k.has_detections?C(fe||(fe=$(['\n                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100">\n                      <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>\n                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>\n                      </svg>\n                      Yes\n                    </span>\n                  ']))):"",()=>c(k),()=>p(k),()=>w(k))))}var we;function nt({pagination:e,goToPage:t}){return C(we||(we=$(['\n    <div class="pagination-controls flex flex-col sm:flex-row justify-between items-center p-4 border-t border-gray-200 dark:border-gray-700">\n      <div class="pagination-info text-sm text-gray-600 dark:text-gray-400 mb-2 sm:mb-0">\n        Showing <span id="pagination-showing">',"-",'</span> of <span id="pagination-total">','</span> recordings\n      </div>\n      <div class="pagination-buttons flex items-center space-x-1">\n        <button id="pagination-first" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="First Page"\n                onClick=',"\n                disabled=",'>\n          «\n        </button>\n        <button id="pagination-prev" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="Previous Page"\n                onClick=',"\n                disabled=",'>\n          ‹\n        </button>\n        <span id="pagination-current" class="px-2 text-sm text-gray-700 dark:text-gray-300">\n          Page '," of ",'\n        </span>\n        <button id="pagination-next" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="Next Page"\n                onClick=',"\n                disabled=",'>\n          ›\n        </button>\n        <button id="pagination-last" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="Last Page"\n                onClick=',"\n                disabled=",">\n          »\n        </button>\n      </div>\n    </div>\n  "])),e.startItem,e.endItem,e.totalItems,()=>t(1),e.currentPage===1,()=>t(e.currentPage-1),e.currentPage===1,e.currentPage,e.totalPages,()=>t(e.currentPage+1),e.currentPage===e.totalPages,()=>t(e.totalPages),e.currentPage===e.totalPages)}const x={hooks:{useStreams:()=>V("streams","/api/streams",{timeout:15e3,retries:2,retryDelay:1e3}),useRecordings:(e,t,r,n)=>{const a=new URLSearchParams;if(a.append("page",t.currentPage),a.append("limit",t.pageSize),a.append("sort",r),a.append("order",n),e.dateRange==="custom")a.append("start","".concat(e.startDate,"T").concat(e.startTime,":00")),a.append("end","".concat(e.endDate,"T").concat(e.endTime,":00"));else{const{start:s,end:d}=x.getDateRangeFromPreset(e.dateRange);a.append("start",s),a.append("end",d)}return e.streamId!=="all"&&a.append("stream",e.streamId),e.recordingType==="detection"&&a.append("detection","1"),V(["recordings",e,t,r,n],"/api/recordings?".concat(a.toString()),{timeout:3e4,retries:2,retryDelay:1e3},{onSuccess:s=>{s.recordings&&s.recordings.length>0&&s.recordings.forEach(d=>{d.has_detections=!1})}})},useRecordingDetections:e=>{if(!e||!e.id||!e.stream||!e.start_time||!e.end_time)return{data:{detections:[]}};const t=Math.floor(new Date(e.start_time).getTime()/1e3),r=Math.floor(new Date(e.end_time).getTime()/1e3),n=new URLSearchParams({start:t,end:r});return V(["recording-detections",e.id],"/api/detection/results/".concat(e.stream,"?").concat(n.toString()),{timeout:15e3,retries:1,retryDelay:1e3},{enabled:!!e.id})},useDeleteRecording:()=>{const e=Q();return je({mutationFn:async t=>{const r="/api/recordings/".concat(t);return await M(r,{method:"DELETE",timeout:15e3,retries:1,retryDelay:1e3})},onSuccess:()=>{e.invalidateQueries({queryKey:["recordings"]}),m("Recording deleted successfully")},onError:t=>{console.error("Error deleting recording:",t),m("Error deleting recording: "+t.message)}})},useBatchDeleteRecordings:()=>{const e=Q();return We("/api/recordings/batch-delete",{timeout:6e4,retries:1,retryDelay:2e3},{onSuccess:t=>{e.invalidateQueries({queryKey:["recordings"]});const r=t.succeeded,n=t.failed;r>0&&n===0?m("Successfully deleted ".concat(r," recording").concat(r!==1?"s":"")):r>0&&n>0?m("Deleted ".concat(r," recording").concat(r!==1?"s":"",", but failed to delete ").concat(n)):m("Failed to delete ".concat(n," recording").concat(n!==1?"s":""))},onError:t=>{console.error("Error in batch delete operation:",t),m("Error in batch delete operation: "+t.message)}})}},loadStreams:async()=>{try{return await M("/api/streams",{timeout:15e3,retries:2,retryDelay:1e3})||[]}catch(e){return console.error("Error loading streams for filter:",e),m("Error loading streams: "+e.message),[]}},getDateRangeFromPreset:e=>{const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0);let a,i;switch(e){case"today":a=n.toISOString(),i=r.toISOString();break;case"yesterday":const s=new Date(n);s.setDate(s.getDate()-1);const d=new Date(s);d.setHours(23,59,59),a=s.toISOString(),i=d.toISOString();break;case"last7days":const g=new Date(n);g.setDate(g.getDate()-7),a=g.toISOString(),i=r.toISOString();break;case"last30days":const y=new Date(n);y.setDate(y.getDate()-30),a=y.toISOString(),i=r.toISOString();break;default:const c=new Date(n);c.setDate(c.getDate()-7),a=c.toISOString(),i=r.toISOString()}return{start:a,end:i}},loadRecordings:async(e,t,r,n)=>{try{const a=new URLSearchParams;if(a.append("page",t.currentPage),a.append("limit",t.pageSize),a.append("sort",r),a.append("order",n),e.dateRange==="custom")a.append("start","".concat(e.startDate,"T").concat(e.startTime,":00")),a.append("end","".concat(e.endDate,"T").concat(e.endTime,":00"));else{const{start:s,end:d}=x.getDateRangeFromPreset(e.dateRange);a.append("start",s),a.append("end",d)}e.streamId!=="all"&&a.append("stream",e.streamId),e.recordingType==="detection"&&a.append("detection","1"),console.log("API Request:","/api/recordings?".concat(a.toString()));const i=await M("/api/recordings?".concat(a.toString()),{timeout:3e4,retries:2,retryDelay:1e3});if(console.log("Recordings data received:",i),i.recordings&&i.recordings.length>0)for(let d=0;d<i.recordings.length;d+=5){const g=i.recordings.slice(d,d+5);await Promise.all(g.map(async y=>{try{y.has_detections=await x.checkRecordingHasDetections(y)}catch(c){console.error("Error checking detections for recording ".concat(y.id,":"),c),y.has_detections=!1}}))}return i}catch(a){throw console.error("Error loading recordings:",a),m("Error loading recordings: "+a.message),a}},deleteRecording:async e=>{try{return await q("/api/recordings/".concat(e.id),{method:"DELETE",timeout:15e3,retries:1,retryDelay:1e3}),m("Recording deleted successfully"),!0}catch(t){return console.error("Error deleting recording:",t),m("Error deleting recording: "+t.message),!1}},deleteSelectedRecordings:async e=>{const t=Object.entries(e).filter(([r,n])=>n).map(([r,n])=>parseInt(r,10));if(t.length===0)return m("No recordings selected"),{succeeded:0,failed:0};try{if(window.wsClient){if(console.log("Using WebSocket for batch delete operation"),window.wsClient.isConnected()||(console.log("WebSocket not connected, connecting now..."),window.wsClient.connect()),!window.batchDeleteClient)if(typeof BatchDeleteRecordingsClient<"u")console.log("Creating new BatchDeleteRecordingsClient"),window.batchDeleteClient=new BatchDeleteRecordingsClient(window.wsClient);else return console.warn("BatchDeleteRecordingsClient not available, falling back to HTTP"),x.deleteSelectedRecordingsHttp(t);return typeof showBatchDeleteModal=="function"&&showBatchDeleteModal(),await window.batchDeleteClient.deleteWithProgress({ids:t})}else return console.log("WebSocket client not available, using HTTP for batch delete"),x.deleteSelectedRecordingsHttp(t)}catch(r){return console.error("Error in batch delete operation:",r),m("Error in batch delete operation: "+r.message),{succeeded:0,failed:0}}},deleteSelectedRecordingsHttp:async e=>{try{const r=await(await q("/api/recordings/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:e}),timeout:6e4,retries:1,retryDelay:2e3})).json(),n=r.succeeded,a=r.failed;return n>0&&a===0?m("Successfully deleted ".concat(n," recording").concat(n!==1?"s":"")):n>0&&a>0?m("Deleted ".concat(n," recording").concat(n!==1?"s":"",", but failed to delete ").concat(a)):m("Failed to delete ".concat(a," recording").concat(a!==1?"s":"")),r}catch(t){return console.error("Error in HTTP batch delete operation:",t),m("Error in batch delete operation: "+t.message),{succeeded:0,failed:0}}},deleteAllFilteredRecordings:async e=>{try{const t={};if(e.dateRange==="custom")t.start="".concat(e.startDate,"T").concat(e.startTime,":00"),t.end="".concat(e.endDate,"T").concat(e.endTime,":00");else{const{start:a,end:i}=x.getDateRangeFromPreset(e.dateRange);t.start=a,t.end=i}e.streamId!=="all"&&(t.stream_name=e.streamId),e.recordingType==="detection"&&(t.detection=1),console.log("Deleting with filter:",t),typeof showBatchDeleteModal=="function"&&(showBatchDeleteModal(),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:0,succeeded:0,failed:0,status:"Preparing to delete recordings matching filter...",complete:!1}));let r=0;try{const a=new URLSearchParams;t.start&&a.append("start",t.start),t.end&&a.append("end",t.end),t.stream_name&&a.append("stream",t.stream_name),t.detection&&a.append("detection","1"),a.append("page","1"),a.append("limit","1"),console.log("Getting total count with params:",a.toString());const i=await fetch("/api/recordings?".concat(a.toString()));if(i.ok){const s=await i.json();s&&s.pagination&&s.pagination.total&&(r=s.pagination.total,console.log("Found ".concat(r," recordings matching filter")),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:r,succeeded:0,failed:0,status:"Found ".concat(r," recordings matching filter. Starting deletion..."),complete:!1}))}}catch(a){console.warn("Error getting recording count:",a)}const n=a=>(console.error("Error in delete all operation:",a),m("Error in delete all operation: "+a.message),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:0,succeeded:0,failed:0,status:"Error: ".concat(a.message),complete:!0}),{succeeded:0,failed:0});if(window.wsClient){if(console.log("Using WebSocket for batch delete with filter"),window.wsClient.isConnected()||(console.log("WebSocket not connected, connecting now..."),window.wsClient.connect()),!window.batchDeleteClient)if(typeof BatchDeleteRecordingsClient<"u")console.log("Creating new BatchDeleteRecordingsClient for filtered delete"),window.batchDeleteClient=new BatchDeleteRecordingsClient(window.wsClient);else return console.warn("BatchDeleteRecordingsClient not available, falling back to HTTP"),x.deleteAllFilteredRecordingsHttp(t);console.log("Using WebSocket client ID for filtered batch delete:",window.wsClient.getClientId());const a=new Promise((i,s)=>{setTimeout(()=>{s(new Error("Operation timed out or server crashed. Some recordings may have been deleted."))},6e4)});try{return await Promise.race([window.batchDeleteClient.deleteWithProgress({filter:t,totalCount:r}),a])}catch(i){return console.error("WebSocket error or timeout:",i),setTimeout(()=>{typeof loadRecordings=="function"&&loadRecordings()},1e3),n(i)}}else return console.log("WebSocket client not available, using HTTP for batch delete with filter"),x.deleteAllFilteredRecordingsHttp(t)}catch(t){return console.error("Error in delete all operation:",t),m("Error in delete all operation: "+t.message),{succeeded:0,failed:0}}},deleteAllFilteredRecordingsHttp:async e=>{try{const r=await(await q("/api/recordings/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filter:e}),timeout:12e4,retries:1,retryDelay:3e3})).json(),n=r.succeeded,a=r.failed;return n>0&&a===0?m("Successfully deleted ".concat(n," recording").concat(n!==1?"s":"")):n>0&&a>0?m("Deleted ".concat(n," recording").concat(n!==1?"s":"",", but failed to delete ").concat(a)):m("Failed to delete ".concat(a," recording").concat(a!==1?"s":"")),r}catch(t){return console.error("Error in HTTP delete all operation:",t),m("Error in delete all operation: "+t.message),{succeeded:0,failed:0}}},checkRecordingHasDetections:async e=>{if(!e||!e.id||!e.stream||!e.start_time||!e.end_time)return!1;try{const t=Math.floor(new Date(e.start_time).getTime()/1e3),r=Math.floor(new Date(e.end_time).getTime()/1e3),n=new URLSearchParams({start:t,end:r}),a=await M("/api/detection/results/".concat(e.stream,"?").concat(n.toString()),{timeout:1e4,retries:1,retryDelay:500});return a.detections&&a.detections.length>0}catch(t){return console.error("Error checking detections:",t),!1}},getRecordingDetections:async e=>{if(!e||!e.id||!e.stream||!e.start_time||!e.end_time)return[];try{const t=Math.floor(new Date(e.start_time).getTime()/1e3),r=Math.floor(new Date(e.end_time).getTime()/1e3),n=new URLSearchParams({start:t,end:r});return(await M("/api/detection/results/".concat(e.stream,"?").concat(n.toString()),{timeout:15e3,retries:1,retryDelay:1e3})).detections||[]}catch(t){return console.error("Error getting detections:",t),[]}},playRecording:(e,t)=>{if(console.log("Play recording clicked:",e),!e.id){console.error("Recording has no id property:",e),m("Error: Recording has no id property");return}const r="/api/recordings/play/".concat(e.id),n="".concat(e.stream," - ").concat(K.formatDateTime(e.start_time)),a="/api/recordings/download/".concat(e.id);console.log("Video URL:",r),console.log("Title:",n),console.log("Download URL:",a),t(r,n,a),console.log("Video modal should be shown now")},downloadRecording:e=>{const t="/api/recordings/download/".concat(e.id),r=document.createElement("a");r.href=t,r.download="".concat(e.stream,"_").concat(new Date(e.start_time).toISOString().replace(/[:.]/g,"-"),".mp4"),document.body.appendChild(r),r.click(),document.body.removeChild(r),m("Download started")}},P={getFiltersFromUrl:()=>{const e=new URLSearchParams(window.location.search);if(!e.has("dateRange")&&!e.has("page")&&!e.has("sort")&&!e.has("detection")&&!e.has("stream"))return null;const t={filters:{dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"},page:1,limit:20,sort:"start_time",order:"desc"};return e.has("dateRange")&&(t.filters.dateRange=e.get("dateRange"),t.filters.dateRange==="custom"&&(e.has("startDate")&&(t.filters.startDate=e.get("startDate")),e.has("startTime")&&(t.filters.startTime=e.get("startTime")),e.has("endDate")&&(t.filters.endDate=e.get("endDate")),e.has("endTime")&&(t.filters.endTime=e.get("endTime")))),e.has("stream")&&(t.filters.streamId=e.get("stream")),e.has("detection")&&e.get("detection")==="1"&&(t.filters.recordingType="detection"),e.has("page")&&(t.page=parseInt(e.get("page"),10)),e.has("limit")&&(t.limit=parseInt(e.get("limit"),10)),e.has("sort")&&(t.sort=e.get("sort")),e.has("order")&&(t.order=e.get("order")),t},getActiveFiltersDisplay:e=>{const t=[];if(e.dateRange!=="last7days"||e.streamId!=="all"||e.recordingType!=="all"){if(e.dateRange!=="last7days"){let n="";switch(e.dateRange){case"today":n="Today";break;case"yesterday":n="Yesterday";break;case"last30days":n="Last 30 Days";break;case"custom":n="".concat(e.startDate," to ").concat(e.endDate);break}t.push({key:"dateRange",label:"Date: ".concat(n)})}e.streamId!=="all"&&t.push({key:"streamId",label:"Stream: ".concat(e.streamId)}),e.recordingType!=="all"&&t.push({key:"recordingType",label:"Detection Events Only"})}return t},loadFiltersFromUrl:(e,t,r,n,a,i)=>{const s=new URLSearchParams(window.location.search),d={...e};s.has("dateRange")&&(d.dateRange=s.get("dateRange"),d.dateRange==="custom"&&(s.has("startDate")&&(d.startDate=s.get("startDate")),s.has("startTime")&&(d.startTime=s.get("startTime")),s.has("endDate")&&(d.endDate=s.get("endDate")),s.has("endTime")&&(d.endTime=s.get("endTime")))),s.has("stream")&&(d.streamId=s.get("stream")),s.has("detection")&&s.get("detection")==="1"&&(d.recordingType="detection"),r(d),s.has("page")&&n(g=>({...g,currentPage:parseInt(s.get("page"),10)})),s.has("limit")&&n(g=>({...g,pageSize:parseInt(s.get("limit"),10)})),s.has("sort")&&a(s.get("sort")),s.has("order")&&i(s.get("order"))},updateUrlWithFilters:(e,t,r,n)=>{const a=new URLSearchParams(window.location.search);a.set("t",Date.now().toString()),a.set("dateRange",e.dateRange),e.dateRange==="custom"?(a.set("startDate",e.startDate),a.set("startTime",e.startTime),a.set("endDate",e.endDate),a.set("endTime",e.endTime)):(a.delete("startDate"),a.delete("startTime"),a.delete("endDate"),a.delete("endTime")),e.streamId!=="all"?a.set("stream",e.streamId):a.delete("stream"),e.recordingType==="detection"?a.set("detection","1"):a.delete("detection"),a.set("page",t.currentPage.toString()),a.set("limit",t.pageSize.toString()),a.set("sort",r),a.set("order",n);const i="".concat(window.location.pathname,"?").concat(a.toString());window.history.pushState({path:i},"",i);const s=i;window.onbeforeunload=function(){window.history.replaceState({path:s},"",s)}}};function ot(){const[e,t]=D([]),[r,n]=D([]),[a,i]=D(!0),[s,d]=D("start_time"),[g,y]=D("desc"),[c,p]=D({dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"}),[w,S]=D({currentPage:1,pageSize:20,totalItems:0,totalPages:1,startItem:0,endItem:0}),[H,k]=D(!1),[ve,xe]=D([]),[W,L]=D({}),[Y,j]=D(!1),[De,G]=D(!1),[X,ke]=D("selected"),$e=Ne(null);Q();const{data:F,isLoading:st,error:z}=x.hooks.useStreams();E(()=>{F&&Array.isArray(F)&&n(F)},[F]),E(()=>{z&&(console.error("Error loading streams for filter:",z),m("Error loading streams: "+z.message))},[z]),E(()=>{if(typeof se<"u"){if(window.wsClient=new se,console.log("WebSocket client initialized at application level"),window.wsClient){console.log("Initial WebSocket connection state:",{connected:window.wsClient.isConnected(),clientId:window.wsClient.getClientId()});const l=window.wsClient.connect;window.wsClient.connect=function(){const h=l.apply(this,arguments);if(this.socket){const f=this.socket.onopen;this.socket.onopen=R=>{console.log("WebSocket connection opened at application level"),f&&f.call(this,R)};const v=this.socket.onerror;this.socket.onerror=R=>{console.error("WebSocket error at application level:",R),v&&v.call(this,R)};const T=this.socket.onclose;this.socket.onclose=R=>{console.log("WebSocket connection closed at application level: ".concat(R.code," ").concat(R.reason)),T&&T.call(this,R)};const I=this.socket.onmessage;this.socket.onmessage=R=>{R.data.includes('"type":"welcome"')||console.log("WebSocket message received at application level"),I&&I.call(this,R)}}return h};const u=window.wsClient.handleMessage;window.wsClient.handleMessage=function(h){const f=this.clientId;u.call(this,h);const v=this.clientId;f!==v&&v&&console.log("WebSocket client ID changed at application level: ".concat(v))}}typeof ie<"u"&&(window.batchDeleteClient=new ie(window.wsClient),console.log("Batch delete client initialized"))}Z();const o=P.getFiltersFromUrl();if(o){console.log("Found URL filters:",o);const l=new URLSearchParams(window.location.search);l.has("detection")&&l.get("detection")==="1"&&(o.filters.recordingType="detection"),p(o.filters),S(u=>({...u,currentPage:o.page||1,pageSize:o.limit||20})),d(o.sort||"start_time"),y(o.order||"desc")}return N(),window.addEventListener("resize",N),()=>{window.removeEventListener("resize",N)}},[]),E(()=>{Ie()},[c]);const Z=()=>{const o=new Date,l=new Date(o);l.setDate(o.getDate()-7),p(u=>({...u,endDate:o.toISOString().split("T")[0],startDate:l.toISOString().split("T")[0]}))},{data:B,isLoading:Se,error:O,refetch:it}=x.hooks.useRecordings(c,w,s,g);E(()=>{if(B){const o=B.recordings||[];t(o),ee(o.length>0),B.pagination&&te(B,w.currentPage)}},[B]),E(()=>{O&&(console.error("Error loading recordings:",O),m("Error loading recordings: "+O.message),ee(!1))},[O]);const N=()=>{window.innerWidth<768?i(!1):i(!0)},Ce=()=>{i(!a)},[Re,ee]=D(!1),Te=(o=w.currentPage,l=!0)=>{console.log("Loading recordings with filters:",JSON.stringify(c));const u={...w,currentPage:o};S(u),l&&P.updateUrlWithFilters(c,u,s,g)},te=(o,l)=>{if(l=l||w.currentPage,o.pagination){const u=o.pagination.limit||20,h=o.pagination.total||0,f=o.pagination.pages||1;let v=0,T=0;o.recordings.length>0&&(v=(l-1)*u+1,T=Math.min(v+o.recordings.length-1,h)),console.log("Pagination update:",{currentPage:l,pageSize:u,totalItems:h,totalPages:f,startItem:v,endItem:T,recordingsLength:o.recordings.length}),S(I=>({...I,totalItems:h,totalPages:f,pageSize:u,startItem:v,endItem:T}))}else{const u=w.pageSize,h=o.total||0,f=Math.ceil(h/u)||1;let v=0,T=0;o.recordings.length>0&&(v=(l-1)*u+1,T=Math.min(v+o.recordings.length-1,h)),console.log("Pagination update (fallback):",{currentPage:l,pageSize:u,totalItems:h,totalPages:f,startItem:v,endItem:T,recordingsLength:o.recordings.length}),S(I=>({...I,totalItems:h,totalPages:f,startItem:v,endItem:T}))}},Pe=o=>{const l=o.target.value;if(p(u=>({...u,dateRange:l})),l==="custom"&&(!c.startDate||!c.endDate)){const u=new Date,h=new Date(u);h.setDate(u.getDate()-7),p(f=>({...f,endDate:u.toISOString().split("T")[0],startDate:h.toISOString().split("T")[0]}))}},Ie=()=>{const o=P.getActiveFiltersDisplay(c);k(o.length>0),xe(o)},ae=(o=!0)=>{o&&S(l=>({...l,currentPage:1})),P.updateUrlWithFilters(c,o?{...w,currentPage:1}:w,s,g)},Ee=()=>{const o={dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"},l=new Date,u=new Date(l);u.setDate(l.getDate()-7),o.endDate=l.toISOString().split("T")[0],o.startDate=u.toISOString().split("T")[0],p(o),S(f=>({...f,currentPage:1})),d("start_time"),y("desc");const h=window.location.pathname;window.history.pushState({path:h},"",h)},Be=o=>{switch(o){case"dateRange":p(l=>({...l,dateRange:"last7days"}));break;case"streamId":p(l=>({...l,streamId:"all"}));break;case"recordingType":p(l=>({...l,recordingType:"all"}));break}ae()},Me=o=>{s===o?y(g==="asc"?"desc":"asc"):(y(o==="start_time"?"desc":"asc"),d(o)),S(l=>({...l,currentPage:1})),P.updateUrlWithFilters(c,{...w,currentPage:1},o,o===s?g==="asc"?"desc":"asc":o==="start_time"?"desc":"asc")},Le=o=>{o<1||o>w.totalPages||(S(l=>({...l,currentPage:o})),P.updateUrlWithFilters(c,{...w,currentPage:o},s,g))},Fe=o=>{L(l=>({...l,[o]:!l[o]}))},ze=()=>{const o=!Y;j(o);const l={};o&&e.forEach(u=>{l[u.id]=!0}),L(l)},re=()=>Object.values(W).filter(Boolean).length,Oe=o=>{ke(o),G(!0)},ne=()=>{G(!1)},Ue=async()=>{ne();const o=new URLSearchParams(window.location.search),l=o.get("sort")||s,u=o.get("order")||g,h=parseInt(o.get("page"),10)||w.currentPage;if(X==="selected"){const f=await x.deleteSelectedRecordings(W);L({}),j(!1),f.succeeded>0&&_e(l,u,h)}else{const f=await x.deleteAllFilteredRecordings(c);L({}),j(!1),f.succeeded>0&&Te()}},_e=(o,l,u)=>{d(o),y(l),S(h=>({...h,currentPage:u})),setTimeout(()=>{const h={...w,currentPage:u};P.updateUrlWithFilters(c,h,o,l),x.loadRecordings(c,h,o,l).then(f=>{console.log("Recordings data received:",f),t(f.recordings||[]),te(f,u)}).catch(f=>{console.error("Error loading recordings:",f),m("Error loading recordings: "+f.message)})},0)},{mutate:Ae}=x.hooks.useDeleteRecording();return b("section",{id:"recordings-page",class:"page",children:[b("div",{class:"page-header flex justify-between items-center mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow",children:[b("div",{class:"flex items-center",children:[b("h2",{class:"text-xl font-bold",children:"Recordings"}),b("div",{class:"ml-4 flex",children:[b("a",{href:"recordings.html",class:"px-3 py-1 bg-blue-500 text-white rounded-l-md",children:"Table View"}),b("a",{href:"timeline.html",class:"px-3 py-1 bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-400 dark:hover:bg-gray-600 rounded-r-md",children:"Timeline View"})]})]}),b("button",{id:"toggle-filters-btn",class:"p-2 rounded-full bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none",title:"Toggle Filters",onClick:Ce,children:b("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:b("path",{"fill-rule":"evenodd",d:"M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z","clip-rule":"evenodd"})})})]}),b("div",{class:"recordings-layout flex flex-col md:flex-row gap-4 w-full",children:[b(tt,{filters:c,setFilters:p,pagination:w,setPagination:S,streams:r,filtersVisible:a,applyFilters:ae,resetFilters:Ee,handleDateRangeChange:Pe,setDefaultDateRange:Z}),b("div",{class:"recordings-content flex-1",children:[b(at,{activeFiltersDisplay:ve,removeFilter:Be,hasActiveFilters:H}),b(Xe,{isLoading:Se,hasData:Re,loadingMessage:"Loading recordings...",emptyMessage:"No recordings found matching your criteria",children:[b(rt,{recordings:e,sortField:s,sortDirection:g,sortBy:Me,selectedRecordings:W,toggleRecordingSelection:Fe,selectAll:Y,toggleSelectAll:ze,getSelectedCount:re,openDeleteModal:Oe,playRecording:o=>{x.playRecording(o,Ke)},downloadRecording:o=>{x.downloadRecording(o)},deleteRecording:o=>{confirm("Are you sure you want to delete this recording from ".concat(o.stream,"?"))&&Ae(o.id)},recordingsTableBodyRef:$e,pagination:w}),b(nt,{pagination:w,goToPage:Le})]})]})]}),b(Je,{isOpen:De,onClose:ne,onConfirm:Ue,mode:X,count:re()})]})}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("main-content");e&&Ve(b(Qe,{client:qe,children:[b(Ye,{}),b(ot,{}),b(Ge,{})]}),e)});export{ut as __vite_legacy_guard};
//# sourceMappingURL=recordings-DjS63dOR.js.map
