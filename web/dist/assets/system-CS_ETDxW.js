var O=Object.freeze,be=Object.defineProperty;var d=(e,t)=>O(be(e,"raw",{value:O(t||e.slice())}));import{d as x,A as j,y,e as pe,c as D,f as F,u as m,E as fe,q as we,Q as ve}from"./query-client-mfCUf3pQ.js";/* empty css               */import{h as c,c as k,H as ye,F as he}from"./Footer-BhxJVGxY.js";import{C as ke}from"./LoadingIndicator-DlQOsIse.js";import{W as A}from"./websocket-client-DzZLM-9M.js";function Ne(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}var T;function xe({restartSystem:e,shutdownSystem:t,isRestarting:r,isShuttingDown:n}){return c(T||(T=d(['\n    <div class="page-header flex justify-between items-center mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow">\n      <h2 class="text-xl font-bold">System</h2>\n      <div class="controls space-x-2">\n        <button \n          id="restart-btn" \n          class="px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed"\n          onClick=',"\n          disabled=",'\n        >\n          Restart\n        </button>\n        <button \n          id="shutdown-btn" \n          class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed"\n          onClick=',"\n          disabled=","\n        >\n          Shutdown\n        </button>\n      </div>\n    </div>\n  "])),e,r||n,t,r||n)}var V;function Se({systemInfo:e,formatUptime:t}){var r,n,i,s;return c(V||(V=d(['\n    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4">\n      <h3 class="text-lg font-semibold mb-4 pb-2 border-b border-gray-200 dark:border-gray-700">System Information</h3>\n      <div class="space-y-2">\n        <div class="flex justify-between">\n          <span class="font-medium">Version:</span>\n          <span>','</span>\n        </div>\n        <div class="flex justify-between">\n          <span class="font-medium">Uptime:</span>\n          <span>','</span>\n        </div>\n        <div class="flex justify-between">\n          <span class="font-medium">CPU Model:</span>\n          <span>','</span>\n        </div>\n        <div class="flex justify-between">\n          <span class="font-medium">CPU Cores:</span>\n          <span>','</span>\n        </div>\n        <div class="flex justify-between items-center">\n          <span class="font-medium">CPU Usage:</span>\n          <div class="w-32 bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">\n            <div class="bg-blue-600 h-2.5 rounded-full" style=',"></div>\n          </div>\n          <span>","</span>\n        </div>\n      </div>\n    </div>\n  "])),e.version||"Unknown",e.uptime?t(e.uptime):"Unknown",((r=e.cpu)==null?void 0:r.model)||"Unknown",((n=e.cpu)==null?void 0:n.cores)||"Unknown","width: ".concat(((i=e.cpu)==null?void 0:i.usage)||0,"%"),(s=e.cpu)!=null&&s.usage?"".concat(e.cpu.usage.toFixed(1),"%"):"Unknown")}var q;function $e({systemInfo:e,formatBytes:t}){var a,b,v,f,p,L,h,M,E,P,W,U;const r=((a=e.memory)==null?void 0:a.used)||0,n=((b=e.go2rtcMemory)==null?void 0:b.used)||0,i=((v=e.memory)==null?void 0:v.total)||0,s=r+n,l=i?(s/i*100).toFixed(1):0,g=s?(r/s*100).toFixed(1):0,o=s?(n/s*100).toFixed(1):0;return c(q||(q=d(['\n    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4">\n      <h3 class="text-lg font-semibold mb-4 pb-2 border-b border-gray-200 dark:border-gray-700">Memory & Storage</h3>\n      <div class="space-y-4">\n        <div>\n          <div class="flex justify-between mb-1">\n            <span class="font-medium">Process Memory:</span>\n            <div>\n              <span class="inline-block px-2 py-0.5 mr-1 text-xs rounded bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">\n                LightNVR: ','\n              </span>\n              <span class="inline-block px-2 py-0.5 text-xs rounded bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">\n                go2rtc: ','\n              </span>\n            </div>\n          </div>\n          <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1">\n            <span>Combined: '," / ","</span>\n            <span>",'% of total memory</span>\n          </div>\n          <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 overflow-hidden">\n            <div class="flex h-full" style=','>\n              <div class="bg-blue-600 h-2.5" style=','></div>\n              <div class="bg-green-500 h-2.5" style=','></div>\n            </div>\n          </div>\n        </div>\n        <div>\n          <div class="flex justify-between mb-1">\n            <span class="font-medium">System Memory:</span>\n            <span>'," / ",'</span>\n          </div>\n          <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">\n            <div class="bg-blue-600 h-2.5 rounded-full" style=','></div>\n          </div>\n        </div>\n        <div>\n          <div class="flex justify-between mb-1">\n            <span class="font-medium">LightNVR Storage:</span>\n            <span>'," / ",'</span>\n          </div>\n          <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">\n            <div class="bg-blue-600 h-2.5 rounded-full" style=','></div>\n          </div>\n        </div>\n        <div>\n          <div class="flex justify-between mb-1">\n            <span class="font-medium">System Storage:</span>\n            <span>'," / ",'</span>\n          </div>\n          <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">\n            <div class="bg-blue-600 h-2.5 rounded-full" style=',"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  "])),t(r),t(n),t(s),t(i),l,"width: ".concat(l,"%"),"width: ".concat(g,"%"),"width: ".concat(o,"%"),(f=e.systemMemory)!=null&&f.used?t(e.systemMemory.used):"0",(p=e.systemMemory)!=null&&p.total?t(e.systemMemory.total):"0","width: ".concat((L=e.systemMemory)!=null&&L.total?(e.systemMemory.used/e.systemMemory.total*100).toFixed(1):0,"%"),(h=e.disk)!=null&&h.used?t(e.disk.used):"0",(M=e.disk)!=null&&M.total?t(e.disk.total):"0","width: ".concat((E=e.disk)!=null&&E.total?(e.disk.used/e.disk.total*100).toFixed(1):0,"%"),(P=e.systemDisk)!=null&&P.used?t(e.systemDisk.used):"0",(W=e.systemDisk)!=null&&W.total?t(e.systemDisk.total):"0","width: ".concat((U=e.systemDisk)!=null&&U.total?(e.systemDisk.used/e.systemDisk.total*100).toFixed(1):0,"%"))}var H,B,I,K,Q;function Ce({systemInfo:e,formatBytes:t}){var g;if(!e.streamStorage||!Array.isArray(e.streamStorage)||e.streamStorage.length===0)return c(H||(H=d(['\n      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4">\n        <h3 class="text-lg font-semibold mb-4 pb-2 border-b border-gray-200 dark:border-gray-700">Stream Storage</h3>\n        <div class="text-gray-500 dark:text-gray-400 text-center py-4">\n          No stream storage information available\n        </div>\n      </div>\n    '])));const r=e.streamStorage.reduce((o,a)=>o+a.size,0),n=((g=e.disk)==null?void 0:g.total)||0,i=n?(r/n*100).toFixed(1):0,s=e.streamStorage.map(o=>({name:o.name,size:o.size,count:o.count,slicePercent:r?(o.size/r*100).toFixed(1):0}));s.sort((o,a)=>a.size-o.size);const l=["bg-blue-600","bg-green-500","bg-yellow-500","bg-red-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-teal-500"];return c(Q||(Q=d(['\n    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4">\n      <h3 class="text-lg font-semibold mb-4 pb-2 border-b border-gray-200 dark:border-gray-700">Stream Storage</h3>\n      \n      <div class="space-y-4">\n        <div>\n          <div class="flex justify-between mb-1">\n            <span class="font-medium">Storage per Stream:</span>\n            <div class="flex flex-wrap justify-end gap-1">\n              ','\n            </div>\n          </div>\n          \n          <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1">\n            <span>Combined: '," / ","</span>\n            <span>",'% of total storage</span>\n          </div>\n          \n          <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 overflow-hidden">\n            <div class="flex h-full" style=',">\n              ",'\n            </div>\n          </div>\n          \n          <div class="mt-4">\n            <h4 class="font-medium mb-2">Stream Details:</h4>\n            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">\n              ',"\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  "])),s.map((o,a)=>c(B||(B=d(['\n                <span class="inline-block px-2 py-0.5 text-xs rounded '," ",'">\n                  ',": ","\n                </span>\n              "])),l[a%l.length].replace("bg-","bg-opacity-20 bg-"),l[a%l.length].replace("bg-","text-"),o.name,t(o.size))),t(r),t(n),i,"width: ".concat(i,"%"),s.map((o,a)=>c(I||(I=d(['\n                <div class="',' h-2.5" style=',"></div>\n              "])),l[a%l.length],"width: ".concat(o.slicePercent,"%"))),s.map((o,a)=>c(K||(K=d(['\n                <a href="recordings.html?stream=','" \n                   class="flex items-center p-2 rounded bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors cursor-pointer">\n                  <div class="w-3 h-3 rounded-full mr-2 ','"></div>\n                  <div>\n                    <div class="font-medium">','</div>\n                    <div class="text-xs text-gray-500 dark:text-gray-400">\n                      '," (","%) â€¢ "," recordings\n                    </div>\n                  </div>\n                </a>\n              "])),encodeURIComponent(o.name),l[a%l.length],o.name,t(o.size),o.slicePercent,o.count)))}var G,Y,J;function Le({systemInfo:e}){var t,r;return c(J||(J=d(['\n    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4">\n      <h3 class="text-lg font-semibold mb-4 pb-2 border-b border-gray-200 dark:border-gray-700">Network Interfaces</h3>\n      <div class="space-y-2">\n        ',"\n      </div>\n    </div>\n  "])),(r=(t=e.network)==null?void 0:t.interfaces)!=null&&r.length?e.network.interfaces.map(n=>c(G||(G=d(["\n          <div key=",' class="mb-2 pb-2 border-b border-gray-100 dark:border-gray-700 last:border-0">\n            <div class="flex justify-between">\n              <span class="font-medium">',":</span>\n              <span>",'</span>\n            </div>\n            <div class="text-sm text-gray-500 dark:text-gray-400">\n              MAC: '," | ","\n            </div>\n          </div>\n        "])),n.name,n.name,n.address||"No IP",n.mac||"Unknown",n.up?"Up":"Down")):c(Y||(Y=d(['<div class="text-gray-500 dark:text-gray-400">No network interfaces found</div>']))))}var Z;function Me({systemInfo:e,formatBytes:t}){var r,n,i,s;return c(Z||(Z=d(['\n    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4">\n      <h3 class="text-lg font-semibold mb-4 pb-2 border-b border-gray-200 dark:border-gray-700">Streams & Recordings</h3>\n      <div class="space-y-2">\n        <div class="flex justify-between">\n          <span class="font-medium">Active Streams:</span>\n          <span>'," / ",'</span>\n        </div>\n        <div class="flex justify-between">\n          <span class="font-medium">Recordings:</span>\n          <span>','</span>\n        </div>\n        <div class="flex justify-between">\n          <span class="font-medium">Recordings Size:</span>\n          <span>',"</span>\n        </div>\n      </div>\n    </div>\n  "])),((r=e.streams)==null?void 0:r.active)||0,((n=e.streams)==null?void 0:n.total)||0,((i=e.recordings)==null?void 0:i.count)||0,(s=e.recordings)!=null&&s.size?t(e.recordings.size):"0")}var X,ee,te,se,oe,ne;function We(e){if(e==null)return c(X||(X=d(['<span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">UNKNOWN</span>'])));const t=String(e).toLowerCase().trim();if(t==="error"||t==="err")return c(ee||(ee=d(['<span class="px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">ERROR</span>'])));if(t==="warning"||t==="warn")return c(te||(te=d(['<span class="px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">WARN</span>'])));if(t==="info")return c(se||(se=d(['<span class="px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">INFO</span>'])));if(t==="debug"||t==="dbg")return c(oe||(oe=d(['<span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">DEBUG</span>'])));{const r=String(e).toUpperCase();return c(ne||(ne=d(['<span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">',"</span>"])),r)}}var re,ie,le;function Ue({logs:e,logLevel:t,logCount:r,setLogLevel:n,setLogCount:i,loadLogs:s,clearLogs:l}){return c(le||(le=d(['\n    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-4">\n      <div class="flex justify-between items-center mb-4 pb-2 border-b border-gray-200 dark:border-gray-700">\n        <h3 class="text-lg font-semibold">System Logs</h3>\n        <div class="flex space-x-2">\n          <select \n            id="log-level" \n            class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            value=',"\n            onChange=",'\n          >\n            <option value="error">Error</option>\n            <option value="warning">Warning</option>\n            <option value="info">Info</option>\n            <option value="debug">Debug</option>\n          </select>\n          <select \n            id="log-count" \n            class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n            value=',"\n            onChange=",'\n          >\n            <option value="50">50 lines</option>\n            <option value="100">100 lines</option>\n            <option value="200">200 lines</option>\n            <option value="500">500 lines</option>\n          </select>\n          <button \n            id="refresh-logs-btn" \n            class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"\n            onClick=','\n          >\n            Refresh\n          </button>\n          <button \n            id="clear-logs-btn" \n            class="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"\n            onClick=','\n          >\n            Clear Logs\n          </button>\n        </div>\n      </div>\n      <div class="logs-container bg-gray-100 dark:bg-gray-900 rounded p-4 overflow-auto max-h-96 font-mono text-sm">\n        ',"\n      </div>\n    </div>\n  "])),t,g=>{const o=g.target.value;console.log("LogsView: Log level changed from ".concat(t," to ").concat(o)),n(o)},r,g=>i(parseInt(g.target.value,10)),s,l,e.length===0?c(re||(re=d(['\n          <div class="text-gray-500 dark:text-gray-400">No logs found</div>\n        ']))):e.map((g,o)=>c(ie||(ie=d(["\n          <div key=",' class="log-entry mb-1 last:mb-0">\n            <span class="text-gray-500 dark:text-gray-400">','</span>\n            <span class="mx-2">',"</span>\n            <span class=",">","</span>\n          </div>\n        "])),o,g.timestamp,We(g.level),"log-message ".concat(g.level==="error"?"text-red-600 dark:text-red-400":""),g.message)))}function N(e,t=1){if(e===0)return"0 Bytes";const r=1024,n=t<0?0:t,i=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,s)).toFixed(n))+" "+i[s]}function Ee(e){const t=Math.floor(e/86400),r=Math.floor(e%86400/3600),n=Math.floor(e%3600/60),i=Math.floor(e%60);let s="";return t>0&&(s+="".concat(t,"d ")),(r>0||t>0)&&(s+="".concat(r,"h ")),(n>0||r>0||t>0)&&(s+="".concat(n,"m ")),s+="".concat(i,"s"),s}function Pe(e,t){if(String(t||"").toLowerCase()==="debug")return!0;let r=2,n=2;const i=String(e||"").toLowerCase(),s=String(t||"").toLowerCase();return i==="error"?r=0:i==="warning"||i==="warn"?r=1:i==="info"?r=2:i==="debug"&&(r=3),s==="error"?n=0:s==="warning"||s==="warn"?n=1:s==="info"?n=2:s==="debug"&&(n=3),r<=n}function Re({logLevel:e,logCount:t,onLogsReceived:r}){const[n,i]=x(!1),s=j(null),l=j(null);y(()=>{const o=localStorage.getItem("lastLogTimestamp");o&&(console.log("Loaded last log timestamp from localStorage:",o),l.current=o)},[]);const g=()=>{if(!window.wsClient){console.log("WebSocket client not available, will retry on next poll");return}if(!window.wsClient.isConnected()){console.log("WebSocket not connected, attempting to connect"),window.wsClient.connect();return}if(!document.getElementById("system-page")){console.log("Not on system page, skipping log fetch");return}console.log("Fetching logs via WebSocket with level: debug (to get all logs, will filter on frontend)");const o={level:"debug",count:t};l.current&&(o.last_timestamp=l.current),window.wsClient.getClientId&&(o.client_id=window.wsClient.getClientId()),console.log("Sending fetch request with payload:",o);try{window.wsClient.send("fetch","system/logs",o)?console.log("Fetch request sent successfully"):console.warn("Failed to send fetch request, will retry on next poll")}catch(a){console.error("Error sending fetch request:",a)}};return y(()=>{if(window.wsClient)return o();{console.log("WebSocket client not available, will check again later");const a=setInterval(()=>{window.wsClient&&(console.log("WebSocket client now available, setting up handlers"),clearInterval(a),o())},1e3);return()=>{clearInterval(a)}}function o(){console.log("Setting up WebSocket handlers for logs");const a=b=>{if(console.log("Received logs update via WebSocket:",b),!document.getElementById("system-page")){console.log("Not on system page, ignoring log update");return}if(b&&b.logs&&Array.isArray(b.logs)){const v=b.logs.map(f=>{const p={timestamp:f.timestamp||"Unknown",level:f.level||"info",message:f.message||""};return p.level&&(p.level=p.level.toLowerCase()),p.level==="warn"&&(p.level="warning"),p});b.latest_timestamp&&(l.current=b.latest_timestamp,localStorage.setItem("lastLogTimestamp",b.latest_timestamp),console.log("Updated and saved last log timestamp:",b.latest_timestamp)),v.length>0?(console.log("Received ".concat(v.length," logs via WebSocket")),v.sort((f,p)=>new Date(p.timestamp)-new Date(f.timestamp)),r(v)):console.log("No logs received via WebSocket")}};return console.log("Registering handler for system/logs via WebSocket (once on mount)"),window.wsClient.on("update","system/logs",a),()=>{console.log("Unregistering handler for system/logs via WebSocket (component unmounting)"),window.wsClient.off("update","system/logs"),s.current&&(clearInterval(s.current),s.current=null)}}},[]),y(()=>{if(n&&!s.current){if(console.log("Starting log polling"),window.wsClient&&typeof window.wsClient.subscribe=="function"){console.log("Subscribing to system/logs via WebSocket for polling");const o={level:"debug",...l.current?{since:l.current}:{}};window.wsClient.subscribe("system/logs",o),console.log("Subscribed to system/logs with level: debug and last_timestamp: ".concat(l.current||"NULL"))}g(),console.log("Setting up polling interval for logs (every 5 seconds)"),s.current=setInterval(()=>{console.log("Polling interval triggered, fetching logs..."),g()},5e3)}else!n&&s.current&&(console.log("Stopping log polling"),window.wsClient&&typeof window.wsClient.unsubscribe=="function"&&(console.log("Unsubscribing from system/logs via WebSocket"),window.wsClient.unsubscribe("system/logs")),clearInterval(s.current),s.current=null);return()=>{s.current&&(clearInterval(s.current),s.current=null),window.wsClient&&typeof window.wsClient.unsubscribe=="function"&&(console.log("Unsubscribing from system/logs via WebSocket on cleanup"),window.wsClient.unsubscribe("system/logs"))}},[n,e]),y(()=>{const o=()=>{console.log("Received refresh-logs-websocket event, triggering fetch"),g()};return window.addEventListener("refresh-logs-websocket",o),()=>{window.removeEventListener("refresh-logs-websocket",o)}},[]),y(()=>(console.log("LogsPoller: Setting up polling with log level ".concat(e)),i(!1),setTimeout(()=>{i(!0)},100),()=>{console.log("LogsPoller: Cleaning up on unmount"),i(!1)}),[e,t]),null}function De(){const[e,t]=x({version:"",uptime:"",cpu:{model:"",cores:0,usage:0},memory:{total:0,used:0,free:0},go2rtcMemory:{total:0,used:0,free:0},systemMemory:{total:0,used:0,free:0},disk:{total:0,used:0,free:0},systemDisk:{total:0,used:0,free:0},network:{interfaces:[]},streams:{active:0,total:0},recordings:{count:0,size:0}}),[r,n]=x([]),[i,s]=x("debug"),l=j("debug"),[g,o]=x(100),[a,b]=x(!1),[v,f]=x(!1),[p,L]=x(!1),{data:h,isLoading:M,error:E,refetch:P}=pe(["systemInfo"],"/api/system/info",{timeout:15e3,retries:2,retryDelay:1e3}),W=D({mutationKey:["clearLogs"],mutationFn:async()=>await F("/api/system/logs/clear",{method:"POST",timeout:1e4,retries:1}),onSuccess:()=>{k("Logs cleared successfully"),n([])},onError:u=>{console.error("Error clearing logs:",u),k("Error clearing logs: ".concat(u.message))}}),U=u=>{console.log("SystemView: Setting log level from ".concat(i," to ").concat(u)),s(u),l.current=u},ae=u=>{console.log("SystemView received new logs:",u.length);const R=l.current,C=u.filter(S=>Pe(S.level,R));n(C)};y(()=>{h&&L(!0)},[h]);const de=D({mutationFn:async()=>await F("/api/system/restart",{method:"POST",timeout:3e4,retries:0}),onMutate:()=>{b(!0),k("Restarting system...")},onSuccess:()=>{k("System is restarting. Please wait..."),setTimeout(()=>{window.location.reload()},1e4)},onError:u=>{console.error("Error restarting system:",u),k("Error restarting system: ".concat(u.message)),b(!1)}}),ce=D({mutationFn:async()=>await F("/api/system/shutdown",{method:"POST",timeout:3e4,retries:0}),onMutate:()=>{f(!0),k("Shutting down system...")},onSuccess:()=>{k("System is shutting down. You will need to manually restart it.")},onError:u=>{console.error("Error shutting down system:",u),k("Error shutting down system: ".concat(u.message)),f(!1)}});y(()=>{h&&t(h)},[h]),y(()=>()=>{window.wsClient&&typeof window.wsClient.unsubscribe=="function"&&(console.log("Cleaning up any WebSocket subscriptions on unmount"),window.wsClient.unsubscribe("system/logs"))},[]);const ge=()=>{confirm("Are you sure you want to clear all logs?")&&W.mutate()},ue=()=>{confirm("Are you sure you want to restart the system?")&&de.mutate()},me=()=>{confirm("Are you sure you want to shut down the system?")&&ce.mutate()};return y(()=>{if(typeof A<"u"){if(window.wsClient=new A,console.log("WebSocket client initialized at application level"),window.wsClient){console.log("Initial WebSocket connection state:",{connected:window.wsClient.isConnected(),clientId:window.wsClient.getClientId()});const u=window.wsClient.connect;window.wsClient.connect=function(){const C=u.apply(this,arguments);if(this.socket){const S=this.socket.onopen;this.socket.onopen=w=>{console.log("WebSocket connection opened at application level"),S&&S.call(this,w)};const $=this.socket.onerror;this.socket.onerror=w=>{console.error("WebSocket error at application level:",w),$&&$.call(this,w)};const z=this.socket.onclose;this.socket.onclose=w=>{console.log("WebSocket connection closed at application level: ".concat(w.code," ").concat(w.reason)),z&&z.call(this,w)};const _=this.socket.onmessage;this.socket.onmessage=w=>{w.data.includes('"type":"welcome"')||console.log("WebSocket message received at application level"),_&&_.call(this,w)}}return C};const R=window.wsClient.handleMessage;window.wsClient.handleMessage=function(C){const S=this.clientId;R.call(this,C);const $=this.clientId;S!==$&&$&&console.log("WebSocket client ID changed at application level: ".concat($))}}}else console.log("WebSocketClient is not defined, cannot initialize WebSocket client")},[]),m("section",{id:"system-page",class:"page",children:[m(xe,{restartSystem:ue,shutdownSystem:me,isRestarting:a,isShuttingDown:v}),m(ke,{isLoading:M,hasData:p,loadingMessage:"Loading system information...",emptyMessage:"System information not available. Please try again later.",children:[m("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[m(Se,{systemInfo:e,formatUptime:Ee}),m($e,{systemInfo:e,formatBytes:N})]}),m("div",{class:"grid grid-cols-1 gap-4 mb-4",children:m(Ce,{systemInfo:e,formatBytes:N})}),m("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[m(Le,{systemInfo:e}),m(Me,{systemInfo:e,formatBytes:N})]}),m(Ue,{logs:r,logLevel:i,logCount:g,setLogLevel:U,setLogCount:o,loadLogs:()=>{if(window.wsClient&&window.wsClient.isConnected()){console.log("Manually triggering WebSocket fetch for logs");const u=new CustomEvent("refresh-logs-websocket");window.dispatchEvent(u)}},clearLogs:ge}),m(Re,{logLevel:i,logCount:g,onLogsReceived:ae})]})]})}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("main-content");e&&fe(m(ve,{client:we,children:[m(ye,{}),m(De,{}),m(he,{})]}),e)});export{Ne as __vite_legacy_guard};
//# sourceMappingURL=system-CS_ETDxW.js.map
