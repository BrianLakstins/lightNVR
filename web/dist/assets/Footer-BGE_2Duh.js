const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./query-client-CTeJEwHK.js","../css/query-client.css"])))=>i.map(i=>d[i]);
var ae=Object.freeze,me=Object.defineProperty;var re=(a,n)=>ae(me(a,"raw",{value:ae(n||a.slice())}));import{_ as ue,Q as ge,e as he,b as se,d as X,y as pe,c as h}from"./query-client-CTeJEwHK.js";const fe="modulepreload",ye=function(a,n){return new URL(a,n).href},ie={},Z=function(n,i,t){let s=Promise.resolve();if(i&&i.length>0){const o=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),m=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));s=Promise.allSettled(i.map(r=>{if(r=ye(r,t),r in ie)return;ie[r]=!0;const l=r.endsWith(".css"),v=l?'[rel="stylesheet"]':"";if(!!t)for(let p=o.length-1;p>=0;p--){const u=o[p];if(u.href===r&&(!l||u.rel==="stylesheet"))return}else if(document.querySelector('link[href="'.concat(r,'"]').concat(v)))return;const c=document.createElement("link");if(c.rel=l?"stylesheet":fe,l||(c.as="script"),c.crossOrigin="",c.href=r,m&&c.setAttribute("nonce",m),document.head.appendChild(c),l)return new Promise((p,u)=>{c.addEventListener("load",p),c.addEventListener("error",()=>u(new Error("Unable to preload CSS for ".concat(r))))})}))}function e(o){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=o,window.dispatchEvent(d),!d.defaultPrevented)throw o}return s.then(o=>{for(const d of o||[])d.status==="rejected"&&e(d.reason);return n().catch(e)})};var ce=function(a,n,i,t){var s;n[0]=0;for(var e=1;e<n.length;e++){var o=n[e++],d=n[e]?(n[0]|=o?1:2,i[n[e++]]):n[++e];o===3?t[0]=d:o===4?t[1]=Object.assign(t[1]||{},d):o===5?(t[1]=t[1]||{})[n[++e]]=d:o===6?t[1][n[++e]]+=d+"":o?(s=a.apply(d,ce(a,d,i,["",null])),t.push(s),d[0]?n[0]|=2:(n[e-2]=0,n[e]=s)):t.push(d)}return t},le=new Map;function be(a){var n=le.get(this);return n||(n=new Map,le.set(this,n)),(n=ce(this,n.get(a)||(n.set(a,n=function(i){for(var t,s,e=1,o="",d="",m=[0],r=function(f){e===1&&(f||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?m.push(0,f,o):e===3&&(f||o)?(m.push(3,f,o),e=2):e===2&&o==="..."&&f?m.push(4,f,0):e===2&&o&&!f?m.push(5,0,!0,o):e>=5&&((o||!f&&e===5)&&(m.push(e,0,o,s),e=6),f&&(m.push(e,f,0,s),e=6)),o=""},l=0;l<i.length;l++){l&&(e===1&&r(),r(l));for(var v=0;v<i[l].length;v++)t=i[l][v],e===1?t==="<"?(r(),m=[m],e=3):o+=t:e===4?o==="--"&&t===">"?(e=1,o=""):o=t+o[0]:d?t===d?d="":o+=t:t==='"'||t==="'"?d=t:t===">"?(r(),e=1):e&&(t==="="?(e=5,s=o,o=""):t==="/"&&(e<5||i[l][v+1]===">")?(r(),e===3&&(m=m[0]),e=m,(m=m[0]).push(2,0,e),e=0):t===" "||t==="	"||t==="\n"||t==="\r"?(r(),e=2):o+=t),e===3&&o==="!--"&&(e=4,m=m[0])}return r(),m}(a)),n),arguments,[])).length>1?n:n[0]}const xe=be.bind(ue);function Ce(){let a=document.getElementById("snapshot-modal-container");a||(a=document.createElement("div"),a.id="snapshot-modal-container",document.body.appendChild(a));const n=document.createElement("div");n.id="snapshot-preview-modal",n.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden",n.innerHTML='\n    <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl max-h-[90vh] flex flex-col transform transition-all duration-300 ease-out scale-95 opacity-0" style="width: 90%;">\n      <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">\n        <h3 id="snapshot-preview-title" class="text-lg font-semibold text-gray-900 dark:text-white">Snapshot</h3>\n        <button class="close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">✕</button>\n      </div>\n      <div class="p-4 overflow-auto flex-grow">\n        <img id="snapshot-preview-image" class="max-w-full max-h-[70vh] mx-auto" src="" alt="Snapshot">\n      </div>\n      <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-2">\n        <button id="snapshot-download-btn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">Download</button>\n        <button id="snapshot-close-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600">Close</button>\n      </div>\n    </div>\n  ',a.appendChild(n);let i=document.getElementById("video-modal-container");i||(i=document.createElement("div"),i.id="video-modal-container",document.body.appendChild(i));const t=document.createElement("div");t.id="video-preview-modal",t.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden",t.innerHTML='\n    <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl max-h-[90vh] flex flex-col transform transition-all duration-300 ease-out scale-95 opacity-0 w-full md:w-[90%]">\n      <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">\n        <h3 id="video-preview-title" class="text-lg font-semibold text-gray-900 dark:text-white">Video</h3>\n        <button class="close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">✕</button>\n      </div>\n      <div class="p-4 flex-grow">\n        <video id="video-preview-player" class="w-full h-auto max-w-full object-contain mx-auto" controls autoplay></video>\n      </div>\n      <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-2">\n        <a id="video-download-btn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors" href="#" download>Download</a>\n        <button id="video-close-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600">Close</button>\n      </div>\n    </div>\n  ',i.appendChild(t),document.addEventListener("keydown",s=>{s.key==="Escape"&&document.querySelectorAll(".fixed.inset-0.bg-black.bg-opacity-75").forEach(o=>{o.classList.contains("hidden")||o.classList.add("hidden")})})}function Ee(){Z(async()=>{const{initToastContainer:a}=await import("./toast-B-CW3gRJ.js");return{initToastContainer:a}},[],import.meta.url).then(({initToastContainer:a})=>{a(!1)}).catch(a=>{if(console.error("Error loading toast module:",a),document.getElementById("status-message-styles"))return;const n=document.createElement("style");n.id="status-message-styles",n.textContent="\n      #status-message-container {\n        position: fixed;\n        top: 1rem;\n        left: 50%;\n        transform: translateX(-50%);\n        z-index: 50;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n      }\n\n      .status-message {\n        background-color: #1f2937;\n        color: white;\n        padding: 0.5rem 1rem;\n        border-radius: 0.375rem;\n        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n        margin-bottom: 0.5rem;\n        transition: all 0.3s ease;\n        opacity: 0;\n        transform: translateY(-0.5rem);\n      }\n\n      .status-message.show {\n        opacity: 1;\n        transform: translateY(0);\n      }\n\n      .status-message.success {\n        background-color: #10b981;\n      }\n\n      .status-message.error {\n        background-color: #ef4444;\n      }\n\n      .status-message.warning {\n        background-color: #f59e0b;\n      }\n\n      .status-message.info {\n        background-color: #3b82f6;\n      }\n    ",document.head.appendChild(n)})}function Ne(){if(document.getElementById("modal-styles"))return;const a=document.createElement("style");a.id="modal-styles",a.textContent="\n    .modal-content {\n      transition: all 0.3s ease-out;\n    }\n\n    .modal-content.scale-95 {\n      transform: scale(0.95);\n      opacity: 0;\n    }\n\n    .modal-content.scale-100 {\n      transform: scale(1);\n      opacity: 1;\n    }\n  ",document.head.appendChild(a)}var de;function Se(a){const{isOpen:n,onClose:i,onConfirm:t,mode:s,count:e}=a;if(!n)return null;let o="Confirm Delete",d="Are you sure you want to delete this item?";s==="selected"?(o="Delete Selected Recordings",d="Are you sure you want to delete ".concat(e," selected recording").concat(e!==1?"s":"","?")):s==="all"&&(o="Delete All Filtered Recordings",d="Are you sure you want to delete all recordings matching the current filters? This action cannot be undone.");const m=l=>{l.key==="Escape"&&i()},r=l=>{l.target===l.currentTarget&&i()};return xe(de||(de=re(['\n    <div\n      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"\n      onClick=',"\n      onKeyDown=",'\n    >\n      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md mx-auto">\n        <div class="mb-4">\n          <h3 class="text-lg font-semibold text-gray-900 dark:text-white">','</h3>\n        </div>\n\n        <p class="text-gray-600 dark:text-gray-300 mb-6">','</p>\n\n        <div class="flex justify-end space-x-3">\n          <button\n            class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"\n            onClick=','\n          >\n            Cancel\n          </button>\n          <button\n            class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"\n            onClick=',"\n          >\n            Delete\n          </button>\n        </div>\n      </div>\n    </div>\n  "])),r,m,o,d,i,t)}function Le(a,n,i){const t=document.createElement("div");t.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",t.id="video-modal-overlay";const s=document.createElement("div");s.className="bg-gray-50 dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl flex flex-col w-full md:w-[90%]";const e=document.createElement("div");e.className="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700";const o=document.createElement("h3");o.className="text-lg font-semibold text-gray-900 dark:text-white",o.textContent=n||"Video";const d=document.createElement("button");d.className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",d.innerHTML="✕",d.addEventListener("click",()=>{document.body.removeChild(t)}),e.appendChild(o),e.appendChild(d);const m=document.createElement("div");m.className="p-4";const r=document.createElement("video");r.src=a,r.className="w-full h-auto max-w-full object-contain mx-auto",r.controls=!0,r.autoplay=!0,m.appendChild(r);const l=document.createElement("div");l.id="recordings-controls",l.className="mx-4 mb-4 p-4 border border-green-500 rounded-lg bg-white dark:bg-gray-700 shadow-md relative z-10";const v=document.createElement("h3");v.className="text-lg font-bold text-center mb-4 text-gray-800 dark:text-white",v.textContent="PLAYBACK CONTROLS",l.appendChild(v);const f=document.createElement("div");f.className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-2";const c=document.createElement("div");c.className="border-b pb-4 md:border-b-0 md:border-r md:pr-4 md:pb-0";const p=document.createElement("h4");p.className="font-bold text-center mb-3 text-gray-700 dark:text-gray-300",p.textContent="Playback Speed",c.appendChild(p);const u=document.createElement("div");u.className="flex flex-wrap justify-center gap-2",[.25,.5,1,1.5,2,4].forEach(g=>{const x=document.createElement("button");x.textContent=g===1?"1× (Normal)":"".concat(g,"×"),x.className=g===1?"speed-btn px-3 py-2 rounded-full bg-green-500 text-white text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50":"speed-btn px-3 py-2 rounded-full bg-gray-200 hover:bg-gray-300 text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50",x.setAttribute("data-speed",g),x.addEventListener("click",()=>{r.playbackRate=g,u.querySelectorAll(".speed-btn").forEach(y=>{y.getAttribute("data-speed")===g.toString()?(y.classList.remove("bg-gray-200","hover:bg-gray-300"),y.classList.add("bg-green-500","text-white")):(y.classList.remove("bg-green-500","text-white"),y.classList.add("bg-gray-200","hover:bg-gray-300"))}),$.textContent="Current Speed: ".concat(g,"× ").concat(g===1?"(Normal)":"")}),u.appendChild(x)}),c.appendChild(u);const $=document.createElement("div");$.id="current-speed-indicator",$.className="mt-3 text-center font-medium text-green-600 dark:text-green-400 text-sm",$.textContent="Current Speed: 1× (Normal)",c.appendChild($),f.appendChild(c);const M=document.createElement("div");M.className="pt-4 md:pt-0 md:pl-4";const H=document.createElement("h4");H.className="font-bold text-center mb-2 text-gray-700 dark:text-gray-300",H.textContent="Detection Overlays",M.appendChild(H);const N=document.createElement("div");N.className="flex flex-col items-center gap-2";const _=document.createElement("div");_.className="flex items-center gap-2 mb-2";const k=document.createElement("input");k.type="checkbox",k.id="detection-overlay-checkbox",k.className="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600";const W=document.createElement("label");W.htmlFor="detection-overlay-checkbox",W.className="text-sm font-medium text-gray-700 dark:text-gray-300",W.textContent="Show Detection Overlays",_.appendChild(k),_.appendChild(W),N.appendChild(_);const z=document.createElement("div");z.className="flex flex-col w-full mt-2 mb-2";const J=document.createElement("label");J.htmlFor="detection-sensitivity-slider",J.className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",J.textContent="Detection Sensitivity";const U=document.createElement("div");U.id="detection-sensitivity-value",U.className="text-xs text-gray-600 dark:text-gray-400 text-center mb-1",U.textContent="Time Window: 2 seconds";const T=document.createElement("input");T.type="range",T.id="detection-sensitivity-slider",T.className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700",T.min="1",T.max="10",T.step="1",T.value="2",z.appendChild(J),z.appendChild(T),z.appendChild(U),T.addEventListener("input",()=>{Q=parseInt(T.value),U.textContent="Time Window: ".concat(Q," second").concat(Q!==1?"s":""),R&&j()}),N.appendChild(z);const b=document.createElement("div");if(b.id="detection-status-indicator",b.className="text-center text-sm text-gray-600 dark:text-gray-400",b.textContent="No detections loaded",N.appendChild(b),M.appendChild(N),f.appendChild(M),l.appendChild(f),i){const g=document.createElement("div");g.className="flex justify-center mt-4 pt-2 border-t border-gray-200 dark:border-gray-700";const x=document.createElement("a");x.className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center text-sm",x.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />\n      </svg>\n      Download Video\n    ',x.href=i,x.download="video-".concat(Date.now(),".mp4"),g.appendChild(x),l.appendChild(g)}const ee=document.createElement("div");ee.className="p-2";const I=document.createElement("div");I.className="relative",I.style.position="relative",I.style.width="100%",I.style.height="100%";const w=document.createElement("canvas");w.id="detection-overlay-canvas",w.className="absolute top-0 left-0 w-full h-full pointer-events-none",w.style.position="absolute",w.style.top="0",w.style.left="0",w.style.width="100%",w.style.height="100%",w.style.pointerEvents="none",w.style.display="none",I.appendChild(r),I.appendChild(w),m.appendChild(I);let L=null,E=[],R=!1,Q=parseInt(T.value);const K=a.match(/\/play\/(\d+)/);if(K&&K[1]){const g=parseInt(K[1],10),x=document.createElement("div");x.id="query-container",x.style.display="none",document.body.appendChild(x),Z(async()=>{const{render:y,h:C}=await import("./query-client-CTeJEwHK.js").then(F=>F.p);return{render:y,h:C}},__vite__mapDeps([0,1]),import.meta.url).then(({render:y,h:C})=>{y(C(ge,{client:he},C(()=>{const{data:S,isLoading:B,error:D}=se(["recording",g],"/api/recordings/".concat(g));let A=!1,O,G,Y;S&&S.stream&&S.start_time&&S.end_time&&(L=S,console.log("Recording data:",S),O=Math.floor(new Date(S.start_time).getTime()/1e3),G=Math.floor(new Date(S.end_time).getTime()/1e3),Y=S.stream,A=!0);const{data:P,isLoading:ne,error:oe}=se(["detections",Y,O,G],A?"/api/detection/results/".concat(Y,"?start=").concat(O,"&end=").concat(G):null,{},{enabled:A});return P&&P.detections&&(console.log("Detection data:",P),E=P.detections||[],b&&(E.length>0?(b.textContent="".concat(E.length," detection").concat(E.length!==1?"s":""," available"),b.className="text-center text-sm font-medium text-green-600 dark:text-green-400",k&&(k.disabled=!1)):(b.textContent="No detections found for this recording",k&&(k.disabled=!0)))),D&&console.error("Error loading recording data:",D),oe&&(console.error("Error loading detection data:",oe),b&&(b.textContent="Error loading detections",b.className="text-center text-sm font-medium text-red-600 dark:text-red-400"),k&&(k.disabled=!0)),null})),x)}).catch(y=>{console.error("Error loading preact for data fetching:",y),fetch("/api/recordings/".concat(g)).then(C=>C.json()).then(C=>{if(L=C,L&&L.stream&&L.start_time&&L.end_time){const F=Math.floor(new Date(L.start_time).getTime()/1e3),S=Math.floor(new Date(L.end_time).getTime()/1e3),B=new URLSearchParams({start:F,end:S});return fetch("/api/detection/results/".concat(L.stream,"?").concat(B.toString()))}throw new Error("Recording data incomplete")}).then(C=>C.json()).then(C=>{E=C.detections||[],E.length>0?(b.textContent="".concat(E.length," detection").concat(E.length!==1?"s":""," available"),b.className="text-center text-sm font-medium text-green-600 dark:text-green-400",k.disabled=!1):(b.textContent="No detections found for this recording",k.disabled=!0)}).catch(C=>{console.error("Error fetching detection data:",C),b.textContent="Error loading detections",b.className="text-center text-sm font-medium text-red-600 dark:text-red-400",k.disabled=!0})})}k.addEventListener("change",()=>{R=k.checked,R?(w.style.display="block",j(),b.textContent="Showing ".concat(E.length," detection").concat(E.length!==1?"s":"")):(w.style.display="none",b.textContent="".concat(E.length," detection").concat(E.length!==1?"s":""," available"))});function j(){if(!R||!r||!w||E.length===0)return;const g=r.videoWidth,x=r.videoHeight;if(g===0||x===0){requestAnimationFrame(j);return}w.width=g,w.height=x;const y=w.getContext("2d");y.clearRect(0,0,w.width,w.height);const C=r.currentTime;if(!L||!L.start_time)return;const S=Math.floor(new Date(L.start_time).getTime()/1e3)+Math.floor(C),B=E.filter(D=>D.timestamp?Math.abs(D.timestamp-S)<=Q:!1);b&&(B.length>0?b.textContent="Showing ".concat(B.length," detection").concat(B.length!==1?"s":""," at current time"):b.textContent="No detections at current time (".concat(E.length," total)")),B.forEach(D=>{const A=D.x*g,O=D.y*x,G=D.width*g,Y=D.height*x;y.strokeStyle="rgba(0, 255, 0, 0.8)",y.lineWidth=2,y.strokeRect(A,O,G,Y),y.fillStyle="rgba(0, 0, 0, 0.7)";const P="".concat(D.label," (").concat(Math.round(D.confidence*100),"%)"),ne=y.measureText(P).width+10;y.fillRect(A,O-20,ne,20),y.fillStyle="white",y.font="12px Arial",y.fillText(P,A+5,O-5)}),!r.paused&&!r.ended&&requestAnimationFrame(j)}r.addEventListener("play",()=>{R&&j()}),r.addEventListener("seeked",()=>{R&&j()}),r.addEventListener("timeupdate",()=>{if(R){const g=Math.floor(r.currentTime*2)/2;r.lastDrawnTime!==g&&(r.lastDrawnTime=g,j())}}),s.appendChild(e),s.appendChild(m),s.appendChild(l),s.appendChild(ee),t.appendChild(s),document.body.appendChild(t);const te=g=>{g.key==="Escape"&&(document.body.contains(t)&&document.body.removeChild(t),document.removeEventListener("keydown",te))};document.addEventListener("keydown",te),t.addEventListener("click",g=>{g.target===t&&document.body.removeChild(t)})}function V(a,n="info",i=4e3){if(console.log("Showing status message: ".concat(a," (").concat(n,")")),window.showToast){window.showToast(a,n,i);return}Z(async()=>{const{showStatusMessage:t}=await import("./toast-B-CW3gRJ.js");return{showStatusMessage:t}},[],import.meta.url).then(({showStatusMessage:t})=>{t(a,n,i)}).catch(t=>{console.error("Error loading toast module:",t);let s=document.getElementById("status-message-container");s||(s=document.createElement("div"),s.id="status-message-container",s.className="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 flex flex-col items-center",document.body.appendChild(s));const e=document.createElement("div");let o="bg-blue-500";n==="success"?o="bg-green-500":n==="error"?o="bg-red-500":n==="warning"&&(o="bg-yellow-500"),e.className="".concat(o," text-white px-4 py-2 rounded-lg shadow-lg mb-2 transition-all duration-300 opacity-0 transform translate-y-2"),e.textContent=a,s.appendChild(e),setTimeout(()=>{e.classList.remove("opacity-0","translate-y-2")},10),setTimeout(()=>{e.classList.add("opacity-0","translate-y-2"),setTimeout(()=>{e.parentNode===s&&s.removeChild(e),s.children.length===0&&s.parentNode===document.body&&document.body.removeChild(s)},300)},i)})}function De(a,n){const i=document.getElementById("snapshot-preview-modal");if(!i){console.error("Snapshot modal not found. Make sure setupModals() has been called.");return}const t=document.getElementById("snapshot-preview-title"),s=document.getElementById("snapshot-preview-image"),e=document.getElementById("snapshot-download-btn"),o=document.getElementById("snapshot-close-btn"),d=i.querySelectorAll(".close"),m=i.querySelector(".modal-content");t&&(t.textContent="Snapshot: ".concat(n)),i.dataset.imageData=a,i.dataset.streamName=n,s&&(s.src=a,s.style.display="block",s.onload=()=>{console.log("Snapshot image loaded successfully")},s.onerror=l=>{console.error("Error loading snapshot image:",l)});function r(){i.classList.add("hidden"),m&&(m.classList.remove("scale-100"),m.classList.add("scale-95"))}o&&(o.onclick=r),d.forEach(l=>{l.onclick=r}),i.onclick=function(l){l.target===i&&r()},document.addEventListener("keydown",function(l){l.key==="Escape"&&!i.classList.contains("hidden")&&r()}),e&&(e.onclick=function(){const l=i.dataset.imageData,v=i.dataset.streamName||n;if(!l){console.error("No image data available for download"),V("Download failed: No image data available",5e3);return}console.log("Downloading snapshot with data URL length:",l.length);try{console.log("Using iframe download method");const c=document.createElement("canvas"),p=new Image;p.onload=function(){try{console.log("Image loaded for optimization, original dimensions:",p.width,"x",p.height);const u=p.width,q=p.height;console.log("Using original image dimensions for maximum quality:",u,"x",q),c.width=u,c.height=q;const $=c.getContext("2d");$.fillStyle="black",$.fillRect(0,0,c.width,c.height),$.drawImage(p,0,0,u,q);const M=c.toDataURL("image/jpeg",1);console.log("Optimized JPEG data URL length:",M.length);const H="snapshot_".concat(v,"_").concat(new Date().toISOString().replace(/[:.]/g,"-"),".jpg"),N=document.createElement("iframe");N.style.display="none",document.body.appendChild(N);try{const _=N.contentWindow.document;_.open(),_.write("\n                <!DOCTYPE html>\n                <html>\n                <head>\n                  <title>Downloading...</title>\n                  <script>\n                    function startDownload() {\n                      const a = document.getElementById('download-link');\n                      a.click();\n                      setTimeout(function() {\n                        window.parent.postMessage('download-complete', '*');\n                      }, 1000);\n                    }\n                  <\/script>\n                </head>\n                <body onload=\"startDownload()\">\n                  <a id=\"download-link\" href=\"".concat(M,'" download="').concat(H,'">Download</a>\n                </body>\n                </html>\n              ')),_.close(),window.addEventListener("message",function k(W){W.data==="download-complete"&&(window.removeEventListener("message",k),document.body.removeChild(N),V("Snapshot downloaded successfully",3e3))},{once:!0}),setTimeout(()=>{document.body.contains(N)&&document.body.removeChild(N)},5e3)}catch(_){console.error("Iframe download method failed:",_),document.body.removeChild(N),f(M,H)}}catch(u){console.error("Canvas processing error:",u),V("Download failed: Error processing image",5e3),f(l,"snapshot_".concat(v,"_").concat(new Date().toISOString().replace(/[:.]/g,"-"),".jpg"))}},p.onerror=function(u){console.error("Error loading image for optimization:",u),V("Download failed: Could not load image",5e3),f(l,"snapshot_".concat(v,"_").concat(new Date().toISOString().replace(/[:.]/g,"-"),".jpg"))},p.src=l}catch(c){console.error("Error in snapshot download process:",c),V("Download failed: "+c.message,5e3),f(l,"snapshot_".concat(v,"_").concat(new Date().toISOString().replace(/[:.]/g,"-"),".jpg"))}function f(c,p){console.log("Attempting direct link download");try{const u=document.createElement("a");u.href=c,u.download=p,u.target="_blank",u.rel="noopener noreferrer",document.body.appendChild(u),u.click(),setTimeout(()=>{document.body.removeChild(u)},100),V("Download initiated",3e3)}catch(u){console.error("Direct link download failed:",u),V("Download failed: Browser restrictions",5e3)}}}),i.classList.remove("hidden"),m&&setTimeout(()=>{m.classList.remove("scale-95","opacity-0"),m.classList.add("scale-100","opacity-100")},10)}const ve="0.11.18";function $e({version:a=ve}){var f;const n=document.getElementById("header-container"),i=((f=n==null?void 0:n.dataset)==null?void 0:f.activeNav)||"",[t,s]=X(""),[e,o]=X(!1);pe(()=>{const c=localStorage.getItem("auth");if(c)try{const u=atob(c).split(":")[0];s(u)}catch(p){console.error("Error decoding auth token:",p),s("User")}else s("User")},[]);const d=c=>{c.preventDefault(),localStorage.removeItem("auth"),document.cookie="auth=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict",document.cookie="session=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict",fetch("/api/auth/logout",{method:"POST"}).then(()=>{window.location.href="login.html?auth_required=true&logout=true"}).catch(()=>{window.location.href="login.html?auth_required=true&logout=true"})},m=()=>{o(!e)},l=[{id:"nav-live",href:window.location.pathname==="/"||window.location.pathname.endsWith("/")?"./":"index.html",label:"Live View"},{id:"nav-recordings",href:"recordings.html",label:"Recordings"},{id:"nav-streams",href:"streams.html",label:"Streams"},{id:"nav-settings",href:"settings.html",label:"Settings"},{id:"nav-users",href:"users.html",label:"Users"},{id:"nav-system",href:"system.html",label:"System"}],v=c=>{const p=i===c.id,u="text-white no-underline rounded transition-colors",q="px-3 py-2",$="block w-full px-4 py-3 text-left",M=p?"bg-blue-600":"hover:bg-blue-700";return h("li",{className:e?"w-full":"mx-1",children:h("a",{href:c.href,id:c.id,className:"".concat(u," ").concat(e?$:q," ").concat(M),onClick:e?m:null,children:c.label})})};return h("header",{className:"bg-gray-800 text-white py-2 shadow-md mb-4 w-full",children:[h("div",{className:"container mx-auto px-4 flex justify-between items-center",children:[h("div",{className:"logo flex items-center",children:[h("h1",{className:"text-xl font-bold m-0",children:"LightNVR"}),h("span",{className:"version text-blue-200 text-xs ml-2",children:["v",a]})]}),h("nav",{className:"hidden md:block",children:h("ul",{className:"flex list-none m-0 p-0",children:l.map(v)})}),h("div",{className:"user-menu hidden md:flex items-center",children:[h("span",{className:"mr-2",children:t}),h("a",{href:"#",onClick:d,className:"logout-link text-white no-underline hover:bg-blue-700 px-3 py-1 rounded transition-colors",children:"Logout"})]}),h("button",{className:"md:hidden text-white p-2 focus:outline-none",onClick:m,"aria-label":"Toggle menu",children:h("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:h("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:e?"M6 18L18 6M6 6l12 12":"M4 6h16M4 12h16M4 18h16"})})})]}),e&&h("div",{className:"md:hidden mt-2 border-t border-gray-700 pt-2 container mx-auto px-4",children:h("ul",{className:"list-none m-0 p-0 flex flex-col w-full",children:[l.map(v),h("li",{className:"w-full mt-2 pt-2 border-t border-gray-700",children:h("div",{className:"flex justify-between items-center px-4 py-2",children:[h("span",{children:t}),h("a",{href:"#",onClick:d,className:"logout-link text-white no-underline hover:bg-blue-700 px-3 py-1 rounded transition-colors",children:"Logout"})]})})]})})]})}function Te(){const[a]=X(new Date().getFullYear());return h("footer",{class:"bg-gray-800 text-white py-3 px-4 mt-4 shadow-inner",children:h("div",{class:"container mx-auto flex flex-col sm:flex-row justify-between items-center",children:h("div",{class:"text-center sm:text-left mb-2 sm:mb-0",children:[h("p",{class:"text-sm",children:["© ",a," LightNVR ·",h("a",{href:"https://github.com/opensensor/lightnvr",class:"text-blue-300 hover:text-blue-100 text-sm",target:"_blank",rel:"noopener noreferrer",children:"GitHub"})]}),h("p",{class:"text-xs text-gray-400 mt-1 hidden sm:block",children:"Lightweight Network Video Recorder"})]})})})}export{Se as D,Te as F,$e as H,Ee as a,Ne as b,V as c,De as d,Le as e,xe as h,Ce as s};
//# sourceMappingURL=Footer-BGE_2Duh.js.map
