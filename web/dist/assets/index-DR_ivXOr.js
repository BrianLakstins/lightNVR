import{g as ze,d as E,A as D,y as L,u as f,a as $e,b as Ge,s as W,q as Z,T as Ve,E as We,c as Je,e as Be,Q as qe,k as He}from"./query-client-DIfHb7sS.js";/* empty css               */import{D as Ke,t as Qe,u as Xe,F as Ye,L as Ze}from"./LiveView-CJvznCdo.js";import{S as we,s as w,u as et,a as tt,b as rt,c as nt}from"./UI-D9BZN-mW.js";import{L as ot}from"./LoadingIndicator-DbxhRnFU.js";import{H as st,F as it}from"./Footer-D76HMRTv.js";function vt(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}function at(e,o){for(var r=0;r<o.length;r++){const t=o[r];if(typeof t!="string"&&!Array.isArray(t)){for(const n in t)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(t,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>t[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}let ae=!0,ce=!0;function A(e,o,r){const t=e.match(o);return t&&t.length>=r&&parseFloat(t[r],10)}function O(e,o,r){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.addEventListener;t.addEventListener=function(a,i){if(a!==o)return n.apply(this,arguments);const p=l=>{const c=r(l);c&&(i.handleEvent?i.handleEvent(c):i(c))};return this._eventMap=this._eventMap||{},this._eventMap[o]||(this._eventMap[o]=new Map),this._eventMap[o].set(i,p),n.apply(this,[a,p])};const s=t.removeEventListener;t.removeEventListener=function(a,i){if(a!==o||!this._eventMap||!this._eventMap[o])return s.apply(this,arguments);if(!this._eventMap[o].has(i))return s.apply(this,arguments);const p=this._eventMap[o].get(i);return this._eventMap[o].delete(i),this._eventMap[o].size===0&&delete this._eventMap[o],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[a,p])},Object.defineProperty(t,"on"+o,{get(){return this["_on"+o]},set(a){this["_on"+o]&&(this.removeEventListener(o,this["_on"+o]),delete this["_on"+o]),a&&this.addEventListener(o,this["_on"+o]=a)},enumerable:!0,configurable:!0})}function ct(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(ae=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function lt(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(ce=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function le(){if(typeof window=="object"){if(ae)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Y(e,o){ce&&console.warn(e+" is deprecated, please use "+o+" instead.")}function pt(e){const o={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return o.browser="Not a browser.",o;const{navigator:r}=e;if(r.userAgentData&&r.userAgentData.brands){const t=r.userAgentData.brands.find(n=>n.brand==="Chromium");if(t)return{browser:"chrome",version:parseInt(t.version,10)}}if(r.mozGetUserMedia)o.browser="firefox",o.version=parseInt(A(r.userAgent,/Firefox\/(\d+)\./,1));else if(r.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)o.browser="chrome",o.version=parseInt(A(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(e.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))o.browser="safari",o.version=parseInt(A(r.userAgent,/AppleWebKit\/(\d+)\./,1)),o.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,o._safariVersion=A(r.userAgent,/Version\/(\d+(\.?\d+))/,1);else return o.browser="Not a supported browser.",o;return o}function ee(e){return Object.prototype.toString.call(e)==="[object Object]"}function pe(e){return ee(e)?Object.keys(e).reduce(function(o,r){const t=ee(e[r]),n=t?pe(e[r]):e[r],s=t&&!Object.keys(n).length;return n===void 0||s?o:Object.assign(o,{[r]:n})},{}):e}function B(e,o,r){!o||r.has(o.id)||(r.set(o.id,o),Object.keys(o).forEach(t=>{t.endsWith("Id")?B(e,e.get(o[t]),r):t.endsWith("Ids")&&o[t].forEach(n=>{B(e,e.get(n),r)})}))}function te(e,o,r){const t=r?"outbound-rtp":"inbound-rtp",n=new Map;if(o===null)return n;const s=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===o.id&&s.push(a)}),s.forEach(a=>{e.forEach(i=>{i.type===t&&i.trackId===a.id&&B(e,i,n)})}),n}const re=le;function ue(e,o){const r=e&&e.navigator;if(!r.mediaDevices)return;const t=function(i){if(typeof i!="object"||i.mandatory||i.optional)return i;const p={};return Object.keys(i).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const c=typeof i[l]=="object"?i[l]:{ideal:i[l]};c.exact!==void 0&&typeof c.exact=="number"&&(c.min=c.max=c.exact);const u=function(d,h){return d?d+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(c.ideal!==void 0){p.optional=p.optional||[];let d={};typeof c.ideal=="number"?(d[u("min",l)]=c.ideal,p.optional.push(d),d={},d[u("max",l)]=c.ideal,p.optional.push(d)):(d[u("",l)]=c.ideal,p.optional.push(d))}c.exact!==void 0&&typeof c.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[u("",l)]=c.exact):["min","max"].forEach(d=>{c[d]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[u(d,l)]=c[d])})}),i.advanced&&(p.optional=(p.optional||[]).concat(i.advanced)),p},n=function(i,p){if(o.version>=61)return p(i);if(i=JSON.parse(JSON.stringify(i)),i&&typeof i.audio=="object"){const l=function(c,u,d){u in c&&!(d in c)&&(c[d]=c[u],delete c[u])};i=JSON.parse(JSON.stringify(i)),l(i.audio,"autoGainControl","googAutoGainControl"),l(i.audio,"noiseSuppression","googNoiseSuppression"),i.audio=t(i.audio)}if(i&&typeof i.video=="object"){let l=i.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const c=o.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete i.video.facingMode;let u;if(l.exact==="environment"||l.ideal==="environment"?u=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(u=["front"]),u)return r.mediaDevices.enumerateDevices().then(d=>{d=d.filter(C=>C.kind==="videoinput");let h=d.find(C=>u.some(S=>C.label.toLowerCase().includes(S)));return!h&&d.length&&u.includes("back")&&(h=d[d.length-1]),h&&(i.video.deviceId=l.exact?{exact:h.deviceId}:{ideal:h.deviceId}),i.video=t(i.video),re("chrome: "+JSON.stringify(i)),p(i)})}i.video=t(i.video)}return re("chrome: "+JSON.stringify(i)),p(i)},s=function(i){return o.version>=64?i:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[i.name]||i.name,message:i.message,constraint:i.constraint||i.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(i,p,l){n(i,c=>{r.webkitGetUserMedia(c,p,u=>{l&&l(s(u))})})};if(r.getUserMedia=a.bind(r),r.mediaDevices.getUserMedia){const i=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(p){return n(p,l=>i(l).then(c=>{if(l.audio&&!c.getAudioTracks().length||l.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return c},c=>Promise.reject(s(c))))}}}function de(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function fe(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(i=>i.track&&i.track.id===n.track.id):s={track:n.track};const a=new Event("track");a.track=n.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[t.stream],this.dispatchEvent(a)}),t.stream.getTracks().forEach(n=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(i=>i.track&&i.track.id===n.id):s={track:n};const a=new Event("track");a.track=n,a.receiver=s,a.transceiver={receiver:s},a.streams=[t.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),o.apply(this,arguments)}}else O(e,"track",o=>(o.transceiver||Object.defineProperty(o,"transceiver",{value:{receiver:o.receiver}}),o))}function me(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const o=function(n,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=n.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:n}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(i,p){let l=n.apply(this,arguments);return l||(l=o(this,i),this._senders.push(l)),l};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(i){s.apply(this,arguments);const p=this._senders.indexOf(i);p!==-1&&this._senders.splice(p,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(o(this,a))})};const t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(a=>{const i=this._senders.find(p=>p.track===a);i&&this._senders.splice(this._senders.indexOf(i),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const t=o.apply(this,[]);return t.forEach(n=>n._pc=this),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function he(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s});const t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=t.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>te(a,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=r.apply(this,[]);return n.forEach(s=>s._pc=this),n}),O(e,"track",t=>(t.receiver._pc=t.srcElement,t)),e.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(s=>te(s,n.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const t=arguments[0];let n,s,a;return this.getSenders().forEach(i=>{i.track===t&&(n?a=!0:n=i)}),this.getReceivers().forEach(i=>(i.track===t&&(s?a=!0:s=i),i.track===t)),a||n&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}function ge(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,i){if(!i)return o.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=o.apply(this,arguments);return this._shimmedLocalStreams[i.id]?this._shimmedLocalStreams[i.id].indexOf(p)===-1&&this._shimmedLocalStreams[i.id].push(p):this._shimmedLocalStreams[i.id]=[i,p],p};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(l=>{if(this.getSenders().find(u=>u.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const i=this.getSenders();r.apply(this,arguments);const p=this.getSenders().filter(l=>i.indexOf(l)===-1);this._shimmedLocalStreams[a.id]=[a].concat(p)};const t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],t.apply(this,arguments)};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(i=>{const p=this._shimmedLocalStreams[i].indexOf(a);p!==-1&&this._shimmedLocalStreams[i].splice(p,1),this._shimmedLocalStreams[i].length===1&&delete this._shimmedLocalStreams[i]}),n.apply(this,arguments)}}function ye(e,o){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&o.version>=65)return ge(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const c=r.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(u=>this._reverseStreams[u.id])};const t=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(u=>{if(this.getSenders().find(h=>h.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){const u=new e.MediaStream(c.getTracks());this._streams[c.id]=u,this._reverseStreams[u.id]=c,c=u}t.apply(this,[c])};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},e.RTCPeerConnection.prototype.addTrack=function(c,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(S=>S===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const C=this._streams[u.id];if(C)C.addTrack(c),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new e.MediaStream([c]);this._streams[u.id]=S,this._reverseStreams[S.id]=u,this.addStream(S)}return this.getSenders().find(S=>S.track===c)};function s(l,c){let u=c.sdp;return Object.keys(l._reverseStreams||[]).forEach(d=>{const h=l._reverseStreams[d],C=l._streams[h.id];u=u.replace(new RegExp(C.id,"g"),h.id)}),new RTCSessionDescription({type:c.type,sdp:u})}function a(l,c){let u=c.sdp;return Object.keys(l._reverseStreams||[]).forEach(d=>{const h=l._reverseStreams[d],C=l._streams[h.id];u=u.replace(new RegExp(h.id,"g"),C.id)}),new RTCSessionDescription({type:c.type,sdp:u})}["createOffer","createAnswer"].forEach(function(l){const c=e.RTCPeerConnection.prototype[l],u={[l](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?c.apply(this,[C=>{const S=s(this,C);d[0].apply(null,[S])},C=>{d[1]&&d[1].apply(null,C)},arguments[2]]):c.apply(this,arguments).then(C=>s(this,C))}};e.RTCPeerConnection.prototype[l]=u[l]});const i=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?i.apply(this,arguments):(arguments[0]=a(this,arguments[0]),i.apply(this,arguments))};const p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const l=p.get.apply(this);return l.type===""?l:s(this,l)}}),e.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(c._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(S=>c.track===S)&&(d=this._streams[h])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function q(e,o){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&o.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const t=e.RTCPeerConnection.prototype[r],n={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=n[r]})}function Ce(e,o){O(e,"negotiationneeded",r=>{const t=r.target;if(!((o.version<72||t.getConfiguration&&t.getConfiguration().sdpSemantics==="plan-b")&&t.signalingState!=="stable"))return r})}const ne=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Ce,shimAddTrackRemoveTrack:ye,shimAddTrackRemoveTrackWithNative:ge,shimGetSendersWithDtmf:me,shimGetUserMedia:ue,shimMediaStream:de,shimOnTrack:fe,shimPeerConnection:q,shimSenderReceiverGetStats:he},Symbol.toStringTag,{value:"Module"}));function ve(e,o){const r=e&&e.navigator,t=e&&e.MediaStreamTrack;if(r.getUserMedia=function(n,s,a){Y("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(n).then(s,a)},!(o.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const n=function(a,i,p){i in a&&!(p in a)&&(a[p]=a[i],delete a[i])},s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a.audio,"autoGainControl","mozAutoGainControl"),n(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},t&&t.prototype.getSettings){const a=t.prototype.getSettings;t.prototype.getSettings=function(){const i=a.apply(this,arguments);return n(i,"mozAutoGainControl","autoGainControl"),n(i,"mozNoiseSuppression","noiseSuppression"),i}}if(t&&t.prototype.applyConstraints){const a=t.prototype.applyConstraints;t.prototype.applyConstraints=function(i){return this.kind==="audio"&&typeof i=="object"&&(i=JSON.parse(JSON.stringify(i)),n(i,"autoGainControl","mozAutoGainControl"),n(i,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[i])}}}}function ut(e,o){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(t){if(!(t&&t.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return t.video===!0?t.video={mediaSource:o}:t.video.mediaSource=o,e.navigator.mediaDevices.getUserMedia(t)})}function Se(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function H(e,o){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),o.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const s=e.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=a[n]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,a,i]=arguments;return t.apply(this,[s||null]).then(p=>{if(o.version<53&&!a)try{p.forEach(l=>{l.type=r[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;p.forEach((c,u)=>{p.set(u,Object.assign({},c,{type:r[c.type]||c.type}))})}return p}).then(a,i)}}function Te(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const o=e.RTCPeerConnection.prototype.getSenders;o&&(e.RTCPeerConnection.prototype.getSenders=function(){const n=o.apply(this,[]);return n.forEach(s=>s._pc=this),n});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const n=r.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Re(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const o=e.RTCPeerConnection.prototype.getReceivers;o&&(e.RTCPeerConnection.prototype.getReceivers=function(){const t=o.apply(this,[]);return t.forEach(n=>n._pc=this),t}),O(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function be(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){Y("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&r.getTracks().includes(t.track)&&this.removeTrack(t)})})}function Pe(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function xe(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const o=e.RTCPeerConnection.prototype.addTransceiver;o&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let t=arguments[1]&&arguments[1].sendEncodings;t===void 0&&(t=[]),t=[...t];const n=t.length>0;n&&t.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=o.apply(this,arguments);if(n){const{sender:a}=s,i=a.getParameters();(!("encodings"in i)||i.encodings.length===1&&Object.keys(i.encodings[0]).length===0)&&(i.encodings=t,a.sendEncodings=t,this.setParametersPromises.push(a.setParameters(i).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function ke(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const o=e.RTCRtpSender.prototype.getParameters;o&&(e.RTCRtpSender.prototype.getParameters=function(){const t=o.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}function _e(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const o=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>o.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):o.apply(this,arguments)}}function Ee(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const o=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>o.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):o.apply(this,arguments)}}const oe=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:xe,shimCreateAnswer:Ee,shimCreateOffer:_e,shimGetDisplayMedia:ut,shimGetParameters:ke,shimGetUserMedia:ve,shimOnTrack:Se,shimPeerConnection:H,shimRTCDataChannel:Pe,shimReceiverGetStats:Re,shimRemoveStream:be,shimSenderGetStats:Te},Symbol.toStringTag,{value:"Module"}));function Me(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(n=>o.call(this,n,t)),t.getVideoTracks().forEach(n=>o.call(this,n,t))},e.RTCPeerConnection.prototype.addTrack=function(t,...n){return n&&n.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),o.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(r);if(t===-1)return;this._localStreams.splice(t,1);const n=r.getTracks();this.getSenders().forEach(s=>{n.includes(s.track)&&this.removeTrack(s)})})}}function Ie(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=t=>{t.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const s=new Event("addstream");s.stream=n,this.dispatchEvent(s)})})}});const o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(s=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(s)>=0)return;t._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,t.dispatchEvent(a)})}),o.apply(t,arguments)}}}function De(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,r=o.createOffer,t=o.createAnswer,n=o.setLocalDescription,s=o.setRemoteDescription,a=o.addIceCandidate;o.createOffer=function(l,c){const u=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[u]);return c?(d.then(l,c),Promise.resolve()):d},o.createAnswer=function(l,c){const u=arguments.length>=2?arguments[2]:arguments[0],d=t.apply(this,[u]);return c?(d.then(l,c),Promise.resolve()):d};let i=function(p,l,c){const u=n.apply(this,[p]);return c?(u.then(l,c),Promise.resolve()):u};o.setLocalDescription=i,i=function(p,l,c){const u=s.apply(this,[p]);return c?(u.then(l,c),Promise.resolve()):u},o.setRemoteDescription=i,i=function(p,l,c){const u=a.apply(this,[p]);return c?(u.then(l,c),Promise.resolve()):u},o.addIceCandidate=i}function Le(e){const o=e&&e.navigator;if(o.mediaDevices&&o.mediaDevices.getUserMedia){const r=o.mediaDevices,t=r.getUserMedia.bind(r);o.mediaDevices.getUserMedia=n=>t(Oe(n))}!o.getUserMedia&&o.mediaDevices&&o.mediaDevices.getUserMedia&&(o.getUserMedia=(function(t,n,s){o.mediaDevices.getUserMedia(t).then(n,s)}).bind(o))}function Oe(e){return e&&e.video!==void 0?Object.assign({},e,{video:pe(e.video)}):e}function je(e){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection;e.RTCPeerConnection=function(t,n){if(t&&t.iceServers){const s=[];for(let a=0;a<t.iceServers.length;a++){let i=t.iceServers[a];i.urls===void 0&&i.url?(Y("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,s.push(i)):s.push(t.iceServers[a])}t.iceServers=s}return new o(t,n)},e.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in o&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return o.generateCertificate}})}function Ae(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ne(e){const o=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(t){if(t){typeof t.offerToReceiveAudio<"u"&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);const n=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");t.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):t.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof t.offerToReceiveVideo<"u"&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="video");t.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):t.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return o.apply(this,arguments)}}function Fe(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const se=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Fe,shimCallbacksAPI:De,shimConstraints:Oe,shimCreateOfferLegacy:Ne,shimGetUserMedia:Le,shimLocalStreamsAPI:Me,shimRTCIceServerUrls:je,shimRemoteStreamsAPI:Ie,shimTrackEventTransceiver:Ae},Symbol.toStringTag,{value:"Module"}));var J={exports:{}},ie;function dt(){return ie||(ie=1,function(e){const o={};o.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},o.localCName=o.generateIdentifier(),o.splitLines=function(r){return r.trim().split("\n").map(t=>t.trim())},o.splitSections=function(r){return r.split("\nm=").map((n,s)=>(s>0?"m="+n:n).trim()+"\r\n")},o.getDescription=function(r){const t=o.splitSections(r);return t&&t[0]},o.getMediaSections=function(r){const t=o.splitSections(r);return t.shift(),t},o.matchPrefix=function(r,t){return o.splitLines(r).filter(n=>n.indexOf(t)===0)},o.parseCandidate=function(r){let t;r.indexOf("a=candidate:")===0?t=r.substring(12).split(" "):t=r.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let s=8;s<t.length;s+=2)switch(t[s]){case"raddr":n.relatedAddress=t[s+1];break;case"rport":n.relatedPort=parseInt(t[s+1],10);break;case"tcptype":n.tcpType=t[s+1];break;case"ufrag":n.ufrag=t[s+1],n.usernameFragment=t[s+1];break;default:n[t[s]]===void 0&&(n[t[s]]=t[s+1]);break}return n},o.writeCandidate=function(r){const t=[];t.push(r.foundation);const n=r.component;n==="rtp"?t.push(1):n==="rtcp"?t.push(2):t.push(n),t.push(r.protocol.toUpperCase()),t.push(r.priority),t.push(r.address||r.ip),t.push(r.port);const s=r.type;return t.push("typ"),t.push(s),s!=="host"&&r.relatedAddress&&r.relatedPort&&(t.push("raddr"),t.push(r.relatedAddress),t.push("rport"),t.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(t.push("tcptype"),t.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(t.push("ufrag"),t.push(r.usernameFragment||r.ufrag)),"candidate:"+t.join(" ")},o.parseIceOptions=function(r){return r.substring(14).split(" ")},o.parseRtpMap=function(r){let t=r.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=t.length===3?parseInt(t[2],10):1,n.numChannels=n.channels,n},o.writeRtpMap=function(r){let t=r.payloadType;r.preferredPayloadType!==void 0&&(t=r.preferredPayloadType);const n=r.channels||r.numChannels||1;return"a=rtpmap:"+t+" "+r.name+"/"+r.clockRate+(n!==1?"/"+n:"")+"\r\n"},o.parseExtmap=function(r){const t=r.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},o.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+"\r\n"},o.parseFmtp=function(r){const t={};let n;const s=r.substring(r.indexOf(" ")+1).split(";");for(let a=0;a<s.length;a++)n=s[a].trim().split("="),t[n[0].trim()]=n[1];return t},o.writeFmtp=function(r){let t="",n=r.payloadType;if(r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const s=[];Object.keys(r.parameters).forEach(a=>{r.parameters[a]!==void 0?s.push(a+"="+r.parameters[a]):s.push(a)}),t+="a=fmtp:"+n+" "+s.join(";")+"\r\n"}return t},o.parseRtcpFb=function(r){const t=r.substring(r.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},o.writeRtcpFb=function(r){let t="",n=r.payloadType;return r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(s=>{t+="a=rtcp-fb:"+n+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+"\r\n"}),t},o.parseSsrcMedia=function(r){const t=r.indexOf(" "),n={ssrc:parseInt(r.substring(7,t),10)},s=r.indexOf(":",t);return s>-1?(n.attribute=r.substring(t+1,s),n.value=r.substring(s+1)):n.attribute=r.substring(t+1),n},o.parseSsrcGroup=function(r){const t=r.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(n=>parseInt(n,10))}},o.getMid=function(r){const t=o.matchPrefix(r,"a=mid:")[0];if(t)return t.substring(6)},o.parseFingerprint=function(r){const t=r.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},o.getDtlsParameters=function(r,t){return{role:"auto",fingerprints:o.matchPrefix(r+t,"a=fingerprint:").map(o.parseFingerprint)}},o.writeDtlsParameters=function(r,t){let n="a=setup:"+t+"\r\n";return r.fingerprints.forEach(s=>{n+="a=fingerprint:"+s.algorithm+" "+s.value+"\r\n"}),n},o.parseCryptoLine=function(r){const t=r.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},o.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?o.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+"\r\n"},o.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const t=r.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},o.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},o.getCryptoParameters=function(r,t){return o.matchPrefix(r+t,"a=crypto:").map(o.parseCryptoLine)},o.getIceParameters=function(r,t){const n=o.matchPrefix(r+t,"a=ice-ufrag:")[0],s=o.matchPrefix(r+t,"a=ice-pwd:")[0];return n&&s?{usernameFragment:n.substring(12),password:s.substring(10)}:null},o.writeIceParameters=function(r){let t="a=ice-ufrag:"+r.usernameFragment+"\r\na=ice-pwd:"+r.password+"\r\n";return r.iceLite&&(t+="a=ice-lite\r\n"),t},o.parseRtpParameters=function(r){const t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=o.splitLines(r)[0].split(" ");t.profile=s[2];for(let i=3;i<s.length;i++){const p=s[i],l=o.matchPrefix(r,"a=rtpmap:"+p+" ")[0];if(l){const c=o.parseRtpMap(l),u=o.matchPrefix(r,"a=fmtp:"+p+" ");switch(c.parameters=u.length?o.parseFmtp(u[0]):{},c.rtcpFeedback=o.matchPrefix(r,"a=rtcp-fb:"+p+" ").map(o.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase());break}}}o.matchPrefix(r,"a=extmap:").forEach(i=>{t.headerExtensions.push(o.parseExtmap(i))});const a=o.matchPrefix(r,"a=rtcp-fb:* ").map(o.parseRtcpFb);return t.codecs.forEach(i=>{a.forEach(p=>{i.rtcpFeedback.find(c=>c.type===p.type&&c.parameter===p.parameter)||i.rtcpFeedback.push(p)})}),t},o.writeRtpDescription=function(r,t){let n="";n+="m="+r+" ",n+=t.codecs.length>0?"9":"0",n+=" "+(t.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=t.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(a=>{n+=o.writeRtpMap(a),n+=o.writeFmtp(a),n+=o.writeRtcpFb(a)});let s=0;return t.codecs.forEach(a=>{a.maxptime>s&&(s=a.maxptime)}),s>0&&(n+="a=maxptime:"+s+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach(a=>{n+=o.writeExtmap(a)}),n},o.parseRtpEncodingParameters=function(r){const t=[],n=o.parseRtpParameters(r),s=n.fecMechanisms.indexOf("RED")!==-1,a=n.fecMechanisms.indexOf("ULPFEC")!==-1,i=o.matchPrefix(r,"a=ssrc:").map(d=>o.parseSsrcMedia(d)).filter(d=>d.attribute==="cname"),p=i.length>0&&i[0].ssrc;let l;const c=o.matchPrefix(r,"a=ssrc-group:FID").map(d=>d.substring(17).split(" ").map(C=>parseInt(C,10)));c.length>0&&c[0].length>1&&c[0][0]===p&&(l=c[0][1]),n.codecs.forEach(d=>{if(d.name.toUpperCase()==="RTX"&&d.parameters.apt){let h={ssrc:p,codecPayloadType:parseInt(d.parameters.apt,10)};p&&l&&(h.rtx={ssrc:l}),t.push(h),s&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:p,mechanism:a?"red+ulpfec":"red"},t.push(h))}}),t.length===0&&p&&t.push({ssrc:p});let u=o.matchPrefix(r,"b=");return u.length&&(u[0].indexOf("b=TIAS:")===0?u=parseInt(u[0].substring(7),10):u[0].indexOf("b=AS:")===0?u=parseInt(u[0].substring(5),10)*1e3*.95-50*40*8:u=void 0,t.forEach(d=>{d.maxBitrate=u})),t},o.parseRtcpParameters=function(r){const t={},n=o.matchPrefix(r,"a=ssrc:").map(i=>o.parseSsrcMedia(i)).filter(i=>i.attribute==="cname")[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);const s=o.matchPrefix(r,"a=rtcp-rsize");t.reducedSize=s.length>0,t.compound=s.length===0;const a=o.matchPrefix(r,"a=rtcp-mux");return t.mux=a.length>0,t},o.writeRtcpParameters=function(r){let t="";return r.reducedSize&&(t+="a=rtcp-rsize\r\n"),r.mux&&(t+="a=rtcp-mux\r\n"),r.ssrc!==void 0&&r.cname&&(t+="a=ssrc:"+r.ssrc+" cname:"+r.cname+"\r\n"),t},o.parseMsid=function(r){let t;const n=o.matchPrefix(r,"a=msid:");if(n.length===1)return t=n[0].substring(7).split(" "),{stream:t[0],track:t[1]};const s=o.matchPrefix(r,"a=ssrc:").map(a=>o.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(s.length>0)return t=s[0].value.split(" "),{stream:t[0],track:t[1]}},o.parseSctpDescription=function(r){const t=o.parseMLine(r),n=o.matchPrefix(r,"a=max-message-size:");let s;n.length>0&&(s=parseInt(n[0].substring(19),10)),isNaN(s)&&(s=65536);const a=o.matchPrefix(r,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:t.fmt,maxMessageSize:s};const i=o.matchPrefix(r,"a=sctpmap:");if(i.length>0){const p=i[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:s}}},o.writeSctpDescription=function(r,t){let n=[];return r.protocol!=="DTLS/SCTP"?n=["m="+r.kind+" 9 "+r.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:n=["m="+r.kind+" 9 "+r.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],t.maxMessageSize!==void 0&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},o.generateSessionId=function(){return Math.random().toString().substr(2,22)},o.writeSessionBoilerplate=function(r,t,n){let s;const a=t!==void 0?t:2;return r?s=r:s=o.generateSessionId(),"v=0\r\no="+(n||"thisisadapterortc")+" "+s+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},o.getDirection=function(r,t){const n=o.splitLines(r);for(let s=0;s<n.length;s++)switch(n[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[s].substring(2)}return t?o.getDirection(t):"sendrecv"},o.getKind=function(r){return o.splitLines(r)[0].split(" ")[0].substring(2)},o.isRejected=function(r){return r.split(" ",2)[1]==="0"},o.parseMLine=function(r){const n=o.splitLines(r)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},o.parseOLine=function(r){const n=o.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},o.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const t=o.splitLines(r);for(let n=0;n<t.length;n++)if(t[n].length<2||t[n].charAt(1)!=="=")return!1;return!0},e.exports=o}(J)),J.exports}var Ue=dt();const j=ze(Ue),ft=at({__proto__:null,default:j},[Ue]);function F(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const o=e.RTCIceCandidate;e.RTCIceCandidate=function(t){if(typeof t=="object"&&t.candidate&&t.candidate.indexOf("a=")===0&&(t=JSON.parse(JSON.stringify(t)),t.candidate=t.candidate.substring(2)),t.candidate&&t.candidate.length){const n=new o(t),s=j.parseCandidate(t.candidate);for(const a in s)a in n||Object.defineProperty(n,a,{value:s[a]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new o(t)},e.RTCIceCandidate.prototype=o.prototype,O(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function K(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||O(e,"icecandidate",o=>{if(o.candidate){const r=j.parseCandidate(o.candidate.candidate);r.type==="relay"&&(o.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return o})}function U(e,o){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const r=function(i){if(!i||!i.sdp)return!1;const p=j.splitSections(i.sdp);return p.shift(),p.some(l=>{const c=j.parseMLine(l);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})},t=function(i){const p=i.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const l=parseInt(p[1],10);return l!==l?-1:l},n=function(i){let p=65536;return o.browser==="firefox"&&(o.version<57?i===-1?p=16384:p=2147483637:o.version<60?p=o.version===57?65535:65536:p=2147483637),p},s=function(i,p){let l=65536;o.browser==="firefox"&&o.version===57&&(l=65535);const c=j.matchPrefix(i.sdp,"a=max-message-size:");return c.length>0?l=parseInt(c[0].substring(19),10):o.browser==="firefox"&&p!==-1&&(l=2147483637),l},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,o.browser==="chrome"&&o.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const p=t(arguments[0]),l=n(p),c=s(arguments[0],p);let u;l===0&&c===0?u=Number.POSITIVE_INFINITY:l===0||c===0?u=Math.max(l,c):u=Math.min(l,c);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return u}}),this._sctp=d}return a.apply(this,arguments)}}function z(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function o(t,n){const s=t.send;t.send=function(){const i=arguments[0],p=i.length||i.size||i.byteLength;if(t.readyState==="open"&&n.sctp&&p>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return s.apply(t,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const n=r.apply(this,arguments);return o(n,this),n},O(e,"datachannel",t=>(o(t.channel,t.target),t))}function Q(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const o=e.RTCPeerConnection.prototype;Object.defineProperty(o,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(o,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const t=o[r];o[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const s=n.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",n);s.dispatchEvent(a)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}})}function X(e,o){if(!e.RTCPeerConnection||o.browser==="chrome"&&o.version>=71||o.browser==="safari"&&o._safariVersion>=13.1)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf("\na=extmap-allow-mixed")!==-1){const s=n.sdp.split("\n").filter(a=>a.trim()!=="a=extmap-allow-mixed").join("\n");e.RTCSessionDescription&&n instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:n.type,sdp:s}):n.sdp=s}return r.apply(this,arguments)}}function $(e,o){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const r=e.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(o.browser==="chrome"&&o.version<78||o.browser==="firefox"&&o.version<68||o.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function G(e,o){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const r=e.RTCPeerConnection.prototype.setLocalDescription;!r||r.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return r.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?r.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>r.apply(this,[a]))})}const mt=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:X,shimAddIceCandidateNullOrEmpty:$,shimConnectionState:Q,shimMaxMessageSize:U,shimParameterlessSetLocalDescription:G,shimRTCIceCandidate:F,shimRTCIceCandidateRelayProtocol:K,shimSendThrowTypeError:z},Symbol.toStringTag,{value:"Module"}));function ht({window:e}={},o={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=le,t=pt(e),n={browserDetails:t,commonShim:mt,extractVersion:A,disableLog:ct,disableWarnings:lt,sdp:ft};switch(t.browser){case"chrome":if(!ne||!q||!o.shimChrome)return r("Chrome shim is not included in this adapter release."),n;if(t.version===null)return r("Chrome shim can not determine version, not shimming."),n;r("adapter.js shimming chrome."),n.browserShim=ne,$(e,t),G(e),ue(e,t),de(e),q(e,t),fe(e),ye(e,t),me(e),he(e),Ce(e,t),F(e),K(e),Q(e),U(e,t),z(e),X(e,t);break;case"firefox":if(!oe||!H||!o.shimFirefox)return r("Firefox shim is not included in this adapter release."),n;r("adapter.js shimming firefox."),n.browserShim=oe,$(e,t),G(e),ve(e,t),H(e,t),Se(e),be(e),Te(e),Re(e),Pe(e),xe(e),ke(e),_e(e),Ee(e),F(e),Q(e),U(e,t),z(e);break;case"safari":if(!se||!o.shimSafari)return r("Safari shim is not included in this adapter release."),n;r("adapter.js shimming safari."),n.browserShim=se,$(e,t),G(e),je(e),Ne(e),De(e),Me(e),Ie(e),Ae(e),Le(e),Fe(e),F(e),K(e),U(e,t),z(e),X(e,t);break;default:r("Unsupported browser!");break}return n}ht({window:typeof window>"u"?void 0:window});function gt({stream:e,streamId:o,onToggleFullscreen:r}){const[t,n]=E(!0),[s,a]=E(null),[i,p]=E(!1),[l,c]=E("unknown"),u=D(null),d=D(null),h=D(null),C=D(null),S=D(null),P=D(null),N=D(0);L(()=>{if(!e||!e.name||!u.current)return;console.log("Initializing WebRTC connection for stream ".concat(e.name)),n(!0),a(null);const g=new RTCPeerConnection({iceTransports:"all",bundlePolicy:"balanced",rtcpCnameCpn:"LightNVR",rtcpCnameRtp:"LightNVR",iceCandidatePoolSize:0,iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});h.current=g,g.ontrack=v=>{if(console.log("Track received for stream ".concat(e.name)),v.track.kind==="video"){const m=u.current;if(!m)return;m.srcObject=v.streams[0],m.onloadeddata=()=>{console.log("Video data loaded for stream ".concat(e.name))},m.onplaying=()=>{console.log("Video playing for stream ".concat(e.name)),n(!1),p(!0)},m.onerror=y=>{console.error("Error loading video for stream ".concat(e.name,":"),y),a("Failed to load video"),n(!1)}}},g.oniceconnectionstatechange=()=>{console.log("ICE connection state for stream ".concat(e.name,": ").concat(g.iceConnectionState)),g.iceConnectionState==="failed"?(console.error("WebRTC ICE connection failed for stream ".concat(e.name)),a("WebRTC ICE connection failed"),n(!1)):g.iceConnectionState==="disconnected"?(console.warn("WebRTC ICE connection disconnected for stream ".concat(e.name,", attempting to recover...")),setTimeout(()=>{h.current&&(h.current.iceConnectionState==="disconnected"||h.current.iceConnectionState==="failed")?(console.error("WebRTC ICE connection could not recover for stream ".concat(e.name)),a("WebRTC connection lost. Please retry."),n(!1)):h.current&&console.log("WebRTC ICE connection recovered for stream ".concat(e.name,", current state: ").concat(h.current.iceConnectionState))},5e3)):(g.iceConnectionState==="connected"||g.iceConnectionState==="completed")&&s&&(console.log("WebRTC connection restored for stream ".concat(e.name)),a(null))},g.addTransceiver("video",{direction:"recvonly"}),g.createOffer().then(v=>g.setLocalDescription(v)).then(()=>{S.current=new AbortController;const v={type:g.localDescription.type,sdp:g.localDescription.sdp},m=localStorage.getItem("auth");return fetch("/api/webrtc?src=".concat(encodeURIComponent(e.name)),{method:"POST",headers:{"Content-Type":"application/json",...m?{Authorization:"Basic "+m}:{}},body:JSON.stringify(v)})}).then(v=>{if(!v.ok)throw new Error("Failed to send offer: ".concat(v.status," ").concat(v.statusText));return v.text()}).then(v=>{try{return JSON.parse(v)}catch(m){throw console.error("Error parsing JSON for stream ".concat(e.name,":"),m),new Error("Failed to parse WebRTC answer")}}).then(v=>g.setRemoteDescription(new RTCSessionDescription(v))).catch(v=>{console.error("Error setting up WebRTC for stream ".concat(e.name,":"),v),a(v.message||"Failed to establish WebRTC connection")});const x=()=>{P.current&&clearInterval(P.current),P.current=setInterval(()=>{h.current&&h.current.getStats().then(v=>{let m=0,y=0,R=0,b=0;v.forEach(_=>{_.type==="inbound-rtp"&&_.kind==="video"&&(m=_.packetsLost||0,y=_.packetsReceived||0,b=_.jitter||0),_.type==="candidate-pair"&&_.state==="succeeded"&&(R=_.currentRoundTripTime||0)});const T=y+m,M=T>0?m/T*100:0;let I="unknown";y>0&&(M<2&&R<.1&&b<.03?I="good":M<5&&R<.3&&b<.1?I="fair":M<15&&R<1?I="poor":I="bad"),I!==l&&(console.log("WebRTC connection quality for stream ".concat(e.name," changed to ").concat(I)),console.log("Stats: loss=".concat(M.toFixed(2),"%, rtt=").concat((R*1e3).toFixed(0),"ms, jitter=").concat((b*1e3).toFixed(0),"ms")),c(I))}).catch(v=>{console.warn("Error getting WebRTC stats for stream ".concat(e.name,":"),v)})},1e4)};h.current&&h.current.iceConnectionState==="connected"&&x();const k=g.oniceconnectionstatechange;return g.oniceconnectionstatechange=()=>{k&&k(),(g.iceConnectionState==="connected"||g.iceConnectionState==="completed")&&(x(),N.current=0),(g.iceConnectionState==="disconnected"||g.iceConnectionState==="failed"||g.iceConnectionState==="closed")&&P.current&&(clearInterval(P.current),P.current=null)},()=>{console.log("Cleaning up WebRTC connection for stream ".concat(e.name)),P.current&&(clearInterval(P.current),P.current=null),S.current&&(S.current.abort(),S.current=null),u.current&&u.current.srcObject&&(u.current.srcObject.getTracks().forEach(m=>m.stop()),u.current.srcObject=null),h.current&&(h.current.close(),h.current=null)}},[e]);const V=()=>{a(null),n(!0),h.current&&(h.current.close(),h.current=null),u.current&&u.current.srcObject&&(u.current.srcObject.getTracks().forEach(x=>x.stop()),u.current.srcObject=null),p(!1)};return f("div",{className:"video-cell","data-stream-name":e.name,"data-stream-id":o,ref:d,style:{position:"relative",pointerEvents:"auto",zIndex:1},children:[f("video",{id:"video-".concat(o.replace(/\s+/g,"-")),className:"video-element",ref:u,autoPlay:!0,muted:!0,disablePictureInPicture:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"contain"}}),e.detection_based_recording&&e.detection_model&&f(Ke,{ref:C,streamName:e.name,videoRef:u,enabled:i,detectionModel:e.detection_model}),f("div",{className:"stream-name-overlay",style:{position:"absolute",top:"10px",left:"10px",padding:"5px 10px",backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",borderRadius:"4px",fontSize:"14px",zIndex:3,display:"flex",alignItems:"center",gap:"8px"},children:[e.name,i&&l!=="unknown"&&f("div",{className:"connection-quality-indicator quality-".concat(l),title:"Connection Quality: ".concat(l.charAt(0).toUpperCase()+l.slice(1)),style:{width:"10px",height:"10px",borderRadius:"50%",backgroundColor:l==="good"?"#10B981":l==="fair"?"#FBBF24":l==="poor"?"#F97316":l==="bad"?"#EF4444":"#6B7280",boxShadow:"0 0 4px rgba(0, 0, 0, 0.3)"}})]}),f("div",{className:"stream-controls",style:{position:"absolute",bottom:"10px",right:"10px",display:"flex",gap:"10px",zIndex:5,backgroundColor:"rgba(0, 0, 0, 0.5)",padding:"5px",borderRadius:"4px"},children:[f("div",{style:{backgroundColor:"transparent",padding:"5px",borderRadius:"4px"},onMouseOver:g=>g.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)",onMouseOut:g=>g.currentTarget.style.backgroundColor="transparent",children:f(we,{streamId:o,streamName:e.name,onSnapshot:()=>{if(u.current){let g=null;if(C.current&&typeof C.current.getCanvasRef=="function"&&(g=C.current.getCanvasRef()),g){const x=Qe(u,g,e.name);x&&w(x.canvas.toDataURL("image/jpeg",.95),"Snapshot: ".concat(e.name))}else{const x=u.current,k=document.createElement("canvas");k.width=x.videoWidth,k.height=x.videoHeight,k.width>0&&k.height>0&&(k.getContext("2d").drawImage(x,0,0,k.width,k.height),w(k.toDataURL("image/jpeg",.95),"Snapshot: ".concat(e.name)))}}}})}),f("button",{className:"fullscreen-btn",title:"Toggle Fullscreen","data-id":o,"data-name":e.name,onClick:g=>r(e.name,g,d.current),style:{backgroundColor:"transparent",border:"none",padding:"5px",borderRadius:"4px",color:"white",cursor:"pointer"},onMouseOver:g=>g.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)",onMouseOut:g=>g.currentTarget.style.backgroundColor="transparent",children:f("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"white","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",children:f("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})})})]}),t&&f("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:5,pointerEvents:"none"},children:f(ot,{message:"Connecting..."})}),s&&f("div",{className:"error-indicator",style:{position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",zIndex:5,textAlign:"center"},children:f("div",{className:"error-content",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"80%",maxWidth:"300px",padding:"20px",borderRadius:"8px",backgroundColor:"rgba(0, 0, 0, 0.5)"},children:[f("div",{className:"error-icon",style:{fontSize:"28px",marginBottom:"15px",fontWeight:"bold",width:"40px",height:"40px",lineHeight:"40px",borderRadius:"50%",backgroundColor:"rgba(220, 38, 38, 0.8)",textAlign:"center"},children:"!"}),f("p",{style:{marginBottom:"20px",textAlign:"center",width:"100%",fontSize:"14px",lineHeight:"1.4"},children:s}),f("button",{className:"retry-button",onClick:V,style:{padding:"8px 20px",backgroundColor:"#2563eb",color:"white",borderRadius:"4px",border:"none",cursor:"pointer",fontWeight:"bold",fontSize:"14px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)",transition:"background-color 0.2s ease"},onMouseOver:g=>g.currentTarget.style.backgroundColor="#1d4ed8",onMouseOut:g=>g.currentTarget.style.backgroundColor="#2563eb",children:"Retry"})]})})]})}function yt(){const{takeSnapshot:e}=et(),{isFullscreen:o,setIsFullscreen:r,toggleFullscreen:t}=Xe(),[n,s]=E([]),[a,i]=E(!0),[p,l]=E(()=>{const y=new URLSearchParams(window.location.search).get("layout");return y||sessionStorage.getItem("webrtc_layout")||"4"}),[c,u]=E(()=>{const y=new URLSearchParams(window.location.search).get("stream");return y||sessionStorage.getItem("webrtc_selected_stream")||""}),[d,h]=E(()=>{const y=new URLSearchParams(window.location.search).get("page");if(y)return Math.max(0,parseInt(y,10)-1);const R=sessionStorage.getItem("webrtc_current_page");return R?Math.max(0,parseInt(R,10)-1):0}),C=$e();L(()=>{tt(),rt()},[]);const{data:S,isLoading:P,error:N}=Ge("streams","/api/streams",{timeout:15e3,retries:2,retryDelay:1e3});L(()=>{i(P)},[P]),L(()=>{S&&Array.isArray(S)&&(async()=>{try{const y=await V(S);if(y.length>0){s(y);const b=new URLSearchParams(window.location.search).get("stream");b&&y.some(T=>T.name===b)?u(b):(!c||!y.some(T=>T.name===c))&&u(y[0].name)}else console.warn("No streams available for WebRTC view after filtering")}catch(y){console.error("Error processing streams:",y),W("Error processing streams: "+y.message)}})()},[S,c]),L(()=>{if(n.length===0)return;console.log("Updating URL parameters");const m=new URL(window.location);d===0?m.searchParams.delete("page"):m.searchParams.set("page",d+1),p!=="4"?m.searchParams.set("layout",p):m.searchParams.delete("layout"),p==="1"&&c?m.searchParams.set("stream",c):m.searchParams.delete("stream"),window.history.replaceState({},"",m),d>0?sessionStorage.setItem("webrtc_current_page",(d+1).toString()):sessionStorage.removeItem("webrtc_current_page"),p!=="4"?sessionStorage.setItem("webrtc_layout",p):sessionStorage.removeItem("webrtc_layout"),p==="1"&&c?sessionStorage.setItem("webrtc_selected_stream",c):sessionStorage.removeItem("webrtc_selected_stream")},[d,p,c,n.length]);const V=async m=>{try{if(!m||!Array.isArray(m))return console.warn("No streams data provided to filter"),[];const y=m.map(async T=>{try{const M=T.id||T.name;return await C.fetchQuery({queryKey:["stream-details",M],queryFn:async()=>{const _=await fetch("/api/streams/".concat(encodeURIComponent(M)));if(!_.ok)throw new Error("Failed to load details for stream ".concat(T.name));return _.json()},staleTime:3e4})}catch(M){return console.error("Error loading details for stream ".concat(T.name,":"),M),T}}),R=await Promise.all(y);console.log("Loaded detailed streams for WebRTC view:",R);const b=R.filter(T=>T.is_deleted?(console.log("Stream ".concat(T.name," is soft deleted, filtering out")),!1):T.enabled?T.streaming_enabled?!0:(console.log("Stream ".concat(T.name," is not configured for streaming, filtering out")),!1):(console.log("Stream ".concat(T.name," is inactive, filtering out")),!1));return console.log("Filtered streams for WebRTC view:",b),b||[]}catch(y){return console.error("Error filtering streams for WebRTC view:",y),W("Error processing streams: "+y.message),[]}},g=Z(()=>{switch(p){case"1":return 1;case"2":return 2;case"4":return 4;case"6":return 6;case"9":return 9;case"16":return 16;default:return 4}},[p]),x=Z(()=>{let m=n;if(p==="1"&&c)m=n.filter(y=>y.name===c);else{const y=g(),R=Math.ceil(n.length/y);if(d>=R&&R>0)return[];const b=d*y,T=Math.min(b+y,n.length);m=n.slice(b,T)}return m},[n,p,c,d]);L(()=>{if(n.length===0)return;const m=g(),y=Math.ceil(n.length/m);d>=y&&h(Math.max(0,y-1))},[n,p,d,g]);const k=(m,y,R)=>{if(y&&(y.preventDefault(),y.stopPropagation()),!m){console.error("Stream name not provided for fullscreen toggle");return}if(console.log("Toggling fullscreen for stream: ".concat(m)),!R){console.error("Video cell element not provided for fullscreen toggle");return}document.fullscreenElement?(console.log("Exiting fullscreen mode"),document.exitFullscreen()):(console.log("Entering fullscreen mode for video cell"),R.requestFullscreen().catch(b=>{console.error("Error attempting to enable fullscreen: ".concat(b.message)),W("Could not enable fullscreen mode: ".concat(b.message))}))},v=Ve(()=>x(),[n,p,c,d,g]);return f("section",{id:"live-page",className:"page ".concat(o?"fullscreen-mode":""),children:[f(nt,{}),f(Ye,{isFullscreen:o,setIsFullscreen:r,targetId:"live-page"}),f("div",{className:"page-header flex justify-between items-center mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow",style:{position:"relative",zIndex:10,pointerEvents:"auto"},children:[f("div",{className:"flex items-center space-x-2",children:[f("h2",{className:"text-xl font-bold mr-4",children:"Live View"}),f("div",{className:"flex space-x-2",children:f("button",{id:"hls-toggle-btn",className:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 inline-block text-center",style:{position:"relative",zIndex:50},onClick:()=>{window.location.href="/hls.html"},children:"HLS View"})})]}),f("div",{className:"controls flex items-center space-x-2",children:[f("div",{className:"flex items-center",children:[f("label",{htmlFor:"layout-selector",className:"mr-2",children:"Layout:"}),f("select",{id:"layout-selector",className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600",value:p,onChange:m=>{const y=m.target.value;l(y),h(0)},children:[f("option",{value:"1",children:"1 Stream"}),f("option",{value:"2",children:"2 Streams"}),f("option",{value:"4",children:"4 Streams"}),f("option",{value:"6",children:"6 Streams"}),f("option",{value:"9",children:"9 Streams"}),f("option",{value:"16",children:"16 Streams"})]})]}),p==="1"&&f("div",{className:"flex items-center",children:[f("label",{htmlFor:"stream-selector",className:"mr-2",children:"Stream:"}),f("select",{id:"stream-selector",className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600",value:c,onChange:m=>{const y=m.target.value;u(y)},children:n.map(m=>f("option",{value:m.name,children:m.name},m.name))})]}),f("button",{id:"fullscreen-btn",className:"p-2 rounded-full bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none",onClick:()=>t(),title:"Toggle Fullscreen",children:f("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:f("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})})})]})]}),f("div",{className:"flex flex-col space-y-4 h-full",children:[f("div",{id:"video-grid",className:"video-container layout-".concat(p),children:P?f("div",{className:"flex justify-center items-center col-span-full row-span-full h-64 w-full",style:{pointerEvents:"none",zIndex:1},children:f("div",{className:"flex flex-col items-center justify-center py-8",children:[f("div",{className:"inline-block animate-spin rounded-full border-4 border-gray-300 dark:border-gray-600 border-t-blue-600 dark:border-t-blue-500 w-16 h-16"}),f("p",{className:"mt-4 text-gray-700 dark:text-gray-300",children:"Loading streams..."})]})}):a&&!P?f("div",{className:"flex justify-center items-center col-span-full row-span-full h-64 w-full",style:{pointerEvents:"none",position:"relative",zIndex:1},children:f("div",{className:"flex flex-col items-center justify-center py-8",children:[f("div",{className:"inline-block animate-spin rounded-full border-4 border-gray-300 dark:border-gray-600 border-t-blue-600 dark:border-t-blue-500 w-16 h-16"}),f("p",{className:"mt-4 text-gray-700 dark:text-gray-300",children:"Loading streams..."})]})}):N?f("div",{className:"placeholder flex flex-col justify-center items-center col-span-full row-span-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-center p-8",children:[f("p",{className:"mb-6 text-gray-600 dark:text-gray-300 text-lg",children:["Error loading streams: ",N.message]}),f("button",{onClick:()=>window.location.reload(),className:"btn-primary px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Retry"})]}):n.length===0?f("div",{className:"placeholder flex flex-col justify-center items-center col-span-full row-span-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-center p-8",children:[f("p",{className:"mb-6 text-gray-600 dark:text-gray-300 text-lg",children:"No streams configured"}),f("a",{href:"streams.html",className:"btn-primary px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Configure Streams"})]}):v.map(m=>f(gt,{stream:m,onToggleFullscreen:k,streamId:m.name},m.name))}),p!=="1"&&n.length>g()?f("div",{className:"pagination-controls flex justify-center items-center space-x-4 mt-4",children:[f("button",{className:"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{console.log("Changing to previous page"),h(Math.max(0,d-1))},disabled:d===0,children:"Previous"}),f("span",{className:"text-gray-700 dark:text-gray-300",children:["Page ",d+1," of ",Math.ceil(n.length/g())]}),f("button",{className:"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{console.log("Changing to next page");const m=Math.ceil(n.length/g());h(Math.min(m-1,d+1))},disabled:d>=Math.ceil(n.length/g())-1,children:"Next"})]}):null]})]})}function Ct(){const[e,o]=E(!1),[r,t]=E(!0);return L(()=>{async function n(){try{const s=await fetch("/api/settings");if(!s.ok){console.error("Failed to fetch settings:",s.status,s.statusText),t(!1);return}(await s.json()).webrtc_disabled?(console.log("WebRTC is disabled, using HLS view"),o(!0)):(console.log("WebRTC is enabled, using WebRTC view"),o(!1))}catch(s){console.error("Error checking WebRTC status:",s)}finally{t(!1)}}n()},[]),r?f("div",{className:"loading",children:"Loading..."}):f(He,{children:e?f(Ze,{isWebRTCDisabled:!0}):f(yt,{})})}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("main-content");e&&We(f(qe,{client:Je,children:[f(st,{}),f(Be,{}),f(Ct,{}),f(it,{})]}),e)});export{vt as __vite_legacy_guard};
//# sourceMappingURL=index-DR_ivXOr.js.map
