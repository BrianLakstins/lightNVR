System.register(["./query-client-legacy-CJ8v9NTz.js"],(function(e,t){"use strict";var r,n,o,a,d,i,s,l;return{setters:[e=>{r=e.K,n=e.u,o=e.s,a=e.d,d=e.A,i=e.y,s=e.q,l=e.$}],execute:function(){e({D:function(e){const{isOpen:t,onClose:r,onConfirm:o,mode:a,count:d}=e;if(!t)return null;let i="Confirm Delete",s="Are you sure you want to delete this item?";return"selected"===a?(i="Delete Selected Recordings",s=`Are you sure you want to delete ${d} selected recording${1!==d?"s":""}?`):"all"===a&&(i="Delete All Filtered Recordings",s="Are you sure you want to delete all recordings matching the current filters? This action cannot be undone."),n("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e=>{e.target===e.currentTarget&&r()},onKeyDown:e=>{"Escape"===e.key&&r()},children:n("div",{class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md mx-auto",children:[n("div",{class:"mb-4",children:n("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white",children:i})}),n("p",{class:"text-gray-600 dark:text-gray-300 mb-6",children:s}),n("div",{class:"flex justify-end space-x-3",children:[n("button",{class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",onClick:r,children:"Cancel"}),n("button",{class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",onClick:o,children:"Delete"})]})]})})},a:function(){console.warn("addModalStyles() is deprecated. Modal styles are now included in components.css")},b:function(e,r,n){if(console.warn("Direct showVideoModal() is deprecated. Use ModalContext.showVideoModal instead."),window.__modalContext&&window.__modalContext.showVideoModal)return void window.__modalContext.showVideoModal(e,r,n);if(!document.getElementById("modal-root")){const e=document.createElement("div");e.id="modal-root",document.body.appendChild(e)}const a=document.createElement("div");a.id="temp-modal-container",document.body.appendChild(a),c((async()=>{const{render:e,h:r}=await t.import("./query-client-legacy-CJ8v9NTz.js").then((e=>e.p));return{render:e,h:r}}),void 0,t.meta.url).then((({render:t,h:o})=>{t(o(h,{isOpen:!0,onClose:()=>{t(null,a),document.body.removeChild(a)},videoUrl:e,title:r,downloadUrl:n}),a)})).catch((e=>{console.error("Error rendering video modal:",e),o("Error showing video modal: "+e.message,"error")}))},c:function(e,r){if(console.warn("Direct showSnapshotPreview() is deprecated. Use ModalContext.showSnapshotPreview instead."),window.__modalContext&&window.__modalContext.showSnapshotPreview)return void window.__modalContext.showSnapshotPreview(e,r);if(!document.getElementById("modal-root")){const e=document.createElement("div");e.id="modal-root",document.body.appendChild(e)}const n=document.createElement("div");n.id="temp-snapshot-container",document.body.appendChild(n),c((async()=>{const{render:e,h:r}=await t.import("./query-client-legacy-CJ8v9NTz.js").then((e=>e.p));return{render:e,h:r}}),void 0,t.meta.url).then((({render:a,h:d})=>{a(d(m,{isOpen:!0,onClose:()=>{a(null,n),document.body.removeChild(n)},imageData:e,streamName:r,onDownload:()=>{try{c((async()=>{const{useSnapshotManager:e}=await t.import("./SnapshotManager-legacy-Cl7HjlRB.js");return{useSnapshotManager:e}}),void 0,t.meta.url).then((({useSnapshotManager:t})=>{const{downloadSnapshot:n}=t();if(n)n();else{const t=(new Date).toISOString().replace(/[:.]/g,"-"),n=`snapshot_${r}_${t}.jpg`,a=document.createElement("a");a.href=e,a.download=n,document.body.appendChild(a),a.click(),setTimeout((()=>{document.body.removeChild(a)}),100),o("Snapshot downloaded successfully","success",3e3)}})).catch((t=>{console.error("Error importing SnapshotManager:",t);const n=(new Date).toISOString().replace(/[:.]/g,"-"),a=`snapshot_${r}_${n}.jpg`,d=document.createElement("a");d.href=e,d.download=a,document.body.appendChild(d),d.click(),setTimeout((()=>{document.body.removeChild(d)}),100),o("Snapshot downloaded successfully","success",3e3)}))}catch(n){console.error("Error downloading snapshot:",n),o("Download failed: "+n.message,"error",5e3)}}}),n)})).catch((e=>{console.error("Error rendering snapshot modal:",e),o("Error showing snapshot preview: "+e.message,"error")}))},s:function(){console.warn("setupModals() is deprecated. Use <ModalProvider> component instead.")}});const c=function(e,t,r){let n=Promise.resolve();function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then((t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)}))};function m({isOpen:e,onClose:t,imageData:r,streamName:o,onDownload:a}){const s=d(null);return i((()=>{const r=r=>{"Escape"===r.key&&e&&t()};return document.addEventListener("keydown",r),e&&s.current&&setTimeout((()=>{const e=s.current.querySelector(".modal-content");e&&(e.classList.remove("scale-95","opacity-0"),e.classList.add("scale-100","opacity-100"))}),10),()=>{document.removeEventListener("keydown",r)}}),[e,t]),e?l(n("div",{ref:s,id:"snapshot-preview-modal",className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:e=>{e.target===e.currentTarget&&t()},children:n("div",{className:"modal-content bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl max-h-[90vh] flex flex-col transform transition-all duration-300 ease-out scale-95 opacity-0",style:{width:"90%"},children:[n("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[n("h3",{id:"snapshot-preview-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:o?`Snapshot: ${o}`:"Snapshot"}),n("button",{className:"close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:t,children:"✕"})]}),n("div",{className:"p-4 overflow-auto flex-grow",children:n("img",{id:"snapshot-preview-image",className:"max-w-full max-h-[70vh] mx-auto",src:r,alt:"Snapshot"})}),n("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-2",children:[n("button",{id:"snapshot-download-btn",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",onClick:a,children:"Download"}),n("button",{id:"snapshot-close-btn",className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",onClick:t,children:"Close"})]})]})}),document.body):null}function h({isOpen:e,onClose:t,videoUrl:r,title:o,downloadUrl:c}){const[m,h]=a(!1),[u,g]=a(2),[y,p]=a([]),[f,w]=a(null),[x,b]=a("No detections loaded"),[v,k]=a(1),N=d(null),C=d(null),E=d(null);i((()=>{const r=r=>{"Escape"===r.key&&e&&t()};return document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}}),[e,t]),i((()=>{if(!e||!r)return;const t=r.match(/\/play\/(\d+)/);if(!t||!t[1])return;const n=parseInt(t[1],10);(async()=>{try{const e=await fetch(`/api/recordings/${n}`);if(!e.ok)throw new Error("Failed to fetch recording data");const t=await e.json();if(w(t),t&&t.stream&&t.start_time&&t.end_time){const e=Math.floor(new Date(t.start_time).getTime()/1e3),r=Math.floor(new Date(t.end_time).getTime()/1e3),n=await fetch(`/api/detection/results/${t.stream}?start=${e}&end=${r}`);if(!n.ok)throw new Error("Failed to fetch detections");const o=(await n.json()).detections||[];p(o),o.length>0?b(`${o.length} detection${1!==o.length?"s":""} available`):b("No detections found for this recording")}}catch(e){console.error("Error fetching data:",e),b("Error loading detections")}})()}),[e,r]);const S=s((()=>{if(!m||!N.current||!C.current||0===y.length)return;const e=N.current,t=C.current,r=e.videoWidth,n=e.videoHeight;if(0===r||0===n)return void requestAnimationFrame(S);t.width=r,t.height=n;const o=t.getContext("2d");o.clearRect(0,0,t.width,t.height);const a=e.currentTime;if(!f||!f.start_time)return;const d=Math.floor(new Date(f.start_time).getTime()/1e3)+Math.floor(a),i=y.filter((e=>!!e.timestamp&&Math.abs(e.timestamp-d)<=u));i.length>0?b(`Showing ${i.length} detection${1!==i.length?"s":""} at current time`):b(`No detections at current time (${y.length} total)`),i.forEach((e=>{const t=e.x*r,a=e.y*n,d=e.width*r,i=e.height*n;o.strokeStyle="rgba(0, 255, 0, 0.8)",o.lineWidth=2,o.strokeRect(t,a,d,i),o.fillStyle="rgba(0, 0, 0, 0.7)";const s=`${e.label} (${Math.round(100*e.confidence)}%)`,l=o.measureText(s).width+10;o.fillRect(t,a-20,l,20),o.fillStyle="white",o.font="12px Arial",o.fillText(s,t+5,a-5)})),e.paused||e.ended||requestAnimationFrame(S)}),[m,y,f,u]);return i((()=>{if(!e||!N.current)return;const t=N.current,r=()=>{m&&S()},n=()=>{m&&S()},o=()=>{if(m){const e=Math.floor(2*t.currentTime)/2;t.lastDrawnTime!==e&&(t.lastDrawnTime=e,S())}};return t.addEventListener("play",r),t.addEventListener("seeked",n),t.addEventListener("timeupdate",o),()=>{t.removeEventListener("play",r),t.removeEventListener("seeked",n),t.removeEventListener("timeupdate",o)}}),[e,m,S]),i((()=>{m?(C.current&&(C.current.style.display="block"),S()):C.current&&(C.current.style.display="none")}),[m,S]),e?l(n("div",{ref:E,id:"video-preview-modal",className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:e=>{e.target===e.currentTarget&&t()},children:n("div",{className:"modal-content bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl max-h-[90vh] flex flex-col transform transition-all duration-300 ease-out scale-95 opacity-0 w-full md:w-[90%]",children:[n("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[n("h3",{id:"video-preview-title",className:"text-lg font-semibold text-gray-900 dark:text-white",children:o||"Video"}),n("button",{className:"close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:t,children:"✕"})]}),n("div",{className:"p-4 flex-grow",children:n("div",{className:"relative",children:[n("video",{ref:N,className:"w-full h-auto max-w-full object-contain mx-auto",src:r,controls:!0,autoPlay:!0}),n("canvas",{ref:C,className:"absolute top-0 left-0 w-full h-full pointer-events-none",style:{display:"none"}})]})}),n("div",{id:"recordings-controls",className:"mx-4 mb-4 p-4 border border-green-500 rounded-lg bg-white dark:bg-gray-700 shadow-md relative z-10",children:[n("h3",{className:"text-lg font-bold text-center mb-4 text-gray-800 dark:text-white",children:"PLAYBACK CONTROLS"}),n("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-2",children:[n("div",{className:"border-b pb-4 md:border-b-0 md:border-r md:pr-4 md:pb-0",children:[n("h4",{className:"font-bold text-center mb-3 text-gray-700 dark:text-gray-300",children:"Playback Speed"}),n("div",{className:"flex flex-wrap justify-center gap-2",children:[.25,.5,1,1.5,2,4].map((e=>n("button",{className:`speed-btn px-3 py-2 rounded-full ${e===v?"bg-green-500 text-white":"bg-gray-200 hover:bg-gray-300"} text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50`,"data-speed":e,onClick:()=>(e=>{N.current&&(N.current.playbackRate=e,k(e))})(e),children:1===e?"1× (Normal)":`${e}×`},e)))}),n("div",{id:"current-speed-indicator",className:"mt-3 text-center font-medium text-green-600 dark:text-green-400 text-sm",children:["Current Speed: ",v,"× ",1===v?"(Normal)":""]})]}),n("div",{className:"pt-4 md:pt-0 md:pl-4",children:[n("h4",{className:"font-bold text-center mb-2 text-gray-700 dark:text-gray-300",children:"Detection Overlays"}),n("div",{className:"flex flex-col items-center gap-2",children:[n("div",{className:"flex items-center gap-2 mb-2",children:[n("input",{type:"checkbox",id:"detection-overlay-checkbox",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",checked:m,onChange:e=>h(e.target.checked),disabled:0===y.length}),n("label",{htmlFor:"detection-overlay-checkbox",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Show Detection Overlays"})]}),n("div",{className:"flex flex-col w-full mt-2 mb-2",children:[n("label",{htmlFor:"detection-sensitivity-slider",className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Detection Sensitivity"}),n("input",{type:"range",id:"detection-sensitivity-slider",className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700",min:"1",max:"10",step:"1",value:u,onChange:e=>{const t=parseInt(e.target.value,10);g(t),m&&S()}}),n("div",{id:"detection-sensitivity-value",className:"text-xs text-gray-600 dark:text-gray-400 text-center mb-1",children:["Time Window: ",u," second",1!==u?"s":""]})]}),n("div",{id:"detection-status-indicator",className:"text-center text-sm "+(y.length>0?"font-medium text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400"),children:x})]})]})]}),c&&n("div",{className:"flex justify-center mt-4 pt-2 border-t border-gray-200 dark:border-gray-700",children:n("a",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center text-sm",href:c,download:`video-${Date.now()}.mp4`,children:[n("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download Video"]})})]}),n("div",{className:"p-2"})]})}),document.body):null}r({showVideoModal:()=>{},showSnapshotPreview:()=>{}})}}}));
//# sourceMappingURL=UI-legacy-BurBBZkY.js.map
