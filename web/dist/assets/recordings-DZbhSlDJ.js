import{u as t,a as K,f as Re,g as Se,b as oe,s as u,h as z,i as J,d as v,A as Y,x as Ce,y as $,E as Te,c as Ne,e as Pe,Q as $e}from"./query-client-BSpadhku.js";import{D as Ie,d as Me,M as Ee,e as Fe}from"./UI-BTDpQQFR.js";import{C as Be}from"./LoadingIndicator-DEzjv51C.js";import{W as G,B as A}from"./websocket-client-DzZLM-9M.js";import{H as _e,F as Ue}from"./Footer-sZlXF2Ei.js";function Ge(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}function Oe({filters:e,setFilters:r,pagination:n,setPagination:s,streams:a,filtersVisible:g,applyFilters:i,resetFilters:m,handleDateRangeChange:p,setDefaultDateRange:x}){return t("aside",{id:"filters-sidebar",className:"filters-sidebar w-full md:w-64 bg-white dark:bg-gray-800 rounded-lg shadow p-4 md:sticky md:top-4 md:self-start transition-all duration-300 ".concat(g?"":"hidden md:block"),children:[t("div",{className:"filter-group mb-4",children:[t("h3",{className:"text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700",children:"Date Range"}),t("div",{className:"filter-option mb-2",children:[t("label",{htmlFor:"date-range-select",className:"block mb-1 text-sm font-medium",children:"Quick Select:"}),t("select",{id:"date-range-select",className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:e.dateRange,onChange:p,children:[t("option",{value:"today",children:"Today"}),t("option",{value:"yesterday",children:"Yesterday"}),t("option",{value:"last7days",children:"Last 7 Days"}),t("option",{value:"last30days",children:"Last 30 Days"}),t("option",{value:"custom",children:"Custom Range"})]})]}),t("div",{id:"custom-date-range",className:"filter-option space-y-3",style:{display:e.dateRange==="custom"?"block":"none"},children:[t("div",{className:"space-y-1",children:[t("label",{htmlFor:"start-date",className:"block text-sm font-medium",children:"Start Date:"}),t("input",{type:"date",id:"start-date",className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:e.startDate,onChange:d=>r(f=>({...f,startDate:d.target.value}))}),t("div",{className:"mt-1",children:[t("label",{htmlFor:"start-time",className:"block text-sm font-medium",children:"Time:"}),t("input",{type:"time",id:"start-time",className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:e.startTime,onChange:d=>r(f=>({...f,startTime:d.target.value}))})]})]}),t("div",{className:"space-y-1",children:[t("label",{htmlFor:"end-date",className:"block text-sm font-medium",children:"End Date:"}),t("input",{type:"date",id:"end-date",className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:e.endDate,onChange:d=>r(f=>({...f,endDate:d.target.value}))}),t("div",{className:"mt-1",children:[t("label",{htmlFor:"end-time",className:"block text-sm font-medium",children:"Time:"}),t("input",{type:"time",id:"end-time",className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:e.endTime,onChange:d=>r(f=>({...f,endTime:d.target.value}))})]})]})]})]}),t("div",{className:"filter-group mb-4",children:[t("h3",{className:"text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700",children:"Stream"}),t("div",{className:"filter-option",children:t("select",{id:"stream-filter",className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:e.streamId,onChange:d=>r(f=>({...f,streamId:d.target.value})),children:[t("option",{value:"all",children:"All Streams"}),a.map(d=>t("option",{value:d.name,children:d.name},d.name))]})})]}),t("div",{className:"filter-group mb-4",children:[t("h3",{className:"text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700",children:"Recording Type"}),t("div",{className:"filter-option",children:t("select",{id:"detection-filter",className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:e.recordingType,onChange:d=>r(f=>({...f,recordingType:d.target.value})),children:[t("option",{value:"all",children:"All Recordings"}),t("option",{value:"detection",children:"Detection Events Only"})]})})]}),t("div",{className:"filter-group mb-4",children:[t("h3",{className:"text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700",children:"Display Options"}),t("div",{className:"filter-option",children:[t("label",{htmlFor:"page-size",className:"block mb-1 text-sm font-medium",children:"Items per page:"}),t("select",{id:"page-size",className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:n.pageSize,onChange:d=>s(f=>({...f,pageSize:parseInt(d.target.value,10)})),children:[t("option",{value:"10",children:"10"}),t("option",{value:"20",children:"20"}),t("option",{value:"50",children:"50"}),t("option",{value:"100",children:"100"})]})]})]}),t("div",{className:"filter-actions flex space-x-2",children:[t("button",{id:"apply-filters-btn",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",onClick:i,children:"Apply Filters"}),t("button",{id:"reset-filters-btn",className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",onClick:m,children:"Reset"})]})]})}function ze({activeFiltersDisplay:e,removeFilter:r,hasActiveFilters:n}){return n?t("div",{id:"active-filters",className:"active-filters mb-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex flex-wrap gap-2",children:e.map((s,a)=>t("div",{className:"filter-tag inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-200",children:[t("span",{children:s.label}),t("button",{className:"ml-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 focus:outline-none",onClick:()=>r(s.key),children:"×"})]},a))}):null}const q={formatDateTime:e=>e?new Date(e).toLocaleString():"",formatDuration:e=>{if(!e)return"00:00:00";const r=Math.floor(e/3600),n=Math.floor(e%3600/60),s=Math.floor(e%60);return[r.toString().padStart(2,"0"),n.toString().padStart(2,"0"),s.toString().padStart(2,"0")].join(":")},formatFileSize:e=>{if(!e)return"0 B";const r=["B","KB","MB","GB","TB"];let n=0,s=e;for(;s>=1024&&n<r.length-1;)s/=1024,n++;return"".concat(s.toFixed(1)," ").concat(r[n])}};function Ae({recordings:e,sortField:r,sortDirection:n,sortBy:s,selectedRecordings:a,toggleRecordingSelection:g,selectAll:i,toggleSelectAll:m,getSelectedCount:p,openDeleteModal:x,playRecording:d,downloadRecording:f,deleteRecording:D,recordingsTableBodyRef:S,pagination:_}){return t("div",{className:"recordings-container bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden w-full",children:[t("div",{className:"batch-actions p-3 border-b border-gray-200 dark:border-gray-700 flex flex-wrap gap-2 items-center",children:[t("div",{className:"selected-count text-sm text-gray-600 dark:text-gray-400 mr-2",children:p()>0?"".concat(p()," recording").concat(p()!==1?"s":""," selected"):"No recordings selected"}),t("button",{className:"px-3 py-1.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:p()===0,onClick:()=>x("selected"),children:"Delete Selected"}),t("button",{className:"px-3 py-1.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",onClick:()=>x("all"),children:"Delete All Filtered"})]}),t("div",{className:"overflow-x-auto",children:t("table",{id:"recordings-table",className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[t("thead",{className:"bg-gray-50 dark:bg-gray-700",children:t("tr",{children:[t("th",{className:"w-10 px-4 py-3",children:t("input",{type:"checkbox",checked:i,onChange:m,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"})}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer",onClick:()=>s("stream_name"),children:t("div",{className:"flex items-center",children:["Stream",r==="stream_name"&&t("span",{className:"sort-icon ml-1",children:n==="asc"?"▲":"▼"})]})}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer",onClick:()=>s("start_time"),children:t("div",{className:"flex items-center",children:["Start Time",r==="start_time"&&t("span",{className:"sort-icon ml-1",children:n==="asc"?"▲":"▼"})]})}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Duration"}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer",onClick:()=>s("size_bytes"),children:t("div",{className:"flex items-center",children:["Size",r==="size_bytes"&&t("span",{className:"sort-icon ml-1",children:n==="asc"?"▲":"▼"})]})}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Detections"}),t("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),t("tbody",{ref:S,className:"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700",children:e.length===0?t("tr",{children:t("td",{colSpan:"6",className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:_.totalItems===0?"No recordings found":"Loading recordings..."})}):e.map(c=>t("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[t("td",{className:"px-4 py-4 whitespace-nowrap",children:t("input",{type:"checkbox",checked:!!a[c.id],onChange:()=>g(c.id),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"})}),t("td",{className:"px-6 py-4 whitespace-nowrap",children:c.stream||""}),t("td",{className:"px-6 py-4 whitespace-nowrap",children:q.formatDateTime(c.start_time)}),t("td",{className:"px-6 py-4 whitespace-nowrap",children:q.formatDuration(c.duration)}),t("td",{className:"px-6 py-4 whitespace-nowrap",children:c.size||""}),t("td",{className:"px-6 py-4 whitespace-nowrap",children:c.has_detections?t("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100",children:[t("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:[t("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),t("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}),"Yes"]}):""}),t("td",{className:"px-6 py-4 whitespace-nowrap",children:t("div",{className:"flex space-x-2",children:[t("button",{className:"p-1 rounded-full text-blue-600 hover:bg-blue-100 dark:text-blue-400 dark:hover:bg-blue-900 focus:outline-none",onClick:()=>d(c),title:"Play",children:t("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:t("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),t("button",{className:"p-1 rounded-full text-green-600 hover:bg-green-100 dark:text-green-400 dark:hover:bg-green-900 focus:outline-none",onClick:()=>f(c),title:"Download",children:t("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:t("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})}),t("button",{className:"p-1 rounded-full text-red-600 hover:bg-red-100 dark:text-red-400 dark:hover:bg-red-900 focus:outline-none",onClick:()=>D(c),title:"Delete",children:t("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:t("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})})]},c.id))})]})})]})}function Le({pagination:e,goToPage:r}){return t("div",{className:"pagination-controls flex flex-col sm:flex-row justify-between items-center p-4 border-t border-gray-200 dark:border-gray-700",children:[t("div",{className:"pagination-info text-sm text-gray-600 dark:text-gray-400 mb-2 sm:mb-0",children:["Showing ",t("span",{id:"pagination-showing",children:[e.startItem,"-",e.endItem]})," of ",t("span",{id:"pagination-total",children:e.totalItems})," recordings"]}),t("div",{className:"pagination-buttons flex items-center space-x-1",children:[t("button",{id:"pagination-first",className:"w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed",title:"First Page",onClick:()=>r(1),disabled:e.currentPage===1,children:"«"}),t("button",{id:"pagination-prev",className:"w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous Page",onClick:()=>r(e.currentPage-1),disabled:e.currentPage===1,children:"‹"}),t("span",{id:"pagination-current",className:"px-2 text-sm text-gray-700 dark:text-gray-300",children:["Page ",e.currentPage," of ",e.totalPages]}),t("button",{id:"pagination-next",className:"w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed",title:"Next Page",onClick:()=>r(e.currentPage+1),disabled:e.currentPage===e.totalPages,children:"›"}),t("button",{id:"pagination-last",className:"w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed",title:"Last Page",onClick:()=>r(e.totalPages),disabled:e.currentPage===e.totalPages,children:"»"})]})]})}const R={hooks:{useStreams:()=>oe("streams","/api/streams",{timeout:15e3,retries:2,retryDelay:1e3}),useRecordings:(e,r,n,s)=>{const a=new URLSearchParams;if(a.append("page",r.currentPage),a.append("limit",r.pageSize),a.append("sort",n),a.append("order",s),e.dateRange==="custom")a.append("start","".concat(e.startDate,"T").concat(e.startTime,":00")),a.append("end","".concat(e.endDate,"T").concat(e.endTime,":00"));else{const{start:i,end:m}=R.getDateRangeFromPreset(e.dateRange);a.append("start",i),a.append("end",m)}return e.streamId!=="all"&&a.append("stream",e.streamId),e.recordingType==="detection"&&a.append("detection","1"),oe(["recordings",e,r,n,s],"/api/recordings?".concat(a.toString()),{timeout:3e4,retries:2,retryDelay:1e3})},useDeleteRecording:()=>{const e=K();return Se({mutationFn:async r=>{const n="/api/recordings/".concat(r);return await z(n,{method:"DELETE",timeout:15e3,retries:1,retryDelay:1e3})},onSuccess:()=>{e.invalidateQueries({queryKey:["recordings"]}),u("Recording deleted successfully")},onError:r=>{console.error("Error deleting recording:",r),u("Error deleting recording: "+r.message)}})},useBatchDeleteRecordings:()=>{const e=K();return Re("/api/recordings/batch-delete",{timeout:6e4,retries:1,retryDelay:2e3},{onSuccess:r=>{e.invalidateQueries({queryKey:["recordings"]});const n=r.succeeded,s=r.failed;n>0&&s===0?u("Successfully deleted ".concat(n," recording").concat(n!==1?"s":"")):n>0&&s>0?u("Deleted ".concat(n," recording").concat(n!==1?"s":"",", but failed to delete ").concat(s)):u("Failed to delete ".concat(s," recording").concat(s!==1?"s":""))},onError:r=>{console.error("Error in batch delete operation:",r),u("Error in batch delete operation: "+r.message)}})}},loadStreams:async()=>{try{return await z("/api/streams",{timeout:15e3,retries:2,retryDelay:1e3})||[]}catch(e){return console.error("Error loading streams for filter:",e),u("Error loading streams: "+e.message),[]}},getDateRangeFromPreset:e=>{const r=new Date,n=new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59),s=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0);let a,g;switch(e){case"today":a=s.toISOString(),g=n.toISOString();break;case"yesterday":const i=new Date(s);i.setDate(i.getDate()-1);const m=new Date(i);m.setHours(23,59,59),a=i.toISOString(),g=m.toISOString();break;case"last7days":const p=new Date(s);p.setDate(p.getDate()-7),a=p.toISOString(),g=n.toISOString();break;case"last30days":const x=new Date(s);x.setDate(x.getDate()-30),a=x.toISOString(),g=n.toISOString();break;default:const d=new Date(s);d.setDate(d.getDate()-7),a=d.toISOString(),g=n.toISOString()}return{start:a,end:g}},loadRecordings:async(e,r,n,s)=>{try{const a=new URLSearchParams;if(a.append("page",r.currentPage),a.append("limit",r.pageSize),a.append("sort",n),a.append("order",s),e.dateRange==="custom")a.append("start","".concat(e.startDate,"T").concat(e.startTime,":00")),a.append("end","".concat(e.endDate,"T").concat(e.endTime,":00"));else{const{start:i,end:m}=R.getDateRangeFromPreset(e.dateRange);a.append("start",i),a.append("end",m)}e.streamId!=="all"&&a.append("stream",e.streamId),e.recordingType==="detection"&&a.append("detection","1"),console.log("API Request:","/api/recordings?".concat(a.toString()));const g=await z("/api/recordings?".concat(a.toString()),{timeout:3e4,retries:2,retryDelay:1e3});if(console.log("Recordings data received:",g),g.recordings&&g.recordings.length>0)for(let m=0;m<g.recordings.length;m+=5){const p=g.recordings.slice(m,m+5);await Promise.all(p.map(async x=>{try{x.has_detections=await R.checkRecordingHasDetections(x)}catch(d){console.error("Error checking detections for recording ".concat(x.id,":"),d),x.has_detections=!1}}))}return g}catch(a){throw console.error("Error loading recordings:",a),u("Error loading recordings: "+a.message),a}},deleteRecording:async e=>{try{return await J("/api/recordings/".concat(e.id),{method:"DELETE",timeout:15e3,retries:1,retryDelay:1e3}),u("Recording deleted successfully"),!0}catch(r){return console.error("Error deleting recording:",r),u("Error deleting recording: "+r.message),!1}},deleteSelectedRecordings:async e=>{const r=Object.entries(e).filter(([n,s])=>s).map(([n,s])=>parseInt(n,10));if(r.length===0)return u("No recordings selected"),{succeeded:0,failed:0};try{if(window.wsClient){if(console.log("Using WebSocket for batch delete operation"),window.wsClient.isConnected()||(console.log("WebSocket not connected, connecting now..."),window.wsClient.connect()),!window.batchDeleteClient)if(typeof BatchDeleteRecordingsClient<"u")console.log("Creating new BatchDeleteRecordingsClient"),window.batchDeleteClient=new BatchDeleteRecordingsClient(window.wsClient);else return console.warn("BatchDeleteRecordingsClient not available, falling back to HTTP"),R.deleteSelectedRecordingsHttp(r);return typeof showBatchDeleteModal=="function"&&showBatchDeleteModal(),await window.batchDeleteClient.deleteWithProgress({ids:r})}else return console.log("WebSocket client not available, using HTTP for batch delete"),R.deleteSelectedRecordingsHttp(r)}catch(n){return console.error("Error in batch delete operation:",n),u("Error in batch delete operation: "+n.message),{succeeded:0,failed:0}}},deleteSelectedRecordingsHttp:async e=>{try{const n=await(await J("/api/recordings/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:e}),timeout:6e4,retries:1,retryDelay:2e3})).json(),s=n.succeeded,a=n.failed;return s>0&&a===0?u("Successfully deleted ".concat(s," recording").concat(s!==1?"s":"")):s>0&&a>0?u("Deleted ".concat(s," recording").concat(s!==1?"s":"",", but failed to delete ").concat(a)):u("Failed to delete ".concat(a," recording").concat(a!==1?"s":"")),n}catch(r){return console.error("Error in HTTP batch delete operation:",r),u("Error in batch delete operation: "+r.message),{succeeded:0,failed:0}}},deleteAllFilteredRecordings:async e=>{try{const r={};if(e.dateRange==="custom")r.start="".concat(e.startDate,"T").concat(e.startTime,":00"),r.end="".concat(e.endDate,"T").concat(e.endTime,":00");else{const{start:a,end:g}=R.getDateRangeFromPreset(e.dateRange);r.start=a,r.end=g}e.streamId!=="all"&&(r.stream_name=e.streamId),e.recordingType==="detection"&&(r.detection=1),console.log("Deleting with filter:",r),typeof showBatchDeleteModal=="function"&&(showBatchDeleteModal(),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:0,succeeded:0,failed:0,status:"Preparing to delete recordings matching filter...",complete:!1}));let n=0;try{const a=new URLSearchParams;r.start&&a.append("start",r.start),r.end&&a.append("end",r.end),r.stream_name&&a.append("stream",r.stream_name),r.detection&&a.append("detection","1"),a.append("page","1"),a.append("limit","1"),console.log("Getting total count with params:",a.toString());const g=await fetch("/api/recordings?".concat(a.toString()));if(g.ok){const i=await g.json();i&&i.pagination&&i.pagination.total&&(n=i.pagination.total,console.log("Found ".concat(n," recordings matching filter")),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:n,succeeded:0,failed:0,status:"Found ".concat(n," recordings matching filter. Starting deletion..."),complete:!1}))}}catch(a){console.warn("Error getting recording count:",a)}const s=a=>(console.error("Error in delete all operation:",a),u("Error in delete all operation: "+a.message),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:0,succeeded:0,failed:0,status:"Error: ".concat(a.message),complete:!0}),{succeeded:0,failed:0});if(window.wsClient){if(console.log("Using WebSocket for batch delete with filter"),window.wsClient.isConnected()||(console.log("WebSocket not connected, connecting now..."),window.wsClient.connect()),!window.batchDeleteClient)if(typeof BatchDeleteRecordingsClient<"u")console.log("Creating new BatchDeleteRecordingsClient for filtered delete"),window.batchDeleteClient=new BatchDeleteRecordingsClient(window.wsClient);else return console.warn("BatchDeleteRecordingsClient not available, falling back to HTTP"),R.deleteAllFilteredRecordingsHttp(r);console.log("Using WebSocket client ID for filtered batch delete:",window.wsClient.getClientId());const a=new Promise((g,i)=>{setTimeout(()=>{i(new Error("Operation timed out or server crashed. Some recordings may have been deleted."))},6e4)});try{return await Promise.race([window.batchDeleteClient.deleteWithProgress({filter:r,totalCount:n}),a])}catch(g){return console.error("WebSocket error or timeout:",g),setTimeout(()=>{typeof loadRecordings=="function"&&loadRecordings()},1e3),s(g)}}else return console.log("WebSocket client not available, using HTTP for batch delete with filter"),R.deleteAllFilteredRecordingsHttp(r)}catch(r){return console.error("Error in delete all operation:",r),u("Error in delete all operation: "+r.message),{succeeded:0,failed:0}}},deleteAllFilteredRecordingsHttp:async e=>{try{const n=await(await J("/api/recordings/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filter:e}),timeout:12e4,retries:1,retryDelay:3e3})).json(),s=n.succeeded,a=n.failed;return s>0&&a===0?u("Successfully deleted ".concat(s," recording").concat(s!==1?"s":"")):s>0&&a>0?u("Deleted ".concat(s," recording").concat(s!==1?"s":"",", but failed to delete ").concat(a)):u("Failed to delete ".concat(a," recording").concat(a!==1?"s":"")),n}catch(r){return console.error("Error in HTTP delete all operation:",r),u("Error in delete all operation: "+r.message),{succeeded:0,failed:0}}},checkRecordingHasDetections:async e=>{if(!e||!e.id||!e.stream||!e.start_time||!e.end_time)return!1;try{const r=Math.floor(new Date(e.start_time).getTime()/1e3),n=Math.floor(new Date(e.end_time).getTime()/1e3),s=new URLSearchParams({start:r,end:n}),a=await z("/api/detection/results/".concat(e.stream,"?").concat(s.toString()),{timeout:1e4,retries:1,retryDelay:500});return a.detections&&a.detections.length>0}catch(r){return console.error("Error checking detections:",r),!1}},getRecordingDetections:async e=>{if(!e||!e.id||!e.stream||!e.start_time||!e.end_time)return[];try{const r=Math.floor(new Date(e.start_time).getTime()/1e3),n=Math.floor(new Date(e.end_time).getTime()/1e3),s=new URLSearchParams({start:r,end:n});return(await z("/api/detection/results/".concat(e.stream,"?").concat(s.toString()),{timeout:15e3,retries:1,retryDelay:1e3})).detections||[]}catch(r){return console.error("Error getting detections:",r),[]}},playRecording:(e,r)=>{if(console.log("Play recording clicked:",e),!e.id){console.error("Recording has no id property:",e),u("Error: Recording has no id property");return}const n="/api/recordings/play/".concat(e.id),s="".concat(e.stream," - ").concat(q.formatDateTime(e.start_time)),a="/api/recordings/download/".concat(e.id);console.log("Video URL:",n),console.log("Title:",s),console.log("Download URL:",a),window.__modalContext&&window.__modalContext.showVideoModal?window.__modalContext.showVideoModal(n,s,a):r(n,s,a),console.log("Video modal should be shown now")},downloadRecording:e=>{const r="/api/recordings/download/".concat(e.id),n=document.createElement("a");n.href=r,n.download="".concat(e.stream,"_").concat(new Date(e.start_time).toISOString().replace(/[:.]/g,"-"),".mp4"),document.body.appendChild(n),n.click(),document.body.removeChild(n),u("Download started")}},F={getFiltersFromUrl:()=>{const e=new URLSearchParams(window.location.search);if(!e.has("dateRange")&&!e.has("page")&&!e.has("sort")&&!e.has("detection")&&!e.has("stream"))return null;const r={filters:{dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"},page:1,limit:20,sort:"start_time",order:"desc"};return e.has("dateRange")&&(r.filters.dateRange=e.get("dateRange"),r.filters.dateRange==="custom"&&(e.has("startDate")&&(r.filters.startDate=e.get("startDate")),e.has("startTime")&&(r.filters.startTime=e.get("startTime")),e.has("endDate")&&(r.filters.endDate=e.get("endDate")),e.has("endTime")&&(r.filters.endTime=e.get("endTime")))),e.has("stream")&&(r.filters.streamId=e.get("stream")),e.has("detection")&&e.get("detection")==="1"&&(r.filters.recordingType="detection"),e.has("page")&&(r.page=parseInt(e.get("page"),10)),e.has("limit")&&(r.limit=parseInt(e.get("limit"),10)),e.has("sort")&&(r.sort=e.get("sort")),e.has("order")&&(r.order=e.get("order")),r},getActiveFiltersDisplay:e=>{const r=[];if(e.dateRange!=="last7days"||e.streamId!=="all"||e.recordingType!=="all"){if(e.dateRange!=="last7days"){let s="";switch(e.dateRange){case"today":s="Today";break;case"yesterday":s="Yesterday";break;case"last30days":s="Last 30 Days";break;case"custom":s="".concat(e.startDate," to ").concat(e.endDate);break}r.push({key:"dateRange",label:"Date: ".concat(s)})}e.streamId!=="all"&&r.push({key:"streamId",label:"Stream: ".concat(e.streamId)}),e.recordingType!=="all"&&r.push({key:"recordingType",label:"Detection Events Only"})}return r},loadFiltersFromUrl:(e,r,n,s,a,g)=>{const i=new URLSearchParams(window.location.search),m={...e};i.has("dateRange")&&(m.dateRange=i.get("dateRange"),m.dateRange==="custom"&&(i.has("startDate")&&(m.startDate=i.get("startDate")),i.has("startTime")&&(m.startTime=i.get("startTime")),i.has("endDate")&&(m.endDate=i.get("endDate")),i.has("endTime")&&(m.endTime=i.get("endTime")))),i.has("stream")&&(m.streamId=i.get("stream")),i.has("detection")&&i.get("detection")==="1"&&(m.recordingType="detection"),n(m),i.has("page")&&s(p=>({...p,currentPage:parseInt(i.get("page"),10)})),i.has("limit")&&s(p=>({...p,pageSize:parseInt(i.get("limit"),10)})),i.has("sort")&&a(i.get("sort")),i.has("order")&&g(i.get("order"))},updateUrlWithFilters:(e,r,n,s)=>{const a=new URLSearchParams(window.location.search);a.set("t",Date.now().toString()),a.set("dateRange",e.dateRange),e.dateRange==="custom"?(a.set("startDate",e.startDate),a.set("startTime",e.startTime),a.set("endDate",e.endDate),a.set("endTime",e.endTime)):(a.delete("startDate"),a.delete("startTime"),a.delete("endDate"),a.delete("endTime")),e.streamId!=="all"?a.set("stream",e.streamId):a.delete("stream"),e.recordingType==="detection"?a.set("detection","1"):a.delete("detection"),a.set("page",r.currentPage.toString()),a.set("limit",r.pageSize.toString()),a.set("sort",n),a.set("order",s);const g="".concat(window.location.pathname,"?").concat(a.toString());window.history.pushState({path:g},"",g);const i=g;window.onbeforeunload=function(){window.history.replaceState({path:i},"",i)}}};function He(){const[e,r]=v([]),[n,s]=v([]),[a,g]=v(!0),[i,m]=v("start_time"),[p,x]=v("desc"),[d,f]=v({dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"}),[D,S]=v({currentPage:1,pageSize:20,totalItems:0,totalPages:1,startItem:0,endItem:0}),[_,c]=v(!1),[P,I]=v([]),[C,b]=v({}),[U,M]=v(!1),[L,H]=v(!1),[X,se]=v("selected"),ie=Y(null),E=Ce(Ee);$(()=>{E?(console.log("Modal context available in RecordingsView"),window.__modalContext=E,console.log("Available modal methods:",Object.keys(E).map(o=>o))):console.warn("Modal context not available in RecordingsView")},[E]),K();const{data:W,isLoading:qe,error:j}=R.hooks.useStreams();$(()=>{W&&Array.isArray(W)&&s(W)},[W]),$(()=>{j&&(console.error("Error loading streams for filter:",j),u("Error loading streams: "+j.message))},[j]),$(()=>{if(typeof G<"u"){if(window.wsClient=new G,console.log("WebSocket client initialized at application level"),window.wsClient){console.log("Initial WebSocket connection state:",{connected:window.wsClient.isConnected(),clientId:window.wsClient.getClientId()});const l=window.wsClient.connect;window.wsClient.connect=function(){const w=l.apply(this,arguments);if(this.socket){const y=this.socket.onopen;this.socket.onopen=T=>{console.log("WebSocket connection opened at application level"),y&&y.call(this,T)};const k=this.socket.onerror;this.socket.onerror=T=>{console.error("WebSocket error at application level:",T),k&&k.call(this,T)};const N=this.socket.onclose;this.socket.onclose=T=>{console.log("WebSocket connection closed at application level: ".concat(T.code," ").concat(T.reason)),N&&N.call(this,T)};const B=this.socket.onmessage;this.socket.onmessage=T=>{T.data.includes('"type":"welcome"')||console.log("WebSocket message received at application level"),B&&B.call(this,T)}}return w};const h=window.wsClient.handleMessage;window.wsClient.handleMessage=function(w){const y=this.clientId;h.call(this,w);const k=this.clientId;y!==k&&k&&console.log("WebSocket client ID changed at application level: ".concat(k))}}typeof A<"u"&&(window.batchDeleteClient=new A(window.wsClient),console.log("Batch delete client initialized"))}Z();const o=F.getFiltersFromUrl();if(o){console.log("Found URL filters:",o);const l=new URLSearchParams(window.location.search);l.has("detection")&&l.get("detection")==="1"&&(o.filters.recordingType="detection"),f(o.filters),S(h=>({...h,currentPage:o.page||1,pageSize:o.limit||20})),m(o.sort||"start_time"),x(o.order||"desc")}return Q(),window.addEventListener("resize",Q),()=>{window.removeEventListener("resize",Q)}},[]),$(()=>{he()},[d]);const Z=()=>{const o=new Date,l=new Date(o);l.setDate(o.getDate()-7),f(h=>({...h,endDate:o.toISOString().split("T")[0],startDate:l.toISOString().split("T")[0]}))},{data:O,isLoading:le,error:V,refetch:Qe}=R.hooks.useRecordings(d,D,i,p);$(()=>{if(O){const o=O.recordings||[];d.recordingType==="detection"&&o.forEach(l=>{l.has_detections=!0}),r(o),ee(o.length>0),O.pagination&&te(O,D.currentPage)}},[O,d.recordingType]),$(()=>{V&&(console.error("Error loading recordings:",V),u("Error loading recordings: "+V.message),ee(!1))},[V]);const Q=()=>{window.innerWidth<768?g(!1):g(!0)},de=()=>{g(!a)},[ce,ee]=v(!1),ge=(o=D.currentPage,l=!0)=>{console.log("Loading recordings with filters:",JSON.stringify(d));const h={...D,currentPage:o};S(h),l&&F.updateUrlWithFilters(d,h,i,p)},te=(o,l)=>{if(l=l||D.currentPage,o.pagination){const h=o.pagination.limit||20,w=o.pagination.total||0,y=o.pagination.pages||1;let k=0,N=0;o.recordings.length>0&&(k=(l-1)*h+1,N=Math.min(k+o.recordings.length-1,w)),console.log("Pagination update:",{currentPage:l,pageSize:h,totalItems:w,totalPages:y,startItem:k,endItem:N,recordingsLength:o.recordings.length}),S(B=>({...B,totalItems:w,totalPages:y,pageSize:h,startItem:k,endItem:N}))}else{const h=D.pageSize,w=o.total||0,y=Math.ceil(w/h)||1;let k=0,N=0;o.recordings.length>0&&(k=(l-1)*h+1,N=Math.min(k+o.recordings.length-1,w)),console.log("Pagination update (fallback):",{currentPage:l,pageSize:h,totalItems:w,totalPages:y,startItem:k,endItem:N,recordingsLength:o.recordings.length}),S(B=>({...B,totalItems:w,totalPages:y,startItem:k,endItem:N}))}},ue=o=>{const l=o.target.value;if(f(h=>({...h,dateRange:l})),l==="custom"&&(!d.startDate||!d.endDate)){const h=new Date,w=new Date(h);w.setDate(h.getDate()-7),f(y=>({...y,endDate:h.toISOString().split("T")[0],startDate:w.toISOString().split("T")[0]}))}},he=()=>{const o=F.getActiveFiltersDisplay(d);c(o.length>0),I(o)},re=(o=!0)=>{o&&S(l=>({...l,currentPage:1})),F.updateUrlWithFilters(d,o?{...D,currentPage:1}:D,i,p)},me=()=>{const o={dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"},l=new Date,h=new Date(l);h.setDate(l.getDate()-7),o.endDate=l.toISOString().split("T")[0],o.startDate=h.toISOString().split("T")[0],f(o),S(y=>({...y,currentPage:1})),m("start_time"),x("desc");const w=window.location.pathname;window.history.pushState({path:w},"",w)},pe=o=>{switch(o){case"dateRange":f(l=>({...l,dateRange:"last7days"}));break;case"streamId":f(l=>({...l,streamId:"all"}));break;case"recordingType":f(l=>({...l,recordingType:"all"}));break}re()},fe=o=>{i===o?x(p==="asc"?"desc":"asc"):(x(o==="start_time"?"desc":"asc"),m(o)),S(l=>({...l,currentPage:1})),F.updateUrlWithFilters(d,{...D,currentPage:1},o,o===i?p==="asc"?"desc":"asc":o==="start_time"?"desc":"asc")},we=o=>{o<1||o>D.totalPages||(S(l=>({...l,currentPage:o})),F.updateUrlWithFilters(d,{...D,currentPage:o},i,p))},ye=o=>{b(l=>({...l,[o]:!l[o]}))},be=()=>{const o=!U;M(o);const l={};o&&e.forEach(h=>{l[h.id]=!0}),b(l)},ae=()=>Object.values(C).filter(Boolean).length,xe=o=>{se(o),H(!0)},ne=()=>{H(!1)},De=async()=>{ne();const o=new URLSearchParams(window.location.search),l=o.get("sort")||i,h=o.get("order")||p,w=parseInt(o.get("page"),10)||D.currentPage;if(X==="selected"){const y=await R.deleteSelectedRecordings(C);b({}),M(!1),y.succeeded>0&&ke(l,h,w)}else{const y=await R.deleteAllFilteredRecordings(d);b({}),M(!1),y.succeeded>0&&ge()}},ke=(o,l,h)=>{m(o),x(l),S(w=>({...w,currentPage:h})),setTimeout(()=>{const w={...D,currentPage:h};F.updateUrlWithFilters(d,w,o,l),R.loadRecordings(d,w,o,l).then(y=>{console.log("Recordings data received:",y),r(y.recordings||[]),te(y,h)}).catch(y=>{console.error("Error loading recordings:",y),u("Error loading recordings: "+y.message)})},0)},{mutate:ve}=R.hooks.useDeleteRecording();return t("section",{id:"recordings-page",class:"page",children:[t("div",{class:"page-header flex justify-between items-center mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow",children:[t("div",{class:"flex items-center",children:[t("h2",{class:"text-xl font-bold",children:"Recordings"}),t("div",{class:"ml-4 flex",children:[t("a",{href:"recordings.html",class:"px-3 py-1 bg-blue-500 text-white rounded-l-md",children:"Table View"}),t("a",{href:"timeline.html",class:"px-3 py-1 bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-400 dark:hover:bg-gray-600 rounded-r-md",children:"Timeline View"})]})]}),t("button",{id:"toggle-filters-btn",class:"p-2 rounded-full bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none",title:"Toggle Filters",onClick:de,children:t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:t("path",{"fill-rule":"evenodd",d:"M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z","clip-rule":"evenodd"})})})]}),t("div",{class:"recordings-layout flex flex-col md:flex-row gap-4 w-full",children:[t(Oe,{filters:d,setFilters:f,pagination:D,setPagination:S,streams:n,filtersVisible:a,applyFilters:re,resetFilters:me,handleDateRangeChange:ue,setDefaultDateRange:Z}),t("div",{class:"recordings-content flex-1",children:[t(ze,{activeFiltersDisplay:P,removeFilter:pe,hasActiveFilters:_}),t(Be,{isLoading:le,hasData:ce,loadingMessage:"Loading recordings...",emptyMessage:"No recordings found matching your criteria",children:[t(Ae,{recordings:e,sortField:i,sortDirection:p,sortBy:fe,selectedRecordings:C,toggleRecordingSelection:ye,selectAll:U,toggleSelectAll:be,getSelectedCount:ae,openDeleteModal:xe,playRecording:o=>{if(console.log("RecordingsView.playRecording called with:",o),E&&E.showVideoModal){console.log("Using modal context showVideoModal");const l="/api/recordings/play/".concat(o.id),h="".concat(o.stream," - ").concat(q.formatDateTime(o.start_time)),w="/api/recordings/download/".concat(o.id);E.showVideoModal(l,h,w)}else console.log("Falling back to recordingsAPI.playRecording"),R.playRecording(o,Me)},downloadRecording:o=>{R.downloadRecording(o)},deleteRecording:o=>{confirm("Are you sure you want to delete this recording from ".concat(o.stream,"?"))&&ve(o.id)},recordingsTableBodyRef:ie,pagination:D}),t(Le,{pagination:D,goToPage:we})]})]})]}),t(Ie,{isOpen:L,onClose:ne,onConfirm:De,mode:X,count:ae()})]})}function We(){const[e,r]=v(!1),[n,s]=v({current:0,total:0,succeeded:0,failed:0,status:"Preparing to delete recordings...",complete:!1,error:!1}),a=Y(null),g=Y(null);$(()=>(window.wsClient||(console.log("Creating WebSocket client in BatchDeleteModal"),window.wsClient=new G),a.current=window.wsClient,window.batchDeleteClient||(console.log("Creating BatchDeleteRecordingsClient"),window.batchDeleteClient=new A(a.current),window.batchDeleteClient.onProgress(c=>{console.log("Batch delete progress:",c),i(c)}),window.batchDeleteClient.onResult(c=>{console.log("Batch delete result:",c);const P=c.total||0,I=c.succeeded||0,C=c.failed||0;i({current:P,total:P,succeeded:I,failed:C,status:"Batch delete operation complete",complete:!0});const b=c.success?"Successfully deleted ".concat(I," recordings"):"Deleted ".concat(I," recordings with ").concat(C," failures");u(b,"success",5e3),setTimeout(()=>{typeof window.loadRecordings=="function"&&window.loadRecordings()},1e3)}),window.batchDeleteClient.onError(c=>{console.error("Batch delete error:",c),i({current:0,total:0,succeeded:0,failed:0,status:"Error: ".concat(c.error||"Unknown error"),complete:!0,error:!0}),u("Error: ".concat(c.error||"Unknown error"),"error",5e3)})),g.current=window.batchDeleteClient,window.showBatchDeleteModal=m,window.updateBatchDeleteProgress=i,window.batchDeleteRecordingsByHttpRequest=d,()=>{}),[]);const i=c=>{s(P=>({...P,...c})),e||r(!0)},m=()=>{s({current:0,total:0,succeeded:0,failed:0,status:"Preparing to delete recordings...",complete:!1,error:!1}),r(!0)},p=()=>{r(!1)},x=()=>{p(),u("Batch delete operation cancelled","warning",5e3)},d=c=>(console.log("Using HTTP fallback for batch delete with params:",c),new Promise((P,I)=>{m();let C=0;c.ids?C=c.ids.length:c.filter&&c.totalCount&&(C=c.totalCount),i({current:0,total:C,status:"Using HTTP fallback for batch delete operation",succeeded:0,failed:0}),fetch("/api/recordings/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then(b=>{if(!b.ok)throw new Error("HTTP error ".concat(b.status,": ").concat(b.statusText));return b.json()}).then(b=>{console.log("HTTP batch delete result:",b);const U=b.total||C||0,M=b.succeeded||0,L=b.failed||0;i({current:U,total:U,succeeded:M,failed:L,status:"Batch delete operation complete",complete:!0});const H=b.success?"Successfully deleted ".concat(M," recordings"):"Deleted ".concat(M," recordings with ").concat(L," failures");u(H,"success",5e3),setTimeout(()=>{typeof window.loadRecordings=="function"&&window.loadRecordings()},1e3),P(b)}).catch(b=>{console.error("HTTP batch delete error:",b),i({current:0,total:0,succeeded:0,failed:0,status:"Error: ".concat(b.message||"Unknown error"),complete:!0,error:!0}),u("Error: ".concat(b.message||"Unknown error"),"error",5e3),I(b)})})),f=()=>n.total>0?Math.round(n.current/n.total*100):n.complete?100:n.current>0?Math.min(90,n.current/10):50,D=()=>{let c="h-4 rounded-full text-center text-xs text-white";return n.error?c+=" bg-red-500":c+=" bg-green-500",!n.complete&&n.total===0&&(c+=" animate-pulse"),c},S=()=>n.total>0?"".concat(n.current," / ").concat(n.total):"".concat(n.current," / ?"),_=()=>n.total>0?"".concat(Math.round(n.current/n.total*100),"%"):n.complete?"100%":"In progress";return e?t("div",{id:"batch-delete-modal",className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50",children:t("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md mx-auto p-6 w-full",children:[t("div",{className:"flex justify-between items-center mb-4 pb-2 border-b border-gray-200 dark:border-gray-700",children:[t("h3",{id:"batch-delete-modal-title",className:"text-xl font-bold text-gray-900 dark:text-white",children:"Batch Delete Progress"}),t("button",{className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl font-bold",onClick:p,children:"×"})]}),t("div",{className:"modal-body",children:[t("div",{className:"mb-4 text-gray-700 dark:text-gray-300",children:n.status}),t("div",{className:"progress-container bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-4",children:t("div",{className:D(),style:{width:"".concat(f(),"%")}})}),t("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-6",children:[t("div",{children:S()}),t("div",{children:_()})]}),t("div",{className:"mb-4",children:[t("div",{className:"flex justify-between mb-2",children:[t("span",{className:"text-gray-700 dark:text-gray-300",children:"Succeeded:"}),t("span",{className:"font-bold text-green-600 dark:text-green-400",children:n.succeeded})]}),t("div",{className:"flex justify-between",children:[t("span",{className:"text-gray-700 dark:text-gray-300",children:"Failed:"}),t("span",{className:"font-bold text-red-600 dark:text-red-400",children:n.failed})]})]}),t("div",{className:"text-sm italic text-gray-600 dark:text-gray-400 mb-4",children:n.message})]}),t("div",{className:"flex justify-end pt-2 border-t border-gray-200 dark:border-gray-700",children:n.complete?t("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",onClick:p,children:"Done"}):t("button",{className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",onClick:x,children:"Cancel"})})]})}):null}function je(e){if(!e||e.length===0){u("No recordings selected for deletion","warning",5e3);return}confirm("Are you sure you want to delete ".concat(e.length," recordings?"))&&(typeof window.showBatchDeleteModal=="function"&&window.showBatchDeleteModal(),!window.batchDeleteClient&&typeof window.wsClient<"u"&&(window.batchDeleteClient=new A(window.wsClient)),window.batchDeleteClient?window.batchDeleteClient.deleteWithProgress({ids:e}).catch(r=>{console.error("Error starting batch delete:",r),u("Error: ".concat(r.message||"Failed to start batch delete operation"),"error",5e3),typeof window.closeBatchDeleteModal=="function"&&window.closeBatchDeleteModal()}):u("Batch delete client not available","error",5e3))}function Ve(e){if(!e){u("No filter specified for deletion","warning",5e3);return}confirm("Are you sure you want to delete all recordings matching the current filter?")&&(typeof window.showBatchDeleteModal=="function"&&window.showBatchDeleteModal(),!window.batchDeleteClient&&typeof window.wsClient<"u"&&(window.batchDeleteClient=new A(window.wsClient)),window.batchDeleteClient?window.batchDeleteClient.deleteWithProgress({filter:e}).catch(r=>{console.error("Error starting batch delete:",r),u("Error: ".concat(r.message||"Failed to start batch delete operation"),"error",5e3),typeof window.closeBatchDeleteModal=="function"&&window.closeBatchDeleteModal()}):u("Batch delete client not available","error",5e3))}typeof window<"u"&&(window.batchDeleteRecordings=je,window.batchDeleteRecordingsByFilter=Ve);document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("main-content");e&&Te(t($e,{client:Ne,children:t(Fe,{children:[t(_e,{}),t(Pe,{}),t(We,{}),t(He,{}),t(Ue,{})]})}),e)});export{Ge as __vite_legacy_guard};
//# sourceMappingURL=recordings-DZbhSlDJ.js.map
