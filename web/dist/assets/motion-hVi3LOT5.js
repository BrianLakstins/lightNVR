import{a as S,d as u,b as x,h as k,s as b,i as h,u as e,E,c as R,e as B,Q as I}from"./query-client-DIfHb7sS.js";/* empty css               */import{C as q}from"./LoadingIndicator-DbxhRnFU.js";import{H as L,F as Q}from"./Footer-BVvFAUIP.js";function T(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}function $(){const a=S(),[o,m]=u(null),[g,c]=u(!1),[l,d]=u({enabled:!0,pre_buffer_seconds:5,post_buffer_seconds:10,max_file_duration:300,codec:"h264",quality:"medium",retention_days:7}),{data:t=[],isLoading:n}=x(["streams"],"/api/streams",{timeout:1e4,retries:2,retryDelay:1e3}),{data:s,isLoading:F}=x(["motionStorage"],"/api/motion/storage",{timeout:5e3,retries:1,retryDelay:1e3}),v=Array.isArray(t)?t:t.streams||[],p=k({mutationFn:async r=>{const{streamName:i,...f}=r,y="/api/motion/config/".concat(encodeURIComponent(i));return await h(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f),timeout:1e4})},onSuccess:()=>{b("Motion recording configuration saved"),c(!1),a.invalidateQueries({queryKey:["motionConfig"]}),a.invalidateQueries({queryKey:["motionStats"]})},onError:r=>{b("Error saving configuration: ".concat(r.message),5e3,"error")}}),N=k({mutationFn:async r=>{const i="/api/motion/config/".concat(encodeURIComponent(r));return await h(i,{method:"DELETE",timeout:1e4})},onSuccess:()=>{b("Motion recording disabled"),a.invalidateQueries({queryKey:["motionConfig"]}),a.invalidateQueries({queryKey:["motionStats"]})},onError:r=>{b("Error disabling motion recording: ".concat(r.message),5e3,"error")}}),w=async r=>{m(r);try{const i=await h("/api/motion/config/".concat(encodeURIComponent(r.name)),{timeout:5e3});d(i)}catch(i){d({enabled:!0,pre_buffer_seconds:5,post_buffer_seconds:10,max_file_duration:300,codec:"h264",quality:"medium",retention_days:7})}c(!0)},C=()=>{o&&p.mutate({streamName:o.name,...l})},_=r=>{confirm("Disable motion recording for ".concat(r,"?"))&&N.mutate(r)},M=r=>{if(r===0)return"0 B";const i=1024,f=["B","KB","MB","GB","TB"],y=Math.floor(Math.log(r)/Math.log(i));return Math.round(r/Math.pow(i,y)*100)/100+" "+f[y]};return n?e(q,{}):e("div",{className:"container mx-auto px-4 py-8",children:[e("div",{className:"mb-8",children:[e("h1",{className:"text-3xl font-bold mb-2",children:"Motion Recording"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Configure ONVIF motion detection recording for your cameras"})]}),s&&e("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[e("h2",{className:"text-xl font-semibold mb-4",children:"Storage Statistics"}),e("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded",children:[e("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Recordings"}),e("div",{className:"text-2xl font-bold",children:s.total_recordings||0})]}),e("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded",children:[e("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Size"}),e("div",{className:"text-2xl font-bold",children:M(s.total_size_bytes||0)})]}),e("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded",children:[e("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Disk Usage"}),e("div",{className:"text-2xl font-bold",children:[(s.disk_space_used_percent||0).toFixed(1),"%"]})]})]})]}),e("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:[e("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e("h2",{className:"text-xl font-semibold",children:"Camera Motion Settings"})}),e("div",{className:"overflow-x-auto",children:e("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Camera"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Pre-Buffer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Post-Buffer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Retention"}),e("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:v.map(r=>e(D,{stream:r,onConfigure:w,onDisable:_},r.name))})]})})]}),g&&o&&e(P,{stream:o,config:l,onConfigChange:d,onSave:C,onClose:()=>c(!1),isSaving:p.isPending})]})}function D({stream:a,onConfigure:o,onDisable:m}){const[g,c]=u(null),[l,d]=u(null),{data:t}=x(["motionStats",a.name],"/api/motion/stats/".concat(encodeURIComponent(a.name)),{timeout:5e3,retries:1,retryDelay:1e3,onError:()=>{}}),{data:n}=x(["motionConfig",a.name],"/api/motion/config/".concat(encodeURIComponent(a.name)),{timeout:5e3,retries:1,retryDelay:1e3,onError:()=>{}}),s=(n==null?void 0:n.enabled)||!1;return e("tr",{children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a.name})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(s?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),children:s?"Enabled":"Disabled"})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[(n==null?void 0:n.pre_buffer_seconds)||"-","s"]}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[(n==null?void 0:n.post_buffer_seconds)||"-","s"]}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[(n==null?void 0:n.retention_days)||"-"," days"]}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e("button",{onClick:()=>o(a),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-4",children:"Configure"}),s&&e("button",{onClick:()=>m(a.name),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:"Disable"})]})]})}function P({stream:a,config:o,onConfigChange:m,onSave:g,onClose:c,isSaving:l}){const d=(t,n)=>{m({...o,[t]:n})};return e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e("h2",{className:"text-2xl font-bold",children:"Motion Recording Configuration"}),e("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:["Camera: ",a.name]})]}),e("div",{className:"p-6 space-y-6",children:[e("div",{className:"flex items-center justify-between",children:[e("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Enable Motion Recording"}),e("label",{className:"relative inline-flex items-center cursor-pointer",children:[e("input",{type:"checkbox",checked:o.enabled,onChange:t=>d("enabled",t.target.checked),className:"sr-only peer"}),e("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Pre-Event Buffer (seconds)"}),e("input",{type:"number",min:"0",max:"30",value:o.pre_buffer_seconds,onChange:t=>d("pre_buffer_seconds",parseInt(t.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),e("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Seconds of video to include before motion event (0-30)"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Post-Event Buffer (seconds)"}),e("input",{type:"number",min:"0",max:"60",value:o.post_buffer_seconds,onChange:t=>d("post_buffer_seconds",parseInt(t.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),e("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Seconds to continue recording after motion stops (0-60)"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Maximum File Duration (seconds)"}),e("input",{type:"number",min:"60",max:"3600",step:"60",value:o.max_file_duration,onChange:t=>d("max_file_duration",parseInt(t.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),e("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Maximum duration for a single recording file (60-3600 seconds)"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Video Codec"}),e("select",{value:o.codec,onChange:t=>d("codec",t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e("option",{value:"h264",children:"H.264"}),e("option",{value:"h265",children:"H.265"})]})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Recording Quality"}),e("select",{value:o.quality,onChange:t=>d("quality",t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e("option",{value:"low",children:"Low"}),e("option",{value:"medium",children:"Medium"}),e("option",{value:"high",children:"High"})]})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Retention Period (days)"}),e("input",{type:"number",min:"1",max:"365",value:o.retention_days,onChange:t=>d("retention_days",parseInt(t.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"}),e("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Automatically delete recordings older than this many days (1-365)"})]})]}),e("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3",children:[e("button",{onClick:c,disabled:l,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Cancel"}),e("button",{onClick:g,disabled:l,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:l?"Saving...":"Save Configuration"})]})]})})}document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("main-content");a&&E(e(I,{client:R,children:[e(L,{}),e(B,{}),e($,{}),e(Q,{})]}),a)});export{T as __vite_legacy_guard};
//# sourceMappingURL=motion-hVi3LOT5.js.map
