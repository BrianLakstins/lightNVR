const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./preact-app-3DvZ3cMn.js","../css/preact-app.css"])))=>i.map(i=>d[i]);
var E=Object.freeze,ie=Object.defineProperty;var l=(a,t)=>E(ie(a,"raw",{value:E(t||a.slice())}));import{h as d,d as m,m as b,u as ce,y as ue,i as v,c as p,_ as P,j as x}from"./preact-app-3DvZ3cMn.js";const $={0:"Admin",1:"User",2:"Viewer",3:"API"};var D,M;function be({users:a,onEdit:t,onDelete:o,onApiKey:i}){const c=(r,n)=>{n.preventDefault(),n.stopPropagation(),t(r)},u=(r,n)=>{n.preventDefault(),n.stopPropagation(),o(r)},s=(r,n)=>{n.preventDefault(),n.stopPropagation(),i(r)};return d(M||(M=l(['\n    <div class="overflow-x-auto">\n      <table class="w-full border-collapse">\n        <thead class="bg-gray-50 dark:bg-gray-700">\n          <tr>\n            <th class="py-3 px-6 text-left font-semibold">ID</th>\n            <th class="py-3 px-6 text-left font-semibold">Username</th>\n            <th class="py-3 px-6 text-left font-semibold">Email</th>\n            <th class="py-3 px-6 text-left font-semibold">Role</th>\n            <th class="py-3 px-6 text-left font-semibold">Status</th>\n            <th class="py-3 px-6 text-left font-semibold">Last Login</th>\n            <th class="py-3 px-6 text-left font-semibold">Actions</th>\n          </tr>\n        </thead>\n        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">\n          ',"\n        </tbody>\n      </table>\n    </div>\n  "])),a.map(r=>d(D||(D=l(["\n            <tr key=",' class="hover:bg-gray-100 dark:hover:bg-gray-600">\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">\n                <span class=',">\n                  ",'\n                </span>\n              </td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">\n                <div class="flex space-x-2">\n                  <button \n                    class="p-1 text-blue-600 hover:text-blue-800 rounded hover:bg-blue-100 transition-colors"\n                    onClick=','\n                    title="Edit User"\n                  >\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />\n                    </svg>\n                  </button>\n                  <button \n                    class="p-1 text-red-600 hover:text-red-800 rounded hover:bg-red-100 transition-colors"\n                    onClick=','\n                    title="Delete User"\n                  >\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />\n                    </svg>\n                  </button>\n                  <button \n                    class="p-1 text-gray-600 hover:text-gray-800 rounded hover:bg-gray-100 transition-colors"\n                    onClick=','\n                    title="Manage API Key"\n                  >\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />\n                    </svg>\n                  </button>\n                </div>\n              </td>\n            </tr>\n          '])),r.id,r.id,r.username,r.email||"-",$[r.role]||"Unknown","inline-block px-2 py-1 text-xs font-semibold rounded-full ".concat(r.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),r.is_active?"Active":"Inactive",r.last_login?new Date(r.last_login*1e3).toLocaleString():"Never",n=>c(r,n),n=>u(r,n),n=>s(r,n))))}var S,I;function _({formData:a,handleInputChange:t,handleAddUser:o,onClose:i}){const c=s=>{s.preventDefault(),s.stopPropagation(),o(s)},u=s=>{s.stopPropagation()};return d(I||(I=l(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">Add New User</h2>\n        \n        <form onSubmit=','>\n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="username">\n              Username\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="username"\n              type="text"\n              name="username"\n              value=',"\n              onChange=",'\n              required\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="password">\n              Password\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="password"\n              type="password"\n              name="password"\n              value=',"\n              onChange=",'\n              required\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="email">\n              Email\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="email"\n              type="email"\n              name="email"\n              value=',"\n              onChange=",'\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="role">\n              Role\n            </label>\n            <select\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="role"\n              name="role"\n              value=',"\n              onChange=","\n            >\n              ",'\n            </select>\n          </div>\n          \n          <div class="mb-6">\n            <label class="flex items-center">\n              <input\n                type="checkbox"\n                name="is_active"\n                checked=',"\n                onChange=",'\n                class="mr-2"\n              />\n              <span class="text-sm font-bold">Active</span>\n            </label>\n          </div>\n          \n          <div class="flex justify-end mt-6">\n            <button\n              type="button"\n              class="px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2"\n              onClick=','\n            >\n              Cancel\n            </button>\n            <button\n              type="submit"\n              class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"\n            >\n              Add User\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  '])),i,u,c,a.username,t,a.password,t,a.email,t,a.role,t,Object.entries($).map(([s,r])=>d(S||(S=l(["\n                <option value=",">","</option>\n              "])),s,r)),a.is_active,t,i)}var T,j;function pe({currentUser:a,formData:t,handleInputChange:o,handleEditUser:i,onClose:c}){const u=r=>{r.preventDefault(),r.stopPropagation(),i(r)},s=r=>{r.stopPropagation()};return d(j||(j=l(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">Edit User: ',"</h2>\n        \n        <form onSubmit=",'>\n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="username">\n              Username\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="username"\n              type="text"\n              name="username"\n              value=',"\n              onChange=",'\n              required\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="password">\n              Password (leave blank to keep current)\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="password"\n              type="password"\n              name="password"\n              value=',"\n              onChange=",'\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="email">\n              Email\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="email"\n              type="email"\n              name="email"\n              value=',"\n              onChange=",'\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="role">\n              Role\n            </label>\n            <select\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="role"\n              name="role"\n              value=',"\n              onChange=","\n            >\n              ",'\n            </select>\n          </div>\n          \n          <div class="mb-6">\n            <label class="flex items-center">\n              <input\n                type="checkbox"\n                name="is_active"\n                checked=',"\n                onChange=",'\n                class="mr-2"\n              />\n              <span class="text-sm font-bold">Active</span>\n            </label>\n          </div>\n          \n          <div class="flex justify-end mt-6">\n            <button\n              type="button"\n              class="px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2"\n              onClick=','\n            >\n              Cancel\n            </button>\n            <button\n              type="submit"\n              class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"\n            >\n              Update User\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  '])),c,s,a.username,u,t.username,o,t.password,o,t.email,o,t.role,o,Object.entries($).map(([r,n])=>d(T||(T=l(["\n                <option value=",">","</option>\n              "])),r,n)),t.is_active,o,c)}var L;function ge({currentUser:a,handleDeleteUser:t,onClose:o}){const i=u=>{u.stopPropagation(),t()},c=u=>{u.stopPropagation()};return d(L||(L=l(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">Delete User</h2>\n        \n        <p class="mb-6">\n          Are you sure you want to delete the user "','"? This action cannot be undone.\n        </p>\n        \n        <div class="flex justify-end">\n          <button\n            class="px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2"\n            onClick=','\n          >\n            Cancel\n          </button>\n          <button\n            class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"\n            onClick=',"\n          >\n            Delete User\n          </button>\n        </div>\n      </div>\n    </div>\n  "])),o,c,a.username,o,i)}var K,O,G;function ye({currentUser:a,newApiKey:t,handleGenerateApiKey:o,copyApiKey:i,onClose:c}){const u=r=>{r.stopPropagation()};console.log("API Key Modal - newApiKey:",t);const s=r=>{t&&t!=="Generating..."||c(r)};return d(G||(G=l(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">API Key for ','</h2>\n\n        <div class="mb-6">\n          ','\n        </div>\n\n        <div class="flex justify-end">\n          <button\n            class="','"\n            onClick=',"\n          >\n            ","\n          </button>\n        </div>\n      </div>\n    </div>\n  "])),s,u,a.username,t?d(K||(K=l(['\n            <div class="mb-4">\n              <label class="block text-sm font-bold mb-2">\n                API Key\n              </label>\n              <div class="flex">\n                <input\n                  class="shadow appearance-none border rounded-l w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n                  type="text"\n                  value=','\n                  readonly\n                />\n                <button\n                  class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r"\n                  onClick=','\n                >\n                  Copy\n                </button>\n              </div>\n              <p class="text-sm text-gray-600 dark:text-gray-300 mt-2">\n                This key will only be shown once. Save it securely.\n              </p>\n            </div>\n          '])),t,i):d(O||(O=l(['\n            <p class="mb-4">\n              Generate a new API key for this user. This will invalidate any existing API key.\n            </p>\n            <button\n              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4"\n              onClick=',"\n            >\n              Generate New API Key\n            </button>\n          "])),o),t&&t!=="Generating..."?"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700":"px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500",c,t&&t!=="Generating..."?"Done":"Close")}var F,z,B,H,N,R,V,q;function he(){const[a,t]=m(null),[o,i]=m(null),[c,u]=m(""),[s,r]=m({username:"",password:"",email:"",role:1,is_active:!0}),n=b(()=>{const e=localStorage.getItem("auth");return e?{Authorization:"Basic "+e}:{}},[]),{data:f,isLoading:U,error:me,refetch:h}=ce(["users"],"/api/auth/users",{headers:n(),cache:"no-store",timeout:15e3,retries:2,retryDelay:1e3}),w=(f==null?void 0:f.users)||[];ue(()=>{const e=document.getElementById("add-user-btn");if(e){const g=()=>{r({username:"",password:"",email:"",role:1,is_active:!0}),t("add")};return e.addEventListener("click",g),()=>{e&&e.removeEventListener("click",g)}}},[]);const k=b(e=>{const{name:g,value:C,type:ne,checked:le}=e.target;r(de=>({...de,[g]:ne==="checkbox"?le:g==="role"?parseInt(C,10):C}))},[]),Q=v({mutationFn:async e=>await x("/api/auth/users",{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(e),timeout:15e3,retries:1,retryDelay:1e3}),onSuccess:()=>{t(null),p("User added successfully","success",5e3),h()},onError:e=>{console.error("Error adding user:",e),p("Error adding user: ".concat(e.message),"error",8e3)}}),W=v({mutationFn:async({userId:e,userData:g})=>await x("/api/auth/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(g),timeout:15e3,retries:1,retryDelay:1e3}),onSuccess:()=>{t(null),p("User updated successfully","success",5e3),h()},onError:e=>{console.error("Error updating user:",e),p("Error updating user: ".concat(e.message),"error",8e3)}}),X=v({mutationFn:async e=>await x("/api/auth/users/".concat(e),{method:"DELETE",headers:n(),timeout:15e3,retries:1,retryDelay:1e3}),onSuccess:()=>{t(null),p("User deleted successfully","success",5e3),h()},onError:e=>{console.error("Error deleting user:",e),p("Error deleting user: ".concat(e.message),"error",8e3)}}),Y=v({mutationFn:async e=>await x("/api/auth/users/".concat(e,"/api-key"),{method:"POST",headers:n(),timeout:2e4,retries:1,retryDelay:2e3}),onMutate:()=>{u("Generating...")},onSuccess:e=>{u(e.api_key),p("API key generated successfully","success"),setTimeout(()=>{h()},100)},onError:e=>{console.error("Error generating API key:",e),u(""),p("Error generating API key: ".concat(e.message),"error")}}),A=b(e=>{e&&e.preventDefault(),console.log("Adding user:",s.username),Q.mutate(s)},[s]),Z=b(e=>{e&&e.preventDefault(),console.log("Editing user:",o.id,o.username),W.mutate({userId:o.id,userData:s})},[o,s]),ee=b(()=>{console.log("Deleting user:",o.id,o.username),X.mutate(o.id)},[o]),te=b(()=>{console.log("Generating API key for user:",o.id,o.username),Y.mutate(o.id)},[o]),oe=b(()=>{navigator.clipboard.writeText(c).then(()=>{window.showSuccessToast?window.showSuccessToast("API key copied to clipboard"):p("API key copied to clipboard","success")}).catch(e=>{console.error("Error copying API key:",e),window.showErrorToast?window.showErrorToast("Failed to copy API key"):p("Failed to copy API key","error")})},[c]),re=b(e=>{i(e),r({username:e.username,password:"",email:e.email||"",role:e.role,is_active:e.is_active}),t("edit")},[]),ae=b(e=>{i(e),t("delete")},[]),se=b(e=>{i(e),u(""),t("apiKey")},[]),y=b(()=>{t(null)},[]);return U&&w.length===0?d(F||(F=l(['\n      <div class="flex justify-center items-center p-8">\n        <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>\n        <span class="sr-only">Loading...</span>\n      </div>\n    ']))):w.length===0&&!U?d(B||(B=l(['\n      <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-4">\n        <h4 class="font-bold mb-2">No Users Found</h4>\n        <p>Click the "Add User" button to create your first user.</p>\n      </div>\n      ',"\n    "])),a==="add"&&d(z||(z=l(["<","\n        formData=","\n        handleInputChange=","\n        handleAddUser=","\n        onClose=","\n      />"])),_,s,k,A,y)):d(q||(q=l(["\n    <div>\n      <","\n        users=","\n        onEdit=","\n        onDelete=","\n        onApiKey=","\n      />\n\n      ","\n\n      ","\n\n      ","\n\n      ","\n    </div>\n  "])),be,w,re,ae,se,a==="add"&&d(H||(H=l(["<","\n        formData=","\n        handleInputChange=","\n        handleAddUser=","\n        onClose=","\n      />"])),_,s,k,A,y),a==="edit"&&d(N||(N=l(["<","\n        currentUser=","\n        formData=","\n        handleInputChange=","\n        handleEditUser=","\n        onClose=","\n      />"])),pe,o,s,k,Z,y),a==="delete"&&d(R||(R=l(["<","\n        currentUser=","\n        handleDeleteUser=","\n        onClose=","\n      />"])),ge,o,ee,y),a==="apiKey"&&d(V||(V=l(["<","\n        currentUser=","\n        newApiKey=","\n        handleGenerateApiKey=","\n        copyApiKey=","\n        onClose=","\n      />"])),ye,o,c,te,oe,y))}var J;function fe(){const a=document.getElementById("users-container");a&&P(async()=>{const{render:t}=await import("./preact-app-3DvZ3cMn.js").then(o=>o.p);return{render:t}},__vite__mapDeps([0,1]),import.meta.url).then(({render:t})=>{P(async()=>{const{QueryClientProvider:o,queryClient:i}=await import("./preact-app-3DvZ3cMn.js").then(c=>c.n);return{QueryClientProvider:o,queryClient:i}},__vite__mapDeps([0,1]),import.meta.url).then(({QueryClientProvider:o,queryClient:i})=>{t(d(J||(J=l(["<"," client=","><"," /></",">"])),o,i,he,o),a)})})}export{he as UsersView,fe as loadUsersView};
//# sourceMappingURL=UsersView-BMLJLumK.js.map
