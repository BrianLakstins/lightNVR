var P=Object.freeze,ee=Object.defineProperty;var u=(a,t)=>P(ee(a,"raw",{value:P(t||a.slice())}));import{d as v,h as b,e as te,y as oe,c as x,f,u as l,E as re,q as ae,Q as se}from"./query-client-mfCUf3pQ.js";/* empty css               */import{h as g,c as p,H as ne,F as le}from"./Footer-BFueUtxh.js";function ye(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}const U={0:"Admin",1:"User",2:"Viewer",3:"API"};var S,D;function de({users:a,onEdit:t,onDelete:r,onApiKey:c}){const i=(o,n)=>{n.preventDefault(),n.stopPropagation(),t(o)},d=(o,n)=>{n.preventDefault(),n.stopPropagation(),r(o)},s=(o,n)=>{n.preventDefault(),n.stopPropagation(),c(o)};return g(D||(D=u(['\n    <div class="overflow-x-auto">\n      <table class="w-full border-collapse">\n        <thead class="bg-gray-50 dark:bg-gray-700">\n          <tr>\n            <th class="py-3 px-6 text-left font-semibold">ID</th>\n            <th class="py-3 px-6 text-left font-semibold">Username</th>\n            <th class="py-3 px-6 text-left font-semibold">Email</th>\n            <th class="py-3 px-6 text-left font-semibold">Role</th>\n            <th class="py-3 px-6 text-left font-semibold">Status</th>\n            <th class="py-3 px-6 text-left font-semibold">Last Login</th>\n            <th class="py-3 px-6 text-left font-semibold">Actions</th>\n          </tr>\n        </thead>\n        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">\n          ',"\n        </tbody>\n      </table>\n    </div>\n  "])),a.map(o=>g(S||(S=u(["\n            <tr key=",' class="hover:bg-gray-100 dark:hover:bg-gray-600">\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">\n                <span class=',">\n                  ",'\n                </span>\n              </td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">','</td>\n              <td class="py-3 px-6 border-b border-gray-200 dark:border-gray-700">\n                <div class="flex space-x-2">\n                  <button \n                    class="p-1 text-blue-600 hover:text-blue-800 rounded hover:bg-blue-100 transition-colors"\n                    onClick=','\n                    title="Edit User"\n                  >\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />\n                    </svg>\n                  </button>\n                  <button \n                    class="p-1 text-red-600 hover:text-red-800 rounded hover:bg-red-100 transition-colors"\n                    onClick=','\n                    title="Delete User"\n                  >\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />\n                    </svg>\n                  </button>\n                  <button \n                    class="p-1 text-gray-600 hover:text-gray-800 rounded hover:bg-gray-100 transition-colors"\n                    onClick=','\n                    title="Manage API Key"\n                  >\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />\n                    </svg>\n                  </button>\n                </div>\n              </td>\n            </tr>\n          '])),o.id,o.id,o.username,o.email||"-",U[o.role]||"Unknown","inline-block px-2 py-1 text-xs font-semibold rounded-full ".concat(o.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),o.is_active?"Active":"Inactive",o.last_login?new Date(o.last_login*1e3).toLocaleString():"Never",n=>i(o,n),n=>d(o,n),n=>s(o,n))))}var _,I;function M({formData:a,handleInputChange:t,handleAddUser:r,onClose:c}){const i=s=>{s.preventDefault(),s.stopPropagation(),r(s)},d=s=>{s.stopPropagation()};return g(I||(I=u(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">Add New User</h2>\n        \n        <form onSubmit=','>\n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="username">\n              Username\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="username"\n              type="text"\n              name="username"\n              value=',"\n              onChange=",'\n              required\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="password">\n              Password\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="password"\n              type="password"\n              name="password"\n              value=',"\n              onChange=",'\n              required\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="email">\n              Email\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="email"\n              type="email"\n              name="email"\n              value=',"\n              onChange=",'\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="role">\n              Role\n            </label>\n            <select\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="role"\n              name="role"\n              value=',"\n              onChange=","\n            >\n              ",'\n            </select>\n          </div>\n          \n          <div class="mb-6">\n            <label class="flex items-center">\n              <input\n                type="checkbox"\n                name="is_active"\n                checked=',"\n                onChange=",'\n                class="mr-2"\n              />\n              <span class="text-sm font-bold">Active</span>\n            </label>\n          </div>\n          \n          <div class="flex justify-end mt-6">\n            <button\n              type="button"\n              class="px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2"\n              onClick=','\n            >\n              Cancel\n            </button>\n            <button\n              type="submit"\n              class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"\n            >\n              Add User\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  '])),c,d,i,a.username,t,a.password,t,a.email,t,a.role,t,Object.entries(U).map(([s,o])=>g(_||(_=u(["\n                <option value=",">","</option>\n              "])),s,o)),a.is_active,t,c)}var j,T;function ie({currentUser:a,formData:t,handleInputChange:r,handleEditUser:c,onClose:i}){const d=o=>{o.preventDefault(),o.stopPropagation(),c(o)},s=o=>{o.stopPropagation()};return g(T||(T=u(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">Edit User: ',"</h2>\n        \n        <form onSubmit=",'>\n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="username">\n              Username\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="username"\n              type="text"\n              name="username"\n              value=',"\n              onChange=",'\n              required\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="password">\n              Password (leave blank to keep current)\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="password"\n              type="password"\n              name="password"\n              value=',"\n              onChange=",'\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="email">\n              Email\n            </label>\n            <input\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="email"\n              type="email"\n              name="email"\n              value=',"\n              onChange=",'\n            />\n          </div>\n          \n          <div class="mb-4">\n            <label class="block text-sm font-bold mb-2" for="role">\n              Role\n            </label>\n            <select\n              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n              id="role"\n              name="role"\n              value=',"\n              onChange=","\n            >\n              ",'\n            </select>\n          </div>\n          \n          <div class="mb-6">\n            <label class="flex items-center">\n              <input\n                type="checkbox"\n                name="is_active"\n                checked=',"\n                onChange=",'\n                class="mr-2"\n              />\n              <span class="text-sm font-bold">Active</span>\n            </label>\n          </div>\n          \n          <div class="flex justify-end mt-6">\n            <button\n              type="button"\n              class="px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2"\n              onClick=','\n            >\n              Cancel\n            </button>\n            <button\n              type="submit"\n              class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"\n            >\n              Update User\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  '])),i,s,a.username,d,t.username,r,t.password,r,t.email,r,t.role,r,Object.entries(U).map(([o,n])=>g(j||(j=u(["\n                <option value=",">","</option>\n              "])),o,n)),t.is_active,r,i)}var L;function ce({currentUser:a,handleDeleteUser:t,onClose:r}){const c=d=>{d.stopPropagation(),t()},i=d=>{d.stopPropagation()};return g(L||(L=u(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">Delete User</h2>\n        \n        <p class="mb-6">\n          Are you sure you want to delete the user "','"? This action cannot be undone.\n        </p>\n        \n        <div class="flex justify-end">\n          <button\n            class="px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2"\n            onClick=','\n          >\n            Cancel\n          </button>\n          <button\n            class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"\n            onClick=',"\n          >\n            Delete User\n          </button>\n        </div>\n      </div>\n    </div>\n  "])),r,i,a.username,r,c)}var N,F,K;function ue({currentUser:a,newApiKey:t,handleGenerateApiKey:r,copyApiKey:c,onClose:i}){const d=o=>{o.stopPropagation()};console.log("API Key Modal - newApiKey:",t);const s=o=>{t&&t!=="Generating..."||i(o)};return g(K||(K=u(['\n    <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick=','>\n      <div class="bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white" onClick=','>\n        <h2 class="text-xl font-bold mb-4">API Key for ','</h2>\n\n        <div class="mb-6">\n          ','\n        </div>\n\n        <div class="flex justify-end">\n          <button\n            class="','"\n            onClick=',"\n          >\n            ","\n          </button>\n        </div>\n      </div>\n    </div>\n  "])),s,d,a.username,t?g(N||(N=u(['\n            <div class="mb-4">\n              <label class="block text-sm font-bold mb-2">\n                API Key\n              </label>\n              <div class="flex">\n                <input\n                  class="shadow appearance-none border rounded-l w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline"\n                  type="text"\n                  value=','\n                  readonly\n                />\n                <button\n                  class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r"\n                  onClick=','\n                >\n                  Copy\n                </button>\n              </div>\n              <p class="text-sm text-gray-600 dark:text-gray-300 mt-2">\n                This key will only be shown once. Save it securely.\n              </p>\n            </div>\n          '])),t,c):g(F||(F=u(['\n            <p class="mb-4">\n              Generate a new API key for this user. This will invalidate any existing API key.\n            </p>\n            <button\n              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4"\n              onClick=',"\n            >\n              Generate New API Key\n            </button>\n          "])),r),t&&t!=="Generating..."?"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700":"px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500",i,t&&t!=="Generating..."?"Done":"Close")}function be(){const[a,t]=v(null),[r,c]=v(null),[i,d]=v(""),[s,o]=v({username:"",password:"",email:"",role:1,is_active:!0}),n=b(()=>{const e=localStorage.getItem("auth");return e?{Authorization:"Basic "+e}:{}},[]),{data:w,isLoading:C,error:pe,refetch:h}=te(["users"],"/api/auth/users",{headers:n(),cache:"no-store",timeout:15e3,retries:2,retryDelay:1e3}),k=(w==null?void 0:w.users)||[];oe(()=>{const e=document.getElementById("add-user-btn");if(e){const y=()=>{o({username:"",password:"",email:"",role:1,is_active:!0}),t("add")};return e.addEventListener("click",y),()=>{e&&e.removeEventListener("click",y)}}},[]);const $=b(e=>{const{name:y,value:E,type:X,checked:Y}=e.target;o(Z=>({...Z,[y]:X==="checkbox"?Y:y==="role"?parseInt(E,10):E}))},[]),H=x({mutationFn:async e=>await f("/api/auth/users",{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(e),timeout:15e3,retries:1,retryDelay:1e3}),onSuccess:()=>{t(null),p("User added successfully","success",5e3),h()},onError:e=>{console.error("Error adding user:",e),p("Error adding user: ".concat(e.message),"error",8e3)}}),O=x({mutationFn:async({userId:e,userData:y})=>await f("/api/auth/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(y),timeout:15e3,retries:1,retryDelay:1e3}),onSuccess:()=>{t(null),p("User updated successfully","success",5e3),h()},onError:e=>{console.error("Error updating user:",e),p("Error updating user: ".concat(e.message),"error",8e3)}}),G=x({mutationFn:async e=>await f("/api/auth/users/".concat(e),{method:"DELETE",headers:n(),timeout:15e3,retries:1,retryDelay:1e3}),onSuccess:()=>{t(null),p("User deleted successfully","success",5e3),h()},onError:e=>{console.error("Error deleting user:",e),p("Error deleting user: ".concat(e.message),"error",8e3)}}),z=x({mutationFn:async e=>await f("/api/auth/users/".concat(e,"/api-key"),{method:"POST",headers:n(),timeout:2e4,retries:1,retryDelay:2e3}),onMutate:()=>{d("Generating...")},onSuccess:e=>{d(e.api_key),p("API key generated successfully","success"),setTimeout(()=>{h()},100)},onError:e=>{console.error("Error generating API key:",e),d(""),p("Error generating API key: ".concat(e.message),"error")}}),A=b(e=>{e&&e.preventDefault(),console.log("Adding user:",s.username),H.mutate(s)},[s]),B=b(e=>{e&&e.preventDefault(),console.log("Editing user:",r.id,r.username),O.mutate({userId:r.id,userData:s})},[r,s]),q=b(()=>{console.log("Deleting user:",r.id,r.username),G.mutate(r.id)},[r]),R=b(()=>{console.log("Generating API key for user:",r.id,r.username),z.mutate(r.id)},[r]),J=b(()=>{navigator.clipboard.writeText(i).then(()=>{window.showSuccessToast?window.showSuccessToast("API key copied to clipboard"):p("API key copied to clipboard","success")}).catch(e=>{console.error("Error copying API key:",e),window.showErrorToast?window.showErrorToast("Failed to copy API key"):p("Failed to copy API key","error")})},[i]),Q=b(e=>{c(e),o({username:e.username,password:"",email:e.email||"",role:e.role,is_active:e.is_active}),t("edit")},[]),V=b(e=>{c(e),t("delete")},[]),W=b(e=>{c(e),d(""),t("apiKey")},[]),m=b(()=>{t(null)},[]);return C&&k.length===0?l("div",{className:"flex justify-center items-center p-8",children:[l("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),l("span",{className:"sr-only",children:"Loading..."})]}):k.length===0&&!C?l("div",{children:[l("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-4",children:[l("h4",{className:"font-bold mb-2",children:"No Users Found"}),l("p",{children:'Click the "Add User" button to create your first user.'})]}),a==="add"&&l(M,{formData:s,handleInputChange:$,handleAddUser:A,onClose:m})]}):l("div",{children:[l(de,{users:k,onEdit:Q,onDelete:V,onApiKey:W}),a==="add"&&l(M,{formData:s,handleInputChange:$,handleAddUser:A,onClose:m}),a==="edit"&&l(ie,{currentUser:r,formData:s,handleInputChange:$,handleEditUser:B,onClose:m}),a==="delete"&&l(ce,{currentUser:r,handleDeleteUser:q,onClose:m}),a==="apiKey"&&l(ue,{currentUser:r,newApiKey:i,handleGenerateApiKey:R,copyApiKey:J,onClose:m})]})}document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("main-content");a&&re(l(se,{client:ae,children:[l(ne,{}),l(be,{}),l(le,{})]}),a)});export{ye as __vite_legacy_guard};
//# sourceMappingURL=users-Bda-OkMz.js.map
