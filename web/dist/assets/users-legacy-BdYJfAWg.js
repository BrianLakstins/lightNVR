System.register(["./query-client-legacy-_zrrCFf8.js","./layout-legacy-BJPDh9kM.js","./Footer-legacy-C7Z0rEtm.js"],(function(e,r){"use strict";var a,t,n,l,o,s,d,i,c,u,m,h,b,g;return{setters:[e=>{a=e.u,t=e.k,n=e.d,l=e.q,o=e.b,s=e.h,d=e.s,i=e.i,c=e.E,u=e.c,m=e.e,h=e.Q},null,e=>{b=e.H,g=e.F}],execute:function(){const e={0:"Admin",1:"User",2:"Viewer",3:"API"};function r({users:r,onEdit:t,onDelete:n,onApiKey:l}){return a("div",{className:"overflow-x-auto",children:a("table",{className:"w-full border-collapse",children:[a("thead",{className:"bg-gray-50 dark:bg-gray-700",children:a("tr",{children:[a("th",{className:"py-3 px-6 text-left font-semibold",children:"ID"}),a("th",{className:"py-3 px-6 text-left font-semibold",children:"Username"}),a("th",{className:"py-3 px-6 text-left font-semibold",children:"Email"}),a("th",{className:"py-3 px-6 text-left font-semibold",children:"Role"}),a("th",{className:"py-3 px-6 text-left font-semibold",children:"Status"}),a("th",{className:"py-3 px-6 text-left font-semibold",children:"Last Login"}),a("th",{className:"py-3 px-6 text-left font-semibold",children:"Actions"})]})}),a("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r.map((r=>a("tr",{className:"hover:bg-gray-100 dark:hover:bg-gray-600",children:[a("td",{className:"py-3 px-6 border-b border-gray-200 dark:border-gray-700",children:r.id}),a("td",{className:"py-3 px-6 border-b border-gray-200 dark:border-gray-700",children:r.username}),a("td",{className:"py-3 px-6 border-b border-gray-200 dark:border-gray-700",children:r.email||"-"}),a("td",{className:"py-3 px-6 border-b border-gray-200 dark:border-gray-700",children:e[r.role]||"Unknown"}),a("td",{className:"py-3 px-6 border-b border-gray-200 dark:border-gray-700",children:a("span",{className:"inline-block px-2 py-1 text-xs font-semibold rounded-full "+(r.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:r.is_active?"Active":"Inactive"})}),a("td",{className:"py-3 px-6 border-b border-gray-200 dark:border-gray-700",children:r.last_login?new Date(1e3*r.last_login).toLocaleString():"Never"}),a("td",{className:"py-3 px-6 border-b border-gray-200 dark:border-gray-700",children:a("div",{className:"flex space-x-2",children:[a("button",{className:"p-1 text-blue-600 hover:text-blue-800 rounded hover:bg-blue-100 transition-colors",onClick:e=>((e,r)=>{r.preventDefault(),r.stopPropagation(),t(e)})(r,e),title:"Edit User",children:a("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),a("button",{className:"p-1 text-red-600 hover:text-red-800 rounded hover:bg-red-100 transition-colors",onClick:e=>((e,r)=>{r.preventDefault(),r.stopPropagation(),n(e)})(r,e),title:"Delete User",children:a("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),a("button",{className:"p-1 text-gray-600 hover:text-gray-800 rounded hover:bg-gray-100 transition-colors",onClick:e=>((e,r)=>{r.preventDefault(),r.stopPropagation(),l(e)})(r,e),title:"Manage API Key",children:a("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})})]})})]},r.id)))})]})})}function p({formData:r,handleInputChange:t,handleAddUser:n,onClose:l}){return a("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:l,children:a("div",{className:"bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white",onClick:e=>{e.stopPropagation()},children:[a("h2",{className:"text-xl font-bold mb-4",children:"Add New User"}),a("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),n(e)},children:[a("div",{className:"mb-4",children:[a("label",{className:"block text-sm font-bold mb-2",htmlFor:"username",children:"Username"}),a("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"username",type:"text",name:"username",value:r.username,onChange:t,required:!0})]}),a("div",{className:"mb-4",children:[a("label",{className:"block text-sm font-bold mb-2",htmlFor:"password",children:"Password"}),a("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"password",type:"password",name:"password",value:r.password,onChange:t,required:!0})]}),a("div",{className:"mb-4",children:[a("label",{className:"block text-sm font-bold mb-2",htmlFor:"email",children:"Email"}),a("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"email",type:"email",name:"email",value:r.email,onChange:t})]}),a("div",{className:"mb-4",children:[a("label",{className:"block text-sm font-bold mb-2",htmlFor:"role",children:"Role"}),a("select",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"role",name:"role",value:r.role,onChange:t,children:Object.entries(e).map((([e,r])=>a("option",{value:e,children:r},e)))})]}),a("div",{className:"mb-6",children:a("label",{className:"flex items-center",children:[a("input",{type:"checkbox",name:"is_active",checked:r.is_active,onChange:t,className:"mr-2"}),a("span",{className:"text-sm font-bold",children:"Active"})]})}),a("div",{className:"flex justify-end mt-6",children:[a("button",{type:"button",className:"px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2",onClick:l,children:"Cancel"}),a("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Add User"})]})]})]})})}function y({currentUser:r,formData:t,handleInputChange:n,handleEditUser:l,onClose:o}){return a("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:o,children:a("div",{className:"bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white",onClick:e=>{e.stopPropagation()},children:[a("h2",{className:"text-xl font-bold mb-4",children:["Edit User: ",r.username]}),a("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),l(e)},children:[a("div",{className:"mb-4",children:[a("label",{className:"block text-sm font-bold mb-2",htmlFor:"username",children:"Username"}),a("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"username",type:"text",name:"username",value:t.username,onChange:n,required:!0})]}),a("div",{className:"mb-4",children:[a("label",{className:"block text-sm font-bold mb-2",htmlFor:"password",children:"Password (leave blank to keep current)"}),a("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"password",type:"password",name:"password",value:t.password,onChange:n})]}),a("div",{className:"mb-4",children:[a("label",{className:"block text-sm font-bold mb-2",htmlFor:"email",children:"Email"}),a("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"email",type:"email",name:"email",value:t.email,onChange:n})]}),a("div",{className:"mb-4",children:[a("label",{className:"block text-sm font-bold mb-2",htmlFor:"role",children:"Role"}),a("select",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"role",name:"role",value:t.role,onChange:n,children:Object.entries(e).map((([e,r])=>a("option",{value:e,children:r},e)))})]}),a("div",{className:"mb-6",children:a("label",{className:"flex items-center",children:[a("input",{type:"checkbox",name:"is_active",checked:t.is_active,onChange:n,className:"mr-2"}),a("span",{className:"text-sm font-bold",children:"Active"})]})}),a("div",{className:"flex justify-end mt-6",children:[a("button",{type:"button",className:"px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2",onClick:o,children:"Cancel"}),a("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Update User"})]})]})]})})}function x({currentUser:e,handleDeleteUser:r,onClose:t}){return a("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:t,children:a("div",{className:"bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white",onClick:e=>{e.stopPropagation()},children:[a("h2",{className:"text-xl font-bold mb-4",children:"Delete User"}),a("p",{className:"mb-6",children:['Are you sure you want to delete the user "',e.username,'"? This action cannot be undone.']}),a("div",{className:"flex justify-end",children:[a("button",{className:"px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500 mr-2",onClick:t,children:"Cancel"}),a("button",{className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",onClick:e=>{e.stopPropagation(),r()},children:"Delete User"})]})]})})}function f({currentUser:e,newApiKey:r,handleGenerateApiKey:n,copyApiKey:l,onClose:o}){return console.log("API Key Modal - newApiKey:",r),a("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:e=>{r&&"Generating..."!==r||o(e)},children:a("div",{className:"bg-white rounded-lg p-6 max-w-md w-full dark:bg-gray-800 dark:text-white",onClick:e=>{e.stopPropagation()},children:[a("h2",{className:"text-xl font-bold mb-4",children:["API Key for ",e.username]}),a("div",{className:"mb-6",children:r?a("div",{className:"mb-4",children:[a("label",{className:"block text-sm font-bold mb-2",children:"API Key"}),a("div",{className:"flex",children:[a("input",{className:"shadow appearance-none border rounded-l w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",type:"text",value:r,readOnly:!0}),a("button",{className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r",onClick:l,children:"Copy"})]}),a("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:"This key will only be shown once. Save it securely."})]}):a(t,{children:[a("p",{className:"mb-4",children:"Generate a new API key for this user. This will invalidate any existing API key."}),a("button",{className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4",onClick:n,children:"Generate New API Key"})]})}),a("div",{className:"flex justify-end",children:a("button",{className:r&&"Generating..."!==r?"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700":"px-4 py-2 bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-white rounded hover:bg-gray-400 dark:hover:bg-gray-500",onClick:o,children:r&&"Generating..."!==r?"Done":"Close"})})]})})}function w(){const[e,t]=n(null),[c,u]=n(null),[m,h]=n(""),[b,g]=n({username:"",password:"",email:"",role:1,is_active:!0}),w=l((()=>{const e=localStorage.getItem("auth");return e?{Authorization:"Basic "+e}:{}}),[]),{data:v,isLoading:k,error:N,refetch:C}=o(["users"],"/api/auth/users",{headers:w(),cache:"no-store",timeout:15e3,retries:2,retryDelay:1e3}),A=v?.users||[],U=l((()=>{g({username:"",password:"",email:"",role:1,is_active:!0}),t("add")}),[]),D=l((e=>{const{name:r,value:a,type:t,checked:n}=e.target;g((e=>({...e,[r]:"checkbox"===t?n:"role"===r?parseInt(a,10):a})))}),[]),P=s({mutationFn:async e=>await i("/api/auth/users",{method:"POST",headers:{"Content-Type":"application/json",...w()},body:JSON.stringify(e),timeout:15e3,retries:1,retryDelay:1e3}),onSuccess:()=>{t(null),d("User added successfully","success",5e3),C()},onError:e=>{console.error("Error adding user:",e),d(`Error adding user: ${e.message}`,"error",8e3)}}),E=s({mutationFn:async({userId:e,userData:r})=>await i(`/api/auth/users/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",...w()},body:JSON.stringify(r),timeout:15e3,retries:1,retryDelay:1e3}),onSuccess:()=>{t(null),d("User updated successfully","success",5e3),C()},onError:e=>{console.error("Error updating user:",e),d(`Error updating user: ${e.message}`,"error",8e3)}}),I=s({mutationFn:async e=>await i(`/api/auth/users/${e}`,{method:"DELETE",headers:w(),timeout:15e3,retries:1,retryDelay:1e3}),onSuccess:()=>{t(null),d("User deleted successfully","success",5e3),C()},onError:e=>{console.error("Error deleting user:",e),d(`Error deleting user: ${e.message}`,"error",8e3)}}),j=s({mutationFn:async e=>await i(`/api/auth/users/${e}/api-key`,{method:"POST",headers:w(),timeout:2e4,retries:1,retryDelay:2e3}),onMutate:()=>{h("Generating...")},onSuccess:e=>{h(e.api_key),d("API key generated successfully","success"),setTimeout((()=>{C()}),100)},onError:e=>{console.error("Error generating API key:",e),h(""),d(`Error generating API key: ${e.message}`,"error")}}),F=l((e=>{e&&e.preventDefault(),console.log("Adding user:",b.username),P.mutate(b)}),[b]),L=l((e=>{e&&e.preventDefault(),console.log("Editing user:",c.id,c.username),E.mutate({userId:c.id,userData:b})}),[c,b]),S=l((()=>{console.log("Deleting user:",c.id,c.username),I.mutate(c.id)}),[c]),K=l((()=>{console.log("Generating API key for user:",c.id,c.username),j.mutate(c.id)}),[c]),T=l((()=>{navigator.clipboard.writeText(m).then((()=>{window.showSuccessToast?window.showSuccessToast("API key copied to clipboard"):d("API key copied to clipboard","success")})).catch((e=>{console.error("Error copying API key:",e),window.showErrorToast?window.showErrorToast("Failed to copy API key"):d("Failed to copy API key","error")}))}),[m]),_=l((e=>{u(e),g({username:e.username,password:"",email:e.email||"",role:e.role,is_active:e.is_active}),t("edit")}),[]),M=l((e=>{u(e),t("delete")}),[]),G=l((e=>{u(e),h(""),t("apiKey")}),[]),O=l((()=>{t(null)}),[]);return k&&0===A.length?a("div",{className:"flex justify-center items-center p-8",children:[a("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),a("span",{className:"sr-only",children:"Loading..."})]}):0!==A.length||k?a("div",{children:[a("div",{className:"mb-4 flex justify-between items-center",children:[a("h2",{className:"text-xl font-semibold",children:"User Management"}),a("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",onClick:U,children:"Add User"})]}),a(r,{users:A,onEdit:_,onDelete:M,onApiKey:G}),"add"===e&&a(p,{formData:b,handleInputChange:D,handleAddUser:F,onClose:O}),"edit"===e&&a(y,{currentUser:c,formData:b,handleInputChange:D,handleEditUser:L,onClose:O}),"delete"===e&&a(x,{currentUser:c,handleDeleteUser:S,onClose:O}),"apiKey"===e&&a(f,{currentUser:c,newApiKey:m,handleGenerateApiKey:K,copyApiKey:T,onClose:O})]}):a("div",{children:[a("div",{className:"mb-4 flex justify-between items-center",children:[a("h2",{className:"text-xl font-semibold",children:"User Management"}),a("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",onClick:U,children:"Add User"})]}),a("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-4",children:[a("h4",{className:"font-bold mb-2",children:"No Users Found"}),a("p",{children:'Click the "Add User" button to create your first user.'})]}),"add"===e&&a(p,{formData:b,handleInputChange:D,handleAddUser:F,onClose:O})]})}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("main-content");e&&c(a(h,{client:u,children:[a(b,{}),a(m,{}),a(w,{}),a(g,{})]}),e)}))}}}));
//# sourceMappingURL=users-legacy-BdYJfAWg.js.map
